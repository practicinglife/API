!function(){"use strict";function e(e,n,r){if(t())return Reflect.construct.apply(null,arguments);var i=[null];return i.push.apply(i,n),new(e.bind.apply(e,i))}function t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(t=function(){return!!e})()}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t,n,r,i,a,s){try{var o=e[a](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function o(e){i(s,r,a,o,l,"next",e)}function l(e){i(s,r,a,o,l,"throw",e)}o(void 0)}))}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n(i.key),i)}}function l(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach((function(t){c(e,t,n[t])}))}return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function f(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},p.apply(this,arguments)}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,s,o=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return o}}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var w="undefined"==typeof window?"node":"browser",_={get environment(){return w},base64:{encode:function(e){return"node"===w?new Buffer(e).toString("base64"):window.btoa(e)},decode:function(e){return"node"===w?new Buffer(e,"base64").toString("utf8"):window.atob(e)}},get URL(){return"browser"===w?window.URL:require("url").URL},get URLSearchParams(){return"browser"===w?window.URLSearchParams:require("url").URLSearchParams},get defaultHost(){return"browser"===w?window.location.origin:global.__DefaultMindTouchHost||""}};function k(e){if(!e.headers.has("location"))return!1;var t=e.status;return 301===t||302===t||303===t||307===t||308===t}function P(e){var t=this;return new Promise((function(n,r){var i=k(e);i&&t._followRedirects&&null!==t._cookieManager?n(e):!i||t._followRedirects?e.ok||304===e.status?n(e):e.text().then((function(t){r({message:e.statusText,status:e.status,responseText:t})})):n(e)}))}function S(e){return null!==this._cookieManager?this._cookieManager.getCookieString(e.url).then((function(t){""!==t&&e.headers.set("Cookie",t)})).then((function(){return e})):Promise.resolve(e)}function C(e){if(null!==this._cookieManager){var t=e.headers.get("Set-Cookie");return t=t?t.split(",").map((function(e){return e.trim()})):[],this._cookieManager.storeCookies(e.url,t).then((function(){return e}))}return Promise.resolve(e)}function T(e){var t=this,n=e.url,r=e.method,i=e.headers,a=e.body,s=void 0===a?null:a,o=new Headers(i),l=s,c={method:r,headers:o,credentials:"include",redirect:this._followRedirects&&null===this._cookieManager?"follow":"manual",keepalive:this._keepAlive};null!==s&&(c.body=l);var u=new Request(n,c);return S.call(this,u).then(this._fetch).then(P.bind(this)).then(C.bind(this)).then((function(e){return t._followRedirects&&k(e)?T.call(t,{url:e.headers.get("location"),method:307!==e.status&&308!==e.status?"GET":u.method,headers:o,body:l}):e}))}var E=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.uriParts,i=void 0===r?{}:r,a=n.headers,o=void 0===a?{}:a,l=n.timeout,c=void 0===l?null:l,u=n.beforeRequest,d=void 0===u?function(e){return e}:u,h=n.cookieManager,m=void 0===h?null:h,f=n.followRedirects,p=void 0===f||f,g=n.keepAlive,v=void 0!==g&&g,y=n.fetchImpl,b=void 0===y?fetch:y;if(s(this,e),!t)throw new Error("A full, valid URL must be specified");try{this._url=new _.URL(t)}catch(e){throw new Error("Unable to construct a URL object from ".concat(t))}"segments"in i&&function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=function e(t){return t.reduce((function(t,n){return Array.isArray(n)?t+=e(n):("/"===n[0]&&(n=n.slice(1)),t+="/".concat(n)),t}),"")}(n),a=e.pathname;"/"===a&&(a=""),e.pathname="".concat(a).concat(i)}(this._url,i.segments),"query"in i&&function(e,t){"q=+%2B"!==new _.URLSearchParams({q:" +"}).toString()?Object.keys(t).forEach((function(n){var r=t[n].toString().includes(" ")?t[n].split(" ").map(encodeURIComponent).join(" "):t[n];e.searchParams.append(n,r)})):Object.keys(t).forEach((function(n){e.searchParams.append(n,t[n])}))}(this._url,i.query),"excludeQuery"in i&&this._url.searchParams.delete(i.excludeQuery),this._beforeRequest=d,this._timeout=c,this._headers=Object.assign({},o),this._cookieManager=m,this._followRedirects=p,this._keepAlive=v,this._fetch=b}return l(e,[{key:"at",value:function(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){e.push(t.toString())})),new this.constructor(this._url.toString(),{headers:this._headers,timeout:this._timeout,beforeRequest:this._beforeRequest,uriParts:{segments:e},cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withParam",value:function(e,t){var n={};return n[e]=t,new this.constructor(this._url.toString(),{headers:this._headers,timeout:this._timeout,beforeRequest:this._beforeRequest,uriParts:{query:n},cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new this.constructor(this._url.toString(),{headers:this._headers,timeout:this._timeout,beforeRequest:this._beforeRequest,uriParts:{query:e},cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withoutParam",value:function(e){return new this.constructor(this._url.toString(),{headers:this._headers,timeout:this._timeout,beforeRequest:this._beforeRequest,uriParts:{excludeQuery:e},cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withHeader",value:function(e,t){var n=Object.assign({},this._headers);return n[e]=t,new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:n,cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withHeaders",value:function(e){var t=Object.assign({},this._headers);return Object.keys(e).forEach((function(n){t[n]=e[n]})),new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:t,cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withoutHeader",value:function(e){var t=Object.assign({},this._headers);return delete t[e],new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:t,cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withFollowRedirects",value:function(){return new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:this._headers,cookieManager:this._cookieManager,followRedirects:!0,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withoutFollowRedirects",value:function(){return new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:this._headers,cookieManager:this._cookieManager,followRedirects:!1,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withKeepAlive",value:function(){return new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:this._headers,cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:!0,fetchImpl:this._fetch})}},{key:"withoutKeepAlive",value:function(){return new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:this._headers,cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:!1,fetchImpl:this._fetch})}},{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET",t=this._beforeRequest({url:this._url.toString(),method:e,headers:Object.assign({},this._headers)});return T.call(this,t)}},{key:"post",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",r=Object.assign({},this._headers);t&&(r["Content-Type"]=t);var i=this._beforeRequest({url:this._url.toString(),method:n,body:e,headers:r});return T.call(this,i)}},{key:"put",value:function(e,t){return this.post(e,t,"PUT")}},{key:"head",value:function(){return this.get("HEAD")}},{key:"options",value:function(){return this.get("OPTIONS")}},{key:"delete",value:function(){return this.post(null,null,"DELETE")}},{key:"url",get:function(){return this._url.toString()}},{key:"headers",get:function(){return new Headers(this._headers)}},{key:"followingRedirects",get:function(){return this._followRedirects}}]),e}(),x=_.defaultHost,R=null,j={"dream.out.format":"json"},A={"X-Deki-Client":"mindtouch-martian"},I=null,N=null;function L(e){var t={};return Object.keys(e).forEach((function(n){t[n]=e[n]})),t}var D=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.host,r=void 0===n?x:n,i=t.queryParams,a=void 0===i?j:i,o=t.headers,l=void 0===o?A:o,c=t.token,u=void 0===c?I:c,d=t.origin,h=void 0===d?R:d,m=t.beforeRequest;s(this,e),this._host=r,this._token=u,this._origin=h,this._queryParams=L(a),this._headers=L(l),this._customBeforeRequest=m}return l(e,null,[{key:"cookieManager",get:function(){return N},set:function(e){N=e}},{key:"default",get:function(){return{get token(){return I},set token(e){I=e},get host(){return x},set host(e){x=e},get origin(){return R},set origin(e){R=e},get headers(){return A},set headers(e){A=e},get queryParams(){return j},set queryParams(e){j=e},reset:function(){x=_.defaultHost,j={"dream.out.format":"json"},I=null,A={"X-Deki-Client":"mindtouch-martian"},R=null}}}}]),l(e,[{key:"_beforeRequest",value:function(e){if(null!==this._token){var t=this._token;"function"==typeof t&&(t=this._token()),e.headers["X-Deki-Token"]=t}if("function"==typeof this._customBeforeRequest){var n=this._customBeforeRequest(e);n&&"object"===r(n)&&(e=n)}return e}},{key:"host",get:function(){return this._host}},{key:"token",get:function(){return this._token}},{key:"origin",get:function(){return this._origin}},{key:"plugConfig",get:function(){var e=this;return{uriParts:{query:this._queryParams},headers:this._headers,beforeRequest:function(t){return e._beforeRequest(t)},cookieManager:N}}}]),e}(),F={to:{boolean:function(e){return!0===e||"true"===e||"True"===e},date:function(e){var t=new Date(e);if(isNaN(t.getTime()))throw new Error("Failed converting to date");return t},apiDate:function(t){if(!/^\d{8}$|^\d{14}$/.test(t))throw new Error("Failed converting an API date: The raw value must be a string of digits and of length 8 or 14");var n=[t.slice(0,4),t.slice(4,6),t.slice(6,8),t.slice(8,10),t.slice(10,12),t.slice(12)].map((function(e){return parseInt(e,10)})).filter((function(e){return!isNaN(e)}));return n[1]--,e(Date,v(n))},number:function(e){if("number"==typeof e)return e;if("string"!=typeof e||""===e)return null;var t=Number(e);if(Number.isNaN(t))throw new Error("Failed converting to integer");return t}},isValid:function(e){return void 0!==e},forceArray:function(e){return F.isValid(e)&&""!==e?Array.isArray(e)?e:[e]:[]},getValue:function(e){if(e&&"object"===r(e)){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var a=n.shift();if(a in e){var s=1===n.length&&"#text"===n[0]&&"string"==typeof e[a];return 0===n.length||s?e[a]:F.getValue.apply(F,[e[a]].concat(n))}}},processModelAndData:function(e,t){var n=null,r=null;return e&&e.model?(n=e.preProcessor,r=e.model):r=e,"function"==typeof n&&(t=n(t)),[r,t]},transformValue:function(e,t){var n=e;if("string"==typeof t)n=F.to[t](e);else if(Array.isArray(t)||t.model){var r=g(F.processModelAndData(t,e),2),i=r[0],a=r[1];n=F.createParser(i)(a)}else{if("function"!=typeof t)throw new Error("Invalid value used for the transform parameter while trying to convert ".concat(e));n=t(e)}return n},parseProperty:function(e,t,n){var i=n.field,a=n.name,s=n.isArray,o=n.transform,l=n.constructTransform;if(!e||"object"!==r(e))throw new TypeError("Cannot parse a non-object");if(void 0===i)throw new TypeError("The 'field' property must be included in every model entry");var c=F.forceArray(i),u=F.getValue.apply(F,[e].concat(v(c)));if(l&&"function"==typeof l){o=l(u);var d=g(F.processModelAndData(o,u),2);o=d[0],u=d[1]}if(s&&(u=F.forceArray(u)),(o&&F.isValid(u)||"function"==typeof o)&&(u=s?u.map((function(e){return F.transformValue(e,o)})):F.transformValue(u,o)),(a=a||c[0])in t)throw new Error('Duplicate "'.concat(a,'" in parsing model'));F.isValid(u)&&(t[a]=u)},createParser:function(e){return function(t){""===t&&(t={});var n=g(F.processModelAndData(e,t),2),r=n[0],i=n[1],a={};return r.forEach((function(e){return F.parseProperty(i,a,e)})),a}}},q=[{field:"context",name:"contextIds",isArray:!0}],M={preProcessor:function(e){return e.context?e.context:e},model:[{field:"description"},{field:"id"}]},O=[{field:"@date",name:"date",transform:"date"},{field:"@count",name:"count",transform:"number"},{field:"@seated.count",name:"seatedCount",transform:"number"},{field:"@unseated.count",name:"unseatedCount",transform:"number"},{field:"@anonymous.count",name:"anonymousCount",transform:"number"},{field:"@score",name:"score",transform:"number"},{field:"@seated.score",name:"seatedScore",transform:"number"},{field:"@unseated.score",name:"unseatedScore",transform:"number"},{field:"@anonymous.score",name:"anonymousScore",transform:"number"},{field:"@score.trend",name:"scoreTrend",transform:"number"},{field:"@seated.score.trend",name:"seatedScoreTrend",transform:"number"},{field:"@unseated.score.trend",name:"unseatedScoreTrend",transform:"number"},{field:"user.ratedby",name:"userRatedBy",transform:[{field:"@id",name:"id",transform:"number"},{field:"@score",name:"score",transform:"number"},{field:"@date",name:"date",transform:"date"},{field:"@href",name:"href"},{field:"@seated",name:"seated",transform:"boolean"}]}],z=[{field:["operations","#text"],transform:function(e){var t=[];return"string"==typeof e&&(t=e.split(",")),t}},{field:"role",transform:function(e){var t={};return"string"==typeof e?t.name=e:e&&"object"===r(e)&&("#text"in e&&(t.name=e["#text"]),"@id"in e&&(t.id=parseInt(e["@id"],10)),"@href"in e&&(t.href=e["@href"])),t}},{field:"restriction",transform:[{field:"@id",name:"id",transform:"number"},{field:"#text",name:"name"}]}],U=[{field:"@id",name:"id",transform:"number"},{field:"@href",name:"href"},{field:"groupname",name:"groupName"},{field:"permissions.group",name:"groupPermissions",transform:z},{field:"users",transform:[{field:"@count",name:"count"},{field:"@href",name:"href"}]}],B=[{field:"@id",name:"id",transform:"number"},{field:"@anonymous",name:"anonymous",transform:"boolean"},{field:"@wikiid",name:"wikiId"},{field:"@href",name:"href"},{field:"date.created",name:"dateCreated",transform:"date"},{field:"date.lastlogin",name:"lastLoginDate",transform:"date"},{field:"email"},{field:"fullname"},{field:"externalname",name:"externalname"},{field:["license.seat","#text"],name:"seated",transform:"boolean"},{field:["license.seat","@owner"],name:"siteOwner",transform:"boolean"},{field:"nick"},{field:["password","@exists"],name:"passwordExists",transform:"boolean"},{field:"status"},{field:"username"},{field:"permissions.user",name:"userPermissions",transform:z},{field:["groups","group"],name:"groups",isArray:!0,transform:U}],H=[{field:"@id",name:"id",transform:"number"},{field:"title"},{field:"@guid",name:"guid"},{field:"uri.ui",name:"uri"},{field:"@href",name:"href"},{field:"@state",name:"state"},{field:"@draft.state",name:"draftState"},{field:"article"},{field:"language"},{field:"namespace"},{field:"language.effective",name:"languageEffective"},{field:"timeuuid"},{field:["path","#text"]},{field:["path","@type"],name:"pathType"},{field:["path","@seo"],name:"pathSeo",transform:"boolean"},{field:"restriction"},{field:"@revision",name:"revision",transform:"number"},{field:"path.original",name:"originalPath",transform:function(e){if(e)return decodeURIComponent(e)}},{field:"@deleted",name:"deleted",transform:"boolean"},{field:"@publish",name:"publish",transform:"boolean"},{field:"@unpublish",name:"unpublish",transform:"boolean"},{field:"@deactivate",name:"deactivate",transform:"boolean"},{field:"@virtual",name:"virtual",transform:"boolean"},{field:"@subpages",name:"hasSubpages",transform:"boolean"},{field:"@files",name:"files",transform:"number"},{field:"@terminal",name:"terminal",transform:"boolean"},{field:"overview"},{field:"user.author",name:"userAuthor",transform:B},{field:"date.created",name:"dateCreated",transform:"date"},{field:"date.modified",name:"dateModified",transform:"date"},{field:"date.edited",name:"dateEdited",transform:"date"},{field:["revisions","@count"],name:"revisionCount",transform:"number"},{field:["comments","@count"],name:"commentCount",transform:"number"},{field:["permissions","permissions.page"],name:"permissions",transform:z},{field:["security","permissions.effective"],name:"effectivePermissions",transform:z},{field:["security","permissions.page"],name:"pageRestriction",transform:z},{field:"rating",constructTransform:function(e){if("object"===r(e)&&null!==e)return O}},{field:"metrics",transform:[{field:"metric.charcount",name:"charCount",transform:"number"},{field:"metric.views",name:"views",transform:"number"}]},{field:["tags","tag"],isArray:!0,transform:[{field:"@href",name:"href"},{field:"@id",name:"id",transform:"number"},{field:"@value",name:"value"},{field:"title"},{field:"type"},{field:"uri"}]}];H.push({field:"page.parent",name:"pageParent",transform:H}),H.push({field:"draft",transform:H});var V=[{field:"@default",name:"default",transform:"boolean"},{field:"@exists",name:"exists",transform:"boolean"},{field:"description"},{field:"id"},{field:"language"},{field:"page",transform:H},{field:["pageid","#text"],transform:"number"}],W=[{field:"contextmap",name:"contextMaps",isArray:!0,transform:V},{field:["languages","language"],isArray:!0}],K={preProcessor:function(e){if("responseText"in e){try{e.errorInfo=JSON.parse(e.responseText)}catch(t){e.errorText=e.responseText}delete e.responseText}return e},model:[{field:"status"},{field:"message"},{field:"errorInfo",name:"info",transform:[{field:["arguments","argument"],name:"arguments",isArray:!0},{field:"exception"},{field:"message"},{field:"resource"},{field:"data"}]},{field:"errorText"}]},G=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;if(s(this,e),!t)throw new Error("an ID must be supplied to create a new ContextDefinition");this.id=t,this.plug=new E(n.host,n.plugConfig).at("@api","deki","contexts",t)}return l(e,[{key:"getInfo",value:function(){return this.plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(M))}},{key:"updateDescription",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="<context><id>".concat(this.id,"</id><description>").concat(e,"</description></context>");return this.plug.put(t,"application/xml; charset=utf-8").catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(M))}},{key:"delete",value:function(){return this.plug.delete().catch((function(e){return Promise.reject(e)}))}}]),e}(),Q=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new D;if(s(this,e),!n||!t)throw new Error("an ID and language must be supplied to create a new ContextMap");this.id=n,this.language=t,this.plug=new E(r.host,r.plugConfig).at("@api","deki","contextmaps",t,n).withParam("verbose","true")}return l(e,[{key:"getInfo",value:function(){return this.plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(V))}},{key:"update",value:function(e){if(!e)return Promise.reject(new Error("a page ID must be supplied in order to update a mapping"));var t="<contextmap><id>".concat(this.id,"</id><pageid>").concat(e,"</pageid><language>").concat(this.language,"</language></contextmap>");return this.plug.put(t,"application/xml; charset=utf-8").catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(V))}},{key:"remove",value:function(){return this.plug.delete().catch((function(e){return Promise.reject(e)}))}}]),e}(),J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this.mapsPlug=new E(t.host,t.plugConfig).at("@api","deki","contextmaps").withParam("verbose","true"),this.definitionsPlug=new E(t.host,t.plugConfig).at("@api","deki","contexts"),this._settings=t,this._errorParser=F.createParser(K)}return l(e,[{key:"getMaps",value:function(){return this.mapsPlug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(W))}},{key:"getMapsByPageId",value:function(e){return this.mapsPlug.at("query").withParam("pageid",e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(W))}},{key:"getDefinitions",value:function(){return this.definitionsPlug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then((function(e){return""===e&&(e={context:[]}),e})).then(F.createParser(q))}},{key:"addDefinition",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)return Promise.reject(new Error("an ID must be supplied to add a definition"));var r="<contexts><context><id>".concat(e,"</id><description>").concat(n,"</description></context></contexts>");return this.definitionsPlug.post(r,"application/xml; charset=utf-8").catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.json()})).then(F.createParser(M))}},{key:"getDefinition",value:function(e){return new G(e,this._settings)}},{key:"getMap",value:function(e,t){return new Q(e,t,this._settings)}}]),e}(),Y=Object.freeze({__proto__:null,ContextDefinition:G,ContextIdManager:J,ContextMap:Q}),X={"<":"lt",">":"gt",'"':"quot","&":"amp","'":"#39"},Z=new RegExp("".concat(Object.keys(X).reduce((function(e,t){return"".concat(e).concat(t)}),"["),"]"),"g"),ee="application/xml; charset=utf-8",te="text/plain; charset=utf-8",ne="application/json; charset=utf-8",re=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(Z,(function(e){return"&"+X[e]+";"}))},ie=function(e){var t=e.toString();return["\\","+","-","&","|","!","(",")","{","}","[","]","^",'"',"~","*","?",":"].forEach((function(e){var n=new RegExp("\\"+e,"g");t=t.replace(n,"\\"+e)})),t},ae=function(e,t){if(!e&&!t)throw new Error("Unable to resolve the input ID to an API resource ID");var n=t;return"string"==typeof e&&e!==t?n="=".concat(encodeURIComponent(encodeURIComponent(e))):e&&(n=e),n},se=function(e){var t=null;if("string"==typeof e)if(e.includes(":")){var n=parseInt(e.split(":",1),10);if(!Number.isNaN(n))return e;t="=".concat(encodeURIComponent(e))}else t="=".concat(encodeURIComponent(encodeURIComponent(e)));else{if("number"!=typeof e)throw new Error("The user activity token must be a string or number");t=e}return t},oe=function(e){var t={year:e.getFullYear(),month:"0".concat(e.getMonth()+1).slice(-2),day:"0".concat(e.getDate()).slice(-2),hours:"0".concat(e.getHours()).slice(-2),minutes:"0".concat(e.getMinutes()).slice(-2),seconds:"0".concat(e.getSeconds()).slice(-2)};return"".concat(t.year).concat(t.month).concat(t.day).concat(t.hours).concat(t.minutes).concat(t.seconds)},le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&""!==e[t]||delete e[t]})),e},ce=[{field:"@id",name:"id",transform:"number"},{field:"@type",name:"type"},{field:"@date",name:"date",transform:"date"},{field:"host"},{field:"key"},{field:"name"},{field:"secret"}],ue=[{field:"@count",name:"count",transform:"number"},{field:"developer-token",name:"developerTokens",isArray:!0,transform:ce}],de=F.createParser(K),he=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._plug=new E(t.host,t.plugConfig).at("@api","deki","site","developer-tokens")}return l(e,[{key:"getTokens",value:function(){return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(ue))}},{key:"addToken",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=e.host,r=e.type,i=void 0===r?"server":r;if(!t)return Promise.reject(new Error("The name must be supplied when adding a new developer token"));var a='<developer-token type="'.concat(i,'"><name>').concat(t,"</name>");return n&&(a+="<host>".concat(n,"</host>")),a+="</developer-token>",this._plug.post(a,ee).catch((function(e){return Promise.reject(de(e))})).then((function(e){return e.json()})).then(F.createParser(ce))}}]),e}(),me=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;if(s(this,e),!t)throw new Error("The id must be supplied to create a new DeveloperToken instance");this._plug=new E(n.host,n.plugConfig).at("@api","deki","site","developer-tokens",t)}return l(e,[{key:"delete",value:function(){return this._plug.delete().catch((function(e){return Promise.reject(de(e))}))}}]),e}(),fe=Object.freeze({__proto__:null,DeveloperToken:me,DeveloperTokenManager:he});function pe(e){var t=e.xhr,n=e.body,r=e.progressInfo;return new Promise((function(e,i){t.onreadystatechange=function(){4===t.readyState&&(t.status>=200&&t.status<=300?(r.callback({loaded:r.size,total:r.size}),e(t)):i({message:t.statusText,status:t.status,responseText:t.responseText}))},t.onerror=function(){i(new Error("An error occurred while initiating the file upload"))},t.send(n)}))}function ge(e){return null!==this._cookieManager?this._cookieManager.getCookieString(this.url).then((function(t){""!==t&&e.xhr.setRequestHeader("Cookie",t)})).then((function(){return e})):Promise.resolve(e)}function ve(e){return null!==this._cookieManager?this._cookieManager.storeCookies(this.url,e.getResponseHeader("Set-Cookie")).then((function(){return e})):Promise.resolve(e)}function ye(e){var t=e.method,n=e.headers,r=e.body,i=void 0===r?null:r,a=e.progressInfo,s=new XMLHttpRequest;s.open(t,this.url,!0),s.withCredentials=!0,s.upload.onprogress=function(e){a.callback({loaded:e.loaded,total:a.size})};for(var o=Object.entries(n),l=0;l<o.length;l++){var c=g(o[l],2),u=c[0],d=c[1];s.setRequestHeader(u,d)}var h={xhr:s,body:i,progressInfo:a};return a.callback({loaded:0,total:a.size}),ge.call(this,h).then(pe).then(ve.bind(this))}var be=function(e){function t(e,n){return s(this,t),f(this,h(t).call(this,e,n))}return d(t,e),l(t,[{key:"post",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:0,callback:function(){}};t&&(this._headers["Content-Type"]=t);var i=this._beforeRequest({method:n,body:e,headers:Object.assign({},this._headers)});return i.progressInfo=r,ye.call(this,i)}},{key:"put",value:function(e,t,n){return this.post(e,t,"PUT",n)}}]),t}(E),we=[{field:"@totalcount",name:"totalCount",transform:"number"},{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"page.subpage",name:"subpages",isArray:!0,transform:H}],_e=[{field:"@id",name:"id",transform:"number"},{field:"@revision",name:"revision",transform:"number"},{field:"@res-id",name:"resId",transform:"number"},{field:"@href",name:"href"},{field:"@res-is-head",name:"resIsHead",transform:"boolean"},{field:"@res-is-deleted",name:"resIsDeleted",transform:"boolean"},{field:"@res-rev-is-head",name:"resRevIsHead",transform:"boolean"},{field:"@res-contents-id",name:"resContentsId",transform:"number"},{field:"date.created",name:"dateCreated",transform:"date"},{field:"date.last-modified",name:"lastModified",transform:"date"},{field:"description"},{field:"alt-text",name:"altText"},{field:"filename"},{field:"location"},{field:"contents",transform:[{field:"@type",name:"type"},{field:"@size",name:"size",transform:"number"},{field:"@href",name:"href"},{field:"@height",name:"height",transform:"number"},{field:"@width",name:"width",transform:"number"}]},{field:"revisions",transform:[{field:"@count",name:"count",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"}]},{field:"user.createdby",name:"userCreatedBy",transform:B},{field:"page.parent",name:"pageParent",transform:H},{field:"properties",transform:[{field:"property",name:"property",isArray:!0,transform:[{field:"@name",name:"name"}]}]}],ke=[{field:"@count",name:"count",transform:"number"},{field:"@offset",name:"offset",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"},{field:"@href",name:"href"},{field:"file",name:"files",isArray:!0,transform:_e}],Pe=[{field:"@id",name:"id",transform:"number"},{field:"@guid",name:"guid"},{field:"@draft.state",name:"draftState"},{field:"@href",name:"href"},{field:"@deleted",name:"deleted",transform:"boolean"},{field:"date.created",name:"dateCreated",transform:"date"},{field:"language"},{field:["path","#text"]},{field:"title"},{field:"uri.ui",name:"uri"},{field:"files",name:"filesInfo",transform:ke},{field:"subpages",name:"subpagesInfo",transform:we}],Se=[{field:"@revision",name:"revision"},{field:"@name",name:"name"},{field:"@href",name:"href"},{field:"date.modified",name:"dateModified",transform:"date"},{field:"contents",transform:[{field:"#text",name:"text"},{field:"@href",name:"href"},{field:"@type",name:"type"},{field:"@size",name:"size"}]}],Ce={preProcessor:function(e){if(e.page)return e.page},model:[{field:"@id",name:"id",transform:"number"},{field:"@guid",name:"guid"},{field:"@draft.state",name:"draftState"},{field:"@href",name:"href"},{field:"@deleted",name:"deleted",transform:"boolean"},{field:"date.created",name:"dateCreated",transform:"date"},{field:"namespace",name:"namespace"},{field:["path","#text"],name:"path"},{field:"title",name:"title"},{field:"uri.ui",name:"uri"}]};Ce.model.push({field:"subpages",isArray:!0,constructTransform:function(e){if(e.page)return Ce}}),Ce.model.push({field:"properties",isArray:!0,constructTransform:function(e){if(e)return{preProcessor:function(e){if(e.property)return e.property},model:Se}}});var Te=[{field:"@type",name:"type"},{field:"@title",name:"title"},{field:"@unsafe",name:"unsafe",transform:"boolean"},{field:"@draft",name:"draft",transform:"boolean"},{field:"head"},{field:"tail"},{field:"body",transform:function(e){return Array.isArray(e)?e[0]:e}},{field:"body",name:"targets",transform:function(e){var t=[];if(Array.isArray(e))for(var n=1;n<e.length;n++)t.push(c({},e[n]["@target"],e[n]["#text"]));return t}}],Ee=[{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"tag",name:"tags",isArray:!0,transform:[{field:"@id",name:"id",transform:"number"},{field:"@value",name:"value"},{field:"@href",name:"href"},{field:"title"},{field:"type"},{field:"uri"}]}],xe=[{field:"@status",name:"status"},{field:"page",transform:H},{field:"draft",transform:H},{field:"page.base",name:"pageBase",transform:H},{field:"page.overwritten",name:"pageOverwritten",transform:H}],Re=[{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"page",name:"pages",isArray:!0,transform:H}],je=[{field:"#text",name:"text"},{field:"@needsmigration",name:"needsMigration",transform:"boolean"}],Ae=[{field:"@type",name:"type"},{field:"#text",name:"combinedText"},{field:"combined"},{field:"before"},{field:"after"}],Ie=[{field:"tag",name:"tags",isArray:!0,transform:[{field:"@value",name:"tag"}]}],Ne=[{field:"@count",name:"count",transform:"number"},{field:"page",name:"pages",isArray:!0,transform:H}],Le=[{field:"@count",name:"count",transform:"number"},{field:"page",name:"pages",isArray:!0,transform:H}],De=[{field:"pagecount",name:"pageCount",transform:"number"},{field:"attachmentcount",name:"attachmentCount",transform:"number"}],Fe=[{field:"@count",name:"count",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"},{field:"page",name:"pages",isArray:!0,transform:H}],qe=F.createParser(K);function Me(e){if(404===e.status&&e.responseText){var t=JSON.parse(e.responseText);if("true"===t["@virtual"]){var n=F.createParser(H);return Promise.resolve(n(t))}}throw e}var Oe=function(){function e(t){if(s(this,e),"PageBase"===this.constructor.name)throw new TypeError("PageBase must not be constructed directly.  Use one of Page() or Draft()");this._id=ae(t,"home")}var t;return l(e,[{key:"getInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={exclude:"revision"};Object.keys(e).forEach((function(n){t[n]=e[n]}));var n=F.createParser(H);return this._plug.at("info").withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(n)}},{key:"getFullInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=F.createParser(H);return this._plug.withParams(e).get().then((function(e){return e.json()})).then(t).catch(Me)}},{key:"getContents",value:function(e){var t=F.createParser(Te);return this._plug.at("contents").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"setContents",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)return Promise.reject(new Error("Contents should be string."));var n={edittime:"now"};Object.keys(t).forEach((function(e){n[e]=t[e]}));var r=F.createParser(xe);return this._plug.at("contents").withParams(n).post(e,te).catch((function(e){return Promise.reject(qe(e))})).then((function(e){return e.json()})).then(r)}},{key:"getTableOfContents",value:(t=a(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getContents(t);case 3:n=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",null);case 9:return r=null,n.targets&&(i=n.targets.find((function(e){return null!==e.toc})))&&"<em>No headers</em>"!==i.toc&&(r=i.toc),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return t.apply(this,arguments)})},{key:"getSubpages",value:function(e){return this._plug.at("subpages").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(we))}},{key:"getFilesAndSubpages",value:function(){return this._plug.at("files,subpages").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Pe))}},{key:"getFiles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=F.createParser(ke);return this._plug.at("files").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"attachFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.name,r=void 0===n?e.name:n,i=t.size,a=void 0===i?e.size:i,s=t.type,o=void 0===s?e.type:s,l=t.progress,c=void 0===l?null:l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==c){var d={callback:c,size:a};return new be(this._plug.url,this._settings.plugConfig).withParams(u).at("files",encodeURIComponent(encodeURIComponent(r))).put(e,o,d).catch((function(e){return Promise.reject(e)})).then((function(e){return JSON.parse(e.responseText)})).then(F.createParser(_e))}return this._plug.withParams(u).withHeader("Content-Length",a).at("files",encodeURIComponent(r)).put(e,o).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()}))}},{key:"getHierarchyInfo",value:function(){return this._plug.at("hierarchyinfo").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(De))}},{key:"getTree",value:function(e){return this._plug.at("tree").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ce))}},{key:"getTreeIds",value:function(){return this._plug.at("tree").withParam("format","ids").get().catch((function(e){return Promise.reject(new Error(e.message))})).then((function(e){return e.text()})).then((function(e){return e.split(",").map((function(e){var t=parseInt(e,10);if(isNaN(t))throw new Error("Unable to parse the tree IDs.");return t}))}))}},{key:"getOverview",value:function(){return this._plug.at("overview").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(je))}},{key:"setOverview",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!("body"in e))return Promise.reject(new Error("No overview body was supplied"));var t="<overview>".concat(re(e.body),"</overview>");return this._plug.at("overview").put(t,ee).catch((function(e){return Promise.reject(e)}))}},{key:"getTags",value:function(){var e=F.createParser(Ee);return this._plug.at("tags").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(e)}},{key:"setTags",value:function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=function(e){var t="";return Array.isArray(e)&&e.forEach((function(e){t="".concat(t,'<tag value="').concat(re(e),'" />')})),t="<tags>".concat(t,"</tags>")}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),n=F.createParser(Ee);return this._plug.at("tags").withParams(e).put(t,"application/xml").catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(n)}},{key:"getRecommendedTags",value:function(){return this._plug.at("tags","recommended").get().catch((function(e){return Promise.reject(qe(e))})).then((function(e){return e.json()})).then(F.createParser(Ie))}},{key:"getDiff",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.previous,n=e.revision,r=void 0===n?"head":n,i=e.includeVersions,a=void 0!==i&&i,s=e.format,o=void 0===s?"html":s;return t?"string"!=typeof t&&"number"!=typeof t?Promise.reject(new Error("The `previous` parameter must be a number or a string.")):"string"!=typeof r&&"number"!=typeof r?Promise.reject(new Error("The revision parameter must be a number or a string.")):"boolean"!=typeof a?Promise.reject(new Error("The `includeVersions` parameter must be a Boolean value.")):"html"!==o&&"xhtml"!==o?Promise.reject(new Error('The `format` parameter must be a string equal to "html" or "xhtml".')):this._plug.at("diff").withParams({previous:t,revision:r,diff:a?"all":"combined",format:o}).get().catch((function(e){return Promise.reject(qe(e))})).then((function(e){return e.json()})).then(F.createParser(Ae)):Promise.reject(new Error("The `previous` parameter must be supplied."))}},{key:"getRelated",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._plug.at("related").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Re))}},{key:"copy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.to?this._plug.at("copy").withParams(e).post(null,te).catch((function(e){return Promise.reject(qe(e))})).then((function(e){return e.json()})).then(F.createParser(Ne)):Promise.reject(new Error("The copy target location must be specified in the `to` parameter."))}},{key:"move",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._plug.at("move").withParams(e).post(null,te).catch((function(e){return Promise.reject(qe(e))})).then((function(e){return e.json()})).then(F.createParser(Ne))}},{key:"delete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=F.createParser(Le);return this._plug.withParam("recursive",e).delete().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"setOrder",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"number"!=typeof e?Promise.reject(new Error("The afterId must be a numeric page ID.")):this._plug.at("order").withParam("afterId",e).put().catch((function(e){return Promise.reject(e)}))}},{key:"find",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1,n={};if(e.tags){if(!Array.isArray(e.tags))return Promise.reject(new Error("The `tags` parameter must be an Array."));e.tags.length>0&&(n.tags=e.tags.join(","),t=!0)}if(e.missingClassifications){if(!Array.isArray(e.missingClassifications))return Promise.reject(new Error("The `missingClassifications` parameter must be an Array."));e.missingClassifications.length>0&&(n.missingclassifications=e.missingClassifications.join(","),t=!0)}if(e.since){if(!(e.since instanceof Date))return Promise.reject(new Error("The `since` parameter must be of type Date."));n.since=oe(e.since),t=!0}if(e.upTo){if(!(e.upTo instanceof Date))return Promise.reject(new Error("The `upTo` parameter must be of type Date."));n.upto=oe(e.upTo),t=!0}return!1===t?Promise.reject(new Error("At least one constraint must be supplied to find pages.")):this._plug.at("find").withParams(n).get().catch((function(e){return Promise.reject(qe(e))})).then((function(e){return e.json()})).then(F.createParser(Fe))}},{key:"revert",value:function(e){if(!e)return Promise.reject(new Error("The revert options must be specified."));if("string"!=typeof e.fromRevision&&"number"!=typeof e.fromRevision)return Promise.reject(new Error("The fromRevision parameter must be specified, and must be a string or a number."));var t={fromrevision:e.fromRevision};if(e.abort){if("string"!=typeof e.abort||"never"!==e.abort&&"conflict"!==e.abort)return Promise.reject(new Error('The `abort` parameter must be set to "conflict" or "never".'));t.abort=e.abort}return"verbose"in e&&!0!==e.verbose&&!1!==e.verbose?Promise.reject(new Error("The `verbose` parameter must be a Boolean value.")):(t.allow=e.allow,t.abort=e.abort,this._plug.at("revert").withParams(t).post(null,te).catch((function(e){return Promise.reject(e)})))}}]),e}(),ze=F.createParser(K),Ue=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;return s(this,t),(e=f(this,h(t).call(this,n)))._settings=r,e._plug=new E(r.host,r.plugConfig).at("@api","deki","drafts",e._id),e}return d(t,e),l(t,[{key:"deactivate",value:function(){var e=F.createParser(H);return this._plug.at("deactivate").post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(e)}},{key:"publish",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._plug.at("publish").withParams(e).post().catch((function(e){return Promise.reject(e)}))}},{key:"unpublish",value:function(){return this._plug.at("unpublish").post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(H))}},{key:"setTitle",value:function(e){return e?this._plug.at("title").put(e,te).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(H)):Promise.reject(new Error("A valid title must be supplied for the draft."))}}]),t}(Oe),Be=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._settings=t,this._plug=new E(this._settings.host,this._settings.plugConfig).at("@api","deki","drafts")}return l(e,[{key:"createDraft",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};if("redirect"in t){if("number"!=typeof t.redirect)return Promise.reject(new Error("The redirect option must be a number."));n.redirect=t.redirect}if("deleteRedirects"in t){if("boolean"!=typeof t.deleteRedirects)return Promise.reject(new Error("The deleteredirects option must be a boolean."));n.deleteRedirects=t.deleteRedirects}return this._plug.at(ae(e),"create").withParams(n).post().catch((function(e){return Promise.reject(ze(e))})).then((function(e){return e.json()})).then(F.createParser(H))}},{key:"getDrafts",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};if(e.parentId&&(t.parentid=ae(e.parentId,"home")),e.tags){if(!Array.isArray(e.tags))return Promise.reject(new Error("The `tags` parameter must be an array."));t.tags=e.tags.join(",")}if("limit"in e){if("number"!=typeof e.limit)return Promise.reject(new Error("The `limit` parameter must be an number."));t.limit=e.limit}if(e.include){if(!Array.isArray(e.include))return Promise.reject(new Error("The `include` parameter must be an array."));t.include=e.include.join(",")}return this._plug.withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser([{field:["pages","page"],name:"pages",isArray:!0,transform:H}]))}},{key:"getDraft",value:function(e){return new Ue(e,this._settings)}}]),e}(),He=Object.freeze({__proto__:null,Draft:Ue,DraftManager:Be});function Ve(e){var t=new Date(e),n=t.getDate();return n!=n?e:t}var We=[{field:"@id",name:"id",transform:"number"},{field:"@timestamp",transform:"date"},{field:"name"},{field:"title"}],$e=[{field:"@cascading",name:"cascading",transform:"boolean"},{field:"@datetime",name:"datetime",transform:"date"},{field:"@id",name:"id"},{field:"@journaled",name:"journaled",transform:"boolean"},{field:"@language",name:"language"},{field:"change-comment",name:"changeComment"},{field:"previous.restriction-id",name:"previousRestrictionId",transform:"number"},{field:"restriction-id",name:"restrictionId",transform:"number"},{field:"root.page",name:"rootPage",transform:H},{field:"@type",name:"type"},{field:"@version",name:"version",transform:"number"},{field:"to",transform:Ve},{field:"from",transform:Ve},{field:"afternode.page",name:"afternodePage",transform:H},{field:"displayname.current",name:"currentDisplayName"},{field:"displayname.previous",name:"previousDisplayName"},{field:"create-reason",name:"createReason"},{field:"source.page",name:"sourcePage",transform:H},{field:"page",transform:H},{field:"user",transform:B},{field:"file",transform:_e},{field:"source.file",name:"sourceFile",transform:_e},{field:"@move-source",name:"moveSource",transform:"boolean"},{field:"data",transform:[{field:"constraint"},{field:"path"},{field:"query"},{field:"limit",transform:"number"},{field:"qid",transform:"number"},{field:"totalrecommended",name:"totalRecommended",transform:"number"},{field:"totalresults",name:"totalResults",transform:"number"},{field:"_uri.host",name:"host"},{field:"_uri.query",name:"uriQuery"},{field:"_uri.scheme",name:"scheme"}]},{field:"diff",transform:[{field:"@toolarge",name:"tooLarge",transform:"boolean"},{field:"added",transform:"number"},{field:"attributes",transform:"number"},{field:"removed",transform:"number"},{field:"structural",transform:"number"},{field:"categorychanged",transform:"boolean"},{field:"pagesadded",transform:"number"},{field:"pagesremoved",transform:"number"},{field:"pagesreordered",transform:"boolean"},{field:"summarychanged",transform:"boolean"},{field:"titlechanged",transform:"boolean"}]},{field:"grant",transform:[{field:"group",transform:U},{field:"id",transform:"number"},{field:"role",transform:[{field:"@id",name:"id",transform:"number"}]},{field:"type"},{field:"user",transform:B}]},{field:"property",transform:[{field:"name"}]},{field:"request",transform:[{field:"@count",name:"count",transform:"number"},{field:"@id",name:"id"},{field:"@seq",name:"seq",transform:"number"},{field:"ip"},{field:"session-id",name:"sessionId"},{field:"signature"},{field:"user",transform:B}]},{field:["tags-added","tag"],name:"tagsAdded",isArray:!0,transform:[{field:"name"}]},{field:["tags-removed","tag"],name:"tagsRemoved",isArray:!0,transform:[{field:"name"}]},{field:"learningpath",name:"learningPath",transform:We},{field:"root.learningpath",name:"learningPathRoot",transform:We}],Ke=[{field:"@count",name:"count",transform:"number"},{field:"@upto",name:"upTo"},{field:"@since",name:"since"},{field:"event",name:"events",isArray:!0,transform:$e}],Ge=[{field:"@count",name:"count",transform:"number"},{field:"@upto",name:"upTo"},{field:"@since",name:"since"},{field:"summary",isArray:!0,transform:[{field:"@id",name:"id"},{field:"@datetime",name:"datetime",transform:"date"},{field:"@count",name:"count",transform:"number"},{field:"@detailid",name:"detailId"},{field:"@journaled",name:"journaled",transform:"boolean"},{field:"@diffable",name:"diffable",transform:"boolean"},{field:"@uri.detail",name:"detailUri"},{field:"@uri.hierarchy",name:"hierarchyUri"},{field:"event",transform:$e},{field:"page",transform:[{field:"@id",name:"id",transform:"number"},{field:"path"}]},{field:["users","user"],name:"users",isArray:!0,transform:B}]}],Qe=[{field:"@count",name:"count",transform:"number"},{field:"event",name:"events",isArray:!0,transform:$e}],Je=[{field:"log",name:"logs",isArray:!0,transform:[{field:"@complete",name:"complete",transform:"boolean"},{field:"modified",transform:"date"},{field:"month"},{field:"name"}]}],Ye=[{field:"url"}],Xe=[{field:"id"}],Ze=F.createParser(K),et=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._plug=new E(t.host,t.plugConfig).at("@api","deki","events")}return l(e,[{key:"getSiteDraftsHistoryLogs",value:function(){return this._plug.at("draft-hierarchy","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Je))}},{key:"getSiteDraftsHistoryLogUrl",value:function(e){return e?this._plug.at("draft-hierarchy","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ye)):Promise.reject(new Error("Attempting to get log url without required name"))}},{key:"getSiteDraftsHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};if(e.limit){if("number"!=typeof e.limit)return Promise.reject(new Error("The `limit` parameter must be a number less than or equal to 1000."));t.limit=e.limit}if(e.include){if(!Array.isArray(e.include))return Promise.reject(new Error("The `include` parameter must be an array."));t.include=e.include.join(",")}if(e.upTo){if("string"!=typeof e.upTo)return Promise.reject(new Error("The `upTo` parameter must be a string."));t.upto=e.upTo}return this._plug.at("draft-hierarchy",ae(e.pageId,"home")).withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ge))}},{key:"getSiteDraftsHistoryDetail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||"string"!=typeof e)return Promise.reject(new Error("The detail ID must be specified, and it must be a string."));var n={};if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` option must be an array"));n.include=t.include.join(",")}return this._plug.at("draft-hierarchy","details",e).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ge))}},{key:"getDraftHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};if(t.limit){if("number"!=typeof t.limit)return Promise.reject(new Error("The `limit` parameter must be a number."));n.limit=t.limit}if(t.upTo){if("string"!=typeof t.upTo)return Promise.reject(new Error("The `upTo` parameter must be a string."));n.upto=t.upTo}if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` parameter must be an array."));n.include=t.include.join(",")}return this._plug.at("draft",ae(e,"home")).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ge))}},{key:"getDraftHistoryDetail",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return Promise.reject(new Error("The page ID is required to fetch a draft history detail."));if(!t)return Promise.reject(new Error("The detail ID is required to fetch a draft history detail."));var r={};if(n.include){if(!Array.isArray(n.include))return Promise.reject(new Error("The `include` parameter must be an array."));r.include=n.include.join(",")}return this._plug.at("draft",ae(e,"home"),t).withParams(r).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Qe))}},{key:"getLearningPathHistory",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||"string"!=typeof e)return Promise.reject(new Error("The learning path ID must be supplied, and must be a string"));var n={};if(t.limit){if("number"!=typeof t.limit)return Promise.reject(new Error("The `limit` parameter must be a number."));n.limit=t.limit}if(t.upTo){if("string"!=typeof t.upTo)return Promise.reject(new Error("The `upTo` parameter must be a string."));n.upto=t.upTo}if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` parameter must be an array."));n.include=t.include.join(",")}return this._plug.at("learningpath",ae(e)).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ge))}},{key:"getSiteHistoryLogs",value:function(){return this._plug.at("page-hierarchy","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Je))}},{key:"getSiteHistoryLogUrl",value:function(e){return e?this._plug.at("page-hierarchy","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ye)):Promise.reject(new Error("Attempting to get log url without required name"))}},{key:"getSiteHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};if(e.limit){if("number"!=typeof e.limit)return Promise.reject(new Error("The `limit` parameter must be a number less than or equal to 1000."));t.limit=e.limit}if(e.include){if(!Array.isArray(e.include))return Promise.reject(new Error("The `include` parameter must be an array."));t.include=e.include.join(",")}if(e.upTo){if("string"!=typeof e.upTo)return Promise.reject(new Error("The `upTo` parameter must be a string."));t.upto=e.upTo}if(e.jobId){if("string"!=typeof e.jobId)return Promise.reject(new Error("The `jobId` parameter must be a string."));t.jobId=e.jobId}return this._plug.at("page-hierarchy",ae(e.pageId,"home")).withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ge))}},{key:"getSiteHistoryDetail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||"string"!=typeof e)return Promise.reject(new Error("The detail ID must be specified, and it must be a string."));var n={};if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` option must be an array"));n.include=t.include.join(",")}return this._plug.at("page-hierarchy","details",e).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ge))}},{key:"logPageView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.event,i=void 0===r?null:r,a=n.keepAlive,s=void 0!==a&&a,o=this._plug.at("page-view",ae(e,"home"));return i&&(o=o.at(i)),s&&(o=o.withKeepAlive()),o.post(JSON.stringify(t),ne).catch((function(e){return Promise.reject(e)}))}},{key:"getPageHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};if(t.limit){if("number"!=typeof t.limit)return Promise.reject(new Error("The `limit` parameter must be a number less than or equal to 1000."));n.limit=t.limit}if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` parameter must be an array."));n.include=t.include.join(",")}if(t.upTo){if("string"!=typeof t.upTo)return Promise.reject(new Error("The `upTo` parameter must be a string."));n.upto=t.upTo}return this._plug.at("page",ae(e,"home")).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ge))}},{key:"getPageHistoryDetail",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return Promise.reject(new Error("The page ID is required to fetch a page history detail."));if(!t)return Promise.reject(new Error("The detail ID is required to fetch a page history detail."));var r={};if(n.include){if(!Array.isArray(n.include))return Promise.reject(new Error("The `include` parameter must be an array."));r.include=n.include.join(",")}return this._plug.at("page",ae(e,"home"),t).withParams(r).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Qe))}},{key:"logSearch",value:function(e,t){return this._plug.at("search",ae(e,"current")).post(JSON.stringify(t),ne).catch((function(e){return Promise.reject(e)}))}},{key:"getUserActivityLogs",value:function(){return this._plug.at("support-agent","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Je))}},{key:"getUserActivityLogUrl",value:function(e){return e?this._plug.at("support-agent","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ye)):Promise.reject(new Error("Attempting to get log url without required name"))}},{key:"getUserActivity",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return Promise.reject(new Error("The user activity token must be supplied"));try{t=se(e)}catch(e){return Promise.reject(e)}var r={};if(n.limit){if("number"!=typeof n.limit)return Promise.reject(new Error("The `limit` parameter must be a number."));r.limit=n.limit}if(n.include){if(!Array.isArray(n.include))return Promise.reject(new Error("The `include` parameter must be an array."));r.include=n.include.join(",")}if(n.upTo){if("string"!=typeof n.upTo&&!(n.upTo instanceof Date))return Promise.reject(new Error("The `upTo` parameter must be a string or a Date."));n.upTo instanceof Date?r.upto=oe(n.upTo):r.upto=n.upTo}return this._plug.at("support-agent",t).withParams(r).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ke))}},{key:"getUserHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};if(t.limit){if("number"!=typeof t.limit)return Promise.reject(new Error("The `limit` parameter must be a number."));n.limit=t.limit}if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` parameter must be an array."));n.include=t.include.join(",")}if(t.upTo){if("string"!=typeof t.upTo&&!(t.upTo instanceof Date))return Promise.reject(new Error("The `upTo` parameter must be a string or a Date."));t.upTo instanceof Date?n.upto=oe(t.upTo):n.upto=t.upTo}return this._plug.at("user-page",ae(e,"current")).withParams(n).get().catch((function(e){return Promise.reject(Ze(e))})).then((function(e){return e.json()})).then(F.createParser(Ge))}},{key:"getUserHistoryDetail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return Promise.reject(new Error("The detail ID must be supplied"));var n={};if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` parameter must be an array."));n.include=t.include.join(",")}return this._plug.at("user-page","current",e).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ge))}},{key:"logWebWidgetImpression",value:function(){return this._plug.at("web-widget-impression").post().catch((function(e){return Promise.reject(e)}))}},{key:"logFormInit",value:function(e){var t={type:e};return this._plug.at("form-init").post(JSON.stringify(t),ne).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Xe))}},{key:"logFormSubmit",value:function(e,t){var n={type:t};return this._plug.at("form-submit",e).post(JSON.stringify(n),ne).catch((function(e){return Promise.reject(e)}))}},{key:"logInteractionAnalytics",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.datetime,i=void 0===r?new Date:r,a=n.keepAlive,s=void 0!==a&&a,o=n.pageId,l=void 0===o?null:o,c=n.url,u=void 0===c?null:c,d=this._plug.at("interaction");s&&(d=d.withKeepAlive()),l&&(d=d.at(ae(l,"home")));var h={_datetime:i.toISOString(),location:e,action:t};return u&&(h._uri=u),d.post(JSON.stringify(h),ne).catch((function(e){return Promise.reject(e)}))}}]),e}(),tt=[{field:"@id",name:"id",transform:"number"},{field:"name",name:"name"},{field:"url",name:"url"}],nt=[{field:"external-report",name:"external-reports",isArray:!0,transform:tt}],rt=[{field:"@id",name:"id",transform:"number"},{field:"@uri",name:"uri"}];function it(){return function(e){return Array.isArray(e)?[]:["".concat(e," is not an array")]}}function at(e){return function(t){return t===e?[]:["".concat(t," does not equal ").concat(e)]}}function st(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=[],r=0;r<t.length;r++){var i,a=t[r](e);if(0===a.length){n=[];break}(i=n).push.apply(i,v(a))}return n}}function ot(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var n=[];return t.forEach((function(t){var r=t(e);r.length>0&&n.push.apply(n,v(r))})),n}}function lt(e,t){return function(n){return void 0===n[e]?[]:t?t(n[e]):[]}}function ct(e,t){return function(n){return void 0===n[e]?["The value of ".concat(e," is not defined")]:t?t(n[e]):[]}}function ut(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return v(t).concat(v(n(e)))}),[])}function dt(e,t){return t(e)}var ht={get object(){return ut},get value(){return dt}},mt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._plug=new E(t.host,t.plugConfig).at("@api","deki","site","external-reports")}return l(e,[{key:"getExternalReports",value:function(){return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(nt))}},{key:"getExternalReport",value:function(e){return e&&Number.isInteger(e)?this._plug.at(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(tt)):Promise.reject(new Error("Must submit a numeric id of an external report."))}},{key:"getExternalReportExternalUri",value:function(e){return e&&Number.isInteger(e)?this._plug.at(e,"external-uri").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(rt)):Promise.reject(new Error("Must submit a numeric id of an external report."))}},{key:"createExternalReport",value:function(e){if(!e)return Promise.reject(new Error("Unable to create an external report without data."));var t=ht.object(e,ct("url",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),ct("name",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})));return t.length>0?Promise.reject(new Error(t)):this._plug.post(e).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(tt))}},{key:"updateExternalReport",value:function(e){if(!e)return Promise.reject(new Error("Unable to create an external report without data."));var t=ht.object(e,ct("url",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),ct("name",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})));return t.length>0?Promise.reject(new Error(t)):this._plug.put(e.id,e).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(tt))}},{key:"deleteExternalReport",value:function(e){return e&&Number.isInteger(e)?this._plug.at(e).delete().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(tt)):Promise.reject(new Error("Must submit a numeric id of an external report."))}}]),e}(),ft=[{field:"@count",name:"count",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"},{field:"@href",name:"href"},{field:"file",isArray:!0,transform:_e}],pt=[{field:"count",name:"count",transform:"number"},{field:"querycount",name:"queryCount",transform:"number"}],gt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;s(this,e),this._id=t,this._settings=n,this._plug=new E(n.host,n.plugConfig).at("@api","deki","files",t),this._progressPlug=new be(n.host,n.plugConfig).at("@api","deki","files",t),this._errorParser=F.createParser(K)}return l(e,[{key:"getInfo",value:function(){var e=F.createParser(_e);return this._plug.at("info").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(e)}},{key:"getRevisions",value:function(){return this._plug.at("revisions").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(ft))}},{key:"getAttachmentDetails",value:function(){return this._plug.at("attachmentdetails").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(pt))}},{key:"setDescription",value:function(e){var t=F.createParser(_e);return this._plug.at("description").put(e,te).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"setAltText",value:function(e){var t=F.createParser(_e);return this._plug.at("alttext").put(e,te).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"delete",value:function(){return this._plug.delete().catch((function(e){return Promise.reject(e)}))}},{key:"addRevision",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.name,r=void 0===n?e.name:n,i=t.size,a=void 0===i?e.size:i,s=t.type,o=void 0===s?e.type:s,l=t.progress,c=void 0===l?null:l;if(null!==c){var u={callback:c,size:a};return this._progressPlug.at(ae(r)).put(e,o,u).catch((function(e){return Promise.reject(e)})).then((function(e){return JSON.parse(e.responseText)})).then(F.createParser(_e))}return this._plug.withHeader("Content-Length",a).at(ae(r)).put(e,o).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(_e))}},{key:"move",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.to?t.name?this._plug.at("move").withParams(t).post(null,te).catch((function(t){return Promise.reject(e._errorParser(t))})).then((function(e){return e.json()})).then(F.createParser(_e)):Promise.reject(new Error("The `name` parameter must be specified to move a file.")):Promise.reject(new Error("The `to` parameter must be specified to move a file."))}},{key:"postFileProperty",value:function(e){return this._plug.withHeader("slug",e).at("properties").post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()}))}},{key:"deleteFileProperty",value:function(e){return this._plug.at("properties",e).delete().catch((function(e){return Promise.reject(e)}))}}]),e}(),vt=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;return s(this,t),(n=f(this,h(t).call(this,e,r)))._plug=n._plug.withParam("draft","true"),n._progressPlug=n._progressPlug.withParam("draft","true"),n}return d(t,e),t}(gt),yt=Object.freeze({__proto__:null,File:gt,FileDraft:vt}),bt=[{field:"@count",name:"count",transform:"number"},{field:"@querycount",name:"queryCount",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"},{field:"@href",name:"href"},{field:"group",name:"groups",isArray:!0,transform:U}],wt=[{field:"@count",name:"count",transform:"number"},{field:"@querycount",name:"queryCount",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"},{field:"@href",name:"href"},{field:"user",name:"users",isArray:!0,transform:B}];function _t(){return"undefined"==typeof document?new(0,require("jsdom").JSDOM)("...").window.document.implementation.createDocument("","",null):document.implementation.createDocument("","",null)}var kt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;if(s(this,e),!t)throw new Error("A group ID must be supplied");this._id=ae(t),this._groupPlug=new E(n.host,n.plugConfig).at("@api","deki","groups",this._id),this._errorParser=F.createParser(K)}return l(e,[{key:"getInfo",value:function(){return this._groupPlug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(U))}},{key:"getUsers",value:function(e){return this._groupPlug.at("users").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(wt))}},{key:"removeUser",value:function(e){var t=this;return this._groupPlug.at("users",ae(e,"current")).delete().catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.json()})).then(F.createParser(U))}},{key:"delete",value:function(){return this._groupPlug.delete().catch((function(e){return Promise.reject(e)}))}},{key:"setRole",value:function(e){var t=this,n=e.name,r=_t(),i=r.createElement("group"),a=r.createElement("permissions.group"),s=r.createElement("role");return s.textContent=n,a.appendChild(s),i.appendChild(a),this._groupPlug.put(i.outerHTML,ee).catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.json()})).then(F.createParser(U))}}]),e}(),Pt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this.plug=new E(t.host,t.plugConfig).at("@api","deki","groups"),this.settings=t}return l(e,[{key:"getGroupList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};if("nameFilter"in e){if("string"!=typeof e.nameFilter)return Promise.reject(new Error("The group name filter must be a string"));""!==e.nameFilter&&(t.groupnamefilter=e.nameFilter)}if("authProvider"in e){if("number"!=typeof e.authProvider)return Promise.reject(new Error("The auth provider ID must be a number"));t.authprovider=e.authProvider}if("limit"in e){if("number"!=typeof e.limit&&"all"!==e.limit)return Promise.reject(new Error('The limit parameter must be a number or "all"'));t.limit=e.limit}if("offset"in e){if("number"!=typeof e.offset)return Promise.reject(new Error("The offset parameter must be a number"));t.offset=e.offset}if("sortBy"in e){if("string"!=typeof e.sortBy)return Promise.reject(new Error("The sortBy option must be a string"));var n=["id","name","role","service","-id","-name","-role","-service"];if(!n.includes(e.sortBy))return Promise.reject(new Error("The sortBy option must be one of ".concat(n.join(", "))));t.sortby=e.sortBy}return this.plug.withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(bt))}},{key:"getGroup",value:function(e){return new kt(e,this.settings)}}]),e}(),St=Object.freeze({__proto__:null,Group:kt,GroupManager:Pt}),Ct=[{field:"@name",name:"name"},{field:"@editable",name:"editable",transform:"boolean"},{field:"@revision",name:"revision",transform:"number"},{field:"edittime",name:"editTime"},{field:"title"},{field:"summary"},{field:"category"},{field:"uri.learningpath",name:"uri"},{field:"pages",isArray:!0,transform:H}],Tt=[{field:"learningpath",name:"learningPaths",isArray:!0,transform:Ct}],Et=[{field:["categories","category"],name:"categories",isArray:!0}],xt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;s(this,e),this._name=t,this._plug=new E(n.host,n.plugConfig).at("@api","deki","learningpaths","=".concat(t))}return l(e,[{key:"getInfo",value:function(e){var t={};return e&&(t.revision=e),this._plug.withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ct))}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"now";if(!e)return Promise.reject("The content parameter must be supplied to update a learning path");if(!e.title||"string"!=typeof e.title||""===e.title)return Promise.reject("The title parameter must be supplied, and must be a non-empty string.");var n="<title>".concat(re(e.title),"</title>");if(e.summary){if("string"!=typeof e.summary)return Promise.reject("The summary parameter must be a string");n+="<summary>".concat(re(e.summary),"</summary>")}if(e.category){if("string"!=typeof e.category)return Promise.reject("The category parameter must be a string");n+="<category>".concat(re(e.category),"</category>")}if(e.pageIds){if(!Array.isArray(e.pageIds))return Promise.reject("The pages parameter must be an array");n+=e.pageIds.reduce((function(e,t){return e+"<pages>".concat(t,"</pages>")}),n)}var r="<learningpath>".concat(n,"</learningpath>");return this._plug.withParam("edittime",t).post(r,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ct))}},{key:"remove",value:function(){return this._plug.delete().catch((function(e){return Promise.reject(e)}))}},{key:"clone",value:function(e){return"string"!=typeof e||""===e?Promise.reject("The new name for the clone must be a non-empty string."):this._plug.at("clone").withParam("name",e).post(null,te).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ct))}},{key:"revertToRevision",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"now";return e?this._plug.at("revert").withParams({torevision:e,edittime:t}).post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ct)):Promise.reject(new Error("The revision parameter is required"))}},{key:"addPage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"now";return this._plug.at("pages",e).withParam("edittime",t).post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(H))}},{key:"removePage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"now";return this._plug.at("pages",e).withParam("edittime",t).delete().catch((function(e){return Promise.reject(e)}))}},{key:"reorderPage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"now";return this._plug.at("pages",e,"order").withParams({edittime:n,afterid:t}).post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ct))}}]),e}(),Rt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this.settings=t,this._plug=new E(t.host,t.plugConfig).at("@api","deki","learningpaths")}return l(e,[{key:"getLearningPaths",value:function(){return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Tt))}},{key:"createLearningPath",value:function(e){return e?e.name&&"string"==typeof e.name&&""!==e.name?e.title&&"string"==typeof e.title&&""!==e.title?e.summary&&"string"!=typeof e.summary?Promise.reject(new Error("The `summary` parameter must be a string.")):e.category&&"string"!=typeof e.category?Promise.reject(new Error("The `category` parameter must be a string.")):this._plug.withParams(e).post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ct)):Promise.reject(new Error("The `title` parameter must be supplied, and must be a non-empty string.")):Promise.reject(new Error("The `name` parameter must be supplied, and must be a non-empty string.")):Promise.reject(new Error("Unable to create a learning path without data."))}},{key:"getCategories",value:function(){return this._plug.at("categories").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Et))}},{key:"getLearningPath",value:function(e){return new xt(e,this.settings)}}]),e}(),jt=Object.freeze({__proto__:null,LearningPath:xt,LearningPathManager:Rt}),At=[{field:"@name",name:"name"},{field:"@count",name:"count",transform:"number"}],It=[{field:"@count",name:"count",transform:"number"},{field:"@date.start",name:"startDate",transform:"apiDate"},{field:"@date.expiration",name:"expirationDate",transform:"apiDate"},{field:"@anually-licensed-help-requests",name:"annuallyLicensedHelpRequests"},{field:"totals",isArray:!0,transform:[{field:"@date",name:"date",transform:"apiDate"},{field:["custom","origin"],name:"customRequests",isArray:!0,transform:At},{field:["mt-requests","origin"],name:"mtRequests",isArray:!0,transform:At}]}],Nt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._plug=new E(t.host,t.plugConfig).at("@api","deki","license")}return l(e,[{key:"getUsage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};if(e.since){if(!(e.since instanceof Date))return Promise.reject(new Error("The `since` parameter must be of type Date."));t.since=oe(e.since)}if(e.upTo){if(!(e.upTo instanceof Date))return Promise.reject(new Error("The `upTo` parameter must be of type Date."));t.upto=oe(e.upTo)}return this._plug.at("usage").withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(It))}},{key:"getUsageLogs",value:function(){return this._plug.at("usage","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Je))}},{key:"getUsageLogUrl",value:function(e){return e?this._plug.at("usage","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser([{field:"url"}])):Promise.reject(new Error("The log name must be supplied."))}}]),e}(),Lt=[{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"page",name:"pages",isArray:!0,transform:H}],Dt=[{field:"uri.status",name:"statusUri"}],Ft=[{field:"uri.download",name:"downloadUri"}],qt=[{field:"count",transform:"number"},{field:"querycount",name:"queryCount",transform:"number"},{field:"pages",isArray:!0,transform:[{field:"links",isArray:!0,transform:[{field:"@sequence",name:"sequence",transform:"number"},{field:"@isredirect",name:"isRedirect",transform:"boolean"},{field:"@isbroken",name:"isBroken",transform:"boolean"},{field:"class"},{field:"href"},{field:"path"},{field:"rel"},{field:"text"},{field:"type"},{field:["destination","page"],name:"destinationPage",transform:H},{field:["destination","file"],name:"destinationFile",transform:_e}]},{field:"page",transform:H}]}],Mt=[{field:"count",transform:"number"},{field:"querycount",name:"queryCount",transform:"number"},{field:"inspections",isArray:!0,transform:[{field:"@severity",name:"severity"},{field:"@type",name:"type"},{field:"message"},{field:"page",transform:[{field:"@uri",name:"uri"},{field:"@id",name:"id",transform:"number"},{field:"article"}]}]}],Ot=[{field:"@count",name:"count",transform:"number"},{field:"template",name:"templates",isArray:!0,transform:[{field:"description"},{field:"id",transform:"number"},{field:"path"},{field:"title"},{field:"articletype",name:"articleType"},{field:"createarticlewidgetflag",name:"createArticleWidgetFlag"}]}],zt=[{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"page",name:"pages",isArray:"true",transform:H}],Ut=[{field:"count",transform:"number"},{field:["linkdata","link"],name:"linkData",isArray:!0,transform:[{field:"caseid",name:"caseId"},{field:"pagetitle",name:"pageTitle"},{field:"pageuri",name:"pageUri"},{field:"linkcreatoruserid",name:"linkCreatorUserId",transform:"number"},{field:"linkcreatorusername",name:"linkCreatorUsername"},{field:"linkdate",name:"linkDate",transform:"date"},{field:"pageid",name:"pageId",transform:"number"}]},{field:"total",transform:"number"}],Bt=F.createParser(K),Ht=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;return s(this,t),(e=f(this,h(t).call(this,n)))._settings=r,e._plug=new E(r.host,r.plugConfig).at("@api","deki","pages",e._id),e}return d(t,e),l(t,[{key:"getRating",value:function(){return this._plug.at("ratings").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(O))}},{key:"rate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(1!==e&&0!==e&&null!==e)throw new Error("Invalid rating supplied");if(1!==t&&0!==t&&null!==t)throw new Error("Invalid rating supplied for the old rating");return null===e&&(e=""),null===t&&(t=""),this._plug.at("ratings").withParams({score:e,previousScore:t}).post(null,te).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(O))}},{key:"getHtmlTemplate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.pageid=this._id;var n="="+encodeURIComponent(encodeURIComponent(e)),r=new E(this._settings.host,this._settings.plugConfig).at("@api","deki","pages",n,"contents").withParams(t),i=F.createParser(Te);return r.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(i)}},{key:"activateDraft",value:function(){var e=F.createParser(H);return this._plug.at("activate-draft").post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(e)}},{key:"importArchive",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.name,r=void 0===n?e.name:n,i=t.size,a=void 0===i?e.size:i,s=t.type,o=void 0===s?e.type:s,l=t.progress,c=void 0===l?null:l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=Object.assign({filename:r,behavior:"async"},u);if(null!==c){var h={callback:c,size:a};return new be(this._settings.host,this._settings.plugConfig).at("@api","deki","pages",this._id).at("import").withParams(d).put(e,o,h).catch((function(e){return Promise.reject(JSON.parse(e.responseText))})).then((function(e){return JSON.parse(e.responseText)})).then(F.createParser(Dt))}return this._plug.withHeader("Content-Length",a).withParams(d).at("import").put(e,o).catch((function(e){return Promise.reject(JSON.parse(e.responseText))})).then((function(e){return e.json()})).then(F.createParser(Dt))}},{key:"getExportInformation",value:function(){return this._plug.at("export").post(null,te).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ft))}},{key:"exportPdf",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fileName,n=e.format,r=void 0===n?"pdf":n,i=e.stylesheet,a=e.deep,s=void 0!==a&&a,o=e.showToc,l=void 0!==o&&o,c=e.dryRun,u=void 0!==c&&c,d={};if(t){if("string"!=typeof t)return Promise.reject(new Error("The fileName parameter must be a non-empty string"));d.filename=t}if(i){if("string"!=typeof i)return Promise.reject(new Error("The stylesheet parameter must be a non-empty string"));d.stylesheet=i}if("pdf"!==r&&"html"!==r)return Promise.reject(new Error('The `format` parameter must be either "pdf" or "html".'));if(d.format=r,"boolean"!=typeof s)return Promise.reject(new Error("The `deep` parameter must be a Boolean value."));if(d.deep=s,"boolean"!=typeof l)return Promise.reject(new Error("The `showToc` parameter must be a Boolean value."));if(d.showtoc=l,"boolean"!=typeof u)return Promise.reject(new Error("The `dryRun` parameter must be a Boolean value."));d.dryrun=u;var h=this._plug.at("pdf").withParams(d).get().catch((function(e){return Promise.reject(e)}));return u?h:h.then((function(e){return e.blob()}))}},{key:"getLinkDetails",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.includeSubpages,n=void 0!==t&&t,r=e.linkTypes,i=void 0===r?[]:r,a=e.broken,s=e.redirect,o=e.limit,l=void 0===o?100:o,c=e.offset,u=void 0===c?0:c,d=e.q,h={};if("boolean"!=typeof n)return Promise.reject(new Error("The `includeSubpages` parameter must be a Boolean value."));if(h.subpages=n,!Array.isArray(i))return Promise.reject(new Error("The `linkTypes` parameter must be an array."));if(i.length>0&&(h.linktypes=i.join(",")),void 0!==a){if("boolean"!=typeof a)return Promise.reject(new Error("The `broken` parameter must be a Boolean value."));h.broken=a}if(void 0!==s){if("boolean"!=typeof s)return Promise.reject(new Error("The `redirect` parameter must be a Boolean value."));h.redirect=s}if("number"!=typeof l)return Promise.reject(new Error("The `limit` parameter must be a number."));if(h.limit=l,"number"!=typeof u)return Promise.reject(new Error("The `offset` parameter must be a number."));if(h.offset=u,void 0!==d){if("string"!=typeof d)return Promise.reject(new Error("The `q` parameter must be a string."));h.q=d}return this._plug.at("linkdetails").withParams(h).get().catch((function(e){return Promise.reject(Bt(e))})).then((function(e){return e.json()})).then(F.createParser(qt))}},{key:"getHealthInspections",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.analyzers,n=e.severities,r=e.includeSubpages,i=e.limit,a=e.offset,s={};if(t){if(!Array.isArray(t))return Promise.reject(new Error("The `analyzers` parameter must be an array."));s.analyzers=t.join(",")}if(n){if(!Array.isArray(n))return Promise.reject(new Error("The `severities` parameter must be an array."));s.severity=n.join(",")}if(void 0!==r){if("boolean"!=typeof r)return Promise.reject(new Error("The `includeSubpages` parameter must be a boolean value."));s.subpages=r}if(i){if("number"!=typeof i)return Promise.reject(new Error("The `limit` parameter must be a number."));s.limit=i}if(a){if("number"!=typeof a)return Promise.reject(new Error("The `offset` parameter must be a number."));s.offset=a}return this._plug.at("health").withParams(s).get().catch((function(e){return Promise.reject(Bt(e))})).then((function(e){return e.json()})).then(F.createParser(Mt))}},{key:"linkToCase",value:function(e){return e?this._plug.at("linktocase",e).post().catch((function(e){return Promise.reject(e)})):Promise.reject(new Error("The case ID must be supplied in order to link a case to the page."))}},{key:"unlinkCase",value:function(e){return e?this._plug.at("linktocase",e).delete().catch((function(e){return Promise.reject(e)})):Promise.reject(new Error("The case ID must be supplied in order to unlink a case from the page."))}},{key:"getLinkedCases",value:function(){return this._plug.at("linktocase","links").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ut))}}]),t}(Oe),Vt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._plug=new E(t.host,t.plugConfig).at("@api","deki","pages")}return l(e,[{key:"getRatings",value:function(e){return this._plug.at("ratings").withParams({pageids:e.join(",")}).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Lt))}},{key:"getTemplates",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=void 0===t?"page":t,r=e.includeDescription,i=void 0===r||r;return"string"!=typeof n||"page"!==n&&"content"!==n&&"kcspage"!==n?Promise.reject(new Error('The `type` parameter must be set to either "page", "content", or "kcspage".')):"boolean"!=typeof i?Promise.reject(new Error("The `includeDescription` parameter must be a Boolean value")):this._plug.at("templates").withParams({type:n,includeDescription:i}).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ot))}},{key:"getPopularPages",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit,n=void 0===t?50:t,r=e.offset,i=void 0===r?0:r,a=ht.object({limit:n,offset:i},ct("limit",st((function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]}),at("all"))),ct("offset",(function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]})));return a.length>0?Promise.reject(a.join(", ")):this._plug.at("popular").withParams({limit:n,offset:i}).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(zt))}}]),e}(),Wt=Object.freeze({__proto__:null,Page:Ht,PageManager:Vt}),$t=[{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"property",name:"properties",isArray:!0,transform:Se}],Kt=function(){function e(t){if(s(this,e),"PagePropertyBase"===this.constructor.name)throw new TypeError("PagePropertyBase must not be constructed directly.  Use one of PageProperty() or DraftProperty()");this._id=ae(t,"home")}return l(e,[{key:"getProperties",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e))return Promise.reject(new Error("The property names must be an array"));var t=this._plug;return e.length>0&&(t=t.withParams({names:e.join(",")})),t.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser($t))}},{key:"getPropertyContents",value:function(e){return e?this._plug.at(encodeURIComponent(e)).get().catch((function(e){return Promise.reject(e)})):Promise.reject(new Error("Attempting to fetch a page property contents without providing a property key"))}},{key:"getProperty",value:function(e){return e?this._plug.at(encodeURIComponent(e),"info").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Se)):Promise.reject(new Error("Attempting to fetch a page property without providing a property key"))}},{key:"setProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{abort:"modified"};return e?"string"!=typeof t.text?Promise.reject(new Error("Attempting to set a property without providing a property value")):(t.type||(t.type=te),this._plug.at(encodeURIComponent(e)).withParams(n).put(t.text,t.type).catch((function(e){return Promise.reject(e)}))):Promise.reject(new Error("Attempting to set a property without providing a property key"))}},{key:"deleteProperty",value:function(e){return e?this._plug.at(encodeURIComponent(e)).delete().catch((function(e){return Promise.reject(e)})):Promise.reject(new Error("Attempting to delete a property without providing a property key"))}}]),e}(),Gt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;return s(this,t),(e=f(this,h(t).call(this,n)))._plug=new E(r.host,r.plugConfig).at("@api","deki","pages",e._id,"properties"),e}return d(t,e),l(t,[{key:"getPropertyForChildren",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e?this._plug.withParams({depth:t,names:e}).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})):Promise.reject(new Error("Attempting to fetch properties for children without providing a property key"))}}]),t}(Kt),Qt=[{field:"@href",name:"href"},{field:["grants","grant"],name:"grants",isArray:!0,transform:[{field:"date.modified",name:"dateModified",transform:"date"},{field:"permissions",transform:z},{field:"user",transform:B},{field:"user.modifiedby",name:"userModifiedBy",transform:B},{field:"group",transform:U}]},{field:"permissions.effective",name:"effectivePermissions",transform:z},{field:"permissions.page",name:"pagePermissions",transform:z},{field:"permissions.revoked",name:"revokedPermissions",transform:z}];function Jt(e){if(!Array.isArray(e))return[!1,"The specified grants must be an array"];var t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value,o=void 0!==s.user,l=void 0!==s.group;if(o&&l||!o&&!l)return[!1,"The grant must only define a single user or group, but not both."];if(o&&"string"!=typeof s.user&&"number"!=typeof s.user)return[!1,"The grant user parameter must be a numeric ID or an username"];if(l&&"string"!=typeof s.group&&"number"!=typeof s.group)return[!1,"The grant group parameter must be a numeric ID or an username"];if("string"!=typeof s.role)return[!1,"The grant role must be defined and must be a string."]}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return[!0,"success"]}function Yt(e,t){var n="grants";t&&(n+=".".concat(t));var r=e.map((function(e){var t,n,r=e[t=e.user?"user":"group"];n="number"==typeof r?"<".concat(t,' id="').concat(r,'"></').concat(t,">"):"<".concat(t,"><").concat(t,"name>").concat(r,"</").concat(t,"name></").concat(t,">");var i="<permissions><role>".concat(e.role,"</role></permissions>");return"<grant>".concat(n).concat(i,"</grant>")})).join("");return"<".concat(n,">").concat(r,"</").concat(n,">")}function Xt(e){return e?"<permissions.page><restriction>".concat(e,"</restriction></permissions.page>"):""}var Zt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;s(this,e),this._plug=new E(n.host,n.plugConfig).at("@api","deki","pages",ae(t,"home"),"security")}return l(e,[{key:"get",value:function(){return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Qt))}},{key:"reset",value:function(){return this._plug.delete().catch((function(e){return Promise.reject(e)}))}},{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cascade,n=void 0===t?"none":t,r=e.pageRestriction,i=e.grants;if("string"!=typeof r)return Promise.reject(new Error("The pageRestriction parameter must be provided and must be a string."));var a="";if(i){var s=g(Jt(i),2),o=s[0],l=s[1];if(!o)return Promise.reject(new Error(l));a=Yt(i)}var c=Xt(r),u="<security>".concat(c).concat(a,"</security>");return this._plug.withParams({cascade:n}).put(u,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Qt))}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cascade,n=void 0===t?"none":t,r=e.pageRestriction,i=e.grantsAdded,a=e.grantsRemoved,s="";if(i){var o=g(Jt(i),2),l=o[0],c=o[1];if(!l)return Promise.reject(new Error(c));s=Yt(i,"added")}var u="";if(a){var d=g(Jt(a),2),h=d[0],m=d[1];if(!h)return Promise.reject(new Error(m));u=Yt(a,"removed")}var f=Xt(r),p="<security>".concat(f).concat(s).concat(u,"</security>");return this._plug.withParams({cascade:n}).post(p,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Qt))}}]),e}(),en=[{field:"subscription.page",name:"subscriptions",isArray:!0,transform:[{field:"@id",name:"id",transform:"number"},{field:"@depth",name:"depth"},{field:"@draft",name:"draft",transform:"boolean"}]}],tn=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"home",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new D;if(s(this,e),ht.value(t,(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})).length>0)throw new Error("The siteId parameter must be supplied, and must be a string.");this._siteId=t,this._settings=r,this._plug=new E(r.host,r.plugConfig).at("@api","deki","pagesubservice","pages",ae(n,"home")).withParam("siteid",t)}return l(e,[{key:"subscribe",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=void 0===t?"page":t,r=e.recursive,i=void 0!==r&&r,a=ht.object({type:n,recursive:i},ct("type",ot((function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]}),st(at("page"),at("draft")))),ct("recursive",(function(e){return"boolean"==typeof e?[]:["".concat(e," is not a Boolean value")]})));return a.length>0?Promise.reject(new Error(a.join(", "))):this._plug.withParams({type:n,depth:i?"infinity":"0"}).post("",te).catch((function(e){return Promise.reject(e)}))}},{key:"unsubscribe",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).type,t=void 0===e?"page":e;return ht.value(t,ot((function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]}),st(at("page"),at("draft")))).length>0?Promise.reject('The type parameter must be a string set to either "page" or "draft".'):this._plug.withParams({type:t}).delete().catch((function(e){return Promise.reject(e)}))}},{key:"getStatus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.pageId,n=e.type,r=void 0===n?"page":n,i=e.parentInfo,a=void 0!==i&&i;return ht.value(r,ot((function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]}),st(at("page"),at("draft")))).length>0?Promise.reject(new Error('The type parameter must be a string set to either "page" or "draft".')):t?new E(this._settings.host,this._settings.plugConfig).at("@api","deki","pagesubservice","subscriptions",t).withParam("siteid","".concat(this._siteId)).withParam("parentinfo",a).withParams({type:r}).get().then((function(e){return e.json()})).then((function(e){var n=e["subscription.page"];if(!n)return{subscribed:!1,status:0,parent:null};var r,i=n["@id"],a=n["@depth"],s=null;if(i===String(t))r="infinity"===a?2:1;else{r=3;var o=n["@parent-title"],l=n["@parent-path"];o&&l&&(s={title:o,href:l})}return{subscribed:!0,status:r,parent:s}})).catch((function(e){return Promise.reject(e)})):Promise.reject(new Error("The pageId parameter must be supplied."))}}]),e}(),nn=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;if(s(this,e),ht.value(t,(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})).length>0)throw new Error("The siteId parameter must be supplied, and must be a string.");this._plug=new E(n.host,n.plugConfig).at("@api","deki","pagesubservice","subscriptions").withParam("siteid",t)}return l(e,[{key:"getSubscriptions",value:function(){return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(en))}}]),e}(),rn=Object.freeze({__proto__:null,PageSubscription:tn,PageSubscriptionManager:nn}),an=[{field:"@id",name:"id",transform:"number"},{field:"date.started",name:"startedTime",transform:"date"},{field:"date.completed",name:"completedTime",transform:"date"},{field:"@currentState.id",name:"currentStateId",transform:"number"},{field:"currentuservalidtransition",name:"rules",transform:[{field:"@requestedByCurrentUser",name:"requestedByCurrentUser",transform:"boolean"},{field:"@requestedOfCurrentUser",name:"requestedOfCurrentUser",transform:"boolean"},{field:"@canPickup",name:"canPickup",transform:"boolean"},{field:"@canCancel",name:"canCancel",transform:"boolean"},{field:"@canNeedsEdits",name:"canNeedsEdits",transform:"boolean"},{field:"@canAccept",name:"canAccept",transform:"boolean"},{field:"@canRequestReview",name:"canRequestReview",transform:"boolean"},{field:"@canReassign",name:"canReassign",transform:"boolean"}]},{field:"page",transform:[{field:"@id",name:"id",transform:"number"},{field:"uri.ui",name:"uri"},{field:"title"}]},{field:["states","state"],isArray:!0,transform:[{field:"@id",name:"id",transform:"number"},{field:"comment"},{field:"date.created",name:"createdTime",transform:"date"},{field:"pagesection",name:"pageSection"},{field:"label"},{field:"requestedby",name:"requestedBy",transform:function(e){return{type:"user",id:parseInt(e.user["@id"],10),name:e.user.displayname||e.user.username,username:e.user.username}}},{field:"requestedof",name:"requestedOf",transform:function(e){var t=Object.keys(e).includes("user")?"user":"group";return"user"===t?{type:t,id:parseInt(e[t]["@id"],10),name:e[t].displayname||e[t].username,username:e[t].username}:{type:t,id:parseInt(e[t]["@id"],10),name:e[t].groupname}}}]}],sn=[{field:"articlereview",name:"articleReview",isArray:!0,transform:an}],on=F.createParser(K);function ln(e){return"number"==typeof e?[]:["Page.ReviewWorkflow.error.user-or-group-must-be-provided"]}function cn(e){var t=_t(),n=t.createElement("reviews");if(e.requestedOf&&e.requestedOfType){var r=t.createElement("requestedof"),i=t.createElement(e.requestedOfType.toLowerCase());i.setAttribute("id",e.requestedOf||""),r.appendChild(i),n.appendChild(r)}return delete e.requestedOf,delete e.requestedOfType,void 0!==e.comment&&0===e.comment.trim().length&&delete e.comment,Object.keys(e).forEach((function(r){var i=t.createElement(r.toLowerCase());i.appendChild(t.createTextNode(e[r]||"")),n.appendChild(i)})),n.outerHTML}var un=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._settings=t,this._plug=new E(t.host,t.plugConfig).at("@api","deki","reviews")}return l(e,null,[{key:"states",get:function(){return{editsRequested:"Needs Edits",reviewRequested:"Review Requested",accepted:"Accepted",cancelled:"Cancelled"}}}]),l(e,[{key:"getInfo",value:function(e){return void 0===e?Promise.reject(new Error("A review ID is required")):new E(this._settings.host,this._settings.plugConfig).at("@api","deki","reviews",e).get().catch((function(e){return Promise.reject(on(e))})).then((function(e){return e.json()})).then(F.createParser(an))}},{key:"listForPage",value:function(e){return this._list(e,!1)}},{key:"listForDraft",value:function(e){return this._list(e,!0)}},{key:"listForUser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(void 0===e)return Promise.reject(new Error("A user ID is required"));var i=new E(this._settings.host,this._settings.plugConfig).at("@api","deki","users",e,"reviews");return t&&(i=i.withParam("offset",t)),n&&(i=i.withParam("limit",n)),r&&(i=i.withParam("path",r)),i.get().catch((function(e){return Promise.reject(on(e))})).then((function(e){return e.json()})).then(F.createParser(sn)).then((function(e){return e.articleReview}))}},{key:"listAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"None",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=new E(this._settings.host,this._settings.plugConfig).at("@api","deki","reviews");return t&&(i=i.withParam("offset",t)),n&&(i=i.withParam("limit",n)),r&&(i=i.withParam("path",r)),(i=i.withParam("filter",e)).get().catch((function(e){return Promise.reject(on(e))})).then((function(e){return e.json()})).then(F.createParser(sn)).then((function(e){return e.articleReview}))}},{key:"create",value:function(e){e=Object.assign({resourceType:e.draft?"drafts":"pages",requestedOfType:"user"},e);var t=ht.object(e,ct("id",(function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]})),ct("requestedOf",ln));if(t.length>0)return Promise.reject(new Error(t.join(", ")));e.label="Review Requested";var n=new E(this._settings.host,this._settings.plugConfig).at("@api","deki",e.resourceType,e.id,"reviews");return delete e.resourceType,delete e.id,n.post(cn(e),ee).catch((function(e){return Promise.reject(on(e))}))}},{key:"update",value:function(e){e=Object.assign({requestedOf:null},e);var t=ht.object(e,ct("reviewId",(function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]})));if(void 0!==e.label&&null!==e.label||t.push.apply(t,v(ht.object(e,ct("requestedOf",ln)))),t.length>0)return Promise.reject(new Error(t.join(", ")));var n=e.reviewId;return delete e.reviewId,this._plug.at(n,"next").post(cn(e),ee).catch((function(e){return Promise.reject(on(e))}))}},{key:"updateBulk",value:function(e){var t=this,n=ht.object(e,ct("reviewIds",it()));return n.length>0?[Promise.reject(new Error(n.join(", ")))]:e.reviewIds.map((function(t){var n={};return Object.assign(n,e),delete n.reviewIds,n.reviewId=t,n})).map((function(e){return t.update(e)}))}},{key:"_list",value:function(e,t){if(void 0===e)return Promise.reject(new Error("A page ID is required"));var n=t?"drafts":"pages";return new E(this._settings.host,this._settings.plugConfig).at("@api","deki",n,e,"reviews").get().catch((function(e){return Promise.reject(on(e))})).then((function(e){return e.json()})).then(F.createParser(sn)).then((function(e){return e.articleReview}))}}]),e}(),dn=[{field:"id",name:"id",transform:"number"},{field:"schedule-datetime",name:"scheduleDatetime",transform:"date"},{field:"subpages",name:"subpages",transform:"boolean"},{field:"isSubpage",transform:"boolean"},{field:"lastUpdatedBy"},{field:"page",transform:H}],hn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._settings=t,this._plug=new E(t.host,t.plugConfig).at("@api","deki","schedules")}return l(e,[{key:"create",value:function(e,t,n,r){var i=r?"drafts":"pages",a=_t(),s=a.createElement("body"),o=a.createElement("schedule-time");o.textContent=t;var l=a.createElement("subpages");return l.textContent=n,s.appendChild(o),s.appendChild(l),this._plug.at(i,e).post(s.outerHTML,ee).catch((function(e){return Promise.reject(e)}))}},{key:"getInfo",value:function(e,t){if(void 0===e)return Promise.reject(new Error("A page ID is required"));var n=t?"drafts":"pages";return this._plug.at(n,e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(dn))}},{key:"update",value:function(e,t,n,r){var i=r?"drafts":"pages",a=_t(),s=a.createElement("body"),o=a.createElement("schedule-time");o.textContent=t;var l=a.createElement("subpages");l.textContent=n;var c=a.createElement("status");return c.textContent=0,s.appendChild(o),s.appendChild(l),s.appendChild(c),this._plug.at(e,i).put(s.outerHTML,ee).catch((function(e){return Promise.reject(e)}))}},{key:"delete",value:function(e,t){var n=t?"drafts":"pages";return this._plug.at(e,n).delete().catch((function(e){return Promise.reject(e)}))}}]),e}();function mn(){return[{field:"@ranking",name:"ranking"},{field:"@queryid",name:"queryId",transform:"number"},{field:"@sessionid",name:"sessionId"},{field:"@querycount",name:"queryCount",transform:"number"},{field:"@count.recommendations",name:"recommendationCount",transform:"number"},{field:"@count",name:"count",transform:"number"},{field:"result",name:"results",isArray:!0,transform:[{field:"author"},{field:"content"},{field:"date.created",name:"dateCreated",transform:"date"},{field:"date.modified",name:"dateModified",transform:"date"},{field:"authorDisplayName"},{field:"draft.state",name:"draftState"},{field:"id",transform:"number"},{field:"last.editor",name:"lastEditor"},{field:"mime"},{field:"rank",transform:"number"},{field:"title"},{field:"type"},{field:"uri"},{field:"uri.track",name:"uriTrack"},{field:"page",transform:H},{field:"preview"},{field:"tag",name:"tags",transform:function(e){if(e)return e.split("\n")}},{field:"publication.schedule",name:"publicationSchedule",transform:"date"}]}]}var fn=v(mn()).concat([{field:"summary",transform:[{field:"@path",name:"path"},{field:"results",isArray:!0,transform:[{field:"@path",name:"path"},{field:"@count",name:"count",transform:"number"},{field:"@title",name:"title"}]}]},{field:"page",name:"pages",isArray:!0,transform:H}]),pn=v(mn()).concat([{field:"recommendations",isArray:!0,transform:[{field:"@id",name:"id",transform:"number"}]},{field:"aggs",transform:[{field:["articles","articles"],isArray:!0,transform:[{field:"@count",name:"count",transform:"number"},{field:"value"}]},{field:["custom_classifications","custom_classifications"],name:"customClassifications",isArray:!0,transform:[{field:"@count",name:"count",transform:"number"},{field:"value",name:"prefix"},{field:["custom_classifications","custom_classifications"],name:"tags",isArray:!0,transform:[{field:"@count",name:"count",transform:"number"},{field:"value"}]}]},{field:["pages","pages"],isArray:!0,transform:[{field:"@count",name:"count",transform:"number"},{field:"@id",name:"id",transform:"number"},{field:"value"},{field:"title"}]}]}]),gn=[{field:"@count",name:"count",transform:"number"},{field:"tag",name:"tags",isArray:!0,transform:[{field:"@value",name:"value"},{field:"@id",name:"id",transform:"number"},{field:"@href",name:"href"},{field:"title"},{field:"type"},{field:"uri"}]}],vn=[{field:"skipped-pageids",name:"skippedPageIds",transform:function(e){return"string"==typeof e?e.split(",").map((function(e){return parseInt(e,10)})):[]}},{field:"skipped-article-change-pageids",name:"skippedArticleChangePageIds",transform:function(e){return"string"==typeof e?e.split(",").map((function(e){return parseInt(e,10)})):[]}},{field:"skipped-kcs-change-pageids",name:"skippedKcsChangePageIds",transform:function(e){return"string"==typeof e?e.split(",").map((function(e){return parseInt(e,10)})):[]}}],yn=[{field:"@type",name:"type"},{field:"entry",name:"entries",isArray:!0,transform:[{field:"@date",name:"date",transform:"date"},{field:"pages.created",name:"pagesCreated",transform:"number"},{field:"pages.deleted",name:"pagesDeleted",transform:"number"},{field:"pages.edited",name:"pagesEdited",transform:"number"},{field:"pages.total",name:"pagesTotal",transform:"number"},{field:"users.created",name:"usersCreated",transform:"number"},{field:"users.total",name:"usersTotal",transform:"number"}]}],bn=[{field:"popular",transform:[{field:"search",isArray:!0,transform:[{field:"averageClicksPerSearch",transform:"number"},{field:"averagePosition",transform:"number"},{field:"hits",transform:"number"},{field:"mostRecent",transform:"date"},{field:"query"},{field:"results",transform:"number"},{field:"topresult",transform:[{field:"page",transform:H},{field:"file",transform:_e}]},{field:"total",transform:"number"}]}]},{field:"volume",transform:[{field:"clickTotal",transform:"number"},{field:"clickthroughRate"},{field:"searchTotal",transform:"number"},{field:"searchesClickedTotal",transform:"number"},{field:"point",isArray:!0,transform:[{field:"clicks",transform:"number"},{field:"date",transform:"date"},{field:"total",transform:"number"}]}]}],wn=[{field:"clicks",transform:[{field:"click",isArray:!0,transform:[{field:"averagePosition",transform:"number"},{field:"hits",transform:"number"},{field:"mostRecent",transform:"date"},{field:"type"},{field:"page",transform:H},{field:"file",transform:_e}]}]},{field:"volume",transform:[{field:"clickTotal",transform:"number"},{field:"clickthroughRate"},{field:"searchTotal",transform:"number"},{field:"searchesClickedTotal",transform:"number"},{field:"point",isArray:!0,transform:[{field:"clicks",transform:"number"},{field:"searchesClicked",transform:"number"},{field:"date",transform:"date"},{field:"total",transform:"number"}]}]}],_n=[{field:"permissions",isArray:!0,transform:z}],kn=[{field:"@lang",name:"lang"},{field:"localization",name:"localizations",isArray:!0,transform:[{field:"@resource",name:"resource"},{field:"@missing",name:"missing",transform:"boolean"},{field:"#text",name:"text"}]}];function Pn(e){var t=[];if("path"in e&&e.path.forEach((function(e){t.push("+path.ancestor:"+ie(e))})),"tags"in e){var n=e.tags;"string"==typeof n&&n&&(n=n.split(",")),n.forEach((function(e){t.push('+tag:"'+ie(e)+'"')}))}if("type"in e){var r=e.type;"string"==typeof r&&r&&(r=r.split(",")),r.forEach((function(e){t.push("+type:"+ie(e))}))}"namespaces"in e&&e.namespaces.forEach((function(e){t.push("+namespace:".concat(ie(e)))}));return t.length>0?"+("+t.join(" ")+")":""}var Sn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this.plug=new E(t.host,t.plugConfig).at("@api","deki","site")}return l(e,[{key:"getSiteActivityLogs",value:function(){return this.plug.at("activity","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Je))}},{key:"getSearchQueryLogs",value:function(){return this.plug.at("query","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Je))}},{key:"getResourceString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!("key"in e))return Promise.reject("No resource key was supplied");var t=this.plug.at("localization",e.key);return"lang"in e&&(t=t.withParam("lang",e.lang)),t.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.text()}))}},{key:"getResourceStrings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.keys,n=e.lang;if(!t||!Array.isArray(t))return Promise.reject(new Error("The keys parameter must be supplied, and it must be an array."));var r={resources:t.join(",")};if(n){if("string"!=typeof n)return Promise.reject(new Error("The lang parameter must be a string"));r.lang=n}return this.plug.at("localizations").withParams(r).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(kn))}},{key:"getSearchQueryLogUrl",value:function(e){return void 0===e||0===e.length?Promise.reject(new Error("Attempting to get log url without required name")):this.plug.at("query","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ye))}},{key:"getSiteActivityLogUrl",value:function(e){return void 0===e||0===e.length?Promise.reject(new Error("Attempting to get log url without required name")):this.plug.at("activity","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Ye))}},{key:"getTags",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=F.createParser(gn);return this.plug.at("tags").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"setTags",value:function(){var e,t,n=(e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t='<?xml version="1.0"?><tags>',Array.isArray(e.add)&&e.add.length>0&&e.add.forEach((function(e){var n='<tag.add value="'.concat(re(e.name),'">');e.pageids.forEach((function(e){n+='<page id="'.concat(e,'"></page>')})),t+=n+="</tag.add>"})),Array.isArray(e.remove)&&e.remove.length>0&&e.remove.forEach((function(e){var n='<tag.remove value="'.concat(re(e.name),'">');e.pageids.forEach((function(e){n+='<page id="'.concat(e,'"></page>')})),t+=n+="</tag.remove>"})),t="".concat(t,"</tags>")),r=F.createParser(vn);return this.plug.at("tags").post(n,"application/xml").catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(r)}},{key:"search",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.limit,r=void 0===n?10:n,i=t.offset,a=void 0===i?0:i,s=t.q,o=void 0===s?"":s,l=t.path,c=void 0===l?"":l,u=t.recommendations,d=void 0===u||u,h=t.recommendedIds,m=void 0===h?[]:h,f=t.tags,p=void 0===f?"":f,g=t.classifications,y=void 0===g?"":g,b=t.type,w=void 0===b?"":b,_=t.constraint,k=void 0===_?"":_,P=t.namespace,S=void 0===P?"main":P,C=t.sessionid,T=void 0===C?null:C,E=t.includeAggregations,x=void 0!==E&&E,R=t.apiVersion,j=void 0===R?1:R,A=t.notrack,I=void 0!==A&&A,N=t.parser,L=void 0===N?"bestguess":N,D=t.conditionals,q=void 0===D?[]:D,M=t.terms,O=void 0===M?[]:M,z=t.dekiEventType,U=void 0===z?"":z;"string"==typeof c&&(c=c.length>=1?[c]:[""]),c=c.map((function(e){return e.replace(/^\//,"")}));var B={limit:r,offset:a,q:o,recommendations:d,sortBy:"-rank"},H=ht.object(B,ct("offset",(function(e){return e>=0?[]:["The offset value must not be negative."]})));if(H.length>0)return Promise.reject(new Error(H.join(", ")));T&&(B.sessionid=T);var V,W=fn;if("string"==typeof(V=S)&&(V=V.split(",")),S=V.map((function(e){return e.toLowerCase()})),1===j){if(!k){var $={};""!==c[0]&&($.path=c),""!==p&&($.tags=p),""!==w&&($.type=w),$.namespaces=S,k=Pn($)}e=Object.assign({},B,{summarypath:encodeURI(c),constraint:k})}else{W=pn;var K=c[0];c.length>1&&(K="/");var G=[],Q="";if(q.length>0){var J=!0,Y=!1,X=void 0;try{for(var Z,ee=function(){var e=Z.value;e+=":";var t=v(O).map((function(t){return e+t}));G.push.apply(G,v(t))},te=q[Symbol.iterator]();!(J=(Z=te.next()).done);J=!0)ee()}catch(e){Y=!0,X=e}finally{try{J||null==te.return||te.return()}finally{if(Y)throw X}}Q=G.join(" OR ")}else O.length>0&&(Q=O.join(" "));Q.length>0&&(o.length>0?B.q+=" "+Q:B.q=Q);var ne=c.map((function(e){return e.replace(/,/g,"%2C")}));e=Object.assign({},B,{aggpath:K,classifications:y,includeaggs:x,namespaces:S,pathancestors:ne,recommendedids:m,tags:p,types:w,notrack:I,parser:L})}return""!==U&&(e.trackeventtype=U),this.plug.at("query").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(W))}},{key:"searchIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.q,n=void 0===t?"":t,r=e.limit,i=void 0===r?100:r,a=e.offset,s=void 0===a?0:a,o=e.sortBy,l=void 0===o?"-score":o,c=e.constraintString,u=void 0===c?null:c,d=e.constraints,h=void 0===d?{}:d,m=e.verbose,f=void 0===m||m,p=e.parser,g=void 0===p?"bestguess":p,v=e.format,y=void 0===v?"xml":v;if("string"==typeof i&&"all"!==i)return Promise.reject(new Error('The limit for index searching must be a number or "all"'));var b={q:n,limit:i,offset:s,sortby:l,constraint:u||Pn(h),verbose:f,parser:g,format:y};return this.plug.at("search").withParams(b).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(fn))}},{key:"getSearchAnalytics",value:function(e){var t=e.start,n=void 0===t?null:t,r=e.end,i=void 0===r?null:r,a=e.queryFilters,s=void 0===a?null:a,o=e.userFilter,l=void 0===o?null:o,c=e.groupIds,u=void 0===c?null:c,d=e.bucket,h=void 0===d?null:d,m=e.origin,f=void 0===m?null:m,p=e.webWidgetEmbedId,g=void 0===p?null:p,v=e.recommendedfocusfilter,y=void 0===v?null:v,b=e.sortBy,w=void 0===b?null:b,_=e.sortOrder,k=void 0===_?null:_,P=e.limit,S={start:n,end:i,queryFilters:s,userFilter:l,groupids:u,bucket:h,recommendedfocusfilter:y,originFilter:f,web_widget_embed_id:g,sortby:w,sortorder:k,limit:void 0===P?null:P};return this.plug.at("search","analytics").withParams(le(S)).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(bn))}},{key:"getSearchAnalyticsQuery",value:function(e){var t=e.query,n=e.start,r=void 0===n?null:n,i=e.end,a=void 0===i?null:i,s=e.userFilter,o=void 0===s?null:s,l=e.groupIds,c=void 0===l?null:l,u=e.bucket,d=void 0===u?null:u,h=e.origin,m=void 0===h?null:h,f=e.webWidgetEmbedId,p=void 0===f?null:f,g=e.sortBy,v=void 0===g?null:g,y=e.sortOrder,b=void 0===y?null:y,w=e.limit,_={query:t,start:r,end:a,userFilter:o,groupids:c,bucket:d,originFilter:m,web_widget_embed_id:p,sortby:v,sortorder:b,limit:void 0===w?null:w};return this.plug.at("search","analytics","query").withParams(le(_)).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(wn))}},{key:"getSearchAnalyticsQueriesCsvUrl",value:function(e){var t=e.start,n=void 0===t?null:t,r=e.end,i=void 0===r?null:r,a=e.userFilter,s=void 0===a?null:a,o=e.queryFilters,l=void 0===o?null:o,c=e.webWidgetEmbedId,u=void 0===c?null:c,d=e.origin,h=void 0===d?null:d,m=e.sortBy,f=void 0===m?null:m,p=e.sortOrder,g=void 0===p?null:p,v=e.groupIds,y=void 0===v?null:v,b=e.recommendedfocusfilter,w=void 0===b?null:b,_=e.limit,k={start:n,end:i,userfilter:s,queryfilters:l,web_widget_embed_id:u,originfilter:h,sortby:f,sortorder:g,groupids:y,recommendedfocusfilter:w,limit:void 0===_?null:_};return this.plug.at("search","analytics","queries.csv").withParams(le(k)).withoutParam("dream.out.format").url}},{key:"getSearchAnalyticsQueryDetailsCsvUrl",value:function(e){var t=e.query,n=e.start,r=void 0===n?null:n,i=e.end,a=void 0===i?null:i,s=e.userFilter,o=void 0===s?null:s,l=e.groupIds,c=void 0===l?null:l,u=e.origin,d=void 0===u?null:u,h=e.webWidgetEmbedId,m=void 0===h?null:h,f=e.sortBy,p=void 0===f?null:f,g=e.sortOrder,v=void 0===g?null:g,y=e.recommendedfocusfilter,b=void 0===y?null:y,w=e.limit,_={query:t,start:r,end:a,userfilter:o,groupids:c,originfilter:d,web_widget_embed_id:m,sortby:p,sortorder:v,recommendedfocusfilter:b,limit:void 0===w?null:w};return this.plug.at("search","analytics","querydetails.csv").withParams(le(_)).withoutParam("dream.out.format").url}},{key:"getActivity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.plug.at("activity");if(null!==e){if(!(e instanceof Date))return Promise.reject(new Error("The `since` parameter must be of type Date."));var n=oe(e);t=t.withParam("since",n)}return t.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(yn))}},{key:"getRoles",value:function(){return this.plug.at("roles").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(_n))}},{key:"sendFeedback",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.comment,n=e.title,i=e.metadata,a=void 0===i?{}:i;if("string"!=typeof t)return Promise.reject(new Error("The `comment` parameter must be supplied, and must be a string."));var s="<feedback>";if(s+="<body>".concat(t,"</body>"),n){if("string"!=typeof n)return Promise.reject(new Error("The title parameter must be a string."));s+="<title>".concat(n,"</title>")}return s+="<metadata>","object"!==r(a)?Promise.reject(new Error("The `metadata` parameter must be an object.")):(Object.keys(a).forEach((function(e){s+="<".concat(e,">").concat(a[e].toString(),"</").concat(e,">")})),s+="</metadata>",s+="</feedback>",this.plug.at("feedback").post(s,ee).catch((function(e){return Promise.reject(e)})))}},{key:"getDraftsCsvUrl",value:function(e){return this.plug.at("queryResults.csv").withParams(e).url}}]),e}(),Cn=[{field:"@id",name:"id"},{field:"@type",name:"type"},{field:"@status",name:"status"},{field:"lastmodified",name:"lastModified",transform:"date"},{field:"submitted",transform:"date"},{field:"started",transform:"date"},{field:"user",transform:B},{field:["data","totalinstances"],name:"totalInstances",transform:"number"},{field:["data","totalpageswithinstances"],name:"totalPagesWithInstances",transform:"number"}],Tn=[{field:"exclude-pages",name:"excludePages",transform:[{field:"page",transform:H}]},{field:["include-hierarchy","hierarchy-path"],isArray:!0,name:"paths",transform:[{field:"@guid",name:"guid"},{field:"@title",name:"title"},{field:"@path",name:"path"}]},{field:["terms","term"],transform:[{field:"key",name:"term"},{field:"value",name:"replacement"}],isArray:!0},{field:"@pagesestimate",name:"pagesEstimate"},{field:"@reverted",name:"reverted",transform:"boolean"},{field:"@undoJobId",name:"undoJobId"},{field:"options",transform:[{field:"pagesummaries",transform:"boolean"},{field:"pagecontent",transform:"boolean"}]}],En=[{field:"job",name:"jobs",isArray:!0,transform:Cn}],xn=[{field:"entry",name:"entries",isArray:!0,transform:[{field:"instances-replaced",name:"instancesReplaced",transform:"number"},{field:"status"}]}],Rn=F.createParser(K);function jn(e){if(!e)throw new Error("The find and replace options must be supplied.");if(!("hierarchyPaths"in e))throw new Error("A hierarchy path must be included.");if(!Array.isArray(e.hierarchyPaths))throw new Error("The hierarchy paths option must be an array.");if(e.hierarchyPaths.forEach((function(e){if(void 0===e.guid)throw new Error("Each hierarchy must have a guid.")})),"pages"in e&&!Array.isArray(e.pages))throw new Error("The pages option must be an array.");if(!("terms"in e))throw new Error("One or more terms must be specified for find and replace.");if(!Array.isArray(e.terms))throw new Error("The terms option must be an array.");if(e.terms.forEach((function(e){if(void 0===e.term||void 0===e.replacement)throw new Error("Each term must have a find value and a replace value.")})),void 0===e.pagesummaries&&void 0===e.pagecontent)throw new Error("One or more options must be specified for find and replace.");var t,n=_t(),r=n.createElement("find-and-replace-manifest");e.pagesEstimate&&e.pagesEstimate>0&&r.setAttribute("pagesestimate",e.pagesEstimate),e.pages&&e.pages.length>0&&(t=n.createElement("exclude-pages"),e.pages.forEach((function(e){var r=n.createElement("page");r.setAttribute("guid",e.guid),r.setAttribute("exclude-subpages",!0),t.appendChild(r)})));var i=n.createElement("include-hierarchy");e.hierarchyPaths.forEach((function(e){var t=n.createElement("hierarchy-path");e.guid&&(t.setAttribute("guid",e.guid),t.setAttribute("title",e.title),t.appendChild(n.createTextNode("/".concat(e.path)))),i.appendChild(t)}));var a=n.createElement("terms");e.terms.forEach((function(e){var t=n.createElement("term");if(e.term){var r=n.createElement("key");r.appendChild(n.createTextNode(encodeURI(e.term))),t.appendChild(r)}if(e.replacement){var i=n.createElement("value");i.appendChild(n.createTextNode(encodeURI(e.replacement))),t.appendChild(i)}a.appendChild(t)}));var s=n.createElement("pagesummaries");s.appendChild(n.createTextNode("false"));var o=n.createElement("pagecontent");o.appendChild(n.createTextNode("false")),e.pagesummaries&&(s=n.createElement("pagesummaries")).appendChild(n.createTextNode(e.pagesummaries)),e.pagecontent&&(o=n.createElement("pagecontent")).appendChild(n.createTextNode(e.pagecontent));var l=n.createElement("options");return l.appendChild(s),l.appendChild(o),t&&r.appendChild(t),r.appendChild(i),r.appendChild(a),r.appendChild(l),r}var An=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;if(s(this,e),!t||"string"!=typeof t)throw new Error("The job ID must be supplied as a GUID string.");this._plug=new E(n.host,n.plugConfig).at("@api","deki","site","jobs",t),this._manifestPlug=new E(n.host,n.plugConfig).at("@api","deki","site","jobs","findreplace",t)}return l(e,[{key:"getStatus",value:function(){return this._plug.at("status").get().catch((function(e){return Promise.reject(Rn(e))})).then((function(e){return e.json()})).then(F.createParser(Cn))}},{key:"cancel",value:function(){return this._plug.at("cancel").post().catch((function(e){return Promise.reject(Rn(e))})).then((function(e){return e.json()})).then(F.createParser(Cn))}},{key:"undo",value:function(){return this._manifestPlug.at("undo").post().catch((function(e){return Promise.reject(Rn(e))})).then((function(e){return e.json()})).then(F.createParser(Cn))}},{key:"getManifest",value:function(){return this._manifestPlug.get().catch((function(e){return Promise.reject(Rn(e))})).then((function(e){return e.json()})).then(F.createParser(Tn))}},{key:"getFindAndReplaceReport",value:function(){return this._manifestPlug.at("report","verbose").get().catch((function(e){return Promise.reject(Rn(e))})).then((function(e){return e.json()})).then(F.createParser(xn)).then((function(e){e.totalReplacements=0,e.totalPages=0;try{e.entries.forEach((function(t){e.totalPages+=t.instancesReplaced>0?1:0,e.totalReplacements+=t.instancesReplaced}))}catch(e){}return e}))}}]),e}(),In=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._plug=new E(t.host,t.plugConfig).at("@api","deki","site","jobs")}var t,n;return l(e,[{key:"scheduleExport",value:function(e){if(!e)return Promise.reject(new Error("The export options must be supplied"));var t=!1;if("email"in e&&(t=!0),"url"in e&&(t=!0),!1===t)return Promise.reject(new Error("Notification email and url are missing. Need an email or url to notify when the job completes."));if(!("pages"in e))return Promise.reject("One or more pages must be specified for export.");if(!Array.isArray(e.pages))return Promise.reject("The pages option must be an array.");var n=e.pages.reduce((function(e,t){var n="<page";return t.id&&(n+=' id="'.concat(t.id,'"')),"includeSubpages"in t&&(n+=' includesubpages="'.concat(t.includeSubpages,'"')),n+=">",t.path&&(n+="<path>".concat(t.path,"</path>")),e+(n+="</page>")}),""),r="<job><notification>";return e.email&&(r+="<email>".concat(e.email,"</email>")),e.url&&(r+="<url>".concat(e.url,"</url>")),r+="</notification>",r+="<pages>".concat(n,"</pages>"),r+="</job>",this._plug.at("export").post(r,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Cn))}},{key:"scheduleImport",value:function(e){if(!e)return Promise.reject(new Error("The import options must be supplied"));var t=!1;if("email"in e&&(t=!0),"url"in e&&(t=!0),!1===t)return Promise.reject(new Error("Notification email and url are missing. Need an email or url to notify when the job completes."));if("string"!=typeof e.archiveUrl||""===e.archiveUrl)return Promise.reject(new Error("An archive url is required, and must be a non-empty string to perform an import."));var n="<job><notification>";return e.email&&(n+="<email>".concat(e.email,"</email>")),e.url&&(n+="<url>".concat(e.url,"</url>")),n+="</notification>",n+="<archive><url>".concat(this._escapeXml(e.archiveUrl),"</url></archive>"),n+="<options>",e.dryRun&&(n+='<option name="dryrun">true</option>'),!1===e.updateAttachments&&(n+='<option name="updateattachments">false</option>'),n+="</options>",n+="</job>",this._plug.at("import").post(n,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Cn))}},{key:"uploadExternalImportArchiveFile",value:(n=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._plug.at("externalimport","uploadurl").get().then((function(e){return e.json()}));case 2:return n=e.sent,e.next=5,this._uploadFileToS3(t,n.uploadurl,"application/zip");case 5:return e.abrupt("return",n.importurl);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"scheduleExternalImport",value:function(e){if(!e)return Promise.reject(new Error("The external import options must be supplied"));if("string"!=typeof e.archiveUrl||""===e.archiveUrl)return Promise.reject(new Error("An archive url is required, and must be a non-empty string to perform an import."));var t=_t(),n=t.createElement("job");if(e.email){var r=t.createElement("notification");Nn(t,r,"email",e.email),n.appendChild(r)}var i=t.createElement("archive");Nn(t,i,"url",e.archiveUrl),e.sourceDomain&&Nn(t,i,"domain",e.sourceDomain),n.appendChild(i);var a=t.createElement("options");return"boolean"==typeof e.isPublicImport&&Nn(t,a,"publicimport",e.isPublicImport),"boolean"==typeof e.dryRun&&Nn(t,a,"dryrun",e.dryRun),"boolean"==typeof e.importUnreferencedMedia&&Nn(t,a,"importallfiles",e.importUnreferencedMedia),n.appendChild(a),this._plug.at("externalimport").post(n.outerHTML,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Cn))}},{key:"scheduleFindAndReplace",value:function(e){var t;try{t=jn(e)}catch(e){return Promise.reject(e)}return this._plug.at("findreplace").post(t.outerHTML,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Cn))}},{key:"scheduleContentAdequacyReport",value:function(e){var t=e?.questionIds??[];if(!Array.isArray(t)||0===t.length)return Promise.reject(new Error("At least one question ID must be provided."));var n=_t(),r=n.createElement("questions");t.forEach((function(e){var t=n.createElement("question-id");t.appendChild(n.createTextNode(String(e))),r.appendChild(t)}));var i=n.createElement("path-ancestor");i.textContent=e?.pathAncestor??"",r.appendChild(i);var a=r.outerHTML;return this._plug.at("content-adequacy","report").post(a,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Cn))}},{key:"scheduleCompletionEvaluationReport",value:function(e){var t=e?.questionIds??[];if(!Array.isArray(t)||0===t.length)return Promise.reject(new Error("At least one question ID must be provided."));var n=_t(),r=n.createElement("questions");t.forEach((function(e){var t=n.createElement("question-id");t.appendChild(n.createTextNode(String(e))),r.appendChild(t)}));var i=n.createElement("path-ancestor");i.textContent=e?.pathAncestor??"",r.appendChild(i);var a=r.outerHTML;return this._plug.at("completion-evaluation","report").post(a,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Cn))}},{key:"getJobsStatuses",value:function(){return this._plug.at("status").get().catch((function(e){return Promise.reject(Rn(e))})).then((function(e){return e.json()})).then(F.createParser(En))}},{key:"_escapeXml",value:function(e){return e.replace(/[<>&'"]/g,(function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}}))}},{key:"_uploadFileToS3",value:(t=a(regeneratorRuntime.mark((function e(t,n,r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{method:"PUT",body:t,headers:{"Content-Type":r}});case 2:if((i=e.sent).ok){e.next=5;break}throw new Error("Upload failed with status: ".concat(i.status));case 5:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}();function Nn(e,t,n,r){var i=e.createElement(n);return i.appendChild(e.createTextNode(r)),t.appendChild(i),i}var Ln=Object.freeze({__proto__:null,SiteJob:An,SiteJobManager:In,createFindAndReplaceManifest:jn}),Dn=[{field:"property",name:"properties",isArray:!0,transform:[{field:"@name",name:"name"},{field:"@href",name:"href"},{field:"@etag",name:"etag"},{field:"@resource-is-deleted",name:"isDeleted",transform:"boolean"},{field:"contents",transform:[{field:"@type",name:"type"},{field:"@href",name:"href"},{field:"#text",name:"value"}]},{field:"date.modified",name:"dateModified",transform:"date"},{field:"user.modified",name:"userModified"},{field:"change-description",name:"changeDescription"}]}],Fn=F.createParser(K),qn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._plug=new E(t.host,t.plugConfig).at("@api","deki","site","properties")}return l(e,[{key:"get",value:function(){return this._plug.get().catch((function(e){return Promise.reject(Fn(e))})).then((function(e){return e.json()})).then(F.createParser(Dn)).then((function(e){var t=new Map;return e.properties.forEach((function(e){return t.set(e.name,e)})),t}))}},{key:"getProperty",value:function(e){var t;return this._plug.at(encodeURIComponent(encodeURIComponent(e))).get().catch((function(e){return Promise.reject(Fn(e))})).then((function(e){return"string"==typeof(t=e.headers.get("ETag"))&&(t=t.replaceAll('"',"")),e.json()})).then((function(e){return{etag:t,contents:e}}))}},{key:"delete",value:function(e){var t=ht.object({key:e},ct("key",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})));return t.length>0?Promise.reject(new Error(t)):this._plug.at(e).delete().catch((function(e){return Promise.reject(Fn(e))}))}},{key:"set",value:function(e){var t=g(this._validatePropertiesArray(e),2),n=t[0],r=t[1];if(!n)return Promise.reject(new Error(r));var i=_t(),a=i.createElement("properties");return e.forEach((function(e){var t=i.createElement("property");t.setAttribute("name",e.name),e.etag&&t.setAttribute("etag",e.etag);var n=i.createElement("contents");n.setAttribute("type",e.contents.type),n.textContent=e.contents.value,t.appendChild(n),a.appendChild(t)})),this._plug.put(a.outerHTML,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return 207===e.status?Promise.reject({message:"Something went wrong, please reload the page and try again."}):e})).then((function(e){return e.json()})).then(F.createParser(Dn)).then((function(e){var t=new Map;return e.properties.forEach((function(e){return t.set(e.name,e)})),t}))}},{key:"_validatePropertiesArray",value:function(e){var t;if(!Array.isArray(e))return[!1,"The `properties` parameter must be an array."];var n=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o,l=a.value;if(t=ht.object(l,ct("name",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),ct("contents")),void 0!==l.contents&&null!==l.contents)(o=t).push.apply(o,v(ht.object(l.contents,ct("type",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),ct("value",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})))))}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return t.length>0?[!1,t]:[!0,"success"]}}]),e}(),Mn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;s(this,e),this._id=ae(t,"current"),this._plug=new E(n.host,n.plugConfig).at("@api","deki","users",this._id),this._errorParser=F.createParser(K)}return l(e,[{key:"getInfo",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).exclude,t=void 0===e?[]:e,n=ht.value(t,it());return n.length>0?Promise.reject(new Error(n.join(", "))):this._plug.withParam("exclude",t.join(",")).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(B))}},{key:"checkAllowed",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ht.value(e,it());if(n.length>0)return Promise.reject(new Error(n.join(", ")));var r=ht.object(t,lt("mask",(function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]})),lt("operations",it()),lt("verbose",(function(e){return"boolean"==typeof e?[]:["".concat(e," is not a Boolean value")]})),lt("invert",(function(e){return"boolean"==typeof e?[]:["".concat(e," is not a Boolean value")]})));if(r.length>0)return Promise.reject(new Error(r.join(", ")));t.operations&&(t.operations=t.operations.join(","));var i=e.map((function(e){return'<page id="'.concat(e,'" />')})).join("");return i="<pages>".concat(i,"</pages>"),this._plug.at("allowed").withParams(t).post(i,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser([{field:"page",name:"pages",isArray:!0,transform:H}]))}},{key:"update",value:function(e){var t=this,n=ht.object(e,lt("active",(function(e){return"boolean"==typeof e?[]:["".concat(e," is not a Boolean value")]})),lt("seated",(function(e){return"boolean"==typeof e?[]:["".concat(e," is not a Boolean value")]})),lt("username",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),lt("fullName",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),lt("email",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),lt("language",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),lt("timeZone",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})));if(n.length>0)return Promise.reject(new Error(n.join(", ")));var r="<user>";return Object.entries(e).forEach((function(e){var t=g(e,2),n=t[0],i=t[1];if("active"===n)r+="<status>".concat(!0===i?"active":"inactive","</status>");else if("seated"===n)r+="<license.seat>".concat(i,"</license.seat>");else{var a=n.toLowerCase();r+="<".concat(a,">").concat(i,"</").concat(a,">")}})),r+="</user>",this._plug.put(r,ee).catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.json()})).then(F.createParser(B))}},{key:"setPassword",value:function(e){var t=this,n=ht.object(e,ct("newPassword",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),lt("currentPassword",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})));if(n.length>0)return Promise.reject(new Error(n.join(", ")));var r={};return e.currentPassword&&(r.currentpassword=e.currentPassword),this._plug.at("password").withParams(r).put(e.newPassword,te).catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.text()})).then((function(e){return{authToken:e}}))}},{key:"setRole",value:function(e){var t=this,n=e.name,r=e.seated,i=void 0===r||r,a=_t(),s=a.createElement("user"),o=a.createElement("license.seat");o.textContent=i.toString();var l=a.createElement("permissions.user"),c=a.createElement("role");return c.textContent=n,l.appendChild(c),s.appendChild(l),s.appendChild(o),this._plug.put(s.outerHTML,ee).catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.json()})).then(F.createParser(B))}}]),e}(),On=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._settings=t,this._plug=new E(t.host,t.plugConfig).at("@api","deki","users")}return l(e,[{key:"getCurrentUser",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).exclude,t=void 0===e?[]:e,n=ht.value(t,it());return n.length>0?Promise.reject(new Error(n.join(", "))):this._plug.at("current").withParam("exclude",t.join(",")).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(B))}},{key:"getCurrentUserActivityToken",value:function(){return this._plug.at("current").withParam("exclude",["groups","properties"]).get().catch((function(e){return Promise.reject(e)})).then((function(e){return Promise.all([e.json().then(F.createParser(B)),new Promise((function(t,n){var r=e.headers.get("X-Deki-Session");null!==r?t(r):n(new Error("Could not fetch an X-Deki-Session HTTP header from the MindTouch API."))}))])})).then((function(e){var t=g(e,2),n=t[0],r=t[1];return"".concat(n.id,":").concat(r)}))}},{key:"getUsers",value:function(){var e=F.createParser(wt);return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(e)}},{key:"searchUsers",value:function(e){var t=F.createParser(wt);return this._plug.at("search").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"authenticate",value:function(e){var t=e.method,n=void 0===t?"GET":t,r=e.username,i=e.password,a=n.toLowerCase();if(ht.value(a,st(at("get"),at("post"))).length>0)return Promise.reject(new Error("GET and POST are the only valid methods for user authentication."));var s=_.base64.encode("".concat(r,":").concat(i));return this._plug.at("authenticate").withHeader("Authorization","Basic ".concat(s))[a]().then((function(e){return e.text()}))}},{key:"logout",value:function(){return this._plug.at("current","logout").post().then((function(e){return e.text()}))}},{key:"getUser",value:function(){return new Mn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current",this._settings)}},{key:"exchangeEauthToken",value:function(e){return this._plug.at("current","eauthtoken").post(e).catch((function(e){return Promise.reject(e)})).then((function(e){return e.text()}))}}]),e}(),zn=Object.freeze({__proto__:null,User:Mn,UserManager:On}),Un=[{field:"@active",name:"active",transform:"boolean"},{field:"@date",name:"date",transform:"date"},{field:"@id",name:"id",transform:"number"},{field:"@type",name:"type"},{field:"@date.deleted",name:"dateDeleted",transform:"date"},{field:"web-widget.parent",name:"parent",transform:[{field:"@id",name:"id",transform:"number"}]},{field:"host"},{field:"name"},{field:"token"},{field:"arguments"},{field:"code",transform:[{field:"#text",name:"text"},{field:"@format",name:"format"},{field:"@id",name:"id"}]}];Un.push({field:"web-widgets",name:"subWidgetInfo",transform:[{field:"@count",name:"count",transform:"number"},{field:"web-widget",name:"widgets",isArray:!0,transform:Un}]});var Bn=[{field:"@count",name:"count",transform:"number"},{field:"web-widget",name:"webWidgets",isArray:!0,transform:Un}],Hn=F.createParser(K);function Vn(e){if(!e||"object"!==r(e))throw new Error("Web widget data must be an object");if(!Array.isArray(e.arguments)||e.arguments.some((function(e){return!(e&&"string"==typeof e.name&&(t=e.value,"string"==typeof t||"number"==typeof t||"boolean"==typeof t));var t})))throw new Error("Web widget arguments must be an array of objects with a `name` string and a `value` string|number|boolean");if(!Array.isArray(e.hosts)||e.hosts.some((function(e){return"string"!=typeof e})))throw new Error("Web widget hosts must be an array of strings");if("string"!=typeof e.name)throw new Error("Web widget name must be a string");if("string"!=typeof e.type)throw new Error("Web widget type must be a string");if("parentId"in e&&"number"!=typeof e.parentId)throw new Error("Web widget parentId must be a number");var t=e.arguments.map((function(e){return"<".concat(e.name,">").concat(re(e.value),"</").concat(e.name,">")}));return"\n        <web-widget>\n            <arguments>".concat(t.join("\n"),"</arguments>\n            <host>").concat(re(e.hosts.join(",")),"</host>\n            <name>").concat(re(e.name),"</name>\n            <type>").concat(re(e.type),'</type>\n            <web-widget.parent id="').concat("parentId"in e?e.parentId:"",'"></web-widget.parent>\n        </web-widget>\n    ')}var Wn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._plug=new E(t.host,t.plugConfig).at("@api","deki","web-widgets")}return l(e,[{key:"getActiveWidgets",value:function(){return this._plug.get().catch((function(e){return Promise.reject(Hn(e))})).then((function(e){return e.json()})).then(F.createParser(Bn))}},{key:"getInactiveWidgets",value:function(){return this._plug.at("inactive").get().catch((function(e){return Promise.reject(Hn(e))})).then((function(e){return e.json()})).then(F.createParser(Bn))}},{key:"getWidget",value:function(e){var t=ae(e);return this._plug.at(t).get().catch((function(e){return Promise.reject(Hn(e))})).then((function(e){return e.json()})).then(F.createParser(Un))}},{key:"createWidget",value:function(e){return this._plug.post(Vn(e),ee).catch((function(e){return Promise.reject(Hn(e))})).then((function(e){return e.json()})).then(F.createParser(Un))}},{key:"deleteWidget",value:function(e){var t=ae(e);return this._plug.at(t).delete().catch((function(e){return Promise.reject(Hn(e))}))}},{key:"updateWidget",value:function(e,t){var n=ae(e);return this._plug.at(n).put(Vn(t),ee).catch((function(e){return Promise.reject(Hn(e))})).then((function(e){return e.json()})).then(F.createParser(Un))}},{key:"activateWidget",value:function(e){var t=ae(e);return this._plug.at(t,"activate").put().catch((function(e){return Promise.reject(Hn(e))})).then((function(e){return e.json()})).then(F.createParser(Un))}},{key:"deactivateWidget",value:function(e){var t=ae(e);return this._plug.at(t,"deactivate").put().catch((function(e){return Promise.reject(Hn(e))})).then((function(e){return e.json()})).then(F.createParser(Un))}}]),e}(),$n=Object.freeze({__proto__:null,WebWidgetsManager:Wn}),Kn=[{field:"@href",name:"href"},{field:"uri.next",name:"uriNext"}],Gn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._plug=new E(t.host,t.plugConfig).at("@api","deki","workflow")}return l(e,[{key:"submitFeedback",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="submit-feedback";if(!("_path"in e))return Promise.reject(new Error("The _path field must be supplied for ".concat(t)));var n=JSON.stringify({_path:e._path,userEmail:e.userEmail,pageTitle:e.pageTitle,siteUrl:e.siteUrl,content:e.content,contactAllowed:e.contactAllowed});return this._plug.at(t).post(n,ne).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Kn))}},{key:"requestArticle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._plug.at("submit-article-request").post(JSON.stringify(e),ne).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Kn))}},{key:"submitIssue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="submit-issue";return"_path"in e&&"_search"in e?this._plug.at(t).post(JSON.stringify(e),ne).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(F.createParser(Kn)):Promise.reject(new Error("The _path and _search fields must be supplied for ".concat(t)))}}]),e}(),Qn={martianContextId:Y,martianDeveloperToken:fe,martianDraft:He,martianEvents:{Events:et},martianExternalReport:{ExternalReport:mt},martianFile:yt,martianGroup:St,martianLearningPath:jt,martianLicense:{License:Nt},martianPage:Wt,martianPageProperty:{PageProperty:Gt},martianPageSecurity:{PageSecurity:Zt},martianPageSubscription:rn,martianReview:{Review:un},martianSchedule:{Schedule:hn},martianSite:{Site:Sn},martianSiteJob:Ln,martianSiteProperties:{SiteProperties:qn},martianUser:zn,martianWebWidgets:$n,martianWorkflows:{WorkflowManager:Gn}},Jn={},Yn={},Xn={read:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global-settings";if(!(e in Jn)||!0!==Jn[e]){var t="#mt-".concat(e),n=document.querySelector(t);if(n){var r=n.textContent;r&&""!==r||(r=n.text);var i=JSON.parse(r);Object.keys(i).forEach((function(e){Yn[e]=i[e]})),Jn[e]=!0}}},get:function(e){return Yn[e]},set:function(e,t){Yn[e]=t},has:function(e){return void 0!==Yn[e]},clear:function(){Yn={}}};Xn.read();try{var Zn=Xn.get("sessionSettings");null!==Zn&&"object"===r(Zn)&&window.sessionStorage.setItem("sessionSettings",JSON.stringify(Zn));var er=window.sessionStorage.getItem("sessionSettings");er&&null!==(Zn=JSON.parse(er))&&"object"===r(Zn)&&Object.keys(Zn).forEach((function(e){Xn.set(e,Zn[e])}))}catch(e){}function tr(){var e=Xn.get("pageContentViewParser"),t={};return e&&(t["mt-view"]=e),new E(window.location.origin).at("@app").withParams(t)}function nr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.origin,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={origin:"f1"===Xn.get("pageContentViewParser")?"mt-f1":"mt-web"};return new E(e,t).withHeaders(function(){var e={"X-Deki-Client":"mindtouch-web"},t=Xn.get("apiToken");t&&(e["X-Deki-Token"]=t);var n=Xn.get("pageViewId");return n&&(e["X-Deki-Page-View-Id"]=n),"f1"===Xn.get("pageContentViewParser")&&(e["X-Deki-Unseated"]=!0),e}()).withParams(n)}var rr=Object.freeze({__proto__:null,getAppPlug:tr,getPlug:nr,getTemplatePlug:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=Xn.get("pageContentViewParser"),r="=".concat(encodeURIComponent(encodeURIComponent(t)));return nr().at("@api","deki","pages",r,"contents").withParams(Object.assign({"dream.out.format":"json",origin:"f1"===n?"mt-f1":"mt-web",pageid:1,format:"text"},e))}}),ir={_previousSearchQuery:"",_options:{},init:function(e,t,n){n&&(this._options=n),this._options.callBack=t,this._options.elm=e,this._options.elm.jquery&&(this._options.elm=this._options.elm[0]),this._options.elm.addEventListener("paste",(function(){sessionStorage.removeItem("searchSessionId")})),this._options.elm.addEventListener("input",this.triggerSearch())},triggerSearch:function(){var e=null,t=this._options,n=t.reference||this,r=t.elm,i=this._previousSearchQuery,a=t.timeout?t.timeout:400,s=t.minimum?t.minimum:4;return function(){var o=r.value.trim().replace(/\s+/g," "),l=arguments;if(o.length<=1)return i=o,void sessionStorage.removeItem("searchSessionId");i===o||o.length<s?i=o:(i=r.value,clearTimeout(e),e=setTimeout((function(){t.callBack.apply(n,l)}),a))}}},ar={"<":"&lt;",">":"&gt;",'"':"&quot;","&":"&amp;","'":"&#39;"},sr=Object.entries(ar).reduce((function(e,t){var n=g(t,2),r=n[0];return e[n[1]]=r,e}),{}),or=new RegExp("[".concat(Object.keys(ar).join(""),"]"),"g"),lr=new RegExp("".concat(Object.keys(sr).map((function(e){return"(".concat(e,")")})).join("|")),"g");function cr(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(or,(function(e){return ar[e]}))}function ur(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(lr,(function(e){return sr[e]}))}function dr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=""===t?-1:e.indexOf(t);return-1===n?e:e.slice(n+t.length,e.length)}function hr(e,t){var n=e.lastIndexOf(t);return e.substring(n+1)}function mr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\\s";return e.replace(new RegExp("^".concat(t,"+")),"")}function fr(e,t){return""===e?[]:e.trim().split(t||/\s+/)}function pr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:",";if(isNaN(e))return"";var i=(e=e.toFixed(~~t)).split("."),a=i[0],s=i[1]?(n||".")+i[1]:"";return a.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+r)+s}function gr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return e.length>t?e.slice(0,t)+n:e}var vr=Object.freeze({__proto__:null,containsOnlySafeCharacters:function(e){return/^[a-zA-Z0-9_.-\s]+$/.test(e)},escapeHTML:cr,ltrim:mr,numberFormat:pr,strRight:dr,strRightBack:hr,truncate:gr,unescapeHTML:ur,words:fr}),yr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.origin;s(this,e),"string"==typeof t&&(t=t.replace(/\\/g,"%5C")),"string"==typeof n&&(n=n.replace(/\\/g,"%5C")),this._url=new URL(t,n)}return l(e,null,[{key:"tryParse",value:function(t){var n;try{n=new URL(t)}catch(e){return null}return new e(n.href)}}]),l(e,[{key:"toString",value:function(){return this._url.toString()}},{key:"getQueryParam",value:function(e){return this._url.searchParams.get(e)}},{key:"removeQueryParam",value:function(e){return this._url.searchParams.delete(e),this}},{key:"addQueryParam",value:function(e,t){var n=null==t?"":t;return this._url.searchParams.append(e,n),this}},{key:"addQueryParams",value:function(e){var t=this;return Object.entries(e).forEach((function(e){var n=g(e,2),r=n[0],i=n[1];t.addQueryParam(r,i)})),this}},{key:"setQueryParam",value:function(e,t){return this.removeQueryParam(e),this.addQueryParam(e,t),this}},{key:"setQueryParams",value:function(e){var t=this;return Object.entries(e).forEach((function(e){var n=g(e,2),r=n[0],i=n[1];t.setQueryParam(r,i)})),this}},{key:"addSegments",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=function e(t){return t.reduce((function(t,n){return Array.isArray(n)?t+=e(n):("/"===n[0]&&(n=n.slice(1)),t+="/".concat(n)),t}),"")}(t),i=this._url.pathname;return"/"===i&&(i=""),this._url.pathname="".concat(i).concat(r),this}},{key:"hash",get:function(){return this._url.hash},set:function(e){this._url.hash=e}},{key:"host",get:function(){return this._url.host},set:function(e){this._url.host=e}},{key:"hostname",get:function(){return this._url.hostname},set:function(e){this._url.hostname=e}},{key:"href",get:function(){return this._url.href},set:function(e){this._url.href=e}},{key:"password",get:function(){return this._url.password},set:function(e){this._url.password=e}},{key:"pathname",get:function(){return this._url.pathname},set:function(e){this._url.pathname=e}},{key:"port",get:function(){return this._url.port},set:function(e){this._url.port=e}},{key:"protocol",get:function(){return this._url.protocol},set:function(e){this._url.protocol=e}},{key:"search",get:function(){return this._url.search},set:function(e){this._url.search=e}},{key:"username",get:function(){return this._url.username},set:function(e){this._url.username=e}},{key:"origin",get:function(){return this._url.origin}},{key:"searchParams",get:function(){return this._url.searchParams}}]),e}(),br={},wr={_restrictedPasswordWords:["password"],getProtocol:function(){return window.location.protocol.replace(":","")},getOrigin:function(e){var t=window.location;return e&&((t=document.createElement("a")).href=e),t.origin||t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")},xmlRequestType:"application/xml; charset=utf-8",textRequestType:"text/plain; charset=utf-8",jsonRequestType:"application/json; charset=utf-8",formRequestType:"application/x-www-form-urlencoded",strToBool:function(e){return!0===e||"string"==typeof e&&"true"===e.trim().toLowerCase()},formatNumber:function(e,t,n){t=t||".",n=n||",";for(var r=(e=String(e)).split("."),i=r[0],a=r.length>1?t+r[1]:"",s=/(\d+)(\d{3})/;s.test(i);)i=i.replace(s,"$1"+n+"$2");return i+a},formatPageContentViewUri:function(e){var t=new yr(e),n=Xn.get("pageContentViewParser");return n&&t.setQueryParam("mt-view",n),t.toString()},formatBytes:function(e){var t=0;switch(e>1228&&(t+=1,e/=1024),e>1228&&(t+=1,e/=1024),e>1228&&(t+=1,e/=1024),t){case 0:default:return this.formatNumber(Math.round(e))+" bytes";case 1:return this.formatNumber(Math.round(e))+" KiB";case 2:return this.formatNumber(Math.round(10*e)/10)+" MiB";case 3:return this.formatNumber(Math.round(100*e)/100)+" GiB"}},pad:function(e){return(e<10?"0":"")+e},compareDate:function(e,t,n){var r=new Date(e),i=new Date(t),a=!1;if(!window.isNaN(r)&&!window.isNaN(i))switch(n){case"day":a=r.getDate()===i.getDate()&&r.getMonth()===i.getMonth()&&r.getFullYear()===i.getFullYear();break;case"month":a=r.getFullYear()===i.getFullYear()&&r.getMonth()===i.getMonth();break;case"year":a=r.getFullYear()===i.getFullYear();break;default:a=r.toString()===i.toString()}return a},formatLocalization:function(e){if(e){e=wr.getLoc(e);for(var t=0;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","g");e=e.replace(n,arguments[t+1])}return e}},getLoc:function(e){return br[e]||e},setLoc:function(e){var t;for(t in e)e.hasOwnProperty(t)&&(br[t]=e[t])},store:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"local";try{var r=JSON.stringify(t);return void 0!==r&&("session"===n?window.sessionStorage.setItem(e,r):window.localStorage.setItem(e,r),!0)}catch(e){return!1}},fetch:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local",r=null;try{(t="session"===n?window.sessionStorage.getItem(e):window.localStorage.getItem(e))&&(r=JSON.parse(t))}catch(e){return null}return r},clearStorage:function(e){if("session"!==(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local"))try{window.localStorage.removeItem(e)}catch(e){}else window.sessionStorage.removeItem(e)},readCookie:function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){var i=mr(n[r]);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},createCookie:function(e,t,n){var r="";if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),r="; expires="+i.toGMTString()}document.cookie=e+"="+t+r+"; path=/"},isValidEmail:function(e){return new RegExp("^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,4}$").test(e)},searchEscape:function(e){var t=e.toString();return["\\","+","-","&","|","!","(",")","{","}","[","]","^",'"',"~","*","?",":"].forEach((function(e){var n=new RegExp("\\"+e,"g");t=t.replace(n,"\\"+e)})),t},getPasswordStrength:function(e){var t={rating:!0,lengthOk:!0,matchVerify:!0,freeOfRestrictedWords:!0};e.password.length<e.minLength&&(t.lengthOk=!1),e.matchPassword.length>0&&e.matchPassword!==e.password&&(t.matchVerify=!1);var n=0;e.password.match(/[a-z]+/)&&n++,e.password.match(/[A-Z]+/)&&n++,e.password.match(/[0-9]+/)&&n++,e.password.match(/\W+/)&&n++,n<e.minRating&&(t.rating=!1);var r=e.password.toLowerCase(),i=!1;return this._restrictedPasswordWords.forEach((function(e){i=i||r.includes(e)})),i&&(t.freeOfRestrictedWords=!1),t.allOk=t.rating&&t.lengthOk&&t.matchVerify&&t.freeOfRestrictedWords,t},makeArray:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)?e:[e]},makeString:function(e){if("string"==typeof e)return e;if(e instanceof Object&&"#text"in e)return e["#text"];throw new Error("No string or string-containing object found")},importModule:function(e){var t,n=e.path,r=e.moduleName,i=void 0===r?null:r,a=e.exportNamespace,s=void 0===a?"Deki._mtLib":a;if("global"===Xn.get("moduleMode")){"noModule"in document.createElement("script")&&(n=n.replace(/\.js/,".modern.js"));var o=s.split(".").reduce((function(e,t){return e[t]=e[t]||{},e[t]}),window);if(void 0!==o[i])return Promise.resolve(o[i]);t=wr.getCachedJavascript(n.replace("/@lib/src/","/deki/javascript/out/")).then((function(){return o[i]}))}return t},importExternalModule:function(e){var t=e.libVar,n=void 0===t?null:t,r=e.globalPath;return null!==n?Promise.resolve():wr.getCachedJavascript(r)},getCachedJavascript:function(e){var t=this;return new Promise((function(n){var r=document.createElement("script");r.src=t.getCacheUrl(e),r.onload=function(){document.head.removeChild(r),n()},r.onerror=function(){document.head.removeChild(r)},document.head.appendChild(r)}))},translateModulePath:function(e){return"module"!==Xn.get("moduleMode")&&(e=e.replace("/@lib/src/","/deki/javascript/out/")),e},getCacheUrl:function(e){if(Xn.get("cdnHostname")){var t=Xn.get("cacheFingerprint");return t?window.location.protocol+"//"+Xn.get("cdnHostname")+e+"?_="+t:e}return e},finishDeferred:function(e){return function(t){var n=!1;"success"in t&&(n=t.success,delete t.success),n?e.resolve(t):e.reject(t)}},getStringParams:function(e){var t={};return fr(dr(e,"?"),"&").forEach((function(e){var n=e.split("=");n[0]&&(t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]))})),t},buildQueryString:function(e){var t="";return Object.keys(e).forEach((function(n){var r="".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e[n]));t="".concat(t).concat(""!==t?"&":"").concat(r)})),t},guid:function(){function e(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return e()+e(!0)+e(!0)+e()},htmlCleanString:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/\s/g,"-");return e=e.replace(/[^A-Za-z0-9-]/g,"")},extendObject:function(e,t){var n={};return Object.keys(e).forEach((function(t){n[t]=e[t]})),Object.keys(t).forEach((function(e){n[e]=t[e]})),n},findInArray:function(e,t){for(var n=null,r=0;r<e.length;r++){var i=e[r];if(t(i)){n=i;break}}return n},getPagesWithClassifications:function(e,t){if(!e)return[];var n=[];return e.forEach((function(e){e.tags||(e.tags=[]);var r=e;r.classifications={},t.forEach((function(t){var n=e.tags.find((function(e){return e.value.startsWith(t.prefix+":")}));if(n&&t.tags){var i=t.tags.find((function(e){return"".concat(t.prefix,":").concat(e.tag)===n.title}));i&&(r.classifications[t.prefix]=i)}})),n.push(r)})),n},ancestorEscape:function(e){var t=this.searchEscape(e);return["#","<",">"].forEach((function(e){var n=new RegExp(e,"g");t=t.replace(n,encodeURIComponent(e))})),t},canCopyToClipboard:function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},copyTextToClipboard:function(e){var t=e instanceof Element?e:document.querySelector(e),n=window.getSelection(),r=document.createRange();r.selectNodeContents(t),n.removeAllRanges(),n.addRange(r);var i=document.execCommand("copy");return n.removeAllRanges(),i},cleanParams:function(e){return Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&""!==e[t].trim()||delete e[t]})),e},parseJwt:function(e){try{var t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(n)}catch(e){return null}}},_r={_keyName:"related-pages-previous-ids",_maxHistoryLength:10,recordPageView:function(e){var t=wr.fetch(this._keyName)||[];t.length>0&&t[0]===e||(t.unshift(e),t=t.slice(0,this._maxHistoryLength),wr.store(this._keyName,t))},getRecentlyViewedPageIds:function(){return wr.fetch(this._keyName)||[]}},kr=Xn.get("apiToken"),Pr=Xn.get("isXhrIEMode"),Sr=Xn.get("pageContentViewParser"),Cr={host:Xn.get("apiHost")||window.location.origin,origin:Xn.get("apiOrigin")||window.location.origin,queryParams:{"dream.out.format":"json"},headers:{"X-Deki-Client":"mindtouch-martian"}},Tr="f1"===Sr;Cr.queryParams.origin=Tr?"mt-f1":"mt-web",Tr&&(Cr.headers["X-Deki-Unseated"]=!0),Pr&&(Cr.headers.pragma="no-cache"),kr&&(Cr.token=kr);var Er=Xn.get("pageViewId");Er&&(Cr.headers["X-Deki-Page-View-Id"]=Er);var xr=Xn.get("translatedLanguage"),Rr=Xn.get("pageLanguageCode");xr&&xr.length>0&&(Cr.headers["X-Deki-Translated-Language"]=xr.toUpperCase(),Cr.headers["X-Deki-Effective-Language"]=Rr);var jr=new D(Cr),Ar=Object.freeze({__proto__:null,standardMartianConfig:Cr,standardMartianSettings:jr}),Ir=Xn.get("clientSideWarnings"),Nr=["aria-label","aria-checked","role"];function Lr(e){return e&&(e.nodeType===Node.ELEMENT_NODE||e.nodeType===Node.TEXT_NODE||e.nodeType===Node.DOCUMENT_FRAGMENT_NODE)}function Dr(e){var t=r(e);return"string"===t||"number"===t||"boolean"===t||"function"===t}function Fr(e,t){t.forEach((function(t){qr(e,t)}))}function qr(e,t){var n,r,i,a=!0;return Array.isArray(t)?Fr(e,t):Lr(t)?e.appendChild(t):"string"==typeof t?(n=e,r=t,i=document.createTextNode(r),n.appendChild(i)):t instanceof Promise?function(e,t){var n=Mr("div");e.appendChild(n),t.then((function(t){if(Lr(t))e.replaceChild(t,n);else if(Lr(t.element))e.replaceChild(t.element,n);else if("string"==typeof t){var r=document.createTextNode(t);e.replaceChild(r,n)}else e.removeChild(n)}))}(e,t):a=!1,a}function Mr(e,t){var n=document.createElement(e);if(t){qr(n,t)||null===t||"object"!==r(t)||Object.keys(t).forEach((function(r){if(r in n||(a=r,Nr.includes(a)||a.startsWith("@"))){var i=t[r];"style"===r?function(e,t){Object.keys(t).forEach((function(n){n in e.style?e.style[n]=t[n]:Ir&&console.warn("".concat(n," is not a valid style for a <").concat(e.tagName.toLowerCase(),">"))}))}(n,i):"dataset"===r?function(e,t){Object.keys(t).forEach((function(n){var r=t[n];Dr(r)?e.dataset[n]=r:Ir&&console.warn("Unable to set data property ".concat(r," on <").concat(e.tagName.toLowerCase(),">"))}))}(n,i):Nr.includes(r)?n.setAttribute(r,i):r.startsWith("@")?n.setAttribute(r.substring(1),i):Dr(i)?n[r]=i:Ir&&console.warn("Unable to set value ".concat(i," for property ").concat(r," of a <").concat(e,">"))}else Ir&&console.warn("".concat(r," is not a valid property of a <").concat(e,">"));var a}));for(var i=arguments.length,a=new Array(i>2?i-2:0),s=2;s<i;s++)a[s-2]=arguments[s];a&&a.length>0&&Fr(n,a)}return n}function Or(){for(var e=document.createDocumentFragment(),t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Fr(e,n),e}var zr=new DOMParser;function Ur(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=zr.parseFromString(e,"image/svg+xml").documentElement;if(t){var r=n.querySelector("title");r&&r.parentNode.removeChild(r)}return n}function Br(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.create){var n=e.create(t);return n.element?n.element:n}Ir&&console.warn("Attempting to create a component element that does not implement a `create` function.")}var Hr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["a"].concat(t))},Vr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["button"].concat(t))},Wr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["div"].concat(t))},$r=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["p"].concat(t))},Kr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["span"].concat(t))},Gr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["ul"].concat(t))},Qr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["li"].concat(t))},Jr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["input"].concat(t))},Yr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["label"].concat(t))},Xr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["table"].concat(t))},Zr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["tr"].concat(t))},ei=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["td"].concat(t))},ti=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["th"].concat(t))},ni=Object.freeze({__proto__:null,a:Hr,button:Vr,component:Br,div:Wr,fragment:Or,input:Jr,label:Yr,li:Qr,makeElement:Mr,ol:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["ol"].concat(t))},p:$r,slot:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["slot"].concat(t))},span:Kr,style:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Mr.apply(void 0,["style"].concat(t))},svg:Ur,table:Xr,td:ei,template:function(){for(var e=Mr("template"),t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){e.content.appendChild(t)})),e},text:function(e){return document.createTextNode(e)},th:ti,tr:Zr,ul:Gr}),ri={TreeBrowser:{LinkPicked:"Events.TreeBrowser.LinkPicked"},Tags:{TagAdded:"Events.Tags.TagAdded",TagRemoved:"Events.Tags.TagRemoved"},Rating:{NegativeFeedbackLeft:"Events.Rating.NegativeFeedbackLeft"},Files:{UploadComplete:"Events.Files.UploadComplete",UploadProgress:"Events.Files.UploadProgress",VersionUploaded:"Events.Files.VersionUploaded",RevisionUploadRequested:"Events.Files.RevisionUploadRequested",RevisionUploaded:"Events.Files.RevisionUploaded"},Nav:{Loaded:"Events.Nav.Loaded"},Flash:{Show:"Events.Flash.Show",Hide:"Events.Flash.Hide"},Template:{Loaded:"Events.Template.Loaded"},PageThumbnail:{Added:"Events.PageThumbnail.Added",Removed:"Events.PageThumbnail.Removed"}},ii=Object.freeze({__proto__:null,events:ri,generateEventName:function(e,t){return"mindtouch-web:".concat(e,":").concat(t)}});function ai(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).bindToContainer;e&&e.nodeType===Node.ELEMENT_NODE&&(e.classList.add("mt-loading"),t&&e.classList.add("mt-loading-force-container-bounds"))}function si(e){e&&e.nodeType===Node.ELEMENT_NODE&&(e.classList.remove("mt-loading"),e.classList.remove("mt-loading-force-container-bounds"))}var oi=Object.freeze({__proto__:null,hideFullPageSpinner:function(){document.querySelector("body > .mt-full-page-spinner").remove()},hideSpinner:si,showFullPageSpinner:function(e){var t=Wr({className:"mt-loading mt-full-page-spinner"},$r(e));document.body.appendChild(t)},showSpinner:ai});function li(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function ci(e,t){t.parentNode.insertBefore(e,t.nextSibling)}function ui(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return Array.from(t.querySelectorAll(e))}function di(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function t(){document.removeEventListener("DOMContentLoaded",t),e()})):e()}function hi(e,t,n){n?e.classList.add(t):e.classList.remove(t)}var mi="ontouchstart"in document.documentElement&&"function"==typeof window.matchMedia&&window.matchMedia("(max-device-width:1024px)").matches;function fi(e){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<e}function pi(e){var t=e.textContent.replace("/*<![CDATA[*/","").replace("/*]]>*/","");return JSON.parse(t)}var gi=function(){function e(){s(this,e)}return l(e,null,[{key:"close",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;e.style.border="none",e.style.margin=0,e.style.maxHeight="0px",e.style.overflow="hidden",e.style.padding=0,e.style.transition="max-height ".concat(t,"ms cubic-bezier(0, 1, 0, 1)")}},{key:"open",value:function(e,t){e.style.border=null,e.style.margin=null,e.style.maxHeight=null,e.style.overflow=null,e.style.padding=null,e.style.transition="max-height ".concat(t,"ms cubic-bezier(0, 1, 0, 1)")}},{key:"toggle",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return e.isClosed(t)?e.open(t):e.close(t,n)}},{key:"isOpen",value:function(t){return!e.isClosed(t)}},{key:"isClosed",value:function(e){return"0px"===e.style.maxHeight}}]),e}();var vi=Object.freeze({__proto__:null,Slider:gi,attachEventListenerToElements:function(e,t,n){for(var r=0;r<e.length;r++)e[r].addEventListener(t,n)},elementArray:ui,forceToggleClass:hi,insertAfter:ci,isSmallTouchDevice:mi,isTouchAndViewportUnderWidth:function(e){return"ontouchstart"in document.documentElement&&fi(e)},isViewportUnder:fi,onDocumentReady:di,onWindowLoad:function(e){"complete"===document.readyState?e():window.addEventListener("load",e)},parseCData:pi,parseErrorMessage:function(e){if(e.detail){if(e.detail.info&&e.detail.info.message)return e.detail.info.message;if(e.detail.message)return e.detail.message}return e.data&&e.data.message?e.data.message:e.info&&e.info.message?e.info.message:e.message?e.message:"Unknown Error"},removeChildren:li,removeNode:function(e){e.parentNode.removeChild(e)},toggleAttribute:function(e,t,n){return null!==e.getAttribute(t)?!!n||(e.removeAttribute(t),!1):!1!==n&&(e.setAttribute(t,""),!0)},tryParseDomJson:function(e){try{return JSON.parse(e.textContent)}catch(e){}}}),yi={_messageFadeOut:function(e){e&&void 0!==e.jquery&&e.length>1&&e[0].remove()},_handleMessageClose:function(e){var t=e.parentElement;t&&(t.style.maxHeight="500px",e.addEventListener("click",(function(){t.style.transition="max-height .5s cubic-bezier(0, 1, 0, 1)",void 0===t.ontransitionend?t.remove():(t.addEventListener("transitionend",t.remove),t.style.border="none",t.style.marginBottom=0,t.style.marginTop=0,t.style.maxHeight="0px",t.style.overflow="hidden")})))},Flash:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(""!==e){t=t||"error";var r=document.getElementById("flash-messages"),i=document.getElementById(n.target||"")||r.querySelector(".dekiFlash"),a=i.querySelector(".".concat(t,"msg")),s=(new DOMParser).parseFromString(e,"text/html"),o=Qr.apply(void 0,v(s.body.childNodes));null===a?(a=Wr({className:"".concat(t,"msg systemmsg"),id:"".concat(t,"Msg")},!n.hideCloseButton&&Vr({className:"ui-button-icon delete-msg mt-icon-delete-msg",title:"Close message"},"Close message"),Wr({className:"inner mt-icon-flash-message"},Gr(o))),i.appendChild(a)):(a.querySelector("ul").appendChild(o),n.hideCloseButton&&r.querySelector(".delete-msg").classList.add("mt-hide")),!0===n.scrollTop&&$("html, body").animate({scrollTop:0},"fast");var l=n.target?i.querySelector(".delete-msg"):r.querySelector(".delete-msg");l&&(yi._handleMessageClose(l),l.focus())}},FlashReload:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).target,r=void 0===n?"":n,i=wr.fetch("mindtouch-flash-message");(i=i||[]).push({text:e,type:t,target:r}),wr.store("mindtouch-flash-message",i)},EmptyFlash:function(e){"all"===(e=e||"error")?(this.EmptyFlash("success"),this.EmptyFlash("error"),this.EmptyFlash("info")):document.querySelectorAll(".".concat(e,"msg")).forEach((function(e){return e.remove()}))},PageRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new yr(window.location.toString());t.setQueryParams(e),window.location.toString()===t.toString()?window.location.reload(!0):window.location.href=t.toString()},redirectTo:function(e){(window.parent?window.parent.window:window).location.href=e},appendPageHtml:function(e,t,n){n.empty(),ai(n[0]),new Ht(Xn.get("pageId"),jr).getHtmlTemplate(e,t).then((function(e){var t=e.body;$(t).each((function(){var e=$(this);e.is("script")?$("head").append(e):n.append(e)})),si(n[0]),$(document).trigger(ri.Template.Loaded)}))},isSmallTouchDevice:"ontouchstart"in document.documentElement&&"function"==typeof window.matchMedia&&window.matchMedia("(max-device-width:1024px)").matches};di((function(){document.querySelectorAll(".delete-msg").forEach((function(e){yi._handleMessageClose(e)}));var e="mindtouch-flash-message";(wr.fetch(e)||[]).forEach((function(e){yi.Flash(e.text,e.type,{target:e.target})})),wr.clearStorage(e)}));var bi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";s(this,e),"string"!=typeof t&&(t=""),t.startsWith("#")&&(t=t.substr(1)),this._hashStr=t,this._params=wr.getStringParams(t)}return l(e,[{key:"getQueryParams",value:function(){return this._params}},{key:"replaceParams",value:function(t){return new e(wr.buildQueryString(t))}},{key:"withParam",value:function(e,t){var n=this._params;return n[e]=t,this.replaceParams(n)}},{key:"withoutParam",value:function(e){var t=this._params;return delete t[e],this.replaceParams(t)}},{key:"getParam",value:function(e){return this._params[e]}},{key:"toHashString",value:function(){return"#"+this._hashStr}}]),e}(),wi={_hasPushState:window.history&&window.history.pushState,generateHistoryUri:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.pathname,n=new yr(t);return e&&n.addQueryParams(e),n.toString()},getParametersFromQuery:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",t="",n={},r=window.location.hash.substr(1);return"hash"!==e?(t=window.location.search.substr(1),"all"===e&&""!==r&&(t+="&"+window.location.hash.substr(1))):""!==r&&(t+="&"+window.location.hash.substr(1)),t.split("&").forEach((function(e){var t=g(e.split("="),2),r=t[0],i=t[1];i&&""!==i&&(n[r]=decodeURIComponent(i.replace(/\+/g," ")))})),n},pushHistory:function(e,t,n){this._hasPushState?window.history.pushState(e,t,n):window.location.hash=this.getQueryStringAsHash()},replaceHistory:function(e,t,n){this._hasPushState?window.history.replaceState(e,t,n):window.location.hash=this.getQueryStringAsHash()},getQueryStringAsHash:function(e){var t=e.split("?"),n=t.length>1?t[1]:"";return"#".concat(n)}},_i={$visibleElements:[],elementSearchArray:[],config:{},setConfig:function(e){Xn.set("webFontConfig",e)},addGoogleFontFamily:function(e){var t=Xn.get("webFontConfig");t.google=t.google||{},t.google.families=t.google.families||[],t.google.families.push(e),this.setConfig(t)},getFontElements:function(){return this.elementSearchArray},setFontElements:function(e){this.elementSearchArray=Array.isArray(e)?e:[]},addFontElements:function(e){var t=this;e.length>0&&e.forEach((function(e){t.elementSearchArray.indexOf(e)<0&&t.elementSearchArray.push(e)}))},removeFontElements:function(e){var t=this;e.length>0&&e.forEach((function(e){var n=t.elementSearchArray.indexOf(e);n>=0&&t.elementSearchArray.splice(n,1)}))},loadFonts:function(){var e=this,t=e.elementSearchArray.toString().trim(","),n=Xn.get("webFontConfig");1===Object.keys(n).length&&n.google&&null===n.google.families||(n.timeout=3e3,n.loading=function(){e.$visibleElements=$(".wf-loading").find(t).filter(":visible"),e.$visibleElements.css("visibility","hidden")},n.active=function(){e.$visibleElements.css("visibility","visible")},n.inactive=function(){e.$visibleElements.css("visibility","visible")},Xn.set("webFontConfig",n),WebFont.load(n))}},ki=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;return s(this,t),(n=f(this,h(t).call(this,e)))._plug=new E(r.host,r.plugConfig).at("@api","deki","drafts",n._id,"properties"),n}return d(t,e),t}(Kt),Pi=Xn.get("clientSideWarnings");function Si(){var e;Pi&&(e=console).warn.apply(e,arguments)}function Ci(e){return function(t){var n=e[t],r=t;if("string"==typeof n){for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];r=Ti.apply(void 0,[n].concat(a))}else Si("Unable to find a localization for key '".concat(t,"'"));return r}}function Ti(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(e,t,n){var r=new RegExp("\\{"+n+"\\}","g");return e=e.replace(r,t)}),e)}function Ei(e,t){return e.reduce((function(e,n){var r=n;if("string"==typeof t){if(!n.startsWith(t))return e;r=r.replace(t,"")}var i=r.split(/\.|-/).filter((function(e){return""!==e}));return e[r=i.reduce((function(e,t,n){var r=0===n?"toLowerCase":"toUpperCase";return e+t.charAt(0)[r]()+t.substr(1)}),"")]=n,e}),{})}function xi(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).onmissingkeysfetched,r=void 0===n?function(){}:n,i={},a=document.getElementById(e);if(!a)return Si("Localization element with id '".concat(e,"' cannot be found on page")),function(e){return e};var s=a.textContent.replace("/*<![CDATA[*/","").replace("/*]]>*/","");try{Object.assign(i,JSON.parse(s))}catch(t){Si("Error parsing localizations for '#".concat(e,"'"))}var o=Object.keys(i).filter((function(e,t,n){return n[t].match(/\[MISSING: .+]/)}));(o.length>0&&Si("Some of the parsed resources are missing",o),Array.isArray(t))&&function(e){return e&&0!==e.length?(Si("Fetching missing parsed keys from API",e),new Sn(jr).getResourceStrings({keys:e}).then((function(e){var t=e.localizations.filter((function(e){return e.missing}));return t.length>0&&Si("Some resources could not be fetched",t),e.localizations.filter((function(e){return!e.missing})).reduce((function(e,t){return e[t.resource]=t.text,e}),{})}))):Promise.resolve({})}(t.filter((function(e){return!(e in i)}))).then((function(e){Object.assign(i,e),r(e)}));return Ci(i)}var Ri=Object.freeze({__proto__:null,formatApiException:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UI";"UI"!==t&&(e=e.toLowerCase());var n=e.split(".");return n[0]=t,n.join(".")},formatString:Ti,makeFetchedLocalizer:function(e){return new Sn(jr).getResourceStrings({keys:e}).then((function(e){return Ci(e.localizations.reduce((function(e,t){return e[t.resource]=t.text,e}),{}))}))},makeLocalizer:xi,makeLocalizerWithTemplating:function(e){return function(t){var n=JSON.parse(e)[t];void 0===n&&(n=t);for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i&&i.length>0&&v(Array(i.length).keys()).forEach((function(e){n=n.replace("$".concat(e+1),"{".concat(e,"}"))})),Ti.apply(void 0,[n].concat(i))}},mapKeys:Ei}),ji=function(){function e(t){if(s(this,e),"MindTouchComponent"===this.constructor.name)throw new TypeError("MindTouchComponent can not be constructed directly.");this._events={},this._options=t,this._initialOptions=t,this._defaultOptions={}}return l(e,[{key:"initialize",value:function(e){var t=e.defaults,n=e.events,r=void 0===n?[]:n;Object.assign(this._defaultOptions,t),this._options=Object.assign({},this._defaultOptions,this._initialOptions),this.addEvents(r)}},{key:"setOptionsDefaults",value:function(e,t){this._options=Object.assign({},t,e)}},{key:"addEvent",value:function(e,t){"function"==typeof t&&(this._events[e]||(this._events[e]=[]),this._events[e].push(t))}},{key:"addEvents",value:function(e){var t=this;e.forEach((function(e){var n=t.options[e];n&&"function"==typeof n&&t.addEvent(e,n)}))}},{key:"callEvent",value:function(e,t){this._events[e]&&this._events[e].forEach((function(e){return e({detail:t})}))}},{key:"hasEventCallback",value:function(e){var t=this._events[e];return!!(t&&t.length>0)}},{key:"clearEvents",value:function(e){var t=this;(e&&Array.isArray(e)?e:Object.keys(this._events)).forEach((function(e){delete t._events[e]}))}},{key:"element",get:function(){return this._element},set:function(e){this._element=e}},{key:"options",get:function(){return this._options}},{key:"events",get:function(){return this._events}}]),e}(),Ai=2e3,Ii={};function Ni(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(e,t,n){var r=new RegExp("\\{"+n+"\\}","g");return e=e.replace(r,t)}),e)}function Li(){var e;(e=console).warn.apply(e,arguments)}function Di(e){var t=Object.keys(Ii),n=e.filter((function(e){return!t.includes(e)}));return v(new Set(n))}function Fi(e,t){return qi.apply(this,arguments)}function qi(){return qi=a(regeneratorRuntime.mark((function e(t,n){var r,i,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Di(t))&&0!==r.length){e.next=3;break}return e.abrupt("return",{});case 3:if(n){e.next=5;break}throw new Error("Attempting to fetch translations from the API without supplying `martianSettings`");case 5:return e.next=7,Mi({keys:r,site:new Sn(n)});case 7:return i=e.sent,(a=i.filter((function(e){return e.missing}))).length>0&&Li("Some resources could not be fetched",a),s=i.filter((function(e){return!e.missing})).reduce((function(e,t){return e[t.resource]=t.text,e}),{}),Object.assign(Ii,s),e.abrupt("return",s);case 13:case"end":return e.stop()}}),e,this)}))),qi.apply(this,arguments)}function Mi(e){return Oi.apply(this,arguments)}function Oi(){return(Oi=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,o,l,c,u,d,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.keys,r=t.site,i=t.localizations,a=void 0===i?[]:i,s=t.depth,o=void 0===s?0:s,!((o+=1)>10)){e.next=4;break}return e.abrupt("return",a);case 4:if(!(n.join().length>Ai)){e.next=16;break}return u=Math.ceil(n.length/2),e.next=8,Mi({keys:n.slice(0,u),site:r,localizations:a,depth:o});case 8:return d=e.sent,(l=a).push.apply(l,v(d)),e.next=12,Mi({keys:n.slice(u),site:r,localizations:a,depth:o});case 12:d=e.sent,(c=a).push.apply(c,v(d)),e.next=20;break;case 16:return e.next=18,r.getResourceStrings({keys:n});case 18:h=e.sent,a=h.localizations;case 20:return e.abrupt("return",a);case 21:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function zi(e){var t=Ii[e],n=e;if("string"==typeof t){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];n=Ni.apply(void 0,[t].concat(i))}else Li("Unable to find a localization for key '".concat(e,"'"));return n}var Ui=function(e){return function(e){function t(){return s(this,t),f(this,h(t).apply(this,arguments))}var n;return d(t,e),l(t,[{key:"initLocalizations",value:(n=a(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=Di(this.constructor.resourceKeys||[]))&&t.length>0)){e.next=4;break}return e.next=4,Fi(t,this.martianSettings);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"localize",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return zi.apply(void 0,[e].concat(n))}}]),t}(e)},Bi=Object.freeze({__proto__:null,LocalizerClient:Ui,clearTranslationCache:function(){Ii={}},getResourceKeysDifference:Di,localize:zi,populateTranslationsFromApi:Fi,populateTranslationsFromElement:function(e){var t=document.getElementById(e);if(!t)return Li("Localization element with id '".concat(e,"' cannot be found on page.")),{};var n=t.textContent.replace("/*<![CDATA[*/","").replace("/*]]>*/",""),r={};try{r=JSON.parse(n)}catch(t){Li("Error parsing localization JSON for '#".concat(e,"'."))}var i=Object.entries(r).filter((function(e){return g(e,2)[1].match(/\[MISSING: .+]/)})).map((function(e){return g(e,1)[0]}));return i.length>0&&Li("Some of the parsed resources are missing",i),Object.assign(Ii,r),r},populateTranslationsFromObject:function(e){return Object.assign(Ii,e),e}}),Hi={},Vi=new Set;function Wi(e){Object.assign(Hi,e),Object.keys(Hi).forEach((function(e){return Vi.add(e)}))}function $i(e){var t=Hi[e];return Gi(e)||console.warn('No entry found in the settings for key "'.concat(e,'".')),t}function Ki(e,t){Hi[e]=t,Vi.add(e)}function Gi(e){return Vi.has(e)}var Qi,Ji,Yi=function(e){return function(e){function t(){return s(this,t),f(this,h(t).apply(this,arguments))}return d(t,e),l(t,[{key:"getSetting",value:function(e){return $i(e)}},{key:"setSetting",value:function(e,t){return Ki(e,t)}}]),t}(e)},Xi=Object.freeze({__proto__:null,SettingsClient:Yi,clearSettings:function(){Hi={},Vi.clear()},getSetting:$i,hasSetting:Gi,populateSettingsFromElement:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document,r=!0;if(t){var i=Object.keys(Hi);r=t.every((function(e){return!i.includes(e)}))}if(r){var a,s=n.getElementById(e);if(!s)throw new Error("Unable to find element #".concat(e," to read settings."));try{a=JSON.parse(s.textContent)}catch(t){throw new Error("Unable to parse the text content from the #".concat(e," settings element."))}Wi(a)}},populateSettingsFromObject:Wi,setSetting:Ki}),Zi=function(e){var t;function n(e){var t;return s(this,n),(t=f(this,h(n).call(this,e))).initialize({defaults:{autoClose:!0,destroyOnClose:!0,isIframe:!1,modalAdditionalClasses:[],modalElementId:"mt-modal-dialog",preventScrolling:!0,showPrimaryButton:!0,showSecondaryButton:!0,showXButton:!0,tabbedContent:!1,openOnCreate:!0,customStyles:{}},events:["onconfirm","oncancel","onclose","onmodalopened"]}),t}return d(n,e),l(n,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new n(t))._createUi(),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Dialog.Common.button.cancel","Dialog.Common.button.close","Dialog.Common.button.ok"]}}]),l(n,[{key:"open",value:function(){this.options.preventScrolling&&document.body.classList.add("mt-modal-open"),this.element.showModal(),this.callEvent("onmodalopened")}},{key:"close",value:function(){this.options.preventScrolling&&document.body.classList.remove("mt-modal-open"),this.element.close(),this.options.destroyOnClose&&this.remove(),this.callEvent("onclose")}},{key:"remove",value:function(){this.options.preventScrolling&&document.body.classList.remove("mt-modal-open"),this.element.parentElement&&this.element.parentElement.removeChild(this.element),delete this.element}},{key:"enablePrimary",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.enable,n=void 0===t||t,r=e.classToggle;this._primaryButton.disabled=!n,r&&hi(this._primaryButton,r,!n)}},{key:"setPrimaryButtonText",value:function(e){this._primaryButton.innerText=e}},{key:"setSecondaryButtonText",value:function(e){this._secondaryButton.innerText=e}},{key:"_createUi",value:function(){var e=this,t=this.styles,n=["mt-modal","ui-dialog-content","ui-widget-content"].concat(v(this.options.modalAdditionalClasses));this.element=Mr("dialog",{className:["ui-dialog","ui-widget","ui-widget-content","ui-corner-all","ui-front mt-dialog","mt-modal-wrapper"].join(" "),role:"dialog",tabIndex:-1,style:t.dialog,oncancel:function(){return e._sendEvent("oncancel")}},Wr({style:t.titleBar,className:"ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"},Kr({className:"ui-dialog-title",style:t.title},this.options.title),this.options.showXButton&&Vr({className:"ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close",role:"button",title:this.localize("Dialog.Common.button.close"),type:"button",style:t.titleClose,onclick:function(){return e._sendEvent("oncancel")}},Kr({className:"ui-button-icon-primary ui-icon ui-icon-closethick"}),Kr({className:"ui-button-text"}))),Wr({className:n.join(" "),dataset:this.options.gaAction?{gaAction:this.options.gaAction}:{},style:t.dialogContent,id:this.options.modalElementId},this._contentContainer=Wr({className:"mt-scrolling-dialog-content".concat(this.options.tabbedContent?" tabbed-content":""),style:t.content},this.options.content),Wr({className:"mt-dialog-button-container"},(this.options.showPrimaryButton||this.options.showSecondaryButton)&&Wr({className:"ui-dialog-buttonset",style:t.buttonset},this.options.f1Title&&this.options.f1Url&&Hr({className:"mt-f1-success mt-f1-link",title:this.options.f1Title,href:this.options.f1Url,target:"_blank",onclick:function(){setTimeout((function(){return e.close()}),10)}},Kr({className:"ui-icon mt-icon-f1-link"}),this.options.f1Title),this.options.showPrimaryButton&&(this._primaryButton=Vr({style:t.confirm,className:"mt-button ui-button-primary",onclick:this.options.primaryActionIsCancel?function(){return e._sendEvent("oncancel")}:function(){return e._sendEvent("onconfirm")},dataset:this.options.primaryButtonGaLabel?{gaLabel:this.options.primaryButtonGaLabel}:{}},this.options.primaryButtonText||this.localize("Dialog.Common.button.ok"))),this.options.showSecondaryButton&&(this._secondaryButton=Vr({style:t.cancel,className:"mt-button ui-button-secondary",onclick:this.options.primaryActionIsCancel?function(){return e._sendEvent("onconfirm")}:function(){return e._sendEvent("oncancel")},dataset:this.options.secondaryButtonGaLabel?{gaLabel:this.options.secondaryButtonGaLabel}:{}},this.options.secondaryButtonText||this.localize("Dialog.Common.button.cancel"))))))),"undefined"!=typeof dialogPolyfill&&dialogPolyfill.registerDialog(this.element),document.body.appendChild(this.element),this.options.openOnCreate&&this.open()}},{key:"_sendEvent",value:function(e){this.callEvent(e),this.options.autoClose&&this.close()}},{key:"content",get:function(){return this._contentElement},set:function(e){this._contentElement=e,li(this._contentContainer),this._contentContainer.appendChild(this._contentElement)}},{key:"styles",get:function(){if(this.options.isIframe)return this.iframeStyling;for(var e={buttonset:{},content:{},confirm:{},cancel:{},dialog:{},dialogContent:{display:"block",width:"auto",minHeight:"104px",maxHeight:"none",height:"auto"},titleBar:{},title:{},titleClose:{}},t=this.options.customStyles||{},n=Object.keys(t),r=0;r<n.length;r++){var i=n[r];if(e[i])for(var a=Object.keys(t[i]),s=0;s<a.length;s++){var o=a[s];e[i][o]=t[i][o]}}return e}},{key:"iframeStyling",get:function(){return{buttonset:{float:"right",textAlign:"right",width:"100%",paddingRight:"1%",paddingBottom:"1%"},content:{paddingTop:"30px",paddingBottom:"10px",paddingLeft:"1%",paddingRight:"1%",fontFamily:"lato,arial,helvetica,sans-serif,'arial unicode ms'"},confirm:{background:"#747474",border:"1px solid #1b1b1b",color:"#fff",textShadow:"none",fontSize:"1rem",borderRadius:".25em",boxSizing:"border-box",display:"inline-block",fontWeight:400,lineHeight:2,outline:0,padding:"0 .8em",marginRight:"1%"},cancel:{background:"#efefef",border:"1px solid #969696",borderRadius:".25em",boxSizing:"border-box",color:"#000",fontSize:"1rem",display:"inline-block",fontWeight:400,lineHeight:2,outline:0,padding:"0 .8em"},dialog:{left:0,margin:"0 auto",position:"fixed",right:0,top:"50%",transform:"translate(0,-50%)",border:"1px solid #30b3f6",borderRadius:".5em",boxShadow:"0 0 1em rgba(48,179,246,.25)",boxSizing:"border-box",fontSize:"105%",height:"auto !important",width:"93% !important",padding:0},dialogContent:{display:"block",width:"auto",minHeight:"104px",maxHeight:"none",height:"auto",marginTop:"2%",marginBottom:"2%"},titleBar:{float:"left",background:"#e5f5fe",border:"1px solid #30b3f6",color:"#000",fontFamily:"lato,arial,helvetica,sans-serif,'arial unicode ms'",borderRadius:".5em .5em 0 0",borderWidth:"0 0 1px",width:"100%",paddingTop:"1%",paddingBottom:"1%"},title:{paddingLeft:"1%"},titleClose:{display:"none"}}}}]),n}(Yi(Ui(ji))),ea=function(e){var t,n,r;function i(e){var t;if(s(this,i),(t=f(this,h(i).call(this,e))).initialize({defaults:{collapsed:!1},events:["onclose","onopen"]}),t.options.container&&("title"in t.options.container.dataset&&(t.options.toggleTitle=t.options.container.dataset.title),"collapsed"in t.options.container.dataset&&(t.options.collapsed="true"===t.options.container.dataset.collapsed)),void 0===t.options.toggleTitle&&(t.options.toggleTitle=t.localize("Component.CollapsibleSection.label.toggle-title")),t.options.settingsCollapsedKey){var n=wr.fetch(e.settingsCollapsedKey);null!==n&&(t.options.collapsed=n)}return t._collapsibleElement=t.options.content,t}return d(i,e),l(i,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new i(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Component.CollapsibleSection.label.toggle-title"]}}]),l(i,[{key:"toggle",value:(r=a(regeneratorRuntime.mark((function e(){var t,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.length>0&&void 0!==n[0]?n[0]:250,this.toggleElement.classList.contains("mt-toggle-expand")?this.open(t):this.close(t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"open",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250;this.toggleElement.classList.add("mt-toggle-collapse"),this.toggleElement.classList.remove("mt-toggle-expand"),this.element.dataset.collapsed=!1,gi.open(this._collapsibleElement,e),this.options.settingsCollapsedKey&&wr.store(this.options.settingsCollapsedKey,!1),this.callEvent("onopen")}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250;this.toggleElement.classList.remove("mt-toggle-collapse"),this.toggleElement.classList.add("mt-toggle-expand"),this.element.dataset.collapsed=!0,gi.close(this._collapsibleElement,e),this.options.settingsCollapsedKey&&wr.store(this.options.settingsCollapsedKey,!0),this.callEvent("onclose")}},{key:"_createUi",value:(n=a(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.options.container?this.element=this.options.container:this.element=Wr(),this.element.classList.add("mt-toggle-container"),this.toggleElement=Vr({className:"mt-toggle mt-summary-toggle ui-button-icon ".concat(this.options.collapsed?"mt-toggle-expand":"mt-toggle-collapse"),type:"button",onclick:function(){n.toggle()}},this.options.toggleTitle),this.element.prepend(this.toggleElement),(t=this.element.querySelector(".mt-collapsible-section"))?this._collapsibleElement=t:this.element.appendChild(this._collapsibleElement),this.options.collapsed?this.close(0):this.element.dataset.collapsed=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),i}(Ui(ji));var ta=function(e){var t;function n(e){var t;return s(this,n),(t=f(this,h(n).call(this,e))).initialize({defaults:{placeholderClasses:[],blockClass:"mt-sortable-element",intersectThreshold:.5,dragOpacity:.5,trackDirection:"both",dragStartBlacklist:[],constrainToElement:!0,dynamicDragWidth:!0},events:["onorderchanged","ondragended","ondragstarting"]}),t.element=t.options.container,t._dragPositionStyle="fixed",t._placeholderClasses=["mt-sortable-drag-target","mt-sortable-placeholder"].concat(v(t.options.placeholderClasses)),t._blockClass=t.options.blockClass,t._handleClass=t.options.handleClass,t._ignoreBlockClass=t.options.ignoreBlockClass,t.options.intersectThreshold<.5?t._intersectThreshold=.5:t.options.intersectThreshold>1?t._intersectThreshold=1:t._intersectThreshold=t.options.intersectThreshold,t.options.dragOpacity<0?t._dragOpacity=0:t.options.dragOpacity>1?t._dragOpacity=1:t._dragOpacity=t.options.dragOpacity,t._trackDirection=t.options.trackDirection,t._dragStartBlacklist=t.options.dragStartBlacklist,t._constrainToElement=t.options.constrainToElement,t._dynamicDragWidth=t.options.dynamicDragWidth,t._dragState={x:0,y:0,initialIndex:null,marginLeft:0,marginTop:0},t._dragElement=null,t._enabled=!0,Array.from(t.element.querySelectorAll(".".concat(t._handleClass||t._blockClass))).forEach((function(e){for(var n=e;!n.classList.contains(t._blockClass);)n=e.parentElement;t._setUpElement(n,e)})),t}return d(n,e),l(n,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new n(t),e.abrupt("return",r);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),l(n,[{key:"addElement",value:function(e){this._setUpElement(e,this._getClickElement(e)),this._element.appendChild(e)}},{key:"activateElement",value:function(e){this._setUpElement(e,this._getClickElement(e))}},{key:"removeElement",value:function(e){this._element.removeChild(e)}},{key:"_getSwapTarget",value:function(){var e=this,t="before";return{target:Array.from(this._element.querySelectorAll(".mt-sortable-drag-target")).find((function(n){if(n.classList.contains("mt-sortable-dragging"))return!1;if(e._ignoreBlockClass&&n.classList.contains(e._ignoreBlockClass))return!1;if(n.classList.contains("mt-sortable-placeholder"))return t="after",!1;var r,i,a,s=e._dragElement.getBoundingClientRect(),o=s.width*s.height,l=n.getBoundingClientRect(),c=l.width*l.height,u=function(e,t){if(e.left>t.right||e.top>t.bottom||e.right<t.left||e.bottom<t.top)return null;var n=Math.max(e.left,t.left),r=Math.min(e.right,t.right),i=Math.max(e.top,t.top),a=Math.min(e.bottom,t.bottom),s=r-n,o=a-i;return{left:n,right:r,top:i,bottom:a,width:s,height:o,area:s*o}}(s,l);return null!==u&&(r=Math.min(o,c),i=u.area,a=e._intersectThreshold,i/r>=a)})),direction:t}}},{key:"_indexOf",value:function(e){return Array.from(document.querySelectorAll(".".concat(this._blockClass))).findIndex((function(t){return t===e}))}},{key:"_setDragLocation",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._dragElement.getBoundingClientRect(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._trackDirection,i=this._dragState.offsetX+e,a=this._dragState.offsetY+t;if(this._constrainToElement){var s=parseInt(this._elementComputedStyle.height,10),o=this._containerRect.top+s;a<this._containerRect.top?a=this._containerRect.top:a+n.height>o&&(a=o-n.height);var l=parseInt(this._elementComputedStyle.width,10),c=this._containerRect.left+l;i<this._containerRect.left?i=this._containerRect.left:i+n.width>c&&(i=c-n.width)}"horizontal"!==r&&"both"!==r||(this._dragElement.style.left="".concat(i,"px")),"vertical"!==r&&"both"!==r||(this._dragElement.style.top="".concat(a,"px"))}},{key:"_dragTracker",value:function(e){var t,n=this._getSwapTarget(),r=n.target,i=n.direction,a=e.pageX,s=e.pageY;if(r){if(this._dynamicDragWidth){var o=getComputedStyle(r);t=this._dragElement.getBoundingClientRect();var l=parseInt(o.width,10),c=t.width;this._dragState.offsetX+=c-l,this._dragElement.style.width=o.width}var u=this._element.removeChild(this._placeholder);"before"===i?this._element.insertBefore(u,r):ci(u,r)}this._setDragLocation(a,s,t)}},{key:"_endDrag",value:function(){this._element.replaceChild(this._dragElement,this._placeholder);var e=this._dragState.initialIndex,t=this._indexOf(this._dragElement);e!==t&&this.callEvent("onorderchanged",{from:e,to:t,element:this._dragElement}),this._dragElement.classList.remove("mt-sortable-dragging"),this._dragElement.style.width="",this._dragElement.style.position="",this._dragElement.style.opacity="",this._dragElement.style.overflow="",this._dragElement.style.zIndex="",this._dragElement.style.left="",this._dragElement.style.top="",this.callEvent("ondragended",{element:this._dragElement}),document.removeEventListener("mousemove",Ji),document.removeEventListener("mouseup",Qi)}},{key:"_startDrag",value:function(e,t){var n=this;this._dragElement=e,this._placeholder=this._dragElement.cloneNode(!0),this._placeholder.id="mt-sortable-placeholder",this._placeholderClasses.forEach((function(e){n._placeholder.classList.add(e)}));var r=getComputedStyle(this._dragElement);this._dragElement.classList.add("mt-sortable-dragging"),this._dynamicDragWidth&&(this._dragElement.style.width=r.width),this._dragElement.style.opacity=this._dragOpacity,this._dragElement.style.overflow="none",this._dragElement.style.zIndex=2e3,this._dragState.initialIndex=this._indexOf(e),this._elementComputedStyle=getComputedStyle(this._element),this._element.style.minHeight=this._elementComputedStyle.height;var i=this._dragElement.getBoundingClientRect();this._dragElement.style.position=this._dragPositionStyle,this._element.style.minHeight="",this._element.insertBefore(this._placeholder,this._dragElement);var a=parseInt(r["margin-left"],10),s=parseInt(r["margin-top"],10);this._dragState.offsetX=i.left-a-t.x,this._dragState.offsetY=i.top-s-t.y,this._containerRect=this._element.getBoundingClientRect(),this.callEvent("ondragstarting",{element:this._dragElement}),this._setDragLocation(t.x,t.y,this._dragElement.getBoundingClientRect(),"both"),Qi=function(e){return n._endDrag(e)},document.addEventListener("mouseup",Qi,!1),Ji=function(e){return n._dragTracker(e)},document.addEventListener("mousemove",Ji,!1)}},{key:"_setUpElement",value:function(e,t){var n=this;e.classList.add("mt-sortable-drag-target"),t.addEventListener("mousedown",(function(t){if(n._enabled){var r=!0;n._dragStartBlacklist.every((function(e){return!t.target.classList.contains(e)||(r=!1,!1)})),r&&0===t.button&&(t.stopPropagation(),n._startDrag(e,{x:t.pageX,y:t.pageY}))}}),!1)}},{key:"_getClickElement",value:function(e){var t=e;return this._handleClass&&(t=e.querySelector(".".concat(this._handleClass))),t}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}}]),n}(ji),na={EN:{language:"Component.Translate.label.english",english:"Reporting.Values.english"},ES:{language:"Component.Translate.language.spanish",english:"Reporting.Values.spanish"},DE:{language:"Component.Translate.language.german",english:"Reporting.Values.german"},JA:{language:"Component.Translate.language.japanese",english:"Reporting.Values.japanese"},ZH:{language:"Component.Translate.language.chinese",english:"Reporting.Values.chinese"},"ZH-TW":{language:"Component.Translate.language.chinese-traditional",english:"Reporting.Values.chinese-traditional"},FR:{language:"Component.Translate.language.french",english:"Reporting.Values.french"},PT:{language:"Component.Translate.language.portuguese-brazil",english:"Reporting.Values.portuguese"},"PT-PT":{language:"Component.Translate.language.portuguese-portugal",english:"Reporting.Values.portuguese"},NL:{language:"Component.Translate.language.dutch",english:"Reporting.Values.dutch"},"KO-KR":{language:"Component.Translate.language.korean",english:"Reporting.Values.korean"},SV:{language:"Component.Translate.language.swedish",english:"Reporting.Values.swedish"},DA:{language:"Component.Translate.language.danish",english:"Reporting.Values.danish"},"FA-AF":{language:"Component.Translate.language.dari",english:"Reporting.Values.dari"},FI:{language:"Component.Translate.language.finnish",english:"Reporting.Values.finnish"},IT:{language:"Component.Translate.language.italian",english:"Reporting.Values.italian"},AF:{language:"Component.Translate.language.afrikaans",english:"Reporting.Values.afrikaans"},SQ:{language:"Component.Translate.language.albanian",english:"Reporting.Values.albanian"},AM:{language:"Component.Translate.language.amharic",english:"Reporting.Values.amharic"},AR:{language:"Component.Translate.language.arabic",english:"Reporting.Values.arabic"},HY:{language:"Component.Translate.language.armenian",english:"Reporting.Values.armenian"},AZ:{language:"Component.Translate.language.azerbaijani",english:"Reporting.Values.azerbaijani"},BN:{language:"Component.Translate.language.bengali",english:"Reporting.Values.bengali"},BS:{language:"Component.Translate.language.bosnian",english:"Reporting.Values.bosnian"},BG:{language:"Component.Translate.language.bulgarian",english:"Reporting.Values.bulgarian"},CA:{language:"Component.Translate.language.catalan",english:"Reporting.Values.catalan"},CS:{language:"Component.Translate.language.czech",english:"Reporting.Values.czech"},HR:{language:"Component.Translate.language.croatian",english:"Reporting.Values.croatian"},ET:{language:"Component.Translate.language.estonian",english:"Reporting.Values.estonian"},FA:{language:"Component.Translate.language.farsi",english:"Reporting.Values.farsi"},"FR-CA":{language:"Component.Translate.language.french.canada",english:"Reporting.Values.french-canadian"},KA:{language:"Component.Translate.language.georgian",english:"Reporting.Values.georgian"},EL:{language:"Component.Translate.language.greek",english:"Reporting.Values.greek"},GU:{language:"Component.Translate.language.gujarati",english:"Reporting.Values.gujarati"},HT:{language:"Component.Translate.language.haitian-creole",english:"Reporting.Values.haitian-creole"},HA:{language:"Component.Translate.language.hausa",english:"Reporting.Values.hausa"},HE:{language:"Component.Translate.language.hebrew",english:"Reporting.Values.hebrew"},HI:{language:"Component.Translate.language.hindi",english:"Reporting.Values.hindi"},HU:{language:"Component.Translate.language.hungarian",english:"Reporting.Values.hungarian"},IS:{language:"Component.Translate.language.icelandic",english:"Reporting.Values.icelandic"},ID:{language:"Component.Translate.language.indonesian",english:"Reporting.Values.indonesian"},KN:{language:"Component.Translate.language.kannada",english:"Reporting.Values.kannada"},KK:{language:"Component.Translate.language.kazakh",english:"Reporting.Values.kazakh"},LV:{language:"Component.Translate.language.latvian",english:"Reporting.Values.latvian"},LT:{language:"Component.Translate.language.lithuanian",english:"Reporting.Values.lithuanian"},MK:{language:"Component.Translate.language.macedonian",english:"Reporting.Values.macedonian"},MS:{language:"Component.Translate.language.malay",english:"Reporting.Values.malay"},ML:{language:"Component.Translate.language.malayalam",english:"Reporting.Values.malayalam"},MT:{language:"Component.Translate.language.maltese",english:"Reporting.Values.maltese"},MN:{language:"Component.Translate.language.mongolian",english:"Reporting.Values.mongolian"},NO:{language:"Component.Translate.language.norwegian",english:"Reporting.Values.norwegian"},PS:{language:"Component.Translate.language.pashto",english:"Reporting.Values.pashto"},PL:{language:"Component.Translate.language.polish",english:"Reporting.Values.polish"},RO:{language:"Component.Translate.language.romanian",english:"Reporting.Values.romanian"},RU:{language:"Component.Translate.language.russian",english:"Reporting.Values.russian"},SR:{language:"Component.Translate.language.serbian",english:"Reporting.Values.serbian"},SI:{language:"Component.Translate.language.sinhala",english:"Reporting.Values.sinhala"},SK:{language:"Component.Translate.language.slovak",english:"Reporting.Values.slovak"},SL:{language:"Component.Translate.language.slovenian",english:"Reporting.Values.slovenian"},"ES-MX":{language:"Component.Translate.language.spanish-mexico",english:"Reporting.Values.spanish-mexican"},SO:{language:"Component.Translate.language.somali",english:"Reporting.Values.somali"},SW:{language:"Component.Translate.language.swahili",english:"Reporting.Values.swahili"},TL:{language:"Component.Translate.language.tagalog",english:"Reporting.Values.tagalog"},TA:{language:"Component.Translate.language.tamil",english:"Reporting.Values.tamil"},TE:{language:"Component.Translate.language.telugu",english:"Reporting.Values.telugu"},TH:{language:"Component.Translate.language.thai",english:"Reporting.Values.thai"},TR:{language:"Component.Translate.language.turkish",english:"Reporting.Values.turkish"},UK:{language:"Component.Translate.language.ukrainian",english:"Reporting.Values.ukrainian"},UR:{language:"Component.Translate.language.urdu",english:"Reporting.Values.urdu"},UZ:{language:"Component.Translate.language.uzbek",english:"Reporting.Values.uzbek"},VI:{language:"Component.Translate.language.vietnamese",english:"Reporting.Values.vietnamese"},CY:{language:"Component.Translate.language.welsh",english:"Reporting.Values.welsh"}},ra=function(){function e(){s(this,e)}return l(e,null,[{key:"generateUrl",value:function(e,t){var n=new URL(e);return n.searchParams.delete("mt-language"),t&&n.searchParams.set("mt-language",t),n.href}},{key:"modifyInternalLinks",value:function(e,t){var n=this;e.querySelectorAll("a[href*='".concat(window.location.hostname,"']")).forEach((function(e){var r=new URL(e.href).pathname.toLowerCase();r.startsWith("/special:")||r.startsWith("/template:")||r.startsWith("/user:")||(e.href=n.generateUrl(e.href,t))}))}},{key:"normalizeLanguageCode",value:function(e){if(e&&"string"==typeof e){var t=e.trim().substring(0,5).toUpperCase();return na.hasOwnProperty(t)?t:t.substring(0,2)}return null}},{key:"resourceKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return na[this.normalizeLanguageCode(e)]?!0===t?na[this.normalizeLanguageCode(e)].english||null:na[this.normalizeLanguageCode(e)].language||null:null}},{key:"resourceKeys",get:function(){return Object.values(na).map((function(e){return e.language}))}},{key:"resourceKeysEnglish",get:function(){return Object.values(na).map((function(e){return e.english}))}}]),e}(),ia=Object.freeze({__proto__:null,TranslateUtils:ra}),aa={prefixSelect:"mt-classifications-selector-prefix-select",tagSelect:"mt-classifications-selector-tag-select",addButton:"mt-classifications-selector-button-add",classification:"mt-classifications-selector-classification",limitMessage:"mt-classifications-selector-limit-message",classificationSelected:"mt-classifications-selector-classification-selected",selectedValue:"mt-classifications-selector-selected-value",getSelector:function(e){return".".concat(this[e])}},sa=function(e){var t,n;function r(e){var t;return s(this,r),(t=f(this,h(r).call(this,e))).initialize({defaults:{limit:10,classifications:[],selected:[]},events:["onadd","onremove","onorderchanged"]}),t.classifications=t.options.classifications.map((function(e){return{classification:{tag:e.prefix,label:e.label},options:v(e.tags)}})),t.selected=t._validateSelected(v(t.options.selected)),t}return d(r,e),l(r,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new r(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Component.ClassificationsSelector.button.add","Component.ClassificationsSelector.button.remove","Component.ClassificationsSelector.limit-reached-message"]}}]),l(r,[{key:"updateOrder",value:function(e){var t=e.from,n=e.to;this.selected.splice(n,0,this.selected.splice(t,1)[0]),this.callEvent("onorderchanged")}},{key:"_validateSelected",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n].classification,i=e[n].type;!1===this._updateClassifications({prefix:r,tag:i})&&t.unshift(n)}return t.forEach((function(t){e.splice(t,1)})),e}},{key:"_createUi",value:(n=a(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.element=Wr(this.selected.map((function(e){return t._createSelected({prefix:e.classification,tag:e.type})})),this._createClassificationSelect());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_createClassificationSelect",value:function(){var e,t,n=this;return this.selected.length>=this.options.limit?$r({className:aa.limitMessage},this.localize("Component.ClassificationsSelector.limit-reached-message",this.options.limit)):e=Wr({className:aa.classification},this._createSelect(this.classifications.map((function(e){return e.classification})),{className:aa.prefixSelect,onchange:function(e){var r=n._findClassification(e.target.value).classification;if(r){var i=n._createSelect(r.options,{className:aa.tagSelect});t.replaceWith(i),t=i}}}),t=this._createSelect(this.classifications[0].options,{className:aa.tagSelect}),Vr({className:aa.addButton,onclick:function(){n._selectClassification(e)}},this.localize("Component.ClassificationsSelector.button.add")))}},{key:"_findClassification",value:function(e){var t=this.classifications.findIndex((function(t){return t.classification.tag===e}));return{classification:this.classifications[t],index:t}}},{key:"_createSelect",value:function(e,t){return Mr("select",t,e.map((function(e){return Mr("option",{value:e.tag},e.label)})))}},{key:"_selectClassification",value:function(e){var t=e.querySelector(aa.getSelector("prefixSelect")).value,n=e.querySelector(aa.getSelector("tagSelect")).value;e.replaceWith(this._createSelected({prefix:t,tag:n})),this._updateClassifications({prefix:t,tag:n}),this.selected.push({classification:t,type:n}),this.element.appendChild(this._createClassificationSelect()),this.callEvent("onadd",{prefix:t,tag:n})}},{key:"_createSelected",value:function(e){var t=this,n=e.prefix,r=e.tag;return Wr({className:aa.classificationSelected,dataset:{prefix:n,tag:r}},$r({className:aa.selectedValue},n),$r({className:aa.selectedValue},r),Vr({className:"mt-classifications-selector-button-remove",onclick:function(e){var i=e.target.closest(aa.getSelector("classificationSelected"));i&&i.remove();var a=t.selected.findIndex((function(e){return e.classification===n&&e.type===r}));a>-1&&t.selected.splice(a,1),t.callEvent("onremove",{prefix:n,tag:r})},ariaLabel:this.localize("Component.ClassificationsSelector.button.remove"),title:this.localize("Component.ClassificationsSelector.button.remove")},"X"))}},{key:"_updateClassifications",value:function(e){var t=e.prefix,n=e.tag,r=this._findClassification(t),i=r.classification;if(i){var a=i.options.findIndex((function(e){return e.tag===n}));if(a>-1)return i.options.splice(a,1),0===i.options.length&&this.classifications.splice(r.index,1),!0}return!1}},{key:"selectedFormatted",get:function(){return this.selected.map((function(e){return"".concat(e.classification,":").concat(e.type)}))}}]),r}(Ui(ji)),oa=null,la=function(){function e(){if(s(this,e),null!==oa)return oa;oa=this;var t=Xn.get("pageId");this._loaded={},this._classNames={classification:{classificationType:"mt-classification-type-select",classificationPrefixSelect:"mt-classification-prefix-select",settingsContainer:"mt-guide-tab-settings",typeSelectPrefix:"mt-classification-",currentType:"mt-classification-current-type",submitButton:"mt-classification-settings-submit"},paths:{settingsContainer:"mt-guide-tab-settings-learning-path",listContainer:"mt-lp-listings",displayContainer:"mt-lp-path-container",addPathButton:"mt-path-settings-submit",deletePathButton:"mt-delete-path"},guideTab:"mt-guide-content",hide:"mt-hide"},this._localize=xi("mt-localizations-guide-tabs-settings",["MindTouch.IDF3.label.guide.settings.classifications","MindTouch.IDF3.label.guide.settings.learningpath","MindTouch.IDF3.label.overview.max.count","MindTouch.IDF3.label.overview.max.count.over","MindTouch.LearningPath.dialog.remove.cancel","MindTouch.LearningPath.dialog.remove.confirm","MindTouch.LearningPath.dialog.remove.header","MindTouch.LearningPath.dialog.remove.message"]),this._pathSettingsTitle=this._localize("MindTouch.IDF3.label.guide.settings.learningpath"),this._classificationSettingsTitle=this._localize("MindTouch.IDF3.label.guide.settings.classifications"),this._$pageEl=$("#pageText"),this._guideTabProperty="mindtouch#idf.guideTabs",this._onLoadMap={"MindTouch/IDF3/Views/Path":this._pathOnLoad.bind(this),"MindTouch/IDF3/Views/Topic_hierarchy":this._topicHierarchyOnLoad.bind(this),"MindTouch/IDF3/Views/Classification":this._classificationOnLoad.bind(this),"MindTouch/IDF3/Views/ExternalImportGuide":this._externalImportOnLoad.bind(this)},this._propApi=Xn.get("isDraftRequest")?new ki(t,jr):new Gt(t,jr),this._languageCode=ra.normalizeLanguageCode(new URL(window.location.href).searchParams.get("mt-language")),this._initPaths()}var t,n,r;return l(e,[{key:"hasGuideTabs",value:function(){var e=this;return new Promise((function(t){e.getGuideTabs().then((function(e){t(e.length>0)}))}))}},{key:"getGuideTabs",value:function(){return this._propApi.getPropertyContents(this._guideTabProperty).then((function(e){return e.json()})).then((function(e){return e||[]})).catch((function(e){return Promise.reject(e)}))}},{key:"reloadGuideTab",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._loaded[e.guid]=!1;var r=document.getElementById(e.guid);return n&&ai(r),this.getGuideTabContent(e).then((function(n){if(t._languageCode){var i=(new DOMParser).parseFromString(n.body,"text/html").getElementsByTagName("div").item(0);ra.modifyInternalLinks(i,t._languageCode),n.body=i.outerHTML}var a=document.getElementById(e.guid);a&&(a.innerHTML=n.body),si(r),t.initGuideTab(e)}))}},{key:"initGuideTab",value:function(e){"function"!=typeof this._onLoadMap[e.templatePath]||this._loaded[e.guid]||(this._loaded[e.guid]=!0,this._onLoadMap[e.templatePath](e.guid))}},{key:"initSingleTab",value:function(){var e=this;this.getGuideTabs().then((function(t){e.initGuideTab(t[0])}))}},{key:"getGuideTabContent",value:function(e){var t=Xn.get("pageId"),n="Template:".concat(decodeURIComponent(e.templatePath)),r=new Ht(n,jr),i={pageid:t,draft:Xn.get("isDraftRequest"),guid:e.guid},a=Xn.get("pageContentViewParser");return a&&(i.parser=a),"settings"in e&&(i=wr.extendObject(i,e.settings)),this._languageCode&&(i.translate=this._languageCode),r.getContents(i)}},{key:"setGuideTabs",value:function(e){return this._propApi.setProperty(this._guideTabProperty,{text:JSON.stringify(e)},{abort:"never"})}},{key:"setGuideTab",value:function(e){var t=this;return new Promise((function(n,r){var i=e.guid;i?t.getGuideTabs().then((function(n){for(var r=0;r<n.length;r++)if(n[r].guid===i){n[r]=e;break}return t.setGuideTabs(n)})):r("Tab data must include a guid")}))}},{key:"updateGuideTab",value:function(e){var t=this,n=e.guid;if(n)return ai(document.getElementById(n)),this.getGuideTabs().then((function(r){var i,a=!0,s=!1,o=void 0;try{for(var l,c=r[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;if(u.guid===n){i=u,Object.assign(i,e);break}}}catch(e){s=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}return t.setGuideTabs(r).then((function(){var e=document.getElementById(i.guid);return t.reloadGuideTab(i,!1).then((function(){e.dispatchEvent(new CustomEvent("reloaded",{detail:{tabData:i}}))}))}))}));Promise.reject("Tab data must include a guid")}},{key:"_topicHierarchyOnLoad",value:function(e){var t=this,n=document.getElementById(e);if(n.querySelector(".ui-sortable-handle-topics")){var r=n.querySelector(".mt-guide-listings");$(r).find("li").hoverableArea({enable:!0}),ta.create({container:r,blockClass:"mt-list-topics",handleClass:"ui-sortable-handle-topics",trackDirection:"both",ignoreBlockClass:"mt-list-topics-childs",onorderchanged:function(n){t._topicOrderChanged(e,n)}}),this._topicHierarchyChildOnLoad(r,e)}}},{key:"_topicHierarchyChildOnLoad",value:function(e,t){var n=this;Array.from(e.querySelectorAll(".mt-listings-simple")).forEach((function(e){ta.create({container:e,blockClass:"mt-list-topics-childs",handleClass:"ui-sortable-handle-childs",trackDirection:"vertical",onorderchanged:function(e){n._topicOrderChanged(t,e)}})}))}},{key:"_topicOrderChanged",value:function(e,t){var n=t.detail.element,r=parseInt(n.dataset.pageId,10),i=n.previousSibling,a=0;i&&(a=parseInt(i.dataset.pageId,10));var s=new Ht(r,jr);try{s.setOrder(a),this.updateGuideTab({guid:e})}catch(e){}}},{key:"_classificationOnLoad",value:(r=a(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=document.getElementById(t))){e.next=3;break}return e.abrupt("return");case 3:if(r=n.querySelector(".".concat(this._classNames.classification.settingsContainer)),!Xn.get("isGuideTabMultipleClassificationsEnabled")){e.next=9;break}return e.next=7,this._initMultipleClassifications({container:n,settingsEl:r,guid:t});case 7:e.next=11;break;case 9:this._initClassifications(),r&&ea.create({collapsed:"true"===r.dataset.collapsed,container:r,toggleTitle:this._classificationSettingsTitle});case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_updateClassificationSettings",value:function(e){var t=e.querySelector(".".concat(this._classNames.classification.currentType)),n={guid:e.closest(".".concat(this._classNames.guideTab)).id,settings:{classification:t.dataset.prefix,type:t.value}};this.updateGuideTab(n)}},{key:"_initClassifications",value:function(){var e=this;this._$pageEl.on("change",".".concat(this._classNames.classification.classificationPrefixSelect),(function(t){var n=t.currentTarget,r=n.closest(".".concat(e._classNames.classification.settingsContainer)),i=r.querySelector(".".concat(e._classNames.classification.typeSelectPrefix).concat(n.value));ui(".".concat(e._classNames.classification.classificationType),r).forEach((function(t){"mt-classification-select"!==t.id&&(t.classList.add(e._classNames.hide),t.classList.remove(e._classNames.classification.currentType))})),i.classList.add(e._classNames.classification.currentType),i.classList.remove(e._classNames.hide)})),this._$pageEl.on("click",".".concat(this._classNames.classification.submitButton),(function(t){var n=t.currentTarget.closest(".".concat(e._classNames.classification.settingsContainer));e._updateClassificationSettings(n)}))}},{key:"_initMultipleClassifications",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,o,l,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.container,r=t.settingsEl,i=t.guid,!r){e.next=13;break}return a=n.querySelector(".mt-guide-tab-classifications-selected"),s=n.querySelector(".mt-guide-tab-classifications-all"),e.next=6,Fi(sa.resourceKeys,jr);case 6:return e.next=8,sa.create({limit:10,classifications:pi(s),selected:pi(a),onadd:function(){c.updateGuideTab({guid:i,settings:{classifications:o.selectedFormatted}})},onremove:function(){c.updateGuideTab({guid:i,settings:{classifications:o.selectedFormatted}})},onorderchanged:function(){c.updateGuideTab({guid:i,settings:{classifications:o.selectedFormatted}})}});case 8:o=e.sent,r.appendChild(o.element),ea.create({collapsed:"true"===r.dataset.collapsed,container:r,content:o.element,toggleTitle:this._classificationSettingsTitle}),l=n.querySelector(".mt-classification-listings-container"),ta.create({container:l,blockClass:"mt-classification-listing",handleClass:"mt-icon-drag",onorderchanged:function(e){o.updateOrder(e.detail)}});case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_initPaths",value:function(){var e=this,t=this;this._$pageEl.on("click",".".concat(this._classNames.paths.deletePathButton),(function(t){t.preventDefault();var n=t.currentTarget,r=n.closest(".".concat(e._classNames.guideTab)).id,i=n.parentElement.querySelector(".".concat(e._classNames.paths.displayContainer)).dataset.lpName;e._deletePath(r,i)})),this._$pageEl.on("click",".".concat(this._classNames.paths.addPathButton),(function(e){e.preventDefault(),$("<div></div>").modal({width:600,height:500,naming:{view:"insert_learning_path",namespace:"InsertLearningPath"},requirePage:!1,dialogClass:"filemodal mt-tabbed-dialog",params:{hidePagesAllowed:!1},load:function(){t._getPathDialog().then((function(n){n.init({submit:function(n){var r=e.currentTarget.closest(".".concat(t._classNames.guideTab)).id;t._updatePathSettings(r,n)}})}))}})}))}},{key:"_updatePathSettings",value:function(e,t){var n=this._getPathIds(e);n.push(t);var r={guid:e,settings:{learningPathIds:n}};this._setPathIds(e,n),this.updateGuideTab(r)}},{key:"_getPathDialog",value:function(){return wr.importModule({path:"/@lib/src/standalone/dialog.insertLearningPath.js",moduleName:"insertLearningPathDialog"})}},{key:"_deletePath",value:function(e,t){var n=this;Zi.create({content:this._localize("MindTouch.LearningPath.dialog.remove.message"),title:this._localize("MindTouch.LearningPath.dialog.remove.header"),primaryButtonText:this._localize("MindTouch.LearningPath.dialog.remove.confirm"),secondaryButtonText:this._localize("MindTouch.LearningPath.dialog.remove.cancel"),showXButton:!1,onconfirm:function(){var r=n._getPathIds(e);r.splice(r.indexOf(t),1),n._setPathIds(e,r),n.updateGuideTab({guid:e,settings:{learningPathIds:r}})}})}},{key:"_getPathIds",value:function(e){var t,n=document.getElementById(e);n&&(t=n.querySelector(".".concat(this._classNames.paths.settingsContainer)));var r="";return t&&(r=t.dataset.lpIds),r?r.split(","):[]}},{key:"_setPathIds",value:function(e,t){var n,r=document.getElementById(e);r&&(n=r.querySelector(".".concat(this._classNames.paths.settingsContainer))),n&&(n.dataset.lpIds=t.join(","))}},{key:"_pathOnLoad",value:function(e){var t=this;this._setPathIds(e,this._loadPathIdsFromDom(e));var n=document.getElementById(e),r=n.querySelector(".".concat(this._classNames.paths.settingsContainer)),i=n.querySelectorAll(".".concat(this._classNames.paths.listContainer)),a=$(i),s=ui(".mt-lp-pages-container",n);r&&(ea.create({collapsed:"true"===r.dataset.collapsed,container:r,toggleTitle:this._pathSettingsTitle}),a.find("li").hoverableArea({enable:!0})),s.forEach((function(e){ea.create({collapsed:!0,container:e,toggleTitle:t._localize("MindTouch.LearningPath.label.view-path")})})),ta.create({container:i[0],blockClass:"mt-sortable-listing",handleClass:"ui-sortable-handle-pages",trackDirection:"vertical",onorderchanged:function(){t._pathOrderChanged(e)}})}},{key:"_pathOrderChanged",value:function(e){var t=this._loadPathIdsFromDom(e);this._setPathIds(e,t);var n={guid:e,settings:{learningPathIds:t}};this.updateGuideTab(n)}},{key:"_loadPathIdsFromDom",value:function(e){var t=[],n=document.getElementById(e);return ui(".".concat(this._classNames.paths.displayContainer),n).forEach((function(e){t.push(e.dataset.lpName)})),t}},{key:"_externalImportOnLoad",value:(t=a(regeneratorRuntime.mark((function e(t){var n,r,i,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.getElementById(t),(r=n.querySelector("#mt-external-import-quick-validate-button"))&&!r.hasClickListener){e.next=4;break}return e.abrupt("return");case 4:return r.hasClickListener=!0,e.next=7,wr.importModule({path:"/@lib/src/standalone/dialog.externalImportQuickValidator.js",moduleName:"QuickValidatorDialog"});case 7:return i=e.sent,e.next=10,Fi(i.resourceKeys,jr);case 10:r.addEventListener("click",a(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.create({articleLinks:n.querySelectorAll(".mt-external-import-unvalidated-article"),onclose:function(){r.validatedCount>0&&s.updateGuideTab({guid:t})}});case 2:r=e.sent;case 3:case"end":return e.stop()}}),e,this)}))));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();var ca=function(){function e(){if(s(this,e),"AnalyticsBase"===this.constructor.name)throw new TypeError("AnalyticsBase can not be constructed directly.")}return l(e,[{key:"getSetting",value:function(){}},{key:"log",value:function(){}},{key:"_getPageId",value:function(){var e=this.getSetting("pageId");return void 0===e&&(e=0),0===e&&(e=encodeURIComponent(encodeURIComponent(document.location.pathname.replace(/^\/+/g,"")))),e}}]),e}(),ua=null;function da(){return ua}var ha=function(e){return function(e){function t(){return s(this,t),f(this,h(t).apply(this,arguments))}return d(t,e),l(t,[{key:"martianSettings",get:function(){return da()}}]),t}(e)},ma=Object.freeze({__proto__:null,MartianClient:ha,clearMartianSettings:function(){ua=null},getMartianSettings:da,setMartianSettings:function(e){ua=e}}),fa=null,pa=0,ga=function(){function e(){s(this,e),this._queue=[]}return l(e,null,[{key:"instance",get:function(){return null===fa&&(fa=new e,window.addEventListener("unload",(function(){pa&&clearInterval(pa),fa.dispatch({unload:!0})}),!1),pa=setInterval((function(){fa.dispatch()}),5e3)),fa}}]),l(e,[{key:"dispatch",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).unload,t=void 0!==e&&e;if(!(this._queue.length<1)){var n=!0,r=!1,i=void 0;try{for(var a,s=this._queue[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;try{o(t)}catch(e){}}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}this._queue=[]}}},{key:"enqueue",value:function(e){this._queue.push(e),this._queue.length>=10&&this.dispatch()}}]),e}(),va=null,ya=function(e){function t(){var e,n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).dispatcher,r=void 0===n?ga.instance:n;return s(this,t),(e=f(this,h(t).call(this)))._dispatcher=r,e._isInteractionAnalyticsEnabled=e.getSetting("isInteractionAnalyticsEnabled"),e._isInteractionAnalyticsDebugEnabled=e.getSetting("isInteractionAnalyticsDebugEnabled"),e._isGoogleAnalyticsEnabled=e.getSetting("isGoogleAnalyticsEnabled"),e._events=new et(e.martianSettings),e._location=null,e._pageId=e._getPageId(),e}return d(t,e),l(t,null,[{key:"instance",get:function(){return null===va&&(va=new t),va}},{key:"selector",get:function(){return"[data-ga-label],[data-mindtouch-action]"}},{key:"settingsKeys",get:function(){return["isInteractionAnalyticsEnabled","isInteractionAnalyticsDebugEnabled","isGoogleAnalyticsEnabled","pageId"]}}]),l(t,[{key:"addGridSortingHandlers",value:function(e){var t=this,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).location,r=!0,i=!1,a=void 0;try{for(var s,o=function(){var e=s.value,r=e.previousSibling;if(!r)return"continue";var i=r.innerText;if(!i)return"continue";e.addEventListener("click",(function(){return t.log({location:n,interaction:"Sort by ".concat(i.toLowerCase())})}))},l=e.querySelectorAll(".dataTables_scrollHead .DataTables_sort_icon")[Symbol.iterator]();!(r=(s=l.next()).done);r=!0)o()}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}}},{key:"log",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.location,r=void 0===n?this._location:n,i=t.action;if(this._isInteractionAnalyticsEnabled&&r){this._isInteractionAnalyticsDebugEnabled&&console.log({location:r,action:i});var a=new Date;this._dispatcher.enqueue((function(t){e._events.logInteractionAnalytics(r,i,{datetime:a,keepAlive:t,pageId:e._pageId,url:document.location.href}).catch({})}))}return Promise.resolve()}},{key:"handleClick",value:function(e){var t=e.currentTarget,n=t.dataset.mindtouchAction;if(n){var r=t.closest("[data-mindtouch-location]");r&&this.log({location:r.dataset.mindtouchLocation,action:n})}else{var i=t.dataset.gaLabel;if(i){var a,s=t.closest("[data-ga-action]");if(s&&(a=s.dataset.gaAction),a){var o,l=t.closest("[data-ga-category]");if(l)o=l.dataset.gaCategory;else{var c=document.querySelector("main");o=c&&c.dataset.gaCategory}o&&(this.log({location:a,action:i}),this._isGoogleAnalyticsEnabled&&"function"==typeof window.ga&&window.ga("mtTracker.send","event",o,a,i))}}}}},{key:"withDefaultLocation",value:function(e){var n=new t({dispatcher:this._dispatcher});return n._isInteractionAnalyticsEnabled=this._isInteractionAnalyticsEnabled,n._isGoogleAnalyticsEnabled=this._isGoogleAnalyticsEnabled,n._events=this._events,n._location=e,n._pageId=this._pageId,n}}]),t}(ha(Yi(ca))),ba=function(e){function t(){var e,n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).event,r=void 0===n?"":n;if(s(this,t),"PageViewAnalyticsBase"===(e=f(this,h(t).call(this))).constructor.name)throw new TypeError("PageViewAnalyticsBase can not be constructed directly.");return e._data={},e._event=r,e._events=new et(e.martianSettings),e._pageId=e._getPageId(),e}return d(t,e),l(t,null,[{key:"settingsKeys",get:function(){return["pageId"]}}]),l(t,[{key:"log",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._events.logPageView(this._pageId,e,{event:this._event}).catch({})}}]),t}(ha(Yi(ca))),wa=null,_a=function(e){function t(){return s(this,t),f(this,h(t).apply(this,arguments))}return d(t,e),l(t,[{key:"log",value:function(){var e={_uri:document.location.href,_referrer:document.referrer},n=new yr(document.location.href).getQueryParam("mt-learningpath");n&&(e._learningPathName=n);var r=Xn.get("webWidgetEmbedded");if(r){var i;try{i=JSON.parse(window.atob(r))}catch(e){i={}}e=Object.assign(e,i);var a=Xn.get("isInitialWebWidgetReferral");a&&(e._isInitialWebWidgetReferral=a)}return p(h(t.prototype),"log",this).call(this,e)}}],[{key:"instance",get:function(){return null===wa&&(wa=new t),wa}},{key:"settingsKeys",get:function(){return p(h(t),"settingsKeys",this).concat(["webWidgetEmbedded","isInitialWebWidgetReferral"])}}]),t}(ba);var ka=null,Pa=function(e){function t(){var e;return s(this,t),(e=f(this,h(t).call(this,{event:"consumption"})))._documentHeight=0,e._trackLength=0,e._windowHeight=0,e._refreshDomMeasurements(),e._data.minPercentViewed=Math.round(100*(1-e._trackLength/e._documentHeight))||0,e._data.maxPercentViewed=Math.round(100*(1-e._trackLength/e._documentHeight))||0,e._data.currentPercentViewed=Math.round(100*(1-e._trackLength/e._documentHeight))||0,e}return d(t,e),l(t,null,[{key:"instance",get:function(){var e;null===ka&&(ka=new t,window.addEventListener("resize",(function(){ka._refreshDomMeasurements()}),!1),window.addEventListener("scroll",(function(){clearTimeout(e),e=setTimeout((function(){ka._refreshAmountScrolled()}),50)}),!1));return ka}}]),l(t,[{key:"log",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).secondsOnPage,n=void 0===e?0:e;return p(h(t.prototype),"log",this).call(this,Object.assign(this._data,{secondsOnPage:n}))}},{key:"_refreshAmountScrolled",value:function(){this._refreshDomMeasurements();var e=window.pageYOffset||(document.documentElement||document.body.parentNode||document.body).scrollTop,t=Math.round((this._windowHeight+e)/this._documentHeight*100);this._data.currentPercentViewed=t,this._data.currentPercentViewed>this._data.maxPercentViewed&&(this._data.maxPercentViewed=this._data.currentPercentViewed)}},{key:"_refreshDomMeasurements",value:function(){this._windowHeight=window.innerHeight||(document.documentElement||document.body).clientHeight,this._documentHeight=function(){if(!document.body)throw new Error("DOM has not been loaded, page view consumption analytics cannot be collected.");return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)}(),this._trackLength=this._documentHeight-this._windowHeight}}]),t}(ba);var Sa=null,Ca=function(e){function t(){return s(this,t),f(this,h(t).call(this,{event:"performance"}))}return d(t,e),l(t,null,[{key:"instance",get:function(){return null===Sa&&(Sa=new t),Sa}},{key:"settingsKeys",get:function(){return p(h(t),"settingsKeys",this).concat(["skinStyle"])}}]),l(t,[{key:"log",value:function(){var e=function(){var e=null,t=null,n=0;if("function"==typeof performance.getEntriesByType){var r=performance.getEntriesByType("navigation");Array.isArray(r)&&r.length>0&&(t=r[0]),t&&(n=t.domInteractive,"function"==typeof performance.now&&(e=performance.now()))}if(t||(t=performance.timing)&&(n=t.domInteractive-t.navigationStart,"function"==typeof performance.now&&(e=performance.now()+t.navigationStart)),!t)return null;var i=t.type;if(!i)switch((performance.navigation||{}).type){case 0:i="navigate";break;case 1:i="reload";break;case 2:i="back_forward";break;default:i=""}return{"duration-appcache":t.domainLookupStart-t.fetchStart,"duration-connect":t.connectEnd-t.connectStart,"duration-dns":t.domainLookupEnd-t.domainLookupStart,"duration-dom-ctor":t.domComplete-t.domInteractive,"duration-dom-init":t.domInteractive-t.responseEnd,"duration-load":e?e-t.loadEventStart:0,"duration-redirect":t.redirectEnd-t.redirectStart,"duration-request":t.responseEnd-t.requestStart,"duration-total":e?e-t.fetchStart:0,"duration-unload":t.unloadEventEnd-t.unloadEventStart,"timeline-dom-interactive":n,type:i}}();if(e){var n=function(){var e=null;if("function"==typeof performance.getEntriesByType){var t=performance.getEntriesByType("paint");Array.isArray(t)&&t.length>0&&(e={},t.forEach((function(t){e["timeline-".concat(t.name)]=t.startTime})))}return e}();n&&(e=Object.assign(e,n))}return e?p(h(t.prototype),"log",this).call(this,Object.assign(e,{_uri:document.location.href,"layout-style":this.getSetting("skinStyle")})):Promise.resolve()}}]),t}(ba),Ta=$.widget("mt.editableText",{options:{save:null,cancel:null,cancelOnBlur:!1,clickElement:null,multiline:!1,placeholder:""},_create:function(){var e=this,t=e.options,n=e.element,r=t.clickElement?t.clickElement:n;r=r instanceof Element?$(r):r,n.off("click").off("blur").off("paste").off("keydown"),e.options.prevText=n.text(),r.on("click",(function(){n.data("editing")||(n.data("editing",!0),n.text()===t.placeholder&&n.empty(),n.prop("contenteditable",!0).addClass("editable-on").trigger("focus"))})),e.options.cancelOnBlur&&n.on("blur",(function(){n.data("saving")?n.data("saving",!1):e.cancel()})),n.on("paste",(function(e){if((e.originalEvent||e).clipboardData||window.clipboardData){e.preventDefault();var t=((e.originalEvent||e).clipboardData||window.clipboardData).getData("Text");t=t.replace(/(\r\n|\n|\r)/gm," "),(e.originalEvent||e).clipboardData?document.execCommand("insertText",!1,t):window.clipboardData&&document.selection.createRange().pasteHTML(t)}})).on("keydown",(function(n){if(n.ctrlKey||n.metaKey)switch(n.keyCode){case 66:case 73:case 85:return!1;case 83:n.preventDefault(),e.save()}else 13===n.keyCode?t.multiline||(n.preventDefault(),e.save()):27===n.keyCode&&(n.preventDefault(),e.cancel());return!0}))},cancel:function(){var e=this.options,t=e.prevText,n=this.element;e.cancel?e.cancel().then((function(){n.empty().html(t||e.placeholder).prop("contenteditable",!1).removeClass("editable-on")})):n.empty().html(t||e.placeholder).prop("contenteditable",!1).removeClass("editable-on"),n.data("editing",!1)},save:function(){var e=this.options,t=this.element;t.data("editing",!1),e.save().then((function(){t.data("saving",!0),t.blur().prop("contenteditable",!1).removeClass("editable-on"),e.prevText=e.editElement.text()}),(function(){t.empty().html(e.prevText)}))}}),Ea=$.widget("mt.expandablelist",{options:{dataSource:null,moreText:function(e){return e+" more"},beforeCreate:null,afterCreate:null,beforeDestroy:null,afterDestroy:null},_create:function(){var e=this;if(e._generatedElements=[],e._list=e.element,e._trigger("beforeCreate"),e.element.is("div")){var t=$("<ul></ul>");e.element.append(t),e._generatedElements.push(t),e._list=t}else if(!e.element.is("ul")&&!e.element.is("ol")&&!e.element.is("dl"))throw new Error("ERROR: The element should be a div, ul, ol or dl");e.options=wr.extendObject(e.options,e.element.data()),e.element.addClass("deki-expandablelist"),e._trigger("afterCreate")},_init:function(){this.options.dataSource&&this._askForData()},_askForData:function(){var e=this;e.options.dataSource.getData().then((function(t){var n=wr.makeArray(t.list);if(n.length>0&&(n.forEach((function(t){var n="string"==typeof t?$(Qr(t)):$(Qr(Hr({title:t.title,href:t.uri},t.title)));e._generatedElements.push(n),e._list.append(n)})),null!==t.itemsLeft&&t.itemsLeft>0)){var r=Hr({href:"#"},e.options.moreText(t.itemsLeft)),i=$(Qr({className:"mt-expandablelist-morelink"},r));e._generatedElements.push(i),e._list.append(i),i.on("click",(function(){i.remove(),e._askForData()})),r.addEventListener("click",(function(e){e.preventDefault()}))}}))},_destroy:function(){var e=this;e._trigger("beforeDestroy"),$.each(e._generatedElements,(function(e){e.remove()})),e.element.removeClass("deki-expandablelist"),e._trigger("afterDestroy")},_setOptions:function(e){var t=this;$.each(e,(function(e,n){t._setOption(e,n)}))},_setOption:function(){$.Widget.prototype._setOption.apply(this,arguments)}}),xa=xi("mt-localizations-grid-widget",["Article.Common.page-is-restricted-login","MindTouch.Help.Page.search-unavailable","MindTouch.Reports.data.empty-grid-text","Page.StructuredTags.error-update"]),Ra=$.widget("mt.grid",{options:{responsive:!1,sortingOrder:[0,"asc"],emptyGridText:xa("MindTouch.Reports.data.empty-grid-text"),spinnerText:"Processing...",spinnerSize:"large",enableSpinner:!1,spinnerElement:null,paginate:!0,infiniteScroll:!1,scrollTriggerPixels:600,showInfo:!0,enableFilter:!0,data:[],domFormat:null,colDefs:[],separate:!1,separator:{sticky:!1,describe:"row-separator"},dataSource:null,serverSideSorting:!1,serverSideSortingTemplates:{default:"css_right ui-icon ui-icon-carat-2-n-s",asc:"ui-icon-triangle-1-n",desc:"ui-icon-triangle-1-s"},onRowAdd:null,onGridDraw:null,onInfiniteScroll:null,onAjaxLoaded:null,onAjaxFail:function(e,t){"status"in t&&403===t.status?yi.Flash(xa("Article.Common.page-is-restricted-login")):"message"in t?yi.Flash(t.message):"status"in t&&503===t.status?yi.Flash(xa("MindTouch.Help.Page.search-unavailable")):yi.Flash(xa("Page.StructuredTags.error-update"))},beforeCreate:null,afterCreate:null,beforeDestroy:null,afterDestroy:null},_create:function(){var e=this;this._trigger("beforeCreate"),wr.importExternalModule({libVar:$.fn.dataTable,globalPath:"/@lib/redist/jquery.dataTables.min.js"}).then((function(){return!0===e.options.responsive?wr.importExternalModule({globalPath:"/@lib/redist/dataTables.responsive.min.js"}):Promise.resolve()})).then((function(){e._initialize(),e._trigger("afterCreate")}))},_initialize:function(){var e=this;e.element.is("table")?(e.element.addClass("mt-grid-table ui-table").wrap('<div class="mt-grid"></div>'),e.$grid=e.element,e.element=e.element.parent()):(e.element.empty(),e.element.addClass("mt-grid"),e.$grid=$("<table>",{class:"mt-grid-table ui-table"}).appendTo(e.element)),e.options.colDefs.length&&!e.options.aoColumnDefs&&(e.options.aoColumnDefs=e._getColumnDefinitions()),e.options.aoColumnDefs=e.options.aoColumnDefs.map((function(e,t){var n={aTargets:[t],bSearchable:!0,bSortable:!0,bVisible:!0,bAutoWidth:!1};return Object.keys(n).forEach((function(t){t in e||(e[t]=n[t])})),e})),!0===e.options.enableSpinner&&(this.options.spinnerElement=e.options.spinnerElement||e.element),e.gridSettings=$.extend(!0,{aaSorting:e.options.serverSideSorting?[]:[e.options.sortingOrder],bJQueryUI:!0,bPaginate:!e.options.infiniteScroll&&e.options.paginate,bScrollInfinite:e.options.infiniteScroll,bInfo:e.options.showInfo,bFilter:e.options.enableFilter,aaData:e.options.data,oLanguage:{},oScroll:{},bRetrieve:!0},e.options,{fnCreatedRow:function(t,n){e._onNewRow(t,n),"function"==typeof e.options.fnCreatedRow&&e.options.fnCreatedRow(t,n)},fnRowCallback:function(t,n){"function"==typeof e.options.fnRowCallback&&e.options.fnRowCallback(t,n)},fnInitComplete:function(t,n){if("function"==typeof e.options.fnInitComplete&&e.options.fnInitComplete(t,n),e.options.serverSideSorting)for(var r=function(){var t=$(this).find("span:visible").last();t.hasClass(e.options.serverSideSortingTemplates.asc)||t.hasClass(e.options.serverSideSortingTemplates.desc)?(t.toggleClass(e.options.serverSideSortingTemplates.asc),t.toggleClass(e.options.serverSideSortingTemplates.desc)):(e.$header.find("."+e.options.serverSideSortingTemplates.asc).removeClass(e.options.serverSideSortingTemplates.asc),e.$header.find("."+e.options.serverSideSortingTemplates.desc).removeClass(e.options.serverSideSortingTemplates.desc),t.toggleClass(e.options.serverSideSortingTemplates.asc));var n=$(this).data("colDef");e.resetGrid(t.hasClass(e.options.serverSideSortingTemplates.desc)?"-"+n.sortOn:n.sortOn)},i=0;i<e.gridSettings.aoColumnDefs.length;i++){var a=e.gridSettings.aoColumnDefs[i];if(a.sortOn){var s=e.$header.find("."+a.sClass.replace(/ /g,".")).data("colDef",a).off("click").on("click",r),o=s.find(".DataTables_sort_wrapper");o.find(".DataTables_sort_icon.css_right.ui-icon").hide(),o.append($(document.createElement("span")).addClass(e.options.serverSideSortingTemplates.default)),e.options.sortingOrder&&i===e.options.sortingOrder[0]&&(e.options.dataSource.sort("asc"===e.options.sortingOrder[1]?a.sortOn:"-"+a.sortOn),s.find("span:visible").addClass("asc"===e.options.sortingOrder[1]?e.options.serverSideSortingTemplates.asc:e.options.serverSideSortingTemplates.desc))}}e.options.dataSource&&e.getData()},fnDrawCallback:function(t){e.dt||(e.dt=this),e._trigger("onGridDraw",null,{settings:t}),"function"==typeof e.options.fnDrawCallback&&e.options.fnDrawCallback(t),e._injectSeparators(),"$body"in e||(e.$body=e.element.find(".dataTables_scrollBody").removeAttr("style")),"$header"in e||(e.$header=e.element.find(".dataTables_scrollHead").removeAttr("style")),e.$bodyTable=e.$body.find("table"),e.$bodyHeight=e.$body.height(),e.doScroll=!0,e.$body.removeAttr("style"),e.$header.removeAttr("style")}}),"sZeroRecords"in e.gridSettings.oLanguage||(e.gridSettings.oLanguage.sZeroRecords=e.options.emptyGridText),"sSearch"in e.gridSettings.oLanguage||(e.gridSettings.oLanguage.sSearch=e.options.searchText),"bInfinite"in e.gridSettings.oScroll||(e.gridSettings.oScroll.bInfinite=e.options.infiniteScroll),e.gridSettings.bProcessing=!1,!e.gridSettings.sDom&&e.gridSettings.domFormat&&(e.gridSettings.sDom=e.gridSettings.domFormat),""!==e.gridSettings.sScrollY&&(e.gridSettings.sScrollY="400px"),"function"==typeof e.options.filterData&&$.fn.dataTableExt.afnFiltering.push(e.options.filterData),e.$grid.dataTable(e.gridSettings),e.processing=e.element.find(".dataTables_processing"),e.previousPlaceholders=[],e._makeScrollable(),e._makeSticky(),e.separators=[]},_makeScrollable:function(){var e=this;e.options.infiniteScroll&&(e.doScroll=!0,e.$body.on("scroll",(function(){e.isEmpty()||e._infiniteScroll(!0)})))},_makeSticky:function(){var e=this;e.options.separator.sticky&&(e.element.addClass("mt-sticky-headers"),e.$body.on("scroll",(function(t){t.originalEvent&&e.drawSeparators()})))},_destroy:function(){var e=this;e._trigger("beforeDestroy"),e.clearGrid(),e.$grid.fnDestroy(),e.$grid.remove(),e.element.removeClass("mt-grid"),e._trigger("afterDestroy")},_setOption:function(e,t){var n=this;switch(e){case"dataSource":n.clearGrid();break;case"emptyGridText":n.$grid.fnSettings().oLanguage.sEmptyTable=t,n.$grid.fnDraw()}n._superApply(arguments)},_getColumnDefinitions:function(){for(var e=[],t=0;t<this.options.colDefs.length;t++){var n=this.options.colDefs[t];e.push({sTitle:n.title,sClass:n.class,bSortable:n.sortable,mDataProp:n.formatter,sortOn:n.sortOn,sWidth:n.width,sDefaultContent:n.defaultContent,bVisible:n.visible,bSearchable:n.searchable})}return e},_insertPlaceholder:function(){var e=this;if(!e.element.find(".separator-placeholder").length){var t=$(e.options.separator.template({data:e.firstRowData}));e.$header.find("table").append($(document.createElement("tbody")).append(t.addClass(e.options.separator.describe+" separator-placeholder first-separator")))}},_injectSeparators:function(){var e=this;e.options.separate&&!e.isEmpty()&&(e.separators=[],e.$grid.find("."+e.options.separator.describe).remove(),e.$grid.find("tr["+e.options.separator.describe+"]").each((function(){var t=$(this),n=t.data(e.options.separator.describe),r=$(e.options.separator.template({data:n})).insertBefore(t).addClass(e.options.separator.describe+" row-separator");e.separators.push(r)})),e._insertPlaceholder())},_onNewRow:function(e,t){var n=this,r=$(e);n.options.separate&&(n.previousRow?n.options.separator.checkWith(n.previousRow,t)&&(r.attr(n.options.separator.describe,!0),r.data(n.options.separator.describe,t)):(r.attr(n.options.separator.describe,!0),r.data(n.options.separator.describe,t),r.addClass("first-row"),n.firstRowData=t),n.previousRow=t),n._trigger("onRowAdd",null,{tr:e,data:t})},_infiniteScroll:function(){var e=this,t=e.$bodyTable.height()-e.options.scrollTriggerPixels-e.$bodyHeight;e.doScroll&&e.$body.scrollTop()>t&&(e.doScroll=!1,e.getData())},_hideSpinner:function(){this.options.spinnerElement&&this.options.spinnerElement.length>0&&si(this.options.spinnerElement[0])},drawSeparators:function(){for(var e=this,t=e.element.find(".separator-placeholder"),n=e.$body.offset().top,r=[],i=0;i<e.separators.length;i++)n>=e.separators[i].offset().top&&r.push(e.separators[i]);r.length&&t.replaceWith(r[r.length-1].clone().addClass("separator-placeholder").get())},getData:function(e){var t=this;!0===t.options.enableSpinner&&ai(this.options.spinnerElement[0],{bindToContainer:!0}),t.options.dataSource.getData(e).then((function(e){t._hideSpinner();var n=t.$body.scrollTop();t.addData(e,!0),t.$body.scrollTop(n-1),t._trigger("onAjaxLoaded",null,e)}),(function(e){t._hideSpinner(),t._trigger("onAjaxFail",null,e)}))},addData:function(e,t){if(e){var n=this;"function"==typeof n.options.transformData&&(e=n.options.transformData.call(this,e)),e&&e.length&&n.dt.fnAddData(e,t)}},getDataSource:function(){return this.options.dataSource},clearGrid:function(){var e=this;e.isEmpty()||(e.element.find(".separator-placeholder").remove(),e.$body.find("tr").remove(),e.previousRow=null,e.separators=[],e.dt.fnClearTable(!0))},resetGrid:function(e){var t=this;t.clearGrid(),t.options.dataSource&&"function"==typeof t.options.dataSource.reset&&t.options.dataSource.reset(),t.options.dataSource&&"function"==typeof t.options.dataSource.sort&&t.options.dataSource.sort(e),t.getData()},redrawGrid:function(e){this.$grid.fnDraw(e)},isEmpty:function(){return!this.$grid.fnGetData().length},processingIndicator:function(e){var t=e.show,n=this.element instanceof $?this.element[0]:this.element;t?ai(n,{bindToContainer:!0}):si(n)},getRowData:function(e){return e instanceof $&&(e=e[0]),this.$grid.fnGetData(e)},getGridData:function(){return this.$grid.fnGetData()},setRowData:function(e,t){return e instanceof $&&(e=e[0]),this.$grid.fnUpdate(t,e)},deleteRow:function(e){return e instanceof $&&(e=e[0]),this.$grid.fnDeleteRow(e)},isColumnVisible:function(e){return this.$grid.DataTable().column(e).visible()},_getStates:function(e){var t=this._located(e,!0,[25,0,0,0]),n=e.data("this_state");return t===n||(e.data("last_state",n),e.data("this_state",t)),[n,t]}}),ja="mt-modal-open",Aa=function(e){var t=e.scrollHeight;t!==e.data("lastHeight")&&(e.data("lastHeight",t),t>e.clientHeight&&(e.addClass("mt-scrollable"),e.on("scroll",(function(){e.scrollTop()>0&&(e.removeClass("mt-scrollable"),e.off("scroll"))}))))},Ia=$.widget("mt.modal",$.ui.dialog,{options:{dialogClass:"mt-dialog",modal:!0,width:400,resizable:!1,draggable:!1,appendTo:"#mt-modal-container",tabs:!1,naming:null,title:null,content:null,params:{},close:function(){$(this).remove()},load:null,beforeCreate:null,afterCreate:null,beforeDestroy:null,afterDestroy:null,requiresPage:!0},_create:function(){var e=this;$("body").addClass(ja),e._trigger("beforeCreate"),e.options=wr.extendObject(e.options,e.element.data()),null===e.options.naming&&null===e.options.content&&$.error("naming or content construction option is necessary"),e.element.addClass("mt-modal"),e.options.tabs&&e.element.addClass("with-tabs"),"string"==typeof e.options.naming?e.templateSpace={template:"MindTouch/Controls/Dialogs/"+e.options.naming.charAt(0).toUpperCase()+e.options.naming.slice(1),javascript:"dialog."+(e.options.naming.charAt(0).toLowerCase()+e.options.naming.slice(1)),namespace:e.options.naming.charAt(0).toUpperCase()+e.options.naming.slice(1)}:e.templateSpace=e.options.naming,e._super(arguments),e._trigger("afterCreate")},open:function(){var e=this;e.widget().trigger("focusin"),e.widget().on("dialoginit",(function(){e._afterDialogInit()})),e._super(),e.load()},close:function(){this._super(),this._destroy()},load:function(){var e=this;if(e.options.content){var t=$(document.createElement("div"));t.addClass("mt-dialog-root").data("title",e.options.title||"").html(e.options.content),e._insertUi(t)}else e._loadUi(e.templateSpace,e.options.params)},_loadViewUi:function(e,t){var n=this;t||(t={}),this.options.requiresPage&&(t.pageid=Xn.get("pageId"),0===t.pageid&&(t.pageid="="+document.location.pathname.replace(/^\/+/g,""))),tr().at("layout","views","".concat(e,".html")).withParams(t).get().then((function(e){return e.text()})).then((function(e){n._insertUi($(e))}))},_loadUi:function(e,t){"view"in e&&this._loadViewUi(e.view,t)},_insertUi:function(e){var t=this;e.each((function(){var e=$(this);e.hasClass("mt-dialog-root")?(t.options.tabs?e.parent().find(".ui-dialog-titlebar-close").prependTo("#link-picker-tabs").closest(".ui-dialog").children(".ui-dialog-titlebar").remove():t._setOption("title",e.data("title")),t.$wrapper=e.appendTo(t.element).parents(".ui-dialog").addClass("mt-modal-wrapper")):e.is("script")&&$("body").append(e)})),t._trigger("load")},_afterDialogInit:function(){var e=this,t=e.$wrapper.find(".mt-scrolling-dialog-content");if(Aa(t),"function"==typeof MutationObserver&&t.length&&(e.observer=new MutationObserver((function(){Aa(t)})),e.observer.observe(t.get(0),{childList:!0,subtree:!0})),e.options.tabs&&e.$wrapper&&"auto"===e.options.height){var n=e.$wrapper.outerHeight(),r=e.$wrapper.addClass("mt-modal-wrapper-tabs").find(".ui-dialog-titlebar").outerHeight();e.element.css("top",-1*r),e.$wrapper.height(n-r)}e.option("position",{my:"center",at:"center",of:window})},_destroy:function(){var e=this;e._trigger("beforeDestroy"),"object"===r(e.observer)&&e.observer.disconnect(),$("body").removeClass(ja),e.element.removeClass("mt-modal"),$(document).off(".mt-modal"),e._super(),e.$wrapper&&e.$wrapper.length&&e.$wrapper.remove(),e._trigger("afterDestroy")}}),Na=$.widget("mt.tabbedContent",$.ui.tabs,{_create:function(){var e=this;e.element.addClass("mt-tabbed-content"),e.options=Object.assign({},e.options,e.element.data()),e._super()}}),La=$.widget("mt.scrollableTabbedContent",Na,{options:$.extend({},$.mt.tabbedContent.options,{scrollable:!0}),_create:function(){var e=this,t=this;t._super(),t.element.addClass("ui-tabs-scrollable");var n=$('<div class="ui-tabs-scroll-container"></div>');$(".mt-guide-add-button-container").length?n.insertAfter(".mt-guide-add-button-container"):n.prependTo(t.element),t.header=$('<div class="ui-tabs-nav-scrollable ui-widget-header ui-corner-all"></div>').appendTo(n);var r=t.element.find(".ui-tabs-nav:first").removeClass("ui-widget-header ui-corner-all").appendTo(this.header),i=$('<ol class="ui-tabs-nav-arrows"></ol>').insertBefore(n),a=t.options.scrollLeftText,s=t.options.scrollRightText,o=$('<li class="ui-tabs-arrow-previous" title="'+a+'"><button class="ui-button-icon mt-icon-tab-scroll-left" data-ga-label="Scroll tabs left"></button></li>').prependTo(i),l=$('<li class="ui-tabs-arrow-next" title="'+s+'"><button class="ui-button-icon mt-icon-tab-scroll-right" data-ga-label="Scroll tabs right"></button></li>').prependTo(i);return o.add(l),o.on("click",(function(e){e.preventDefault(),t._scrollTo(-150,200)})),l.on("click",(function(e){e.preventDefault(),t._scrollTo(150,200)})),i.find("li").on("mouseenter focus",(function(){$(e).addClass("ui-state-hover")})),i.find("li").on("mouseleave blur",(function(){$(e).removeClass("ui-state-hover")})),this.anchors.bind("click.tabs",(function(){var e=$(this).parent(),i=o.outerWidth(),a=e.outerWidth(!0),s=n.width(),l=e.position().left,c=-parseInt(r.stop(!0,!0).css("marginLeft"),10),u=-1;0===e.index()?u=0:l+a>=s+c?(u=l-s+a,e.index()+1<r.find("li").length&&(u+=i)):l<c&&(u=l+i),u>-1&&r.animate({marginLeft:-u},200,(function(){t._resize()}))})),t._resize(),$(window).on("resize",(function(){t._resize()})),t},_update:function(){this._super()._update.apply(this)},_resize:function(){var e=this,t=e.element.find(".ui-tabs-nav:first"),n=e.element.find(".ui-tabs-scroll-container"),r=e.element.find(".ui-tabs-arrow-previous"),i=e.element.find(".ui-tabs-arrow-next"),a=0;t.find("li").each((function(){a+=$(this).outerWidth(!0)}));var s=r.width()+i.width(),o=-parseInt(t.css("marginLeft"),10),l=n.width(),c=l+o-a;if(a>l+o-3.5)e.header.addClass("ui-tabs-arrow-r"),r.show("fade"),i.show("fade"),i.removeClass("mt-disabled"),n.removeClass("mt-tabs-arrows-disabled").prev().removeClass("mt-tabs-arrows-disabled"),o>0?(e.header.addClass("ui-tabs-arrow-l"),r.removeClass("mt-disabled")):(e.header.removeClass("ui-tabs-arrow-l"),r.addClass("mt-disabled"));else{if(c>3.5&&o>0){var u=Math.min(o,c-3.5);e._scrollTo(-u,200)}l+s-3.5>a?(r.hide("fade"),i.hide("fade"),e.header.removeClass("ui-tabs-arrow-r"),e.header.removeClass("ui-tabs-arrow-l"),n.addClass("mt-tabs-arrows-disabled").prev().addClass("mt-tabs-arrows-disabled")):(i.addClass("mt-disabled"),e.header.removeClass("ui-tabs-arrow-r"),e.header.addClass("ui-tabs-arrow-l"),r.show("fade"),i.show("fade"),r.removeClass("mt-disabled"),n.removeClass("mt-tabs-arrows-disabled").prev().removeClass("mt-tabs-arrows-disabled"))}},_scrollTo:function(e,t){var n=this,r=n.element.find(".ui-tabs-nav:first"),i=n.element.find(".ui-tabs-scroll-container"),a=0,s=-parseInt(r.css("marginLeft"),10),o=i.width(),l=0;r.find("li").each((function(){a+=$(this).outerWidth(!0)})),e instanceof $.Event||(l=s+e,a<o||a<0||s<=0&&e<0||l<0?l=0:l>a-o&&a>o&&(l=a-o+5),r.stop(!0).animate({marginLeft:-l},t,(function(){n._resize()})))}}),Da=$.widget("mt.draggableTabbedContent",La,{_create:function(){var e=this;this._super(),this._sortableElement=this.element.addClass("mt-draggable-tabbed-content").find("ul").addClass("mt-draggable-tabs"),this._sorterPromise=ta.create({container:this._sortableElement[0],blockClass:"mt-guide-tab",handleClass:"mt-icon-tab-move",trackDirection:"horizontal",intersectThreshold:.7,dynamicDragWidth:!1,onorderchanged:function(){e.tabsSorted()}})},enableDragging:function(){this._sorterPromise.then((function(e){e.enabled=!0}))},disableDragging:function(){this._sorterPromise.then((function(e){e.enabled=!1}))},activateTab:function(e){this._sorterPromise.then((function(t){t.activateElement(e)}))},tabsSorted:function(){}}),Fa=Object.freeze({__proto__:null,draggableTabbedContent:Da,scrollableTabbedContent:La,tabbedContent:Na}),qa=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.martianSettings,r=t.environmentSettings;if(s(this,e),"ComponentBase"===this.constructor.name)throw new TypeError("ComponentBase can not be constructed directly.");this._listeners=[],this._events={},this._options={},this._martianSettings=n,this._envSettings=r}return l(e,[{key:"addListener",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this._element).addEventListener.apply(e,n),this._listeners.push(n),this}},{key:"emitEvent",value:function(e,t){this._element.dispatchEvent(new CustomEvent(e,{detail:t}))}},{key:"removeAllListeners",value:function(){for(var e=0;e<this._listeners.length;e++){var t;(t=this._element).removeEventListener.apply(t,v(this._listeners[e]))}this._listeners=[]}},{key:"addEvent",value:function(e,t){"function"==typeof t&&(this._events[e]=t)}},{key:"callEvent",value:function(e,t){this._events[e]&&this._events[e]({detail:t})}},{key:"setOptionsDefaults",value:function(e,t){this._options=Object.assign({},t,e)}},{key:"element",get:function(){return this._element},set:function(e){this._element=e}},{key:"martianSettings",get:function(){return this._martianSettings},set:function(e){this._martianSettings=e}},{key:"environmentSettings",get:function(){return this._envSettings},set:function(e){this._envSettings=e}},{key:"options",get:function(){return this._options}}]),e}();var Ma=function(e){var t;function n(e){var t;return s(this,n),(t=f(this,h(n).call(this,e))).initialize({defaults:{clearOnSelect:!1,dataProvider:function(e){return Promise.resolve([{value:e}])},delay:250,displayMode:"value",inputElement:document.createElement("input"),parentElement:document.body,clearResultsOnBlur:!0,selectOnTab:!0},events:["onitemselected","onitemsadded","oninvaliddata","oncurrentselectionchanged"]}),t._hotkeys={escape:27,enter:13,arrowDown:40,arrowUp:38,tab:9},t._inputElement=t.options.inputElement,t.options.clearResultsOnBlur&&t._inputElement.addEventListener("blur",(function(){t.removeItemsElement()})),t._inputElement.addEventListener("input",t.getData()),t._inputElement.addEventListener("keydown",(function(e){Object.values(t._hotkeys).includes(e.keyCode)&&t.handleHotkey(e)})),t}return d(n,e),l(n,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new n(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),l(n,[{key:"getData",value:function(){var e,t=this;return function(){clearTimeout(e);var n=t._inputElement.value.trim();t._typedInput=n,e=setTimeout((function(){t.removeItemsElement(),""!==n&&t.options.dataProvider(n).then((function(e){!function(e){if(!Array.isArray(e))return!1;for(var t=0;t<e.length;t++)if(!("value"in e[t]))return!1;return!0}(e)?t.callEvent("oninvaliddata",{suppliedData:e,message:"The data supplied to the autocomplete is not valid: It must be an array, and each item must have a `value` property."}):(e.length>0&&!t._suppressDisplay&&(t._inputElement.dataset.value="",t.removeItemsElement(),t._itemsElement=t.itemsTemplate(e),t.options.parentElement.appendChild(t._itemsElement),t.callEvent("onitemsadded",{data:e})),t._suppressDisplay=!1)}))}),t.options.delay)}}},{key:"itemsTemplate",value:function(e){var t=this,n=this._inputElement.getBoundingClientRect(),r=window.pageYOffset+n.bottom,i=window.pageXOffset+n.left;return Gr({className:"ui-autocomplete ui-front ui-menu ui-widget ui-widget-content",style:{top:"".concat(r,"px"),left:"".concat(i,"px"),width:"".concat(n.width,"px")}},e.map((function(e){return Qr({className:"ui-menu-item",onmousedown:function(e){return t.itemSelected(e)},dataset:e},e.label||e.value)})))}},{key:"itemSelected",value:function(e){e.stopPropagation();var t=Object.assign({},e.target.dataset,{label:e.target.textContent});this.selectedEvent(t)}},{key:"removeItemsElement",value:function(){this._itemsElement&&(this.options.parentElement.removeChild(this._itemsElement),delete this._itemsElement)}},{key:"selectedEvent",value:function(e){this.options.clearOnSelect?this.selection={value:"",label:""}:this.selection=e,this._currentSelection=null,this.removeItemsElement(),this.callEvent("onitemselected",e)}},{key:"currentSelectionEvent",value:function(e){this.callEvent("oncurrentselectionchanged",e)}},{key:"handleHotkey",value:function(e){var t=e.keyCode,n=this._itemsElement?this._itemsElement.querySelector(".ui-state-focus"):null;if(t===this._hotkeys.escape)this.removeItemsElement();else if(t===this._hotkeys.arrowDown||t===this._hotkeys.arrowUp)t===this._hotkeys.arrowDown?!n&&this._itemsElement?this._currentSelection=this._itemsElement.firstChild:this._currentSelection&&(this._currentSelection.classList.remove("ui-state-focus"),this._currentSelection=this._currentSelection.nextSibling):t===this._hotkeys.arrowUp&&(!n&&this._itemsElement?this._currentSelection=this._itemsElement.lastChild:this._currentSelection&&(this._currentSelection.classList.remove("ui-state-focus"),this._currentSelection=this._currentSelection.previousSibling)),this._currentSelection?(this._currentSelection.classList.add("ui-state-focus"),this.selection={label:this._currentSelection.textContent,value:this._currentSelection.dataset.value},this.currentSelectionEvent(this._getCurrentEventData()),this._currentSelection.scrollIntoView()):this.selection={value:this._typedInput};else if((t===this._hotkeys.enter||this.options.selectOnTab&&t===this._hotkeys.tab)&&(this._suppressDisplay=!0,this._currentSelection||""!==this._inputElement.value)){e.preventDefault();var r={};this._currentSelection?r=this._getCurrentEventData():(r.value=this._inputElement.value,r.label=this._inputElement.value),this.selectedEvent(r)}}},{key:"_getCurrentEventData",value:function(){return Object.assign({},this._currentSelection.dataset,{label:this._currentSelection.textContent})}},{key:"selection",get:function(){return{value:this._inputElement.dataset.value,label:this._inputElement.value}},set:function(e){var t=e.value,n=e.label,r=void 0===n?t:n;if(void 0===t)return!1;"label"===this.options.displayMode?this._inputElement.value=r:this._inputElement.value=t,this._inputElement.dataset.value=t}}]),n}(ji),Oa=[{field:"id",transform:"number"},{field:"question"},{field:"updated_at",name:"dateUpdated",transform:"date"}],za=[{field:"@exceeding-count",name:"exceedingCount",transform:"number"},{field:"questions",using:[{field:"@count",name:"totalCount",transform:"number"},{field:"question",name:"items",isArray:!0,using:Oa}]}],Ua=[{field:"@count",name:"totalCount",transform:"number"},{field:"question",name:"items",isArray:!0,using:Oa}],Ba=F.createParser(K),Ha=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D;s(this,e),this._settings=t,this._plug=new E(t.host,t.plugConfig).at("@api","deki","llm")}return l(e,[{key:"query",value:function(e){var t=e.q,n=e.paths,r=e.tags,i=e.limit,a=e.threshold,s=e.include,o=e.dekiEventType,l=e.format,c=void 0===l?"xml":l,u=e.fileExtensions,d=void 0===u?[]:u,h=ht.object({q:t,limit:i,threshold:a,paths:n,tags:r,include:s,dekiEventType:o,format:c,fileExtensions:d},ct("q",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),lt("paths",it()),lt("tags",it()),lt("limit",(function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]})),lt("threshold",(function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]})),lt("include",st(at("completion"),at("prompt"))),lt("dekiEventType",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),lt("format",st(at("xml"),at("sse"),at("textstream"))),lt("fileExtensions",it()));if(h.length>0)return Promise.reject(new Error(h));var m={q:t},f={threshold:a,limit:i,include:s,format:c};for(var p in f)void 0!==f[p]&&(m[p]=f[p]);n&&n.length>0&&(m.pathancestors=n.map(encodeURIComponent).join(",")),r&&r.length>0&&(m.tags=r.join(",")),d&&d.length>0&&(m.fileextensions=d.join(","),m.includeattachments=!0);var g=this._plug.at("completion");return null!==o&&(m.trackeventtype=o),g.withParams(m).get().catch((function(e){return Promise.reject(Ba(e))})).then((function(e){return e.json()})).then(F.createParser([{field:"@query-id",name:"id"},{field:"completion"},{field:["pages","page"],name:"sources",isArray:!0,transform:v(H).concat([{field:"page.top_ancestor",name:"topAncestor",transform:H}])}]))}},{key:"feedback",value:function(e){var t=e.id,n=e.feedback,r=ht.object({id:t,feedback:n},ct("id",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),ct("feedback",st(at(0),at(1))));return r.length>0?Promise.reject(new Error(r)):this._plug.at("feedback","queries",t).withParams({feedback:n}).post().catch((function(e){return Promise.reject(Ba(e))}))}},{key:"followArticle",value:function(e){var t=e.pageId,n=e.url,r=ht.object({pageId:t,url:n},ct("pageId",(function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]})),ct("url",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})));return r.length>0?Promise.reject(new Error(r)):this._plug.at("search-followed","queries",t).withParam("pageurl",n).post().catch((function(e){return Promise.reject(Ba(e))}))}},{key:"editorCompletions",value:function(e){return this._plug.at("editor","completions").withHeaders({"Content-Type":"application/json; charset=utf-8"}).post(JSON.stringify(e)).then((function(e){return e.text()})).catch((function(e){return Promise.reject(Ba(e))}))}},{key:"uploadContentAdequacyQuestions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._plug.withHeader("Content-Length",e.size).at("evaluation-reports","queries").put(e).catch((function(e){return Promise.reject(Ba(e))})).then((function(e){return e.json()})).then(F.createParser(za))}},{key:"getContentAdequacyQuestions",value:function(){return this._plug.at("evaluation-reports","queries").get().catch((function(e){return Promise.reject(Ba(e))})).then((function(e){return e.json()})).then(F.createParser(Ua))}}]),e}(),Va=function(e){var t;function n(e){var t;return s(this,n),(t=f(this,h(n).call(this,e))).initialize({defaults:{progressClassName:"mt-progress-bar",prependText:"",appendText:"%",elementId:"mt-progress-bar-element",maxValue:100,initialValue:0}}),t}return d(n,e),l(n,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new n(t))._createUi(),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),l(n,[{key:"_createUi",value:function(){this.element=Wr({className:"mt-progress-bar-container",id:this.options.elementId},this._progressElement=Mr("progress",{className:this.options.progressClassName,max:this.options.maxValue,value:this.options.initialValue}),this._progressText=Kr({className:"mt-progress-bar-value"},this._getProgressText()))}},{key:"_getProgressText",value:function(){return"".concat(this.options.prependText).concat(this._progressElement.value).concat(this.options.appendText)}},{key:"value",get:function(){return this._progressElement.value},set:function(e){this._progressElement.value=e,this._progressText.textContent=this._getProgressText()}},{key:"prependText",get:function(){return this.options.prependText},set:function(e){this.options.prependText=e||"",this._progressText&&(this._progressText.textContent=this._getProgressText())}}]),n}(ji),Wa=function(e){var t,n,r;function i(e){var t;return s(this,i),(t=f(this,h(i).call(this,e))).initialize({defaults:{allowDragDrop:!0,allowedExtensions:[],allowMultiple:!0,autoUpload:!0,mode:"attach",selectedFiles:[],showAllowedExtensions:!1,showHelperMessage:!0,showSizeMessage:!0,showExtensionsHelperMessage:!1,uploadButtonLabel:t.localize("Dialog.Attach.button.upload"),hideUploadButtonUntilFileSelected:!1,showResetButton:!1},events:["onsuccess","onerror","onfiledropped","onfileupload"]}),t._progressBars={},t._selectedFiles=v(t.options.selectedFiles),t}return d(i,e),l(i,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new i(t))._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Dialog.Attach.allowed-types","Dialog.Attach.button.upload","Dialog.Attach.button.reset","Dialog.Attach.choose-files-dad","Dialog.Attach.choose-files-extensions","Dialog.Attach.max-size"]}},{key:"settingsKeys",get:function(){return["maxFileSize","pageId","isDraftRequest","attachFileMax"]}}]),l(i,[{key:"uploadFromCache",value:function(){this._cache&&this._cache.selectorDom?this._upload(this._cache.selectorDom,!0):this.callEvent("onerror",{error:"error.noCacheSet"})}},{key:"setSelectedFiles",value:function(e){this._externalFilesSource=!0,this._selectedFiles=e}},{key:"resetUi",value:function(){this._selectorArea&&(this._selectorArea.classList.remove("mt-hide"),li(this._progressArea))}},{key:"updateUploadButtonLabel",value:function(e){this._uploadButton&&(this._uploadButton.textContent=e)}},{key:"_createUi",value:(r=a(regeneratorRuntime.mark((function e(){var t,n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=wr.formatBytes(this.getSetting("maxFileSize")),this.hideUploadResetButtons=this.options.hideUploadButtonUntilFileSelected,this.options.showAllowedExtensions&&Array.isArray(this.options.allowedExtensions)&&this.options.allowedExtensions.length>0&&(n="".concat(this.localize("Dialog.Attach.allowed-types")," ").concat(this.options.allowedExtensions.join(", "))),this.options.showExtensionsHelperMessage&&Array.isArray(this.options.allowedExtensions)&&this.options.allowedExtensions.length>0&&(r=this.localize("Dialog.Attach.choose-files-extensions",this.options.allowedExtensions.join(", "))),this.options.autoUpload||(this._uploadButton=Vr({type:"button",className:"ui-button mt-file-uploader-button mt-disabled".concat(this.hideUploadResetButtons?" mt-hide":""),disabled:!0,onclick:function(){return a._uploadButtonClicked()}},this.options.uploadButtonLabel)),this.options.showResetButton&&(this._resetButton=Vr({type:"button",className:"ui-button mt-file-uploader-reset-button".concat(this.hideUploadResetButtons?" mt-hide":""),disabled:!0,onclick:function(){a._selectedFiles=null,a._fileInput.value="",a.hideUploadResetButtons&&(a._resetButton.classList.add("mt-hide"),a._uploadButton.classList.add("mt-hide"))}},this.localize("Dialog.Attach.button.reset"))),this._fileInput=Jr({type:"file",name:"file",className:"mt-file-uploader-file",multiple:this.options.allowMultiple,onchange:function(e){return a._fileInputChanged(e)}}),this.options.selectedFiles&&0!==this.options.selectedFiles.length||(this._selectorArea=Wr({className:"mt-file-uploader-select-area"},this.options.showHelperMessage&&$r({className:"mt-file-uploader-help-text"},this.localize("Dialog.Attach.choose-files-dad")),Wr(this._fileInput,this._uploadButton,this._resetButton),Wr({className:"mt-file-uploader-restriction-messages"},r&&$r({className:"mt-file-uploader-allowed-types"},r),this.options.showSizeMessage&&$r({className:"mt-file-uploader-max-filesize"},this.localize("Dialog.Attach.max-size",t)),n&&$r({className:"mt-file-uploader-allowed-types"},n)))),this.element=Wr({className:"mt-file-uploader-main"},this._selectorArea,this._progressArea=Wr({className:"mt-file-uploader-progress-area"})),i=this.options.dropElement||this.element,this.options.allowDragDrop&&(i.addEventListener("dragover",(function(e){return a._cancelDragDropEvent(e)})),i.addEventListener("dragenter",(function(e){return a._cancelDragDropEvent(e)}))),i.addEventListener("drop",(function(e){return a._fileDropped(e)})),this._selectedFiles&&this._selectedFiles.length>0&&this._upload();case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_cancelDragDropEvent",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"_fileDropped",value:function(e){var t;if((this.callEvent("onfiledropped",{uploadCancelled:!this.options.allowDragDrop}),this.options.allowDragDrop)&&(this._cancelDragDropEvent(e),0!==(t=this._externalFilesSource&&Array.isArray(this._selectedFiles)?this._selectedFiles:e.dataTransfer&&e.dataTransfer.files?Array.prototype.slice.call(e.dataTransfer.files):[]).length)){this._externalFilesSource=!1,this._selectedFiles=t;try{var n=new DataTransfer;t.forEach((function(e){return n.items.add(e)})),this._fileInput.files=n.files}catch(e){this.callEvent("onerror",{error:"error.upload",errorArgs:[e.message]})}this.options.autoUpload?this._upload(this._selectorArea):(this._uploadButton.disabled=!1,this._uploadButton.classList.remove("mt-disabled"),this.hideUploadResetButtons&&this._uploadButton.classList.remove("mt-hide"),this.options.showResetButton&&(this._resetButton.disabled=!1,this._resetButton.classList.remove("mt-disabled"),this.hideUploadResetButtons&&this._resetButton.classList.remove("mt-hide")))}}},{key:"_fileInputChanged",value:function(){this._externalFilesSource&&this._selectedFiles||(this._selectedFiles=Array.from(this._fileInput.files)),this.options.autoUpload?this._upload():(this._uploadButton.disabled=!1,this._uploadButton.classList.remove("mt-disabled"),this.hideUploadResetButtons&&this._uploadButton.classList.remove("mt-hide"),this.options.showResetButton&&(this._resetButton.disabled=!1,this._resetButton.classList.remove("mt-disabled"),this.hideUploadResetButtons&&this._resetButton.classList.remove("mt-hide"))),this.callEvent("onfileupload")}},{key:"_uploadButtonClicked",value:function(){this._externalFilesSource&&this._selectedFiles||(this._selectedFiles=Array.from(this._fileInput.files)),this._upload()}},{key:"_fileProgress",value:function(e,t,n){var r=this;return function(){var i=a(regeneratorRuntime.mark((function i(a){var s;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=r._progressBars[e]){i.next=8;break}return n&&n.classList.add("mt-hide"),i.next=5,Va.create({prependText:"".concat(t.name,": "),elementId:e});case 5:s=i.sent,r._progressArea.appendChild(Wr({className:"mt-file-uploader-progress-bar"},s.element)),r._progressBars[e]=s;case 8:s.value=parseInt(a.loaded/a.total*100,10);case 9:case"end":return i.stop()}}),i,this)})));return function(e){return i.apply(this,arguments)}}()}},{key:"_validateFiles",value:function(e){var t=!0,n=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;this._validateFileSize(o)&&this._validateFileExtension(o)||(t=!1)}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return t}},{key:"_validateFileSize",value:function(e){var t=this.getSetting("maxFileSize");return!(e.size>t)||(this.callEvent("onerror",{error:"file.upload.toobig",errorArgs:[(t/1024/1024).toFixed(2)+" MiB"],filename:e.name,fileSize:e.size,maxSize:t}),!1)}},{key:"_validateFileExtension",value:function(e){var t=hr(e.name,".").toLowerCase();return!(Array.isArray(this.options.allowedExtensions)&&this.options.allowedExtensions.length>0)||(!!this.options.allowedExtensions.map((function(e){return e.toLowerCase()})).includes(t)||(this.callEvent("onerror",{error:"file.upload.fileExtension",extension:t,filename:e.name}),!1))}},{key:"_getUploadApiInfo",value:function(){var e,t,n=this.getSetting("pageId"),r=this.getSetting("isDraftRequest");return"attach"===this.options.mode?t=(e=r?new Ue(n,this.martianSettings):new Ht(n,this.martianSettings)).attachFile.bind(e):"revision"===this.options.mode?t=(e=r?new vt(this.options.revisionFileId,this.martianSettings):new gt(this.options.revisionFileId,this.martianSettings)).addRevision.bind(e):"import"===this.options.mode?t=(e=new Ht(n,this.martianSettings)).importArchive.bind(e):"llmUploadContentAdequacyQuestions"===this.options.mode&&(t=(e=new Ha(this.martianSettings)).uploadContentAdequacyQuestions.bind(e)),[e,t]}},{key:"_upload",value:(n=a(regeneratorRuntime.mark((function e(){var t,n,r,i,a,s,o,l,c,d,h=this,m=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=m.length>0&&void 0!==m[0]?m[0]:this._selectorArea,n={},m.length>1&&void 0!==m[1]&&m[1]?n.allow="deleteredirects":this._cache={selectorDom:t},this.options.allowMultiple||(this._selectedFiles=this._selectedFiles.slice(0,1)),this._validateFiles(this._selectedFiles)){e.next=7;break}return e.abrupt("return");case 7:if(r=this._getUploadApiInfo(),i=g(r,2),a=i[0],s=i[1],!((o=this._selectedFiles.map((function(e){var r=u({},n);"mediaManager"===h.options.origin&&(r.uploadsource="mediamanager");var i="file_".concat(wr.guid()),a=h._fileProgress(i,e,t),o={name:h.options.fileNameOverride||e.name,progress:a};return function(){return s(e,o,r)}}))).length>0)){e.next=39;break}if("attach"!==this.options.mode){e.next=25;break}return e.prev=11,e.next=14,a.getFiles();case 14:l=e.sent,e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(11),this.callEvent("onerror",e.t0),e.abrupt("return");case 21:if(c=this.getSetting("attachFileMax"),!(l.count+o.length>c)){e.next=25;break}return this.callEvent("onerror",{error:"error.multiple.truncation",errorArgs:[o.length,c]}),e.abrupt("return");case 25:return e.prev=25,e.next=28,Promise.all(o.map((function(e){return e()})));case 28:d=e.sent,e.next=36;break;case 31:return e.prev=31,e.t1=e.catch(25),403===e.t1.status?e.t1.error="file.upload.notAllowed":400===e.t1.status&&e.t1.responseText&&(e.t1.error=JSON.parse(e.t1.responseText).message),this.callEvent("onerror",e.t1),e.abrupt("return");case 36:this._selectedFiles=null,this._externalFilesSource=!1,this.callEvent("onsuccess",{files:d});case 39:case"end":return e.stop()}}),e,this,[[11,17],[25,31]])}))),function(){return n.apply(this,arguments)})}]),i}(Yi(ha(Ui(ji)))),$a=function(e){var t;function n(e){var t;return s(this,n),(t=f(this,h(n).call(this,e))).initialize({defaults:{clearPreviousMessages:!0,defaultType:"error",showCloseButton:!0},events:["onclearmessages"]}),t}return d(n,e),l(n,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new n(t))._createUi(),r.options.initialMessages&&r[r.options.defaultType](r.options.initialMessages),e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),l(n,[{key:"error",value:function(e,t){this._createNewMessage(e,{type:"errormsg",name:"error",onCloseFunction:t})}},{key:"info",value:function(e,t){this._createNewMessage(e,{type:"infomsg",name:"info",onCloseFunction:t})}},{key:"success",value:function(e,t){this._createNewMessage(e,{type:"successmsg",name:"success",onCloseFunction:t})}},{key:"warning",value:function(e,t){this._createNewMessage(e,{type:"warningmsg",name:"warning",onCloseFunction:t})}},{key:"clearMessages",value:function(){li(this.element),this.callEvent("onclearmessages")}},{key:"_createUi",value:function(){this.element=Wr({className:"mt-flash-message-component"})}},{key:"_createNewMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.type,r=void 0===n?"".concat(this.options.defaultType,"msg"):n,i=t.name,a=void 0===i?this.options.defaultType:i,s=t.onCloseFunction,o=void 0===s?null:s;this.options.clearPreviousMessages&&this.clearMessages(),this.element.append(Ka({messages:e,type:r,name:a,onCloseFunction:o,showCloseButton:this.options.showCloseButton}))}}]),n}(ji);function Ka(e){var t=e.messages,n=e.showCloseButton,r=void 0!==n&&n,i=e.type,a=void 0===i?"infomsg":i,s=e.name,o=e.onCloseFunction;"string"==typeof t&&(t=[t]);var l=[a,"systemmsg"];!1===r&&l.push("no-close-button");var c=Wr({className:l.join(" ")},r&&Vr({className:"ui-button-icon delete-msg mt-icon-delete-msg",title:"Close message",onclick:function(){c.parentElement&&c.parentElement.removeChild(c),o&&"function"==typeof o&&o()}}),Wr({className:"inner mt-icon-flash-message"},Gr({className:"".concat(s," first flashMsg")},t.map((function(e){return Qr(e)})))));return c}var Ga={error:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.showCloseButton;return Ka({messages:e,showCloseButton:void 0!==n&&n,type:"errormsg",name:"error",onCloseFunction:t.onCloseFunction})},info:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.showCloseButton;return Ka({messages:e,showCloseButton:void 0!==n&&n,type:"infomsg",name:"info",onCloseFunction:t.onCloseFunction})},success:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.showCloseButton;return Ka({messages:e,showCloseButton:void 0!==n&&n,type:"successmsg",name:"success",onCloseFunction:t.onCloseFunction})},warning:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.showCloseButton;return Ka({messages:e,showCloseButton:void 0!==n&&n,type:"warningmsg",name:"warning",onCloseFunction:t.onCloseFunction})}};function Qa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.path;return""===n||["topic-portfolio","topic-category","topic-guide","topic","reference","howto"].includes(e.article)?"pageParent"in e&&""!==n?Qa(e.pageParent,[e].concat(v(t))):t:"pageParent"in e&&""!==n?Qa(e.pageParent,t):void 0}var Ja=function(e){var t,n,r,i;function o(e){var t;return s(this,o),(t=f(this,h(o).call(this,e))).initialize({defaults:{path:""},events:["onpathselected"]}),t}return d(o,e),l(o,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o(t),e.next=3,n._createUi();case 3:return n.element=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["MindTouch.Help.Page.category-selector","MindTouch.Help.Page.label-filter","MindTouch.Help.Page.label-search-all","MindTouch.Help.Page.label-result-count"]}}]),l(o,[{key:"update",value:(i=a(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setCrumbsFromPath(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"_createUi",value:(r=a(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Wr({className:"mt-help-breadcrumb-container"},Kr({className:"mt-help-breadcrumb-label"},"".concat(this.localize("MindTouch.Help.Page.label-filter"))),this._breadCrumbList=Gr({className:"mt-help-breadcrumb"}),this._searchResultCount=Wr({className:"mt-search-results-count-text",role:"status"})),e.next=3,this._setCrumbsFromPath("",0);case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_setCrumbsFromPath",value:(n=a(regeneratorRuntime.mark((function e(){var t,n,r,i,a,s,o=this,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.length>0&&void 0!==l[0]?l[0]:this.options.path,n=l.length>1&&void 0!==l[1]?l[1]:0,li(this._breadCrumbList),this._addCrumb({text:this.localize("MindTouch.Help.Page.label-search-all"),path:"",index:1,createLink:!0}),"/"===t||""===t){e.next=10;break}return r=new Ht(t,this.martianSettings),e.next=8,r.getFullInfo();case 8:"pageParent"in(i=e.sent)&&(a=Qa(i,[]),s=a.length-1,a.forEach((function(e,t){o._addCrumb({text:e.title,path:e.path,index:t+2,createLink:s!==t})})));case 10:n>0?(this._searchResultCount.innerText=this.localize("MindTouch.Help.Page.label-result-count",n),this._searchResultCount.classList.remove("mt-hide")):this._searchResultCount.classList.add("mt-hide");case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_addCrumb",value:function(e){var t=this,n=e.path,r=e.text,i=e.index,a=r;e.createLink&&(a=Hr({className:"mt-filter-breadcrumb",href:"#",onclick:function(e){e.preventDefault(),t.callEvent("onpathselected",{name:"path",value:n,index:i})}},r)),this._breadCrumbList.appendChild(Qr(a))}}]),o}(Ui(ha(ji))),Ya={propertyKeys:{assistantPersona:"mindtouch.llm.prompt.assistant-persona",missingContextInstructions:"mindtouch.llm.prompt.missing-context-instructions",name:"mindtouch.llm.generative-search.name",promptOutputContraints:"mindtouch.llm.prompt.output-contraints",promptTargetResponseLength:"mindtouch.llm.prompt.target-response-length",streamResponse:"mindtouch.llm.generative-search.stream-response",toggleDefaultState:"mindtouch.llm.generative-search.default-toggle-state",userPersona:"mindtouch.llm.prompt.user-persona",threshold:"mindtouch.llm.search-threshold",searchLimit:"mindtouch.llm.search-limit",allowedGroups:"mindtouch.llm.generative-search.allowed-groups",disclaimerVisibility:"mindtouch.llm.generative-search.disclaimer.visibility",disclaimerText:"mindtouch.llm.generative-search.disclaimer.text"}};function Xa(e){return Za.apply(this,arguments)}function Za(){return Za=a(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new qn(t),e.prev=1,e.next=4,n.get();case 4:r=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{name:null,toggleState:null,streamResponse:null});case 10:return e.abrupt("return",{name:r.get(Ya.propertyKeys.name)||null,toggleState:r.get(Ya.propertyKeys.toggleDefaultState)||null,streamResponse:r.get(Ya.propertyKeys.streamResponse)||null});case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),Za.apply(this,arguments)}var es="mt-generative-article-search-expanded",ts=function(e){var t,n,r,i,o,c,u,m,p,g;function y(e){var t;s(this,y),(t=f(this,h(y).call(this,e))).initialize({defaults:{isClosed:!0,shouldStreamResponse:!0,name:t.localize("Component.GenerativeSearch.title"),typeWriterDelay:65},events:["onrequestquery","oncontentupdated","onsendfeedback","onpathselected","ongeneratedfrom"]}),t.options.q&&(t.query=t.options.q),t._isClosed=t.options.isClosed,t._isStreamResponseToggleEnabled=t.getSetting("isGenerativeSearchStreamResponseToggleEnabled");var n=wr.fetch(es,"session");return t._isArticlesExpanded=null!==n&&Boolean(n),t._llmApi=new Ha(t.martianSettings),t.paths=[],t.currentRequestId=0,t}return d(y,e),l(y,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new y(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Component.GenerativeSearch.button.feedback.negative.text","Component.GenerativeSearch.button.feedback.negative","Component.GenerativeSearch.button.feedback.positive.text","Component.GenerativeSearch.button.feedback.positive","Component.GenerativeSearch.label.active-articles","Component.GenerativeSearch.label.empty.result.error","Component.GenerativeSearch.label.error","Component.GenerativeSearch.label.fetching-content","Component.GenerativeSearch.label.generated-from","Component.GenerativeSearch.title","Component.GenerativeSearchAdministration.disclaimer.text-default"]}},{key:"settingsKeys",get:function(){return["isGenerativeSearchEnabled","displayGenerativeSearchDisclaimer","isGenerativeSearchStreamResponseToggleEnabled"]}},{key:"noAnswerResponse",get:function(){return"Sorry, we could not find an answer in our knowledge base."}}]),l(y,[{key:"search",value:(g=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.query=t,e.next=3,this._fetch();case 3:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"setFilters",value:(p=a(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.classifications,r=t.path,i=t.type,this.classifications=n||[],i&&i.includes("document")?this.fileExtensions=[".doc",".docx",".pdf"]:this.fileExtensions=[],r&&r.length>0?Array.isArray(r)?this.paths=r:this.paths=[r]:this.paths=[];case 4:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"updateEmptysMessage",value:function(){this._isClosed||this._setResponse({response:this.localize("Component.GenerativeSearch.label.empty.result.error")})}},{key:"toggleVisibility",value:(m=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isClosed=!this._isClosed,e.next=3,this._updateVisibility();case 3:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"_createUi",value:(u=a(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new qn(this.martianSettings),e.next=3,t.get();case 3:return this._siteProperties=e.sent,this.element=Wr({className:"mt-generative-search-component"},this._content=Wr({className:"mt-generative-search-content"})),e.next=7,this._updateVisibility();case 7:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"_updateVisibility",value:(c=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._content.hidden=this._isClosed,this._isClosed){e.next=4;break}return e.next=4,this._fetch();case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"_fetch",value:(o=a(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isClosed){e.next=2;break}return e.abrupt("return");case 2:if(!(void 0===this.query||this.query.length<1)){e.next=6;break}return e.next=5,this._setResponse({response:this.localize("Component.GenerativeSearch.label.empty.result.error")});case 5:return e.abrupt("return");case 6:return this._displaySpinner(),n=++this.currentRequestId,e.prev=8,e.next=11,this._llmApi.query({q:this.query,paths:this.paths,tags:this.classifications,dekiEventType:"GENERATIVE_SEARCH",fileExtensions:this.fileExtensions});case 11:t=e.sent,e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(8),this._setResponse({response:this._getErrorText(e.t0),requestId:n}),e.abrupt("return");case 18:return e.next=20,this._setResponse({response:t.completion,id:t.id,sources:t.sources,requestId:n});case 20:case"end":return e.stop()}}),e,this,[[8,14]])}))),function(){return o.apply(this,arguments)})},{key:"_displaySpinner",value:function(){null===this._content.querySelector(".mt-generative-search-content-fetching")&&(this._content.innerText="",this._content.appendChild($r({className:"mt-generative-search-content-fetching"},this.localize("Component.GenerativeSearch.label.fetching-content",this.name))))}},{key:"_setResponse",value:(i=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.response,r=t.id,i=t.sources,a=void 0===i?[]:i,s=t.requestId,l=void 0===r||n.includes(y.noAnswerResponse),this._content.textContent="",this._responseElement=Wr(),this._content.appendChild(this._responseElement),!l){e.next=9;break}this._responseElement.appendChild($r({className:"mt-generative-search-error-message"},n)),e.next=21;break;case 9:if(this._content.appendChild(o=Wr({className:"mt-generative-search-feedback-sources-container"},this._feedbackUi(r))),!(a.length>0)){e.next=18;break}return e.t0=this._content,e.next=14,this._generatedSourcesUi(a);case 14:e.t1=e.sent,e.t2=this._responseElement,e.t0.insertBefore.call(e.t0,e.t1,e.t2),o.appendChild(this._sourceUi(a));case 18:return this.getSetting("displayGenerativeSearchDisclaimer")&&(c=this._siteProperties.get(Ya.propertyKeys.disclaimerText)||null,(u=c&&c.contents?c.contents.value:null)||(u=this.localize("Component.GenerativeSearchAdministration.disclaimer.text-default")),this._content.insertBefore(Wr({className:"mt-generative-search-response-disclaimer"},u),this._responseElement)),e.next=21,this._formatResponse(n,s);case 21:this.callEvent("oncontentupdated",{response:n});case 22:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_generatedSourcesUi",value:(r=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,o,l,c,u,d,h,m,f,p,g=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=new Map,r=!0,i=!1,a=void 0,e.prev=4,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)void 0!==(l=o.value).topAncestor&&n.set(l.topAncestor.id,l.topAncestor);e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),i=!0,a=e.t0;case 12:e.prev=12,e.prev=13,r||null==s.return||s.return();case 15:if(e.prev=15,!i){e.next=18;break}throw a;case 18:return e.finish(15);case 19:return e.finish(12);case 20:if(c=[],!(this.paths.length>0)){e.next=34;break}return u=new Ht(this.paths[0],this.martianSettings),e.prev=23,e.next=26,u.getFullInfo();case 26:"pageParent"in(h=e.sent)&&(d="mt-generative-search-generated-from-selected-path-with-descendants",m=Qa(h,[]),c=m.map((function(e,t){var r;return r=g.paths[0]===e.path?e.title:g._pathElement(e),m.length===t+1&&0===n.size&&(d=""),Qr({className:d},r)}))),e.next=34;break;case 30:e.prev=30,e.t1=e.catch(23),f=this.paths[0].slice(0,this.paths[0].length-1).lastIndexOf("/"),c.push(Qr({className:d},this.paths[0].slice(f+1).replace(/_/g," ")));case 34:return p=[],v(n.values()).forEach((function(e){p.push(e.path),c.push(Qr({className:"mt-generative-search-generated-from-path-filter"},g._pathElement(e)))})),this.callEvent("ongeneratedfrom",{paths:p}),e.abrupt("return",Wr({className:"mt-generative-search-generated-from"},[Mr("h3",{className:"mt-generative-search-generated-from-title"},"".concat(this.localize("Component.GenerativeSearch.label.generated-from")," ")),Gr({className:"mt-generative-search-generated-from-paths"},c)]));case 38:case"end":return e.stop()}}),e,this,[[4,8,12,20],[13,,15,19],[23,30]])}))),function(e){return r.apply(this,arguments)})},{key:"_pathElement",value:function(e){var t=this;return Hr({href:e.uri,onclick:function(n){n.preventDefault(),t.callEvent("onpathselected",{path:e.path})},dataset:{id:e.id}},e.title)}},{key:"_feedbackUi",value:function(e){var t,n,r=this;return Gr({className:"mt-feedback-rating-controls"},Qr({className:"mt-rating-yes"},this._positiveFeedbackButton=Vr({className:"mt-generative-search-feedback-positive",onclick:(n=a(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._llmApi.feedback({id:e,feedback:1});case 2:r._disableFeedback(),r._positiveFeedbackButton.classList.add("selected-feedback"),r.callEvent("onsendfeedback");case 5:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)}),title:this.localize("Component.GenerativeSearch.button.feedback.positive")},this.localize("Component.GenerativeSearch.button.feedback.positive.text"))),Qr({className:"mt-rating-no"},this._negativeFeedbackButton=Vr({className:"mt-generative-search-feedback-negative",onclick:(t=a(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._llmApi.feedback({id:e,feedback:0});case 2:r._disableFeedback(),r._negativeFeedbackButton.classList.add("selected-feedback"),r.callEvent("onsendfeedback");case 5:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)}),title:this.localize("Component.GenerativeSearch.button.feedback.negative")},this.localize("Component.GenerativeSearch.button.feedback.negative.text"))))}},{key:"_sourceUi",value:function(e){var t=this,n="mt-generative-search-collapsible-menu";return this._isArticlesExpanded&&(n+=" expanded"),Wr(Vr({className:n,"aria-expanded":this._isArticlesExpanded,dataset:this.localize("Component.GenerativeSearch.label.active-articles"),onclick:function(e){return t._toggleArticlesVisibility(e)}},this.localize("Component.GenerativeSearch.label.active-articles")),Gr({className:"mt-generative-search-list",hidden:!this._isArticlesExpanded},e.slice(0,5).map((function(e){return Qr({className:t._sourcePageClassName(e)},Hr({href:e.uri,onclick:(n=a(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t._llmApi.followArticle({pageId:e.id,url:e.uri});case 1:case"end":return n.stop()}}),n,this)}))),function(){return n.apply(this,arguments)}),target:"_blank"},e.title));var n}))))}},{key:"_disableFeedback",value:function(){this._positiveFeedbackButton&&this._negativeFeedbackButton&&(this._positiveFeedbackButton.disabled=!0,this._negativeFeedbackButton.disabled=!0)}},{key:"_getErrorText",value:function(e){return 400===e.status&&"MindTouch.Deki.Exceptions.LlmRequestContainsPiiBadRequestException"===e.info.exception||429===e.status?e.info.message:this.localize("Component.GenerativeSearch.label.error")}},{key:"_sourcePageClassName",value:function(e){var t="mt-generative-search-source-page";if(!this.getSetting("userIsAnonymous")){var n=e.restriction["#text"].toLowerCase().includes("public")?"unlocked":"lock";t+=" mt-icon-".concat(n)}return t}},{key:"_formatResponse",value:(n=a(regeneratorRuntime.mark((function e(t,n){var r,i,s,o,l,c,u,d,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.split("\n"),!this._isStreamResponseToggleEnabled||this.options.shouldStreamResponse){e.next=6;break}return(i=$r({ariaLabel:t,className:"mt-generative-search-response"})).innerText=t,this._responseElement.appendChild(i),e.abrupt("return");case 6:s=!0,o=!1,l=void 0,e.prev=9,c=regeneratorRuntime.mark((function e(){var t,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=d.value).trim().length<1)){e.next=3;break}return e.abrupt("return","continue");case 3:return r=$r({ariaLabel:t,className:"mt-generative-search-response"}),h._responseElement.appendChild(r),i=t.split(" "),e.next=8,new Promise(function(){var e=a(regeneratorRuntime.mark((function e(t){var a,s,o,l,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=!0,s=!1,o=void 0,e.prev=3,l=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.value,e.next=3,new Promise((function(e){setTimeout((function(){n===h.currentRequestId?(r.innerText="".concat(r.innerText," ").concat(t),e()):h._displaySpinner()}),h.options.typeWriterDelay)}));case 3:case"end":return e.stop()}}),e,this)})),c=i[Symbol.iterator]();case 6:if(a=(u=c.next()).done){e.next=11;break}return e.delegateYield(l(),"t0",8);case 8:a=!0,e.next=6;break;case 11:e.next=17;break;case 13:e.prev=13,e.t1=e.catch(3),s=!0,o=e.t1;case 17:e.prev=17,e.prev=18,a||null==c.return||c.return();case 20:if(e.prev=20,!s){e.next=23;break}throw o;case 23:return e.finish(20);case 24:return e.finish(17);case 25:t();case 26:case"end":return e.stop()}}),e,this,[[3,13,17,25],[18,,20,24]])})));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return e.stop()}}),e,this)})),u=r[Symbol.iterator]();case 12:if(s=(d=u.next()).done){e.next=20;break}return e.delegateYield(c(),"t0",14);case 14:if("continue"!==e.t0){e.next=17;break}return e.abrupt("continue",17);case 17:s=!0,e.next=12;break;case 20:e.next=26;break;case 22:e.prev=22,e.t1=e.catch(9),o=!0,l=e.t1;case 26:e.prev=26,e.prev=27,s||null==u.return||u.return();case 29:if(e.prev=29,!o){e.next=32;break}throw l;case 32:return e.finish(29);case 33:return e.finish(26);case 34:case"end":return e.stop()}}),e,this,[[9,22,26,34],[27,,29,33]])}))),function(e,t){return n.apply(this,arguments)})},{key:"_toggleArticlesVisibility",value:function(e){this._isArticlesExpanded=!this._isArticlesExpanded,wr.store(es,this._isArticlesExpanded,"session");var t=!0===this._isArticlesExpanded;this.element.querySelector(".mt-generative-search-list").hidden=!t,e.target.classList.toggle("expanded"),e.target.setAttribute("aria-expanded",t)}},{key:"query",get:function(){return this._query},set:function(e){if(void 0!==e){var t=e.trim();this._query=t}}},{key:"name",get:function(){return this.options.name}}]),y}(ha(Ui(Yi(ji)))),ns=function(e){var t,n;function r(e){var t;return s(this,r),(t=f(this,h(r).call(this,e))).initialize({defaults:{tabInfo:[]}}),t._guideTabsManager=new la,t}return d(r,e),l(r,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new r(t),e.next=3,n._createUi(t.tabInfo);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),l(r,[{key:"_createUi",value:(n=a(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.options.tabInfo.length){e.next=3;break}return this.element=Or(),e.abrupt("return");case 3:this.element=Wr({className:"mt-guide-tabs-container mt-tabbed-content mt-tabs"},Gr({id:"mt-guide-tabs-selectors",className:"mt-guide-tabs-selectors",role:"tablist"},this.options.tabInfo.map((function(e){return r._tabDom(e)}))),this.options.tabInfo.map((function(e){return Wr({className:"mt-guide-content",hidden:!0,id:e.guid,role:"tabpanel"})}))),t=this.options.activeTabGuid,n=this.options.tabInfo[0],Boolean(t)&&t.match("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$")&&this.options.tabInfo.forEach((function(e){e.guid===t&&(n=e)})),this._activateTab(n);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_tabDom",value:function(e){var t=this;return Qr({className:"mt-guide-tab",dataset:{guid:e.guid,templatePath:e.templatePath,templateTitle:e.label},role:"tab"},Hr({className:"mt-guide-tab-link",href:"#".concat(e.guid),role:"presentation",onclick:function(n){n.preventDefault(),t._activateTab(e)}},e.templateTitle))}},{key:"_activateTab",value:function(e){var t=this;this.element.querySelectorAll(".mt-guide-tab").forEach((function(t){t.dataset.guid===e.guid?t.classList.add("ui-tabs-active","ui-state-active"):t.classList.remove("ui-tabs-active","ui-state-active")})),this.element.querySelectorAll(".mt-guide-content").forEach((function(n){n.id===e.guid?(n.hidden=!1,n.style.display="block",0===n.childElementCount&&t._guideTabsManager.reloadGuideTab(e)):(n.hidden=!0,n.style.display="none")}))}}]),r}(ji);function rs(e){return"_mt-tree-node_".concat(e)}var is,as,ss=function(e){var t,n,r;function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,i),(e=f(this,h(i).call(this,t))).initialize({defaults:{showMultiSelect:!1,showRestriction:!1},events:["onnodeselected","ondisablednodeselected","onnodesadded","onsubnodesrequired","onnodecreated","onnodecheckchange"]}),e._nodeMapping={},e}return d(i,e),l(i,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new i(t))._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),l(i,[{key:"clearTree",value:function(){this._nodeMapping={},li(this._rootNode)}},{key:"getNode",value:function(e){return this._nodeMapping[rs(e)]}},{key:"addNodes",value:function(e){var t,n=this,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).parentNodeId,i=void 0===r?"_root":r;t="_root"===i?this.element:this.getNode(i),Array.isArray(e)||(e=[e]);var a=t.querySelector(".mt-tree-node-wrapper");if(a)e.forEach((function(e){var t=n._createNodeDom(e,{parentNodeId:i});if(a.appendChild(t),e.expanded){var r=t.querySelector(".mt-tree-node-wrapper"),s=t.querySelector(".fancytree-node");n._toggleNode(s,r,{expand:!0,partial:e.partialExpanded})}}));else{var s=this._createTree(e,{parentNodeId:i}),o=t.querySelector(".fancytree-node");0===e.length&&(o.classList.remove("fancytree-has-children"),o.classList.add("fancytree-exp-n")),t.appendChild(s),this._toggleNode(o,s,{expand:!0})}this.callEvent("onnodesadded",{nodes:e})}},{key:"selectNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.collapseChildren,r=void 0!==n&&n,i=t.scrollIntoView,a=void 0!==i&&i,s=t.forceFullChildren,o=void 0!==s&&s,l=t.suppressEvent,c=void 0!==l&&l,u=this.getNode(e);if(u){var d=u.querySelector(".fancytree-node");if(d.classList.contains("mt-disabled-node"))this.callEvent("ondisablednodeselected",{nodeElement:u});else if(ui(".fancytree-node",this._element).forEach((function(e){e.classList.remove("fancytree-active"),e.classList.remove("fancytree-focused")})),d.classList.add("fancytree-active"),d.classList.add("fancytree-focused"),c||this.callEvent("onnodeselected",{nodeElement:u}),r&&this._collapseChildren(u),a&&u.scrollIntoView(),o){var h=u.querySelector(".mt-tree-node-wrapper");if(h){u.removeChild(h);var m={nodeId:u.dataset.nodeId};this.callEvent("onsubnodesrequired",m),this._fetchSubnodes(m),u.dataset.showingPartial=!1}}}return u}},{key:"getSelectedNode",value:function(){var e=this._element.querySelector(".fancytree-active");return e?e.parentElement:null}},{key:"getNextNode",value:function(){var e=this.getSelectedNode();return e?e.nextElementSibling:null}},{key:"getPreviousNode",value:function(){var e=this.getSelectedNode();return e?e.previousSibling:null}},{key:"getParentNode",value:function(){var e=this.getSelectedNode();return e?e.parentElement.parentElement:null}},{key:"getPathToNode",value:function(e){for(var t=this.getNode(e),n=[];t;)n.unshift(t),t=this.getNode(t.dataset.parentNodeId);return n}},{key:"_createUi",value:(r=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._rootNode=Gr({className:"mt-tree-node-wrapper ui-fancytree fancytree-container fancytree-plain fancytree-treefocus fancytree-nodes-visible"}),this.element=Wr({classList:this.options.wrapperClasses},this._rootNode);case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_createNodeDom",value:function(e,t){var n=this,r=t.parentNodeId,i=e.nodes&&e.nodes.length>0,a=["fancytree-node","fancytree-lastsib","fancytree-ico-e"];i||e.expandable?a.push("fancytree-has-children"):a.push("fancytree-exp-n"),!0!==e.expanded||e.partialExpanded||a.push("fancytree-expanded"),e.disabled&&a.push("mt-disabled-node"),e.iconClass&&a.push(e.iconClass);var s=Qr({className:["mt-tree-node"].join(" "),title:e.label,dataset:Object.assign({},{nodeId:e.nodeId,showingPartial:!0===e.partialExpanded,parentNodeId:r},e.data),onclick:function(e){return n._nodeClicked(e)},ondblclick:function(e){!1===e.target.classList.contains("mt-tree-multiselect")&&n._expanderClicked(e)}},Kr({className:a.join(" ")},Kr({className:"fancytree-expander",onclick:function(e){return n._expanderClicked(e)}}),this.options.showMultiSelect&&Jr({className:"mt-tree-multiselect",type:"checkbox",checked:!0,onchange:function(){n.callEvent("onnodecheckchange",e)}}),Kr({className:e.treeIconClass||"fancytree-icon"}),Kr({className:"fancytree-title"},e.label),this.options.showRestriction&&e.data.restriction&&Mr("em",{className:"fancytree-restriction"},"(".concat(e.data.restriction,")"))),i&&this._createTree(e.nodes,{expanded:!0===e.expanded,parentNodeId:e.nodeId}));return this._nodeMapping[rs(e.nodeId)]=s,this.callEvent("onnodecreated",{node:s}),s}},{key:"_createTree",value:function(e,t){var n=this,r=t.expanded,i=t.parentNodeId,a=["mt-tree-node-wrapper"];return r&&a.push("fancytree-nodes-visible"),Gr({className:a.join(" ")},e.map((function(e){return n._createNodeDom(e,{parentNodeId:i})})))}},{key:"_toggleNode",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.expand,i=n.partial,a=void 0!==i&&i;void 0===r&&(r=!e.classList.contains("fancytree-expanded")),e.classList.contains("fancytree-has-children")&&e.classList.remove("fancytree-exp-n"),r?(a||e.classList.add("fancytree-expanded"),t&&t.classList.add("fancytree-nodes-visible")):(e.classList.remove("fancytree-expanded"),t&&t.classList.remove("fancytree-nodes-visible"))}},{key:"_expanderClicked",value:function(e){e.stopPropagation();var t=e.target.parentElement.parentElement,n=t.querySelector(".fancytree-node"),r=t.querySelector(".mt-tree-node-wrapper");if("true"===t.dataset.showingPartial){t.removeChild(r);var i={nodeId:t.dataset.nodeId};this.callEvent("onsubnodesrequired",i),this._fetchSubnodes(i),t.dataset.showingPartial=!1}else if(r)this._toggleNode(n,r);else if(!n.classList.contains("fancytree-expanded")&&!n.classList.contains("fancytree-exp-n")){var a={nodeId:t.dataset.nodeId};this.callEvent("onsubnodesrequired",a),this._fetchSubnodes(a)}}},{key:"_nodeClicked",value:function(e){e.stopPropagation(),this.selectNode(e.currentTarget.dataset.nodeId)}},{key:"_collapseChildren",value:function(e){var t=this,n=e.querySelector(".mt-tree-node-wrapper");n&&ui(".mt-tree-node",n).forEach((function(e){t._toggleNode(e.querySelector(".fancytree-node"),e.querySelector(".mt-tree-node-wrapper"),{expand:!1})}))}},{key:"_fetchSubnodes",value:(n=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"isSelectedNodeRoot",get:function(){var e=this.getSelectedNode();return null!==e&&"_root"===e.dataset.parentNodeId}}]),i}(ji),os={1:"Page.PageRestrictions.label-public",2:"Page.PageRestrictions.label-semipublic",3:"Page.PageRestrictions.label-private",4:"Page.PageRestrictions.label-semiprivate"},ls=function(){function e(){s(this,e)}return l(e,null,[{key:"getRestrictionLocaleKeyById",value:function(e){var t=os[e];return t||null}},{key:"resourceKeys",get:function(){return Object.values(os)}}]),e}(),cs=function(e){var t,n,r,i,o,c,m,p,g,y;function b(e){var t;return s(this,b),(t=f(this,h(b).call(this,e))).initialize({defaults:{initialId:"home",initToParent:!1,includeFiles:!1,onlyShowFiles:!1,enabledFileExtensions:[],excludedFileExtensions:[],articleTypes:[],articleIcons:t.getSetting("isTreeArticleIconsEnabled"),showMoreChildrenEnabled:t.getSetting("isShowMoreChildrenNodesEnabled"),selectParent:!0,localizedHomeLabel:"Home",localizedMediaLabel:null,permissionsToEnable:[],childLimit:50,showMore:!1},events:["onpopulated"]}),t.addEvent("onnodesadded",(function(e){if(t.options.showMoreChildrenEnabled){var n=e.detail.nodes;if(n&&!(n.length<t.options.childLimit)){var r=t.getNode(n[0].nodeId),i=t._createShowMoreButton((function(e,n){var r=t.getNode(n[0].nodeId).parentNode;r.removeChild(r.lastChild),e.stopPropagation(),r&&(r.dataset.childCount=parseInt(r.dataset.childCount,10)+t.options.childLimit,t._fetchSubnodes({nodeId:r.parentNode.dataset.nodeId}))}),n);r&&r.parentNode&&t._showMore&&r.parentNode.appendChild(i)}}})),t.options.onlyShowFiles&&(t.options.includeFiles=!0),t.options.excludedFileExtensions.length>0&&(t.options.includeFiles=!0),t}return d(b,e),l(b,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new b(t),e.next=3,n._createUi();case 3:return e.next=5,n._initialPopulate();case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return v(ls.resourceKeys)}},{key:"settingsKeys",get:function(){return["isTreeArticleIconsEnabled","isShowMoreChildrenNodesEnabled"]}}]),l(b,[{key:"resetToPageId",value:(y=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=o.length>1&&void 0!==o[1]?o[1]:{}).initToParent,i=void 0!==r&&r,a=n.selectParent,s=void 0===a||a,e.next=3,this.populate({initialId:t,initToParent:i,selectParent:s});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"resetToFileId",value:(g=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,o,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(l.length>1&&void 0!==l[1]?l[1]:{}).parentPageId,r=parseInt(t,10),i=new gt(r,this.martianSettings),e.prev=3,e.next=6,i.getInfo();case 6:a=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(3),new Error("Unable to fetch file information for file ID ".concat(t));case 12:if(a.pageParent||n){e.next=14;break}throw new Error("Unable to initialize to the specified file's parent page");case 14:return s=a.pageParent?a.pageParent.id:n,e.next=17,this.populate({initialId:s,initToParent:!1,notify:!1});case 17:o=this.selectNode("file_".concat(t),{scrollIntoView:!0}),this.callEvent("onpopulated",{instance:this,selectedNode:o});case 19:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e){return g.apply(this,arguments)})},{key:"populate",value:(p=a(regeneratorRuntime.mark((function e(){var t,n,r,i,a,s,o,l,c,u,d,h,m,f,p,g,v,y,b,w,_,k,P,S=this,C=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=C.length>0&&void 0!==C[0]?C[0]:{}).initialId,r=void 0===n?this.options.initialId:n,i=t.initToParent,a=void 0===i?this.options.initToParent:i,s=t.selectParent,o=void 0===s?this.options.selectParent:s,l=t.notify,c=void 0===l||l,this.clearTree(),!(a||this.options.articleTypes.length>0)){e.next=9;break}return d=new Ht(r,this.martianSettings),e.next=6,d.getFullInfo();case 6:if(h=e.sent,this.options.articleTypes.length>0)for(;!this.options.articleTypes.includes(h.article)&&h.pageParent;)u=this._getPageIdOrHome(h),h=h.pageParent,r=h.id;a&&h.pageParent&&(u=o?this._getPageIdOrHome(h.pageParent):h.id,r=h.pageParent.id);case 9:return f=!0,e.prev=10,e.next=13,this._getRoot(r);case 13:m=e.sent,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(10),f=!1;case 19:if(f&&!m[0].virtual){e.next=30;break}return r="home",e.prev=21,e.next=24,this._getRoot(r);case 24:m=e.sent,e.next=30;break;case 27:throw e.prev=27,e.t1=e.catch(21),new Error('Unable to initialize to the fallback "home" page ID');case 30:return p=m[0],this._namespace=p.namespace||"main",r=this._getPageIdOrHome(p),u||(u=r),e.next=36,this._getChildren(r,0);case 36:if(g=e.sent,p.hasSubpages=g.length>0,v=this._translateApiData(m),y=v[0],p.hasSubpages?(y.expanded=!0,y.nodes=this._translateApiData(g)):a&&(u=this._getPageIdOrHome(p)),!p.pageParent){e.next=50;break}b=p.pageParent;case 43:if(!b){e.next=50;break}return e.next=46,this._addNodesToParent(v,b);case 46:v=e.sent,b=b.pageParent,e.next=43;break;case 50:this.addNodes(v),(w=this.selectNode("page_".concat(r),{suppressEvent:!0}))&&(w.dataset.childCount=g.length),c&&(_=this.selectNode("page_".concat(u),{suppressEvent:!0}),this.callEvent("onpopulated",{instance:this,selectedNode:_}),this.options.showMoreChildrenEnabled&&(k=function(e){_.parentNode.removeChild(_.parentNode.lastChild),e.stopPropagation(),S._fetchSubnodes({nodeId:"page_"+r})},P=this._createShowMoreButton(k,null),_&&_.parentNode&&this._showMore&&_.parentNode.appendChild(P)));case 54:case"end":return e.stop()}}),e,this,[[10,16],[21,27]])}))),function(){return p.apply(this,arguments)})},{key:"_initialPopulate",value:(m=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.options.initFileId){e.next=5;break}return e.next=3,this.resetToFileId(this.options.initFileId);case 3:e.next=7;break;case 5:return e.next=7,this.populate();case 7:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"_getPageIdOrHome",value:function(e){return""===e.path?"home":e.id}},{key:"_addNodesToParent",value:(c=a(regeneratorRuntime.mark((function e(t,n){var r,i,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.title,""===n.path&&this.options.localizedHomeLabel&&(r=this.options.localizedHomeLabel),"Media:"===n.path&&this.options.localizedMediaLabel&&(r=this.options.localizedMediaLabel),!(this.options.permissionsToEnable.length>0)||n.effectivePermissions){e.next=9;break}return i=new Zt(n.id,this.martianSettings),e.next=7,i.get();case 7:a=e.sent,n.effectivePermissions=a.effectivePermissions;case 9:return s={label:r,nodeId:"page_".concat(this._getPageIdOrHome(n)),expandable:!0,expanded:!0,partialExpanded:!0,disabled:this._isDisabledBasedOnPermissions(n),data:{id:n.id,uri:n.uri,path:n.path,title:n.title,isFile:!1},nodes:t,treeIconClass:this.options.articleIcons?"mt-icon-article-".concat(n.article):null},e.abrupt("return",[s]);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"_isDisabledBasedOnPermissions",value:function(e){var t=this.options.permissionsToEnable;if(0===t.length)return!1;if(e.effectivePermissions&&e.effectivePermissions.operations){var n=e.effectivePermissions.operations;return t.filter((function(e){return n.includes(e)})).length!==t.length}return!1}},{key:"_translateApiEntry",value:function(e){if(e.filename){var t=e.filename.split("."),n=t[t.length-1].toLowerCase(),r=new yr(e.contents.href),i=!1;return this.options.excludedFileExtensions.length>0&&this.options.excludedFileExtensions.includes(n)?null:(this.options.enabledFileExtensions.length>0&&(i=!this.options.enabledFileExtensions.includes(n)),{nodeId:"file_".concat(e.id),label:e.filename,expandable:!1,iconClass:"mt-file-".concat(n),treeIconClass:"fancytree-icon",disabled:i,data:{id:e.id,uri:e.contents.href,path:r.pathname,title:e.filename,isFile:!0}})}var a=e.title;if(""===e.path&&this.options.localizedHomeLabel&&(a=this.options.localizedHomeLabel),"Media:"===e.path&&this.options.localizedMediaLabel&&(a=this.options.localizedMediaLabel),this.options.onlyShowFiles&&!e.hasSubpages&&e.files<1)return null;var s=null;return"home"===this._getPageIdOrHome(e)?s="mt-icon-article-home":this.options.articleIcons&&(s="mt-icon-article-".concat(e.article)),{nodeId:"page_".concat(this._getPageIdOrHome(e)),label:a,expandable:e.hasSubpages||this.options.includeFiles&&e.files>0,iconClass:"mt-article-".concat(e.article),treeIconClass:s,disabled:this._isDisabledBasedOnPermissions(e),data:{id:e.id,guid:e.guid,uri:e.uri,path:e.path,title:e.title,isFile:!1,restriction:e.pageRestriction?this.localize(ls.getRestrictionLocaleKeyById(e.pageRestriction.restriction.id)):null}}}},{key:"_translateApiData",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t._translateApiEntry(e);r&&n.push(r)})),n}},{key:"_processSubpages",value:function(e){var t=this,n=e;return this.options.articleTypes.length>0&&(n=e.filter((function(e){return e.article&&t.options.articleTypes.includes(e.article)}))),n}},{key:"_sortFiles",value:function(e){return e.sort((function(e,t){var n=e.filename.toLowerCase(),r=t.filename.toLowerCase();return n<r?-1:n>r?1:0}))}},{key:"_getRoot",value:(o=a(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ht(t,this.martianSettings),e.prev=1,e.next=4,n.getFullInfo();case 4:r=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),new Error("Unable to get the full info for page root '".concat(t,"'"));case 10:return e.abrupt("return",[r]);case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return o.apply(this,arguments)})},{key:"_getChildren",value:(i=a(regeneratorRuntime.mark((function e(t,n){var r,i,s,o,l,c,d,h,m=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Ht(t,this.martianSettings),i={limit:1e3},this.options.showMoreChildrenEnabled&&(i.limit=this.options.childLimit,i.offset=n),this.options.articleTypes.length>0&&(i.article=this.options.articleTypes.join(",")),!this.options.includeFiles){e.next=20;break}return e.next=7,r.getFilesAndSubpages(i);case 7:if(o=e.sent,l=this._processSubpages(o.subpagesInfo.subpages),c=this._sortFiles(o.filesInfo.files),!this.options.onlyShowFiles){e.next=17;break}return e.next=13,Promise.all(l.map(function(){var e=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=u,e.t1={},e.t2=t,e.next=5,m._doesHierarchyContainAttachments(t);case 5:return e.t3=e.sent,e.t4={hasAttachmentInPath:e.t3},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t4));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}())).then((function(e){return e.filter((function(e){return e.hasAttachmentInPath}))}));case 13:d=e.sent,s=v(d).concat(v(c)),e.next=18;break;case 17:s=v(l).concat(v(c));case 18:e.next=25;break;case 20:return e.next=22,r.getSubpages(i);case 22:h=e.sent,this.options.showMoreChildrenEnabled&&(this._showMore=h.totalCount>h.count+i.offset),s=this._processSubpages(h.subpages);case 25:return e.abrupt("return",s);case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"_fetchSubnodes",value:(r=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.nodeId,r=this.getNode(n),i=parseInt(r.dataset.id,10),a=parseInt(r.dataset.childCount,10)||0,e.next=6,this._getChildren(i,a);case 6:s=e.sent,r.dataset.childCount=a+s.length,this.addNodes(this._translateApiData(s),{parentNodeId:n});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_doesHierarchyContainAttachments",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.files>0)){e.next=2;break}return e.abrupt("return",!0);case 2:if(t.hasSubpages){e.next=4;break}return e.abrupt("return",!1);case 4:return n=new Ht(t.id,this.martianSettings),e.next=7,n.getHierarchyInfo();case 7:return r=e.sent,e.abrupt("return",r.attachmentCount>0);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_createShowMoreButton",value:function(e,t){return Qr({className:"mt-hierachy-tree-show-more-nodes-li"},Vr({className:"mt-hierachy-tree-show-more-nodes mt-reveal-listing-expand-link",title:"Show more",onclick:function(n){e(n,t)}}))}},{key:"namespace",get:function(){return this._namespace}}]),b}(ha(Yi(Ui(ss)))),us=function(e){var t,n,r,i;function o(e){var t;return s(this,o),(t=f(this,h(o).call(this,e))).initialize({events:["onshowhierarchytree","onhidehierarchytree"]}),t._pageId=t.getSetting("pageId"),t.element=t.options.globalNavHeader,t._hierarchyContainer=t.options.hierarchyContainer,t}return d(o,e),l(o,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=new o(t)).element&&n._hierarchyContainer){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n._attachListeners();case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Skin.Common.home"]}},{key:"settingsKeys",get:function(){return["pageId","isShowTerminalNodesEnabled"]}}]),l(o,[{key:"breadcrumbResize",value:function(){this._breadcrumbs.offsetWidth<this._breadcrumbs.scrollWidth?this._closeBreadcrumbsMobileView():(this.element.classList.remove("mt-breadcrumbs-mobile-view-opened"),this.element.classList.remove("mt-breadcrumbs-mobile-view-closed"))}},{key:"_attachListeners",value:(i=a(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._hierarchyToggle=this.element.querySelector(".mt-hierarchy-trigger"),this._hierarchyToggle.addEventListener("click",a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._toggleHierarchyTree();case 2:case"end":return e.stop()}}),e,this)})))),this._breadcrumbs=this.element.querySelector(".mt-breadcrumbs"),this.element.querySelector(".mt-icon-hierarchy-mobile-view-trigger").addEventListener("click",(function(){t._hideHierarchyTree(),t.element.classList.contains("mt-breadcrumbs-mobile-view-opened")?t._closeBreadcrumbsMobileView():(t.element.classList.add("mt-breadcrumbs-mobile-view-opened"),t.element.classList.remove("mt-breadcrumbs-mobile-view-closed"))})),this.breadcrumbResize();case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_closeBreadcrumbsMobileView",value:function(){this.element.classList.remove("mt-breadcrumbs-mobile-view-opened"),this.element.classList.add("mt-breadcrumbs-mobile-view-closed")}},{key:"_getHierarchyTree",value:(r=a(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this._hierarchyTree){e.next=8;break}return e.next=3,Fi(["Skin.Common.home"],this.martianSettings);case 3:return t=[],t=this.getSetting("isShowTerminalNodesEnabled")?[]:["topic-portfolio","topic-category","topic-guide"],e.next=7,cs.create({martianSettings:this.martianSettings,initialId:this._pageId,initToParent:!0,articleTypes:t,suppressInitialSelect:!0,selectParent:!1,localizedHomeLabel:this.localize("Skin.Common.home"),onnodeselected:function(e){window.location.href=e.detail.nodeElement.dataset.uri}});case 7:this._hierarchyTree=e.sent;case 8:return e.abrupt("return",this._hierarchyTree);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_toggleHierarchyTree",value:(n=a(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getHierarchyTree();case 2:t=e.sent,n=!1,0===this._hierarchyContainer.childElementCount&&(this._hierarchyContainer.appendChild(t.element),n=!0),!0===n||gi.isClosed(this._hierarchyContainer)?(this._hierarchyToggle.classList.add("mt-icon-hierarchy-trigger-open"),this._hierarchyToggle.classList.remove("mt-icon-hierarchy-trigger-closed"),this._hierarchyContainer.style.display="block",gi.open(this._hierarchyContainer,150),this.callEvent("onshowhierarchytree")):this._hideHierarchyTree();case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_hideHierarchyTree",value:function(){this._hierarchyToggle.classList.add("mt-icon-hierarchy-trigger-closed"),this._hierarchyToggle.classList.remove("mt-icon-hierarchy-trigger-open"),gi.close(this._hierarchyContainer,150),this.callEvent("onhidehierarchytree")}}]),o}(Ui(ha(Yi(ji)))),ds=[{field:"@label",name:"label"},{field:"value"},{field:"value-label",name:"valueLabel"}],hs=[{field:"confidence",transform:ds},{field:"flag",transform:[{field:"@label",name:"label"},{field:"value",transform:"boolean"},{field:"value-label",name:"valueLabel"}]},{field:"governance",transform:ds},{field:"visibility",transform:ds}],ms=[{field:"transitions",transform:[{field:"state",name:"states",isArray:!0,transform:hs}]},{field:"flag",transform:[{field:"@label",name:"label"},{field:"value",transform:"boolean"},{field:"value-label",name:"valueLabel"}]},{field:"governance",transform:[{field:"@label",name:"label"},{field:"value"},{field:"value-label",name:"valueLabel"}]}],fs=F.createParser(K),ps=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new D;s(this,e),this._plug=new E(n.host,n.plugConfig).at("@api","deki","pages",t,"kcs")}return l(e,[{key:"getState",value:function(){return this._plug.at("state").get().catch((function(e){return Promise.reject(fs(e))})).then((function(e){return e.json()})).then(F.createParser(hs))}},{key:"getValidTransitions",value:function(){return this._plug.at("validtransitions").get().catch((function(e){return Promise.reject(fs(e))})).then((function(e){return e.json()})).then(F.createParser(ms))}},{key:"setState",value:function(e){return e&&0===Object.keys(e).length?Promise.reject("A state must be specified for request."):this._plug.at("state").withParams().post(JSON.stringify(e),ne).catch((function(e){return Promise.reject(fs(e))}))}},{key:"setFlag",value:function(e){return void 0===e.state?Promise.reject("A flagged state must be specified for request."):!0===e.state&&void 0===e.details?Promise.reject("Details must be specified for request when the flagged state is set to true."):this._plug.at("flag").withParams().post(JSON.stringify({flag:e.state,flag_details:e.details}),ne).catch((function(e){return Promise.reject(fs(e))}))}},{key:"initialize",value:function(){return this._plug.at("initialize").post(ne).catch((function(e){return Promise.reject(fs(e))}))}}]),e}(),gs="confidence",vs="visibility",ys="flag",bs="governance",ws="mindtouch-kcs-collapsed",_s="mindtouch-kcs-container-collapsed",ks=["WIP","NOTVALIDATED","VALIDATED","ARCHIVED"],Ps=["INTERNAL","PARTNERS","CUSTOMERS","PUBLIC"],Ss=function(e){var t,n,r,i;function o(e){var t;s(this,o),(t=f(this,h(o).call(this,e))).initialize({defaults:{isIframe:!1},events:["onerror","oninfo","onuiupdated"]}),t._kcs=new ps(t.getSetting("pageId"),t.martianSettings);var n=JSON.parse(window.localStorage.getItem(ws));t._optionsCollapsed=null===n||n;var r=JSON.parse(window.localStorage.getItem(_s));return t._containerCollapsed=null!==r&&r,t._kcsState={},t._transitions=[],t._flagTransition=[],t._governanceTransition=[],t.isIframe=e.isIframe,t}return d(o,e),l(o,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o(t),e.next=3,n.initLocalizations();case 3:return r=!0,e.prev=4,e.next=7,n._fetchState();case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),r=!1;case 12:return e.prev=12,e.next=15,n._createUi(r);case 15:return e.finish(12);case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,this,[[4,9,12,16]])}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Page.KcsWorkflow.dialog.additional-change-required","Page.KcsWorkflow.dialog.cancel","Page.KcsWorkflow.dialog.confirm","Page.KcsWorkflow.dialog.title","Page.KcsWorkflow.dialog.work-in-progress","Page.KcsWorkflow.feedback.cancel","Page.KcsWorkflow.feedback.details-required","Page.KcsWorkflow.feedback.submit","Page.KcsWorkflow.title"]}},{key:"settingsKeys",get:function(){return["pageId"]}}]),l(o,[{key:"_createUi",value:(i=a(regeneratorRuntime.mark((function e(){var t,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!(n.length>0&&void 0!==n[0])||n[0],this.element?this.element.innerHTML="":this.element=Wr({className:"mt-kcs-workflow mt-hide"}),si(this.element),t&&(this.element.classList.remove("mt-hide"),this.element.appendChild(Or(Wr({className:"mt-kcs-title-container "},Wr({className:"mt-kcs-title-wrapper"},this._publicationSettingsToggleElm())),Wr({className:"mt-kcs-selection-container ".concat(this._containerCollapsed?"mt-kcs-selection-container-collapsed":"")},Wr({className:"mt-kcs-classification",id:"mt-kcs-classification-".concat(gs)},Mr("strong",{className:"mt-kcs-classification-name"},this._kcsState[gs].label),this._classificationValueElm(gs),this._canSet(gs)&&this._classificationToggleElm(),this._canSet(gs)&&this._radioElms(gs,vs,this._transitions)),Wr({className:"mt-kcs-classification",id:"mt-kcs-classification-".concat(vs)},Mr("strong",{className:"mt-kcs-classification-name"},this._kcsState[vs].label),this._classificationValueElm(vs),this._canSet(vs)&&this._classificationToggleElm(),this._canSet(vs)&&this._radioElms(vs,gs,this._transitions)),Wr({className:"mt-kcs-classification",id:"mt-kcs-classification-".concat(ys)},Mr("strong",{className:"mt-kcs-classification-name"},this._kcsState[ys].label),Kr({id:"mt-kcs-classification-value-".concat(this._kcsState[ys].label)},this._kcsState[ys].valueLabel),this._canSet(ys)&&this._flaggingElm()),Wr({className:"mt-kcs-classification",id:"mt-kcs-classification-".concat(bs)},Mr("strong",{className:"mt-kcs-classification-name"},this._kcsState[bs].label),this._classificationValueElm(bs),this._canSet(bs)&&this._classificationToggleElm(),this._canSet(bs)&&this._radioElms(bs,null,this._governanceTransitionOptions()))))),this.callEvent("onuiupdated"));case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_fetchState",value:(r=a(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([this._kcs.getState(),this._kcs.getValidTransitions()]);case 3:t=e.sent,n=g(t,2),r=n[0],i=n[1],Object.assign(this._kcsState,r),this._transitions=i.transitions.states,this._flagTransition=i[ys],this._governanceTransition=i[bs],e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(0),e.t0.info&&e.t0.info.message&&("MindTouch.Deki.Exceptions.KCSNotEnabledForPageException"===e.t0.info.exception?this.callEvent("oninfo",{message:e.t0.info.message}):this.callEvent("onerror",{message:e.t0.info.message})),e.t0;case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(){return r.apply(this,arguments)})},{key:"_canSet",value:function(e){var t=this;return e===ys?0!==Object.keys(this._flagTransition).length:e===bs?0!==Object.keys(this._governanceTransition).length:this._transitions.find((function(n){return n[e]&&n[e].value!==t._kcsState[e].value}))}},{key:"_setState",value:function(e){var t=this;ai(this.element,{bindToContainer:!0}),"false"!==e.showWIPConfirmation&&"wip"===this._kcsState[gs].value&&"wip"!==e[gs].value&&(e.confirmationDialogText=this.localize("Page.KcsWorkflow.dialog.work-in-progress",this._kcsState[gs].label,this._kcsState[gs].valueLabel)),e.confirmationDialogText?Zi.create({content:e.confirmationDialogText,title:this.localize("Page.KcsWorkflow.dialog.title"),primaryButtonText:this.localize("Page.KcsWorkflow.dialog.confirm"),secondaryButtonText:this.localize("Page.KcsWorkflow.dialog.cancel"),isIframe:this.options.isIframe,onconfirm:function(){e.showWIPConfirmation=!1,delete e.confirmationDialogText,t._setState(e)},oncancel:function(){t._createUi()}}):this._kcs.setState(e).then(a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._fetchState();case 2:return e.next=4,t._createUi();case 4:case"end":return e.stop()}}),e,this)})))).catch((function(e){e.info&&e.info.message&&(t.callEvent("onerror",{message:e.info.message}),t._createUi())}))}},{key:"_submitFeedback",value:(n=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._flagTransition.value||"string"!=typeof t||""!==t.trim()){e.next=4;break}this.callEvent("onerror",{message:this.localize("Page.KcsWorkflow.feedback.details-required")}),e.next=10;break;case 4:return e.next=6,this._kcs.setFlag({state:this._flagTransition.value,details:t});case 6:return e.next=8,this._fetchState();case 8:return e.next=10,this._createUi();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_classificationToggleElm",value:function(){var e=this;return Hr({className:"mt-kcs-classification-toggle",href:"#",onclick:function(t){t.preventDefault(),e._optionsCollapsed=!e._optionsCollapsed,window.localStorage.setItem(ws,e._optionsCollapsed),e.element.querySelectorAll(".mt-kcs-classification-options").forEach((function(e){e.classList.toggle("mt-hide")})),e.element.querySelectorAll(".mt-kcs-classification-value").forEach((function(e){e.classList.toggle("mt-hide")}))}},"...")}},{key:"_publicationSettingsToggleElm",value:function(){var e=this;return Vr({className:"mt-kcs-title mt-toggle ui-button-icon mt-kcs-selection-container-toggle ".concat(this._containerCollapsed?"mt-toggle-expand":"mt-toggle-collapse"),onclick:function(t){t.preventDefault(),e._containerCollapsed=!e._containerCollapsed,window.localStorage.setItem(_s,e._containerCollapsed);var n=e.element.querySelector(".mt-kcs-selection-container"),r=t.target;e._containerCollapsed?(r.classList.remove("mt-toggle-collapse"),r.classList.add("mt-toggle-expand"),n.classList.toggle("mt-kcs-selection-container-collapsed")):(r.classList.add("mt-toggle-collapse"),r.classList.remove("mt-toggle-expand"),n.classList.toggle("mt-kcs-selection-container-collapsed"))}},this.localize("Page.KcsWorkflow.title"))}},{key:"_flaggingElm",value:function(){var e=this,t=Mr("form",{className:"mt-kcs-flag-comment-form mt-hide",onreset:function(){return e._createUi()},onsubmit:function(n){n.preventDefault(),e._submitFeedback(t.querySelector("textarea").value)}},Yr({className:"mt-kcs-flag-comment-label"},!this._kcsState[ys].value&&Mr("textarea",{className:"mt-kcs-flag-comment-textarea",placeholder:this.localize("Page.KcsWorkflow.feedback.details-required")})),Jr({className:"mt-button ui-button-primary mt-kcs-flag-comment-submit",type:"submit",value:this.localize("Page.KcsWorkflow.feedback.submit")}),Jr({className:"mt-button mt-kcs-flag-comment-reset",type:"reset",value:this.localize("Page.KcsWorkflow.feedback.cancel")}));return[Yr({className:"mt-toggle-switch mt-kcs-flag-switch"},Jr({checked:this._kcsState[ys].value,onkeydown:function(e){13===e.keyCode&&e.currentTarget.click()},onchange:function(){e._flagTransition.value?(e.element.querySelector("#mt-kcs-classification-value-".concat(e._kcsState[ys].label)).innerText=e._flagTransition.valueLabel,t.classList.contains("mt-hide")?t.classList.remove("mt-hide"):t.reset()):e._submitFeedback()},type:"checkbox"}),Kr({className:"mt-toggle-switch-slider"})),t]}},{key:"_radioElms",value:function(e,t,n){var r=this,i=[],a="mt-kcs-classification-options";this._optionsCollapsed&&(a+=" mt-hide");var s=Wr({className:a}),o=function(t){return t[e].value.toUpperCase()},l=function(e,t){var n=o(e),r=o(t);return n<r?-1:n>r?1:0};if(e===gs||e===vs){var u=e===gs?ks:Ps;l=function(e,t){var n=o(e),r=o(t);return u.indexOf(n)<u.indexOf(r)?-1:u.indexOf(n)<u.indexOf(r)?1:0}}return n.sort(l),n.forEach((function(a){if(!i.includes(a[e].value)){var o="",l="mt-kcs-classification-label",u=c({},e,a[e].value);if(r._kcsState[e].value===a[e].value)o="checked",l+=" mt-is-checked";else if(t){void 0===n.find((function(n){return a[e].value===n[e].value&&r._kcsState[t].value===n[t].value}))&&(u[t]=a[t].value,u.confirmationDialogText=r.localize("Page.KcsWorkflow.dialog.additional-change-required",a[e].label,a[e].valueLabel,a[t].label,a[t].valueLabel))}i.push(a[e].value),s.appendChild(Yr({className:l,onchange:function(e){r._setState(e.target.dataset)}},Jr({type:"radio",dataset:u,name:e,checked:o}),a[e].valueLabel))}})),s}},{key:"_governanceTransitionOptions",value:function(){return[c({},bs,this._kcsState[bs]),c({},bs,this._governanceTransition)]}},{key:"_classificationValueElm",value:function(e){if(this._canSet(e)){var t="mt-kcs-classification-value";return this._optionsCollapsed||(t+=" mt-hide"),Mr("span",{className:t},this._kcsState[e].valueLabel)}return this._kcsState[e].valueLabel}}]),o}(Yi(ha(Ui(ji)))),Cs={"MindTouch.Deki.TitleSegmentTooLongException":"Dialog.PageTitleEditor.error.title-segment-too-long","MindTouch.Deki.TitleDisplayNameTooLongException":"Dialog.PageTitleEditor.error.title-display-name-too-long","MindTouch.Deki.Exceptions.TitleRenameNameInvalidArgumentException":"Dialog.PageTitleEditor.error.title-invalid"},Ts=function(e){var t,n,r;function i(e){var t;return s(this,i),(t=f(this,h(i).call(this,e))).initialize({defaults:{version:"modern",learningPathId:null},events:["onbeforesubmit","onsuccess","onclose","onpagenotinlearningpath","oneditoropened","onpathlinked","onpathunlinked","onredirectdetected","onsubmiterror"]}),t._pageId=t.getSetting("pageId"),t}return d(i,e),l(i,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new i(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Dialog.ConfirmRename.error.redirect","Dialog.ConfirmRename.label.cancel","Dialog.ConfirmRename.label.continue","Dialog.ConfirmRename.label.f1-link","Dialog.ConfirmRename.title","Dialog.PageTitleEditor.button.cancel","Dialog.PageTitleEditor.button.edit","Dialog.PageTitleEditor.button.update","Dialog.PageTitleEditor.error.conflict","Dialog.PageTitleEditor.error.generic","Dialog.PageTitleEditor.error.title-invalid","Dialog.PageTitleEditor.error.title-segment-too-long","Dialog.PageTitleEditor.label.special-character","Dialog.PageTitleEditor.success","Dialog.PageTitleEditor.success.moved","Dialog.PageTitleEditor.tooltip","Dialog.PageTitleEditor.tooltip.special-character"]}},{key:"settingsKeys",get:function(){return["isDraftRequest","pageId"]}},{key:"hoverDelay",get:function(){return 200}}]),l(i,[{key:"submitWithRedirectsIgnored",value:function(){this._submitTitleEdit(!0)}},{key:"_createUi",value:(r=a(regeneratorRuntime.mark((function e(){var t,n,r,i,a,s,o,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSetting("isDraftRequest")?new Ue(this._pageId,this.martianSettings):new Ht(this._pageId,this.martianSettings),e.next=3,t.getFullInfo();case 3:if(this._pageInfo=e.sent,this._currentUri=this._pageInfo.uri,this._isPathLinked="custom"!==this._pageInfo.pathType,null===this.options.learningPathId){e.next=13;break}return r=new xt(this.options.learningPathId,this.martianSettings),e.next=10,r.getInfo();case 10:i=e.sent,n=i.pages.find((function(e){return e.id===l._pageId})),n||this.callEvent("onpagenotinlearningpath");case 13:s={className:"state-view"},o={className:"state-hover",ondblclick:function(){return l._openEditor()}},"legacy"===this.options.version&&(s.onmouseover=function(){a=window.setTimeout((function(){return l._hoverOver()}),200)},s.onmouseleave=function(){window.clearTimeout(a)},o.onmouseleave=function(){window.clearTimeout(a),l.element.classList.remove("ui-state-hover")}),this.element=Wr({id:"deki-page-title"},!this._pageInfo.pathSeo&&Hr({className:"mt-f1-success mt-icon-special-character-warning",title:this.localize("Dialog.PageTitleEditor.tooltip.special-character"),rel:"external nofollow",href:"https://expert-help.nice.com/@go/cid/titleseo",target:"_blank"},this.localize("Dialog.PageTitleEditor.label.special-character")),this._viewArea=Wr(s,this._viewStateTitle=Kr({className:"title mt-title-edit"},this._pageInfo.title)),this._hoverArea=Wr(o,this._hoverStateTitle=Kr({className:"title mt-title-edit"},n&&Kr({className:"mt-icon-article-lp"}),this._pageInfo.title),Hr({className:"edit",onclick:function(){return l._openEditor()}},this.localize("Dialog.PageTitleEditor.button.edit"))),this._editControls=Wr({className:"mt-title-editor-component state-edit mt-hide"},this._editControlFields=Wr({className:"fields"}),Wr({className:"submit"},Vr({type:"submit",name:"deki_buttons[page_title_action][update]",value:"update",className:"edit-update",onclick:function(){return l._submitTitleEdit()}},Kr(this.localize("Dialog.PageTitleEditor.button.update"))),Hr({className:"cancel",href:"#",onclick:function(e){e.preventDefault(),l._closeEditor()}},this.localize("Dialog.PageTitleEditor.button.cancel")),this._errorMessage=Kr({className:"title-editor-fail mt-hide"}))));case 17:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_loadEditControlsFields",value:function(){var e,t=this;this._isHomePage||(e=Hr({className:"toggle-link",title:this.localize("Dialog.PageTitleEditor.tooltip"),onclick:function(){return t._togglePathEditor()}},Kr())),li(this._editControlFields),this._editControlFields.appendChild(Or(Wr({className:"title mt-page-title-editor-editable-title"},this._pageTitleText=Jr({type:"text",value:this._pageInfo.title,name:"page_title",className:"edit-title",size:"24",spellcheck:!1,autocomplete:"off",id:"text-page_title",onkeyup:function(e){return t._keyUpHandler(e.key)}}),"legacy"===this.options.version&&e),!this._isHomePage&&!this.getSetting("isDraftRequest")&&Wr({className:"path"},"legacy"!==this.options.version&&e,Kr({title:this._pageInfo.path,className:"mt-page-title-editor-parent-path-display"},this._getDisplayParentUri(this._pageInfo.pageParent)),this._pathSegmentInput=Jr({type:"text",value:this._getPageSegmentFromPath(this._pageInfo.path),name:"page_segment",className:"edit-path",size:"24",spellcheck:!1,autocomplete:"off",id:"text-page_segment",disabled:"custom"!==this._pageInfo.pathType,onkeyup:function(e){return t._keyUpHandler(e.key)}}))))}},{key:"_openEditor",value:function(){this._loadEditControlsFields(),this._showOverlay(),this.element.classList.add("ui-state-edit"),this._hoverArea.classList.add("mt-hide"),this._editControls.classList.remove("mt-hide"),this._pageTitleText.focus(),this._pageTitleText.setSelectionRange(0,this._pageTitleText.value.length),this._isPathLinked||this._editControls.classList.add("ui-state-unlinked"),this.callEvent("oneditoropened")}},{key:"_closeEditor",value:function(){this._editControls.classList.add("mt-hide"),this._hoverArea.classList.remove("mt-hide"),this.element.classList.remove("ui-state-edit"),this._hideOverlay(),this.callEvent("onclose")}},{key:"_togglePathEditor",value:function(){this._isPathLinked?(this._isPathLinked=!1,this._pathSegmentInput.disabled=!1,this._editControls.classList.add("ui-state-unlinked"),this.callEvent("onpathunlinked")):(this._isPathLinked=!0,this._pathSegmentInput.disabled=!0,this._editControls.classList.remove("ui-state-unlinked"),this.callEvent("onpathlinked"))}},{key:"_keyUpHandler",value:function(e){"Escape"===e?this._closeEditor():"Enter"===e&&this._submitTitleEdit()}},{key:"_getPageSegmentFromPath",value:function(e){var t=e.replace(/\/\//g,"%2F%2F").split("/");return t[t.length-1].replace(/%2F%2F/g,"//")}},{key:"_getDisplayParentUri",value:function(e){for(var t=[];e;)t.unshift(e),e=e.pageParent;if(t.length>2)return"".concat(t[1].uri,"/.../");var n=t[t.length-1].uri;return n.endsWith("/")||(n="".concat(n,"/")),n}},{key:"_submitTitleEdit",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,o,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.callEvent("onbeforesubmit"),n=this.localize("Dialog.PageTitleEditor.success"),r=this._pageTitleText.value,!this.getSetting("isDraftRequest")){e.next=11;break}return i=new Ue(this._pageId,this.martianSettings),e.next=7,i.setTitle(r);case 7:return this._updateTitleFields(r),this.callEvent("onsuccess",{newTitle:r,successMessage:n}),this._closeEditor(),e.abrupt("return");case 11:return a={title:r},!this._isPathLinked&&this._pathSegmentInput&&(s=this._pathSegmentInput.value,a.name=s.replace(/\/\//g,"/")),t&&(a.allow="deleteredirects"),o=new Ht(this._pageId,this.martianSettings),e.prev=15,e.next=18,o.move(a);case 18:l=e.sent,e.next=25;break;case 21:return e.prev=21,e.t0=e.catch(15),this._handleMoveError(e.t0),e.abrupt("return");case 25:if(!(l.count>0)){e.next=35;break}if(this._pageInfo=l.pages[0],(c=this._pageInfo.uri)!==this._currentUri&&(n=this.localize("Dialog.PageTitleEditor.success.moved",c)),this._pathSegmentInput.value=this._getPageSegmentFromPath(this._pageInfo.path),null!==document.getElementById("editform")){e.next=34;break}return this._updateTitleFields(r),this.callEvent("onsuccess",{newUri:c,newTitle:r,successMessage:n}),e.abrupt("return");case 34:window.history.replaceState({},r,c);case 35:this._updateTitleFields(r),this._closeEditor(),this.callEvent("onsuccess",{newTitle:r,newUri:c,successMessage:n});case 38:case"end":return e.stop()}}),e,this,[[15,21]])}))),function(e){return n.apply(this,arguments)})},{key:"_updateTitleFields",value:function(e){this._pageInfo.title=e,this._pageTitleText.value=e,this._viewStateTitle.textContent=e,this._hoverStateTitle.textContent=e}},{key:"_handleMoveError",value:function(e){var t=e.status,n=e.info;this._errorMessage.classList.remove("mt-hide");var r=Cs[n.exception];if(409===t){if("MindTouch.Deki.Exceptions.RedirectExistsAtLocationException"===n.exception)return void this.callEvent("onredirectdetected");this._errorMessage.textContent=this.localize("Dialog.PageTitleEditor.error.conflict")}else this._errorMessage.textContent=r?this.localize(r,n.data?n.data.maxlength:null):this.localize("Dialog.PageTitleEditor.error.generic");this.callEvent("onsubmiterror",{info:n})}},{key:"_hoverOver",value:function(){if("true"!==this._hoverStateTitle.dataset["deki.positioned"]){this._hoverStateTitle.dataset["deki.positioned"]=!0,this._hoverArea.style.visibility="hidden",this._hoverArea.style.display="block";var e=this._viewArea.getBoundingClientRect(),t=this._hoverStateTitle.getBoundingClientRect(),n=parseInt(e.left-t.left,10),r=parseInt(e.top-t.top,10);this._hoverArea.style.left=n,this._hoverArea.style.top=r,this._hoverArea.style.visibility="visible",this._hoverArea.style.display=""}this.element.classList.add("ui-state-hover")}},{key:"_showOverlay",value:function(){"legacy"===this.options.version&&(this._overlay||(this._overlay=Wr({className:"mt-title-editor-overlay mt-hide"}),document.body.appendChild(this._overlay)),this._overlay.classList.remove("mt-hide"))}},{key:"_hideOverlay",value:function(){"legacy"===this.options.version&&this._overlay&&this._overlay.classList.add("mt-hide")}},{key:"_isHomePage",get:function(){return""===this._pageInfo.path}}]),i}(ha(Yi(Ui(ji)))),Es=function(e){var t,n;function r(e){var t;return s(this,r),(t=f(this,h(r).call(this,e))).initialize({defaults:{languageCode:null}}),t.element=t.options.relatedListingsContainer,t._detailed=t.getSetting("relatedArticlesDetailed"),t._languageCode=t.options.languageCode,t._relatedPages=[],t}return d(r,e),l(r,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new r(t),e.next=3,n._fetchDependencies();case 3:return n._createUi(),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"settingsKeys",get:function(){return["relatedArticlesDetailed"]}},{key:"resourceKeys",get:function(){return["Skin.Columbia.label.no-recommended-articles"]}}]),l(r,[{key:"_fetchDependencies",value:(n=a(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},"true"===this.element.dataset.trackPreviousPages&&(_r.recordPageView(this.options.pageId),t.previouspages=_r.getRecentlyViewedPageIds().join(",")),this._detailed&&(t.include="overview"),this._languageCode&&(t.translate=this._languageCode),n=new Ht(this.options.pageid,this.martianSettings),e.prev=6,e.next=9,n.getRelated(t);case 9:r=e.sent,this._relatedPages=r.pages,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),this._relatedPages=[];case 16:case"end":return e.stop()}}),e,this,[[6,13]])}))),function(){return n.apply(this,arguments)})},{key:"_createUi",value:function(){var e=this;if(this._relatedPages.length>0){var t=this._relatedPages.map((function(t,n){var r={uri:t.uri,article:t.article,title:t.title,id:n+1,overview:!1};return e._detailed&&t.overview&&(r.overview=t.overview.length>150?t.overview.substr(0,150)+"...":t.overview),e._relatedPageItem(r)}));this.element.appendChild(Or(t))}else this.element.appendChild(Qr({className:"mt-related-empty-listing"},Kr(this.localize("Skin.Columbia.label.no-recommended-articles"))))}},{key:"_relatedPageItem",value:function(e){return Qr({className:"mt-related-listing mt-related-listing-detailed"},Hr({className:"mt-related-listing-link",href:e.uri,title:e.title,dataset:{gaLabel:"related-link-detailed-".concat(e.id)}},Kr({className:"mt-related-listing-link-icon mt-icon-article-".concat(e.article)}),Kr({className:"mt-related-listing-link-text"},e.title)),e.overview&&Kr({className:"mt-related-listing-link-overview"},e.overview))}}]),r}(ha(Yi(Ui(ji)))),xs=function(e){var t;function n(e){var t;return s(this,n),(t=f(this,h(n).call(this,e))).initialize({defaults:{allowLinks:!0,allowRatings:!0,resultsListId:"search-results",selectedClass:"mt-selected",selectOnClick:!1,showPageContextForFiles:!0,showSummaries:!0},events:["onshowmore","onresultclicked","onresultlinkclicked","onratingclicked"]}),t._resultTally=0,t}return d(n,e),l(n,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new n(t))._createUi(),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["MindTouch.Help.Page.in","MindTouch.Help.Page.label.page-rating-no","MindTouch.Help.Page.label.page-rating-yes","MindTouch.Help.Page.more","MindTouch.Help.Page.no-search-results","MindTouch.Help.Page.no-search-try","MindTouch.Help.Page.recommended","MindTouch.Help.Page.show-more-search"]}},{key:"settingsKeys",get:function(){return["isF1Request","userIsSeated"]}}]),l(n,[{key:"setResults",value:function(e){var t=e.results,n=e.count,r=e.queryCount,i=e.limit;this._resultTally+=n,this.toggleShowMore(this._resultTally<r&&n>=i),this._resultsList.appendChild(this._resultsDom(t))}},{key:"resetResults",value:function(){this._resultTally=0,this.toggleShowMore(!1),li(this._resultsList)}},{key:"clearSelections",value:function(){var e=this;this.selectedResults.forEach((function(t){return t.classList.remove(e.options.selectedClass)}))}},{key:"displayEmptyState",value:function(){this.displayMessage({title:this.localize("MindTouch.Help.Page.no-search-results"),message:this.localize("MindTouch.Help.Page.no-search-try")})}},{key:"displayMessage",value:function(e){var t=e.title,n=e.message;this.resetResults(),this._resultsList.appendChild(this._informationDom({title:t,message:n}))}},{key:"toggleShowMore",value:function(e){hi(this._showMore,"mt-hide",!e)}},{key:"_createUi",value:function(){var e=this;this._resultsList=Gr({id:this.options.resultsListId,className:"mt-tree-search-results",dataset:{gaAction:"Search results"},tabindex:"1"}),this._showMore=Wr({className:"mt-help-actions-container center mt-hide"},Vr({value:"search",className:"help-show-more ui-button",type:"button",ariaLabel:this.localize("MindTouch.Help.Page.show-more-search"),onclick:function(){return e._showMoreClicked()}},this.localize("MindTouch.Help.Page.show-more-search"))),this.element=Wr({className:"mt-tree-search-results-container"},this._resultsList,this._showMore)}},{key:"_searchResultClicked",value:function(e){this.options.selectOnClick&&(this.clearSelections(),e.currentTarget.classList.add(this.options.selectedClass)),this.callEvent("onresultclicked",{target:e.currentTarget})}},{key:"_showMoreClicked",value:function(){this.callEvent("onshowmore")}},{key:"_resultLinkClicked",value:function(e){this.callEvent("onresultlinkclicked",{clickEvent:e})}},{key:"_ratingButtonClicked",value:function(e,t){this.callEvent("onratingclicked",{rating:e,element:t})}},{key:"_getPageTitleLink",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.uriTrack,i={className:"go result-spacer mt-tracked-result",title:e.title,dataset:{gaLabel:"Result ".concat(new URLSearchParams(r).get("position")),trackUri:r,tracking:!1}};return this.options.allowLinks?(i.href=e.page?e.page.uri:e.uri,i.onclick=function(e){return n._resultLinkClicked(e)}):i.onclick=function(e){e.preventDefault()},Hr(i,e.title)}},{key:"_getFileTitleLink",value:function(e,t){var n=this,r={className:"go result-spacer mt-tracked-result",title:e.title,dataset:{trackUri:e.uriTrack,tracking:"false"}},i=e.mime.split("/")[1].replace("+","-");return this.options.allowLinks?(r.href=e.uri,r.onclick=function(e){return n._resultLinkClicked(e)}):r.onclick=function(e){e.preventDefault()},Or(Hr(r,Kr({className:"mt-search-file mt-icon-".concat(i)},""),e.title),this.options.showPageContextForFiles&&Or(Kr(" ".concat(this.localize("MindTouch.Help.Page.in")," ")),this._getPageTitleLink(e.page,t,e.uriTrack)))}},{key:"_canRateResult",value:function(e){if(this.getSetting("userIsSeated")&&!this.getSetting("isF1Request"))return void 0!==("tags"in e?e.tags:[]).find((function(e){return e.startsWith("article:")&&!["article:topic-guide","article:topic-portfolio","article:topic-category"].includes(e)}))}},{key:"_resultsDom",value:function(e){var t=this,n="mt-search-information";return this.getSetting("userIsSeated")&&(n="".concat(n," mt-seated")),Or(e.map((function(e,r){return Qr({className:"result type-".concat(e.type),dataset:{key:e.id,type:e.type,path:e.page.path},onclick:function(e){return t._searchResultClicked(e)}},Wr({className:n},Wr({className:"title",tabIndex:2},"file"===e.type&&t._getFileTitleLink(e,r),("page"===e.type||"recommended"===e.type||"draft"===e.type)&&t._getPageTitleLink(e,r),"recommended"===e.type&&Kr({className:"recommended-tag"}," ".concat(t.localize("MindTouch.Help.Page.recommended")))),Wr({className:"meta"},Wr({className:"url",title:"file"===e.type?e.page.uri:e.uri},"file"===e.type?e.page.uri:e.uri),t.options.showSummaries&&e.content&&Wr({className:"preview"},Kr({className:"mt-search-partial-content"},gr(e.content,200)),e.content.length>200&&Kr({className:"mt-search-full-content mt-hide"},e.content),e.content.length>200&&Wr(Vr({className:"mt-help-more-content",dataset:{gaLabel:"Help more content"},onclick:function(e){return t._showFullPreview(e)}},t.localize("MindTouch.Help.Page.more")))))),t.options.allowRatings&&t._canRateResult(e)&&Wr({className:"mt-help-button-container",dataset:{pageId:e.id}},Vr({className:"mt-help-upvote ui-button-icon mt-icon-rating-yes",onclick:function(e){return t._ratingButtonClicked("up",e.target)}},t.localize("MindTouch.Help.Page.label.page-rating-yes")),Vr({className:"mt-help-downvote ui-button-icon mt-icon-rating-no",type:"button",onclick:function(e){return t._ratingButtonClicked("down",e.target)}},t.localize("MindTouch.Help.Page.label.page-rating-no"))))})))}},{key:"_informationDom",value:function(e){var t=e.title,n=e.message;return Qr({className:"type-empty"},Mr("h4",t),$r(n))}},{key:"_showFullPreview",value:function(e){var t=e.target,n=t.closest(".preview");n.querySelector(".mt-search-partial-content").classList.add("mt-hide"),n.querySelector(".mt-search-full-content").classList.remove("mt-hide"),t.parentNode.classList.add("mt-hide")}},{key:"resultCount",get:function(){return this._resultTally}},{key:"selectedResults",get:function(){return ui(".".concat(this.options.selectedClass),this._resultsList)}}]),n}(Ui(Yi(ji))),Rs="mt-generative-search-hide",js=function(e){var t,n;function r(e){var t;s(this,r),(t=f(this,h(r).call(this,e))).initialize({defaults:{name:t.localize("Component.GenerativeSearch.title"),isClosed:!0},events:["ontoggle"]});var n=wr.fetch(Rs,"session");return t.getSetting("userIsAnonymous")?t._isClosed=t.options.isClosed:null!==n&&"boolean"==typeof n?t._isClosed=n:"boolean"==typeof t.options.isClosed?t._isClosed=t.options.isClosed:t._isClosed=!0,t}return d(r,e),l(r,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new r(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"settingsKeys",get:function(){return["userIsAnonymous"]}},{key:"resourceKeys",get:function(){return["Component.GenerativeSearch.button.toggle.show","Component.GenerativeSearch.button.toggle.hide","Component.GenerativeSearch.title"]}}]),l(r,[{key:"_createUi",value:(n=a(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.element=Wr({className:"mt-generative-search-toggle-container"},Mr("h2",{className:"mt-generative-search-toggle-label",onclick:function(){t._toggleButton.click()}},this.name),this._expertToggleLabel=Yr({htmlFor:"mt-generative-search-toggle",className:"mt-toggle-switch mt-generative-search-toggle-switch"},this._toggleButton=Jr({id:"mt-generative-search-toggle",checked:!this._isClosed,type:"checkbox",onkeydown:function(e){13===e.keyCode&&e.currentTarget.click()},onchange:function(){t.callEvent("ontoggle"),t._toggle()}}),Kr({className:"mt-toggle-switch-slider"}))),this._setAriaLabel();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_toggle",value:function(){this._isClosed=!this._isClosed,wr.store(Rs,this._isClosed,"session"),this._setAriaLabel()}},{key:"_setAriaLabel",value:function(){var e=this._isClosed?"show":"hide",t="".concat(this.localize("Component.GenerativeSearch.button.toggle.".concat(e))," ").concat(this.name);this._toggleButton.ariaLabel=t,this._expertToggleLabel.ariaLabel=t}},{key:"name",get:function(){return this.options.name}},{key:"isClosed",get:function(){return this._isClosed}}]),r}(ha(Yi(Ui(ji)))),As=function(e){var t,n,r,i;function o(e){var t;return s(this,o),(t=f(this,h(o).call(this,e))).initialize({defaults:{formId:"mt-search-component-form",elementId:"mt-search-component",elementClassName:"mt-search-component",limit:10,searchCurrentNsOnly:!1,searchMainOnly:!1,searchFilesOnly:!1,namespaces:[],showClearResultsButton:!1,searchPagesOnly:!1,searchImagesOnly:!1,includeGenerativeSearch:!1,includeMetadata:!1,includeRecommendations:!1,allowLinks:!1,allowRatings:!1,selectOnClick:!0,showPageContextForFiles:!1,showSummaries:!1,apiVersion:1,isDraft:!1,searchAsYouType:!0},events:["onbreadcrumbselected","onresultlinkclicked","onresultselected","onsearchcompleted","onsearcherror","onsearchinitiated","onsearchinputupdated","onsearchsubmitted","onupdatefilters","ongeneratedfrom","oncleargenerativesearchhighlight"]}),t._page=1,t._recommendedIds=[],t._initNamespace(),t._generativeSearchPaths=[],t}return d(o,e),l(o,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Dialog.JS.submit","Dialog.CopyMove.placeholder.search","MindTouch.Help.Page.search-error","MindTouch.Help.Page.search-error-try","MindTouch.Help.Page.search-unavailable","MindTouch.Help.Page.search-clear","Page.Search.genius-link-title"].concat(v(xs.resourceKeys),v(Ja.resourceKeys))}},{key:"settingsKeys",get:function(){return["pageNamespace","userIsSeated","isGenerativeSearchSearchIconEnabled"].concat(v(xs.settingsKeys))}}]),l(o,[{key:"updateFilters",value:function(e){var t=this;this._filters.forEach((function(n){void 0!==e[n]&&(t.options[n]=e[n])})),this.searchQuery=e.query||this.searchQuery,this.callEvent("onupdatefilters",e)}},{key:"_createUi",value:(i=a(regeneratorRuntime.mark((function e(){var t,n,r,i,s,o,l,u,d=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.options.includeMetadata){e.next=5;break}return e.next=3,Ja.create({path:this.options.path,onpathselected:function(e){var t;d.callEvent("onbreadcrumbselected",(c(t={},e.detail.name,e.detail.value),c(t,"index",e.detail.index),t)),d.updateFilters(c({},e.detail.name,e.detail.value))}});case 3:this._breadcrumbs=e.sent,this.addEvent("onsearchcompleted",function(){var e=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d._breadcrumbs.update(t.detail.path,t.detail.searchResponse.queryCount);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}());case 5:if(!this.options.includeGenerativeSearch){e.next=24;break}return this._generativeSearchInitialSearch=!0,t={},e.next=10,Xa(this.martianSettings);case 10:return n=e.sent,r=n.name,i=n.toggleState,s=n.streamResponse,null!==r&&(t.name=r.contents.value),null!==i&&(t.isClosed="closed"===i.contents.value),o=!0,null!==s&&(o="true"===s.contents.value),e.next=20,js.create(t);case 20:return this._generativeSearchToggle=e.sent,e.next=23,ts.create({name:this._generativeSearchToggle.name,isClosed:this._generativeSearchToggle.isClosed,shouldStreamResponse:o,ongeneratedfrom:function(e){d._generativeSearchPaths=e.detail.paths,d.callEvent("oncleargenerativesearchhighlight"),d.callEvent("ongeneratedfrom",{paths:e.detail.paths})},onpathselected:function(e){d.updateFilters({path:e.detail.path})}});case 23:this._generativeSearch=e.sent;case 24:l=this.getSetting("userIsSeated"),this.element=Wr({className:this.options.elementClassName,id:this.options.elementId},this.options.includeGenerativeSearch?Wr({className:"mt-search-generative-container"},this._getSearchForm(),this._generativeSearchToggle&&this._generativeSearchToggle.element,l&&Wr({className:"mt-f1-search-container",id:"mt-f1-gen-search"},Hr({className:"mt-f1-success mt-f1-link mt-icon-f1-link mt-f1-search",title:this.localize("Page.Search.genius-link-title"),href:"https://expert-help.nice.com/@go/cid/mindtouch-search"},Kr({className:"ui-icon"})))):this._getSearchForm(),this._generativeSearch&&this._generativeSearch.element,this._breadcrumbs&&this._breadcrumbs.element,this._searchResults=Br(xs,{showSummaries:this.options.showSummaries,allowLinks:this.options.allowLinks,showPageContextForFiles:this.options.showPageContextForFiles,selectOnClick:this.options.selectOnClick,allowRatings:this.options.allowRatings,onshowmore:function(){return d._searchShowMoreClicked()},onresultclicked:function(e){return d._searchResultClicked(e.detail.target)},onresultlinkclicked:function(e){d._searchResultLinkClicked(e.detail.clickEvent)}})),this.options.searchAsYouType?ir.init(this._searchQueryInput,(function(){d.callEvent("onsearchinputupdated"),d._initiateSearch()}),{timeout:600,minimum:this._minimumSearchCharacters}):this._searchForm.addEventListener("submit",a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d._initiateSearch();case 2:case"end":return e.stop()}}),e,this)})))),this.options.includeGenerativeSearch&&((u=document.querySelector("#mt-f1-search-container"))&&u.classList.add("mt-hide"),this._searchForm.addEventListener("submit",a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d._generativeSearchPaths=[],e.next=3,d._generativeSearch.search(d._searchQueryInput.value);case 3:case"end":return e.stop()}}),e,this)})))),this.addEvent("onupdatefilters",a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d._generativeSearch.setFilters(d.options),e.next=3,d._generativeSearch.search(d._searchQueryInput.value);case 3:case"end":return e.stop()}}),e,this)})))),this._generativeSearch.addEvent("onrequestquery",(function(){d._generativeSearch.query=d._searchQueryInput.value})),this._generativeSearchToggle.addEvent("ontoggle",a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d._generativeSearch.query=d._searchQueryInput.value,d._generativeSearch.toggleVisibility(),d._initiateSearch(),!1===d._generativeSearchToggle.isClosed&&(d._generativeSearchPaths=[],d.callEvent("oncleargenerativesearchhighlight"));case 4:case"end":return e.stop()}}),e,this)})))));case 28:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_getSearchForm",value:function(){var e=this,t=this.options.includeGenerativeSearch?"mt-search-form-with-generative-search":"";return this._searchForm=Mr("form",{id:this.options.formId,onsubmit:function(t){return e._searchFormSubmitted(t)},className:this.getSetting("userIsSeated")?"mt-search-form-seated":"mt-search-form-unseated ".concat(t)},this._searchQueryInput=Jr({className:"mt-text mt-help-search-input",name:"mtsearch",placeholder:this.localize("Dialog.CopyMove.placeholder.search"),ariaLabel:this.localize("Dialog.CopyMove.placeholder.search")}),this._searchIcon=Vr({className:"".concat(this.getSetting("isGenerativeSearchSearchIconEnabled")?"mt-icon-gen-search3":"mt-icon-search"," ui-icon-button"),type:"submit",ariaLabel:this.localize("Dialog.JS.submit")}))}},{key:"_searchShowMoreClicked",value:function(){this._page++,this._doSearch(this._searchQueryInput.value)}},{key:"_searchResultClicked",value:function(e){this.callEvent("onresultselected",{result:e})}},{key:"_searchResultLinkClicked",value:function(e){this.callEvent("onresultlinkclicked",{clickEvent:e})}},{key:"_searchFormSubmitted",value:function(e){e.preventDefault();var t=this.searchQuery.trim();t.length>0&&t.length<this._minimumSearchCharacters&&(this._page=1,this.callEvent("onsearchsubmitted",{query:t}),this._doSearch(t))}},{key:"_initNamespace",value:function(){var e=this.getSetting("pageNamespace")||"main";e=e.charAt(0).toUpperCase()+e.slice(1),this.options.searchCurrentNsOnly?this._namespace=e:this.options.searchMainOnly?this._namespace="main":this.options.namespaces.length>0&&(this._namespace=this.options.namespaces)}},{key:"_initiateSearch",value:(r=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._page=1,this._recommendedIds=[],e.next=4,this._doSearch(this._searchQueryInput.value);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_doSearch",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,o,l,c,u,d,h,m=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t.trim()||this._hasFilters){e.next=3;break}return this.callEvent("onsearcherror",{message:"The search was aborted because the query was empty"}),e.abrupt("return");case 3:return n=this.options.includeRecommendations&&1===this._page,r={aggpath:this.options.aggpath,apiVersion:this.options.apiVersion,classifications:this.options.classifications,includeAggregations:this.options.includeAggregations,limit:this.options.limit,namespace:this._namespace,offset:(this._page-1)*this.options.limit-this._recommendedIds.length,path:this.options.path,q:t,recommendations:n,recommendedIds:this._recommendedIds,tags:this.options.tags,type:this.options.type},this.options.searchPagesOnly?(r.type="wiki",this.options.isDraft&&(r.type="wiki-draft")):this.options.searchImagesOnly&&(r.type="image"),this.options.searchFilesOnly&&(r.type=["document","image","binary"]),(i=wr.fetch("searchSessionId","session"))&&(r.sessionid=i),ai(this.element),e.next=12,this._searchResults;case 12:return a=e.sent,s=Vr({ariaLabel:this.localize("MindTouch.Help.Page.search-clear"),className:"mt-icon-cross ui-icon-button",type:"button",onclick:function(){a.resetResults(),s.replaceWith(m._searchIcon),m._searchQueryInput.value=null,m._searchQueryInput.focus()}}),this.options.includeGenerativeSearch&&!this._generativeSearchToggle.isClosed&&(r.dekiEventType="GENERATIVE_SEARCH"),o=new Sn(this.martianSettings),e.prev=16,this.callEvent("onsearchinitiated",r),e.next=20,o.search(r);case 20:l=e.sent,1===this._page&&a.resetResults(),l.results&&l.results.length>0?(l.recommendations&&(this._recommendedIds=l.recommendations.map((function(e){return e.id}))),this.options.resultFilter?(c=l.results.filter(this.options.resultFilter),0===(u=c.length)?a.displayEmptyState():(d=l.results.length-u,a.setResults({results:c,count:u,queryCount:l.queryCount-d,limit:this.options.limit}))):(a.setResults({results:l.results,count:l.count,queryCount:l.queryCount,limit:this.options.limit}),this.options.showClearResultsButton&&this._searchIcon.replaceWith(s))):(a.displayEmptyState(),this.options.showClearResultsButton&&this._searchIcon.replaceWith(s),this.options.includeGenerativeSearch&&this._generativeSearch.updateEmptysMessage()),si(this.element),this.callEvent("onsearchcompleted",{limit:r.limit,offset:r.offset,page:this._page,path:this.options.path,query:t,searchResponse:l}),this.options.includeGenerativeSearch&&!1===this._generativeSearchToggle.isClosed&&this.callEvent("ongeneratedfrom",{paths:this._generativeSearchPaths}),e.next=36;break;case 28:e.prev=28,e.t0=e.catch(16),si(this.element),a.resetResults(),h="MindTouch.Help.Page.search-error",503===e.t0.status&&(h="MindTouch.Help.Page.search-unavailable"),a.displayMessage({title:this.localize(h),message:this.localize("MindTouch.Help.Page.search-error-try")}),this.callEvent("onsearcherror",e.t0);case 36:case"end":return e.stop()}}),e,this,[[16,28]])}))),function(e){return n.apply(this,arguments)})},{key:"searchQuery",get:function(){return this._searchQueryInput.value},set:function(e){this._page=1,this._searchQueryInput.value=e,this._recommendedIds=[],this._generativeSearch&&(this._generativeSearch.query=e,this._generativeSearchInitialSearch&&(this._generativeSearchInitialSearch=!1,this._generativeSearch.setFilters(this.options),this._generativeSearch.search(e))),this._doSearch(e)}},{key:"namespace",set:function(e){if("string"==typeof e&&(e=[e]),null===e||!Array.isArray(e)||0===e.length||!e.every((function(e){return"string"==typeof e})))throw new TypeError("invalid, must be a string or array of strings");this._namespace=e}},{key:"_minimumSearchCharacters",get:function(){return 3}},{key:"_filters",get:function(){return["classifications","path","tags","type"]}},{key:"_hasFilters",get:function(){var e=this;return this._filters.some((function(t){return e.options[t]&&e.options[t].length>0}))}}]),o}(Ui(ha(Yi(ji)))),Is="mt-search-filters-option",Ns="mt-search-filters-sub-options-show",Ls="mt-search-filters-sub-options",Ds="mt-search-filters-toggle-all-hide",Fs=function(e){var t;function n(e){var t;return s(this,n),(t=f(this,h(n).call(this,e))).initialize({defaults:{classifications:[]},events:["onfilteradded","onresetfilters"]}),t.resetFilters(!1),t._currentLocations=[],t.addEvent("onfilteradded",(function(){t._updateFiltersHeader()})),t}return d(n,e),l(n,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new n(t)).element=r._createUi(),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["MindTouch.SearchFilters.button.toggle.hide","MindTouch.SearchFilters.button.toggle.show","MindTouch.SearchFilters.label.attachments-description","MindTouch.SearchFilters.label.attachments.type.binary","MindTouch.SearchFilters.label.attachments.type.document","MindTouch.SearchFilters.label.attachments.type.image","MindTouch.SearchFilters.label.attachments","MindTouch.SearchFilters.label.classification","MindTouch.SearchFilters.label.clear-all","MindTouch.SearchFilters.label.description","MindTouch.SearchFilters.label.filters","MindTouch.SearchFilters.label.location","MindTouch.SearchFilters.label.location-empty","MindTouch.SearchFilters.label.view.attachments.toggle"]}}]),l(n,[{key:"highlightLocations",value:function(e){var t=e.paths,n=e.className,r=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var l=s.value,c=void 0;try{c=this._locationList.querySelector('a[data-path="'.concat(encodeURIComponent(l),'"]'))}catch(e){}c&&c.classList.add(n)}}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}}},{key:"clearHighlightedLocations",value:function(e){this._locationList&&this._locationList.querySelectorAll("a.".concat(e)).forEach((function(t){return t.classList.remove(e)}))}},{key:"resetFilters",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._currentFilters={paths:[]},this.element&&(li(this.element),this.element.appendChild(this._createUi())),this._filtersHeader&&(li(this._filtersHeader),this._filtersHeader.innerText=this.localize("MindTouch.SearchFilters.label.description")),e&&this.callEvent("onresetfilters",this._currentFilters)}},{key:"updateSelection",value:function(e){var t=this,n=e.path,r=void 0===n?"":n,i=e.classifications,a=void 0===i?[]:i,s=e.type,o=void 0===s?[]:s,l=this.element.querySelector(".mt-search-filters-attachments-toggle");if(o.length>1&&(this._showChildList(l),l.checked="checked",o.forEach((function(e){var n=t.element.querySelector('.mt-search-filters-document-type[value="'.concat(e,'"]'));n&&(n.checked=!0)}))),1===o.length&&"wiki"===o[0]&&(this._hideChildList(l),l.checked=!1),r.length>0){var c=this.element.querySelector(".mt-search-filters-option-location .mt-search-filters-option-toggle");this._showChildList(c)}if(a.length>0){Array.from(this._classificationList.querySelectorAll("input")).forEach((function(e){e.checked=!1}));var u=this.element.querySelector(".mt-search-filters-option-classifications .mt-search-filters-option-toggle");this._showChildList(u),a.forEach((function(e){var n=t.element.querySelector("input[value='".concat(e,"']"));n.checked=!0;var r=n.closest(".mt-search-filters-classification-item").querySelector(".mt-search-filters-classification-toggle");t._showChildList(r)}))}(a.length>0||o.length>1||r.length>0)&&this._updateFiltersHeader()}},{key:"_createUi",value:function(){var e=this;return Gr({className:"mt-search-filters-options"},Qr({className:"mt-search-filters-header"},this._filtersHeader=Kr(this.localize("MindTouch.SearchFilters.label.description")),Vr({className:"mt-search-filters-toggle-all","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.filters")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.filters")},onclick:function(t){e._toggleAllFilters(t)}})),Qr({className:"".concat(Is," mt-search-filters-option-location ").concat(Ds)},this.localize("MindTouch.SearchFilters.label.location"),Vr({className:"mt-search-filters-option-toggle","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.location")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.location")},onclick:function(t){e._toggleChildList(t)}}),this._locationList=Gr({className:"".concat(Ls," mt-search-filters-sub-options-locations")},Qr({className:"mt-search-filters-location-item"},this.localize("MindTouch.SearchFilters.label.location-empty")))),Qr({className:"".concat(Is," mt-search-filters-option-classifications ").concat(Ds)},this.localize("MindTouch.SearchFilters.label.classification"),Vr({className:"mt-search-filters-option-toggle","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.classification")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.classification")},onclick:function(t){e._toggleChildList(t)}}),this._classificationList=Gr({className:Ls},this.options.classifications.map((function(t){return Qr({className:"mt-search-filters-classification-item mt-search-filters-classification-".concat(t.prefix)},Hr({className:"mt-search-filters-classification",onclick:function(t){e._toggleChildList(t)}},t.label,Vr({className:"mt-search-filters-classification-toggle","aria-expanded":!1,"aria-label":"".concat(e.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(t.label),dataset:{toggleLabel:t.label},onclick:function(t){e._toggleChildList(t)}})),Gr({className:"".concat(Ls," mt-search-filters-sub-options-classification")},t.tags.map((function(n){return Qr({className:"mt-search-filters-classification-".concat(t.prefix,"-").concat(n.tag)},Yr({className:"mt-search-filters-classification-label"},Jr({name:t.prefix,type:"checkbox",value:"".concat(t.prefix,":").concat(n.tag),onchange:function(){var t=Array.from(e._classificationList.querySelectorAll("input:checked"));e.callEvent("onfilteradded",{name:"classifications",value:t.map((function(e){return e.value})),analyticsName:"Classification"})}}),n.label))}))))})))),Qr({className:"".concat(Is," mt-search-filters-option-attachments ").concat(Ds)},this.localize("MindTouch.SearchFilters.label.attachments"),Yr({className:"mt-toggle-switch mt-search-filters-toggle-switch",ariaLabel:"".concat(this.localize("MindTouch.SearchFilters.label.view.attachments.toggle"))},Jr({"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.attachments")),className:"mt-search-filters-attachments-toggle",dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.attachments")},onkeydown:function(e){13===e.keyCode&&e.currentTarget.click()},onchange:function(t){e._toggleAttachments(t)},type:"checkbox"}),Kr({className:"mt-toggle-switch-slider"})),Gr({className:Ls},Qr(Yr({className:"mt-search-filters-sub-options-attachments-description"},this.localize("MindTouch.SearchFilters.label.attachments-description")),Gr({className:"".concat(Ls," mt-search-filters-sub-options-attachments")},this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.document"),"document"),this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.image"),"image"),this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.binary"),"binary"))))))}},{key:"_toggleAttachments",value:function(e){this._toggleChildList(e);var t=Boolean(e.currentTarget.checked);Array.from(this.element.querySelectorAll(".mt-search-filters-document-type")).forEach((function(e){e.checked=t})),this._updateTypes({analyticsName:"Include attachments"})}},{key:"_updateTypes",value:function(e){var t=e.analyticsName,n=["wiki"];Array.from(this.element.querySelectorAll(".mt-search-filters-document-type")).forEach((function(e){e.checked&&n.push(e.value)})),this.callEvent("onfilteradded",{name:"type",value:n,analyticsName:t})}},{key:"_documentTypeElm",value:function(e,t){var n=this;return Qr(Yr({className:"mt-search-filters-classification-label"},Jr({className:"mt-search-filters-document-type",name:"type",type:"checkbox",value:t,onchange:function(){n._updateTypes({analyticsName:"Content Type"})}}),e))}},{key:"_toggleAllFilters",value:function(e){e.stopPropagation();var t=e.target,n=Array.from(this.element.querySelectorAll(".".concat(Is)));"true"===e.target.getAttribute("aria-expanded")?(n.forEach((function(e){return e.classList.add(Ds)})),t.classList.remove("expanded"),t.setAttribute("aria-expanded",!1),t.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(t.dataset.toggleLabel||""))):(n.forEach((function(e){return e.classList.remove(Ds)})),t.classList.add("expanded"),t.setAttribute("aria-expanded",!0),t.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.hide")," ").concat(t.dataset.toggleLabel||"")))}},{key:"_toggleChildList",value:function(e){e.stopPropagation(),"true"===e.target.getAttribute("aria-expanded")?this._hideChildList(e.target):this._showChildList(e.target)}},{key:"_showChildList",value:function(e){e.closest("li").querySelector(".".concat(Ls)).classList.add(Ns),e.classList.add("expanded"),e.setAttribute("aria-expanded",!0),e.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.hide")," ").concat(e.dataset.toggleLabel||""))}},{key:"_hideChildList",value:function(e){e.closest("li").querySelector(".".concat(Ls)).classList.remove(Ns),e.classList.remove("expanded"),e.setAttribute("aria-expanded",!1),e.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(e.dataset.toggleLabel||""))}},{key:"_updateFiltersHeader",value:function(){var e=this;this._filtersHeader&&(li(this._filtersHeader),this._filtersHeader.appendChild(Hr({className:"mt-search-filters-clear-all",onclick:function(){e.resetFilters()}},this.localize("MindTouch.SearchFilters.label.clear-all"))))}},{key:"locations",set:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this._locationSelected&&0===t.length)return this._locationSelected=!1,!1;this._locationSelected=!1;var n=Or();0===t.length?n.appendChild(Qr({className:"mt-search-filters-location-item"},this.localize("MindTouch.SearchFilters.label.location-empty"))):t.forEach((function(t){n.appendChild(Qr({className:"mt-search-filters-location-item"},Hr({className:"mt-search-filters-location",href:"#",dataset:{path:encodeURIComponent(t.value)},onclick:function(n){n.preventDefault(),e._currentFilters.paths.push(t.value),e._locationSelected=!0,e.callEvent("onfilteradded",{name:"path",value:t.value,analyticsName:"Location"})}},"".concat(t.title," "),Kr({className:"mt-search-filters-count"},"(".concat(t.count,")")))))})),li(this._locationList),this._locationList.appendChild(n)}}]),n}(Ui(ji)),qs=function(){function e(t){s(this,e),this._url=new URL(t);var n=this._url.searchParams.get("q")||this._url.searchParams.get("search");n&&(this._url.searchParams.delete("q"),this._url.searchParams.delete("search"),this.query=n)}return l(e,[{key:"_getArray",value:function(e){var t=this._url.searchParams.get(e);if(t&&Array.isArray(t))return t;var n=[];return t&&"string"==typeof t&&t.length>0&&(n=t.split(",")),n}},{key:"_setArray",value:function(e,t){t&&t.length>0?this._url.searchParams.set(e,t):this._url.searchParams.delete(e)}},{key:"query",get:function(){return this._url.searchParams.get("query")},set:function(e){this._url.searchParams.set("query",e)}},{key:"path",get:function(){return this._url.searchParams.get("path")||""},set:function(e){e&&e.length>0?this._url.searchParams.set("path",e):this._url.searchParams.delete("path")}},{key:"classifications",get:function(){return this._getArray("classifications")},set:function(e){this._setArray("classifications",e)}},{key:"tags",get:function(){return this._getArray("tags")},set:function(e){this._setArray("tags",e)}},{key:"type",get:function(){return this._getArray("type")},set:function(e){this._setArray("type",e)}},{key:"limit",get:function(){return this._url.searchParams.get("limit")},set:function(e){e&&e.length>0?this._url.searchParams.set("limit",e):this._url.searchParams.delete("limit")}},{key:"url",get:function(){return this._url.toString()}}]),e}(),Ms=function(e){var t,n;function r(e){var t;return s(this,r),(t=f(this,h(r).call(this,e))).initialize({events:["onpathselected"]}),t}return d(r,e),l(r,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new r(t)).element=n._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["MindTouch.SearchLocationNav.label.current-location"]}}]),l(r,[{key:"update",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(li(this.element),"/"===t||""===t){e.next=7;break}return n=new Ht(t,this.martianSettings),e.next=5,n.getFullInfo();case 5:"pageParent"in(r=e.sent)&&((i=new qs(window.location.href)).path=r.pageParent.path,this.element.appendChild(Qr({className:"mt-search-filters-location-navigation-item"},Hr({onclick:function(e){e.preventDefault(),a.callEvent("onpathselected",{path:r.pageParent.path})},href:i.url},r.pageParent.title))),this.element.appendChild(Qr({className:"mt-search-filters-location-navigation-item"},"".concat(this.localize("MindTouch.SearchLocationNav.label.current-location")," ").concat(r.title))));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_createUi",value:function(){return Gr({className:"mt-search-filters-location-navigation"})}}]),r}(Ui(ha(ji))),Os="mt-search-filtersV2-option",zs="mt-search-filtersV2-sub-options";try{is=new Event("MT:SearchFilters:Hide")}catch(e){is=document.createEvent("Event"),event.initEvent("MT:SearchFilters:Hide",!0,!0)}var Us=function(e){var t;function n(e){var t;return s(this,n),(t=f(this,h(n).call(this,e))).initialize({defaults:{classifications:[]},events:["onfilteradded","onresetfilters"]}),t.resetFilters(!1),t._currentLocations=[],t}return d(n,e),l(n,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new n(t),e.next=3,Ms.create({onpathselected:function(e){r.setFilter({analyticsName:"Location Navigation",name:"path",value:e.detail.path})}});case 3:return r._locationNav=e.sent,e.next=6,r._createUi();case 6:return r.element=e.sent,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["MindTouch.SearchFilters.button.toggle.hide","MindTouch.SearchFilters.button.toggle.show","MindTouch.SearchFilters.label.attachments-description","MindTouch.SearchFilters.label.attachments.type.binary","MindTouch.SearchFilters.label.attachments.type.document","MindTouch.SearchFilters.label.attachments.type.image","MindTouch.SearchFilters.label.attachments.v2","MindTouch.SearchFilters.label.classification","MindTouch.SearchFilters.label.clear-all.v2","MindTouch.SearchFilters.label.description.v2","MindTouch.SearchFilters.label.filters","MindTouch.SearchFilters.label.location","MindTouch.SearchFilters.label.location-empty","MindTouch.SearchFilters.label.view.attachments.toggle","MindTouch.SearchFilters.label.search"].concat(v(Ms.resourceKeys))}}]),l(n,[{key:"highlightLocations",value:function(e){var t=e.paths,n=e.className,r=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var l=s.value,c=void 0;try{c=this._locationList.querySelector('a[data-path="'.concat(encodeURIComponent(l),'"]'))}catch(e){}c&&c.classList.add(n)}}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}}},{key:"clearHighlightedLocations",value:function(e){this._locationList&&this._locationList.querySelectorAll("a.".concat(e)).forEach((function(t){return t.classList.remove(e)}))}},{key:"setFilter",value:function(e){var t=e.name,n=e.value,r=e.analyticsName;this._filtersResetButton.hidden=!1,"path"===t&&(this._selectedPath=n),0!==this._getCheckedClassifications.length||0!==this._getCheckedDocumentTypes.length||void 0!==this._selectedPath&&""!==this._selectedPath||(this._filtersResetButton.hidden=!0),this.callEvent("onfilteradded",{name:t,value:n,analyticsName:r})}},{key:"resetFilters",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.element&&(li(this._allFilter),this._locationNav.update(""),this._allFilter.appendChild(this._createFilters())),e&&this.callEvent("onresetfilters")}},{key:"updateSelection",value:function(e){var t=this,n=e.path,r=void 0===n?"":n,i=e.classifications,a=void 0===i?[]:i,s=e.type,o=void 0===s?[]:s;if(o.length>1&&(this._toggleChildren({toggleElm:this._attachmentsToggle,hide:!1}),this._attachmentsToggle.checked="checked",o.forEach((function(e){var n=t.element.querySelector('.mt-search-filtersV2-document-type[value="'.concat(e,'"]'));n&&(n.checked=!0)}))),1===o.length&&"wiki"===o[0]&&(this._toggleChildren({toggleElm:this._attachmentsToggle,hide:!0}),this._attachmentsToggle.checked=!1),r.length>0){var l=this.element.querySelector(".mt-search-filtersV2-option-location .mt-search-filtersV2-option-toggle");this._toggleChildren({toggleElm:l,hide:!1})}if(this._locationNav.update(r),a.length>0){Array.from(this._classificationList.querySelectorAll("input")).forEach((function(e){e.checked=!1}));var c=this.element.querySelector(".mt-search-filtersV2-option-classifications .mt-search-filtersV2-option-toggle");this._toggleChildren({toggleElm:c,hide:!1}),a.forEach((function(e){var n=t.element.querySelector("input[value='".concat(e,"']"));n.checked=!0;var r=n.closest(".mt-search-filtersV2-classification-item").querySelector(".mt-search-filtersV2-classification");t._toggleChildren({toggleElm:r,hide:!1})}))}(a.length>0||o.length>1||r.length>0)&&(this._filtersResetButton.hidden=!1)}},{key:"_createUi",value:function(){var e=this,t=Wr(this._filtersToggleAllButton=Vr({className:"mt-search-filtersV2-toggle-all","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.filters")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.filters")},onclick:function(){e._updateFiltersVisibility({hide:!1}),e._filtersHideButton.focus()}},this.localize("MindTouch.SearchFilters.label.filters")),this._allFilter=Gr({className:"mt-search-filtersV2-options"},this._createFilters()));return t.addEventListener(is.type,(function(){e._updateFiltersVisibility({hide:!0})})),t}},{key:"_createFilters",value:function(){var e=this;return Or(Qr({className:"mt-search-filtersV2-header"},this.localize("MindTouch.SearchFilters.label.description.v2"),Wr({className:"mt-search-filtersV2-header-buttons"},this._filtersResetButton=Vr({className:"mt-search-filtersV2-reset",hidden:!0,onclick:function(){e.resetFilters()}},this.localize("MindTouch.SearchFilters.label.clear-all.v2")),this._filtersHideButton=Vr({className:"mt-search-filtersV2-close","aria-expanded":!0,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.hide")," ").concat(this.localize("MindTouch.SearchFilters.label.filters")),onclick:function(){e._updateFiltersVisibility({hide:!0}),e._filtersToggleAllButton.focus()}}))),Qr({className:"".concat(Os," mt-search-filtersV2-option-location"),onclick:function(t){e._handleToggleClick(t)}},Vr({className:"mt-search-filtersV2-option-toggle","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.location")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.location")}},this.localize("MindTouch.SearchFilters.label.location")),this._locationNav.element,this._locationList=Gr({className:"".concat(zs," mt-search-filtersV2-sub-options-locations"),hidden:!0},Qr({className:"mt-search-filtersV2-location-item"},Mr("i",this.localize("MindTouch.SearchFilters.label.location-empty"))))),Qr({className:"".concat(Os," mt-search-filtersV2-option-classifications"),onclick:function(t){e._handleToggleClick(t)}},Vr({className:"mt-search-filtersV2-option-toggle","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.classification")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.classification")}},this.localize("MindTouch.SearchFilters.label.classification")),this._classificationList=Gr({className:zs,hidden:!0},this.options.classifications.map((function(t){return Qr({className:"mt-search-filtersV2-classification-item mt-search-filtersV2-classification-".concat(t.prefix)},Vr({className:"mt-search-filtersV2-classification","aria-expanded":!1,"aria-label":"".concat(e.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(t.label),dataset:{toggleLabel:t.label},onclick:function(t){e._handleToggleClick(t)}},t.label),Gr({className:"".concat(zs," mt-search-filtersV2-sub-options-classification"),hidden:!0,onclick:function(e){e.stopPropagation()}},t.tags.map((function(n){return Qr({className:"mt-search-filtersV2-classification-".concat(t.prefix,"-").concat(n.tag)},Yr({className:"mt-search-filtersV2-classification-label"},Jr({name:t.prefix,type:"checkbox",value:"".concat(t.prefix,":").concat(n.tag),onchange:function(){var t=e._getCheckedClassifications;e.setFilter({name:"classifications",value:t.map((function(e){return e.value})),analyticsName:"Classification"})}}),n.label))}))))})))),Qr({className:"".concat(Os," mt-search-filtersV2-option-attachments"),onclick:function(t){t.currentTarget===t.target&&e._attachmentsToggle.click()}},Wr({className:"mt-search-filtersV2-option-toggle-container",onclick:function(t){t.currentTarget===t.target&&e._attachmentsToggle.click()}},this.localize("MindTouch.SearchFilters.label.attachments.v2"),Yr({className:"mt-toggle-switch mt-search-filtersV2-toggle-switch",ariaLabel:this.localize("MindTouch.SearchFilters.label.view.attachments.toggle")},this._attachmentsToggle=Jr({"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.attachments.v2")),className:"mt-search-filtersV2-attachments-toggle",dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.attachments.v2")},onkeydown:function(e){13===e.keyCode&&e.currentTarget.click()},onchange:function(t){e._toggleAttachments(t)},type:"checkbox"}),Kr({className:"mt-toggle-switch-slider"}))),Gr({className:zs,hidden:!0},Qr(Yr({className:"mt-search-filtersV2-sub-options-attachments-description"},this.localize("MindTouch.SearchFilters.label.attachments-description")),Gr({className:"".concat(zs," mt-search-filtersV2-sub-options-attachments"),hidden:!0},this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.document"),"document"),this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.image"),"image"),this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.binary"),"binary"))))))}},{key:"_toggleAttachments",value:function(e){this._handleToggleClick(e);var t=Boolean(e.currentTarget.checked);Array.from(this.element.querySelectorAll(".mt-search-filtersV2-document-type")).forEach((function(e){e.checked=t})),this._updateTypes({analyticsName:"Include attachments"})}},{key:"_updateTypes",value:function(e){var t=e.analyticsName,n=["wiki"];Array.from(this.element.querySelectorAll(".mt-search-filtersV2-document-type")).forEach((function(e){e.checked&&n.push(e.value)})),this.setFilter({name:"type",value:n,analyticsName:t})}},{key:"_documentTypeElm",value:function(e,t){var n=this;return Qr(Yr({className:"mt-search-filtersV2-classification-label"},Jr({className:"mt-search-filtersV2-document-type",name:"type",type:"checkbox",value:t,onchange:function(){n._updateTypes({analyticsName:"Content Type"})}}),e))}},{key:"_updateFiltersVisibility",value:function(e){var t=e.hide;if(t)try{this.element.removeChild(this._overlay)}catch(e){}else this._overlay=Wr({className:"mt-search-filtersV2-click-overlay"}),this.element.appendChild(this._overlay);var n,r=t?"show":"hide";this._allFilter.classList.toggle("expanded"),this._filtersToggleAllButton.classList.toggle("expanded"),this._filtersToggleAllButton.setAttribute("aria-expanded",!t),this._filtersToggleAllButton.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.".concat(r))," ").concat(this._filtersToggleAllButton.dataset.toggleLabel||"")),t?document.removeEventListener("click",as):(n=this.element,as=function(e){(e.target.classList.contains("mt-search-filtersV2-click-overlay")||!n.contains(e.target)&&!e.target.classList.contains("mt-search-filtersV2-reset"))&&(n.dispatchEvent(is),document.removeEventListener("click",as))},document.addEventListener("click",as))}},{key:"_handleToggleClick",value:function(e){var t;e.stopPropagation(),t="BUTTON"===e.target.nodeName||"INPUT"===e.target.nodeName?e.target:e.target.querySelector("button"),this._toggleChildren({toggleElm:t})}},{key:"_toggleChildren",value:function(e){var t=e.toggleElm,n=e.hide;if(null===t)return!1;void 0===n&&(n="true"===t.getAttribute("aria-expanded"));var r=t.closest("li"),i=r.querySelector(".".concat(zs));r.contains(this._locationNav.element)&&(this._locationNav.element.hidden=n),i.hidden=n,t.classList.toggle("expanded"),t.setAttribute("aria-expanded",!n),t.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(t.dataset.toggleLabel||""))}},{key:"locations",set:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];li(this._locationList);var n=Or();t.forEach((function(t){n.appendChild(Qr({className:"mt-search-filtersV2-location-item"},Hr({className:"mt-search-filtersV2-location",href:"#",dataset:{path:encodeURIComponent(t.value)},onclick:function(n){n.stopPropagation(),n.preventDefault(),e.setFilter({name:"path",value:t.value,analyticsName:"Location"})}},"".concat(t.title," "),Kr({className:"mt-search-filtersV2-count"},"(".concat(t.count,")")))))})),this._locationList.appendChild(n)}},{key:"_getCheckedClassifications",get:function(){return Array.from(this._classificationList.querySelectorAll("input:checked"))}},{key:"_getCheckedDocumentTypes",get:function(){return Array.from(this.element.querySelectorAll(".mt-search-filtersV2-document-type:checked"))}}]),n}(Ui(ji)),Bs=function(e){var t;function n(e){var t;return s(this,n),(t=f(this,h(n).call(this,e))).initialize({defaults:{initialQuery:"",path:"",queryKey:"q",targetNewTab:!1,url:"/Special:Search"},events:["onsubmit"]}),t.addEvent("onsubmit",(function(){t.doSearch(t._inputElement.value)})),t}return d(n,e),l(n,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new n(t))._createUi(),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Help.Widget.button.text","Help.Widget.label.text","Help.Widget.placeholder.text"]}},{key:"settingsKeys",get:function(){return["isGenerativeSearchSearchIconEnabled"]}}]),l(n,[{key:"doSearch",value:function(e){if(""!==(e=e.trim())){var t=new yr(this.options.url.toString());t.addQueryParam(this.options.queryKey,e),this.options.path&&t.addQueryParam("path",this.options.path),wr.clearStorage("searchSessionId","session"),this.options.targetNewTab?window.open(t.toString(),"_blank"):window.location.href=t.toString()}}},{key:"_createUi",value:function(){var e=this;this.element=Mr("form",{className:"ui-dform mt-inputredirect-form",onsubmit:function(t){t.preventDefault(),e.callEvent("onsubmit")}},Mr("fieldset",{className:"ui-dform-fieldset"},Wr({className:"mt-field"},Yr({htmlFor:"mt-inputredirect-input",className:"mt-inputredirect-label ui-dform-label"},this.localize("Help.Widget.label.text")),this._inputElement=Jr({autocomplete:"off",className:"mt-help mt-inputredirect-input ui-dform-input",id:"mt-inputredirect-input",placeholder:this.localize("Help.Widget.placeholder.text"),value:this.options.initialQuery}),Vr({className:"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only mt-inputredirect-button".concat(this.getSetting("isGenerativeSearchSearchIconEnabled")?" mt-icon-gen-search3":""),role:"button"},Kr({className:"ui-button-text"},this.localize("Help.Widget.button.text"))))))}}]),n}(Ui(Yi(ji))),Hs=function(e){var t;function n(e){var t;return s(this,n),(t=f(this,h(n).call(this,e))).initialize({inputHint:"",queryKey:"query"}),t}return d(n,e),l(n,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new n(t))._createUi(),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),l(n,[{key:"_createUi",value:function(){var e=this;this.element=Wr({className:"mt-widget-search-input-container"},Vr({className:"mt-icon-search",onclick:function(t){t.preventDefault(),e.callEvent("onsubmit")}},Ur('\x3c!-- Generated by IcoMoon.io --\x3e\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">\n<title>search</title>\n<path d="M15.504 13.616l-3.79-3.223c-0.392-0.353-0.811-0.514-1.149-0.499 0.895-1.048 1.435-2.407 1.435-3.893 0-3.314-2.686-6-6-6s-6 2.686-6 6c0 3.314 2.686 6 6 6 1.486 0 2.845-0.54 3.893-1.435-0.016 0.338 0.146 0.757 0.499 1.149l3.223 3.79c0.552 0.613 1.453 0.665 2.003 0.115s0.498-1.452-0.115-2.003zM6 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"></path>\n</svg>\n')),Mr("form",{className:"mt-widget-search-form",onsubmit:function(t){t.preventDefault(),e.callEvent("onsubmit")}},this._inputElement=Mr("input",{autocomplete:"off",className:"mt-widget-search-input mt-help-search-input mt-text",placeholder:this.options.inputHint,type:"search",incremental:"incremental"})))}}]),n}(Bs),Vs=function(e){var t,n;function r(e){var t;return s(this,r),(t=f(this,h(r).call(this,e))).initialize({defaults:{includeChooseLanguageOption:!0},events:["onlanguageselect"]}),t}return d(r,e),l(r,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new r(t),e.next=3,n._createUi(n._getLanguages());case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Component.Translate.label.choose-language"].concat(v(ra.resourceKeys))}},{key:"settingsKeys",get:function(){return["supportedTranslationTargetLanguages","pageLanguageCode","uiLanguage"]}}]),l(r,[{key:"selectLanguage",value:function(e){if(e){var t=this.element.querySelector('option[value="'.concat(e,'"]'));if(t)return void(t.selected=!0)}this.element.selectedIndex=0}},{key:"_createUi",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=ra.resourceKey(this.getSetting("uiLanguage")),this.element=Mr("select",{className:"mt-translate-language-picker",required:!0,title:this.localize("Component.Translate.label.choose-language"),onchange:function(e){r.callEvent("onlanguageselect",e.currentTarget.value)}},this.options.includeChooseLanguageOption&&Mr("option",{selected:!0,disabled:!0},this.localize("Component.Translate.label.choose-language")),[Mr("option",{value:""},this.localize(n)),t.map((function(e){return Mr("option",{value:e},r.localize(ra.resourceKey(e)))}))]);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_getLanguages",value:function(){return Array.from(this.getSetting("supportedTranslationTargetLanguages")||[],(function(e){return ra.normalizeLanguageCode(e)}))}}]),r}(Yi(Ui(ha(ji)))),Ws=function(e){var t,n,r;function i(e){var t;return s(this,i),(t=f(this,h(i).call(this,e))).initialize({events:["onlanguageselect","onsourcelanguageselect","onsuccess","onerror"]}),t._selectedLanguage=ra.normalizeLanguageCode(e.selectedLanguage),t._translatedLanguage=t.getSetting("translatedLanguage"),t}return d(i,e),l(i,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new i(t),e.next=3,n._fetchDependencies();case 3:return e.next=5,n._createUi();case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"settingsKeys",get:function(){return["translatedLanguage"].concat(v(Vs.settingsKeys))}},{key:"resourceKeys",get:function(){return["Component.Translate.label.update-failed","Component.Translate.dialog.translated-mindtouch"].concat(v(Vs.resourceKeys),v(ra.resourceKeys))}}]),l(i,[{key:"_createUi",value:(r=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.element=this._languagePicker.element,this._translatedStatus();case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_fetchDependencies",value:(n=a(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Vs.create({onlanguageselect:function(e){t.callEvent("onlanguageselect",e.detail)}});case 2:this._languagePicker=e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_translatedStatus",value:function(){void 0!==this._selectedLanguage&&null!==this._selectedLanguage&&(ra.normalizeLanguageCode(this._selectedLanguage)===ra.normalizeLanguageCode(this._translatedLanguage)?this.callEvent("onsuccess",{message:this.localize("Component.Translate.dialog.translated-mindtouch")}):this.callEvent("onerror",{message:this.localize("Component.Translate.label.update-failed")}),this._languagePicker.selectLanguage(this._selectedLanguage))}}]),i}(Yi(Ui(ji))),$s="https://expert-help.nice.com/@go/cid/youtubeupgrade",Ks=/^(?:(?:https?:\/\/)*(?:www\.|))*(?:(?:youtube\.com\/(?:(?:watch\?(?:.*?&|)v=([a-zA-Z0-9_-]+)(?:$|&))|(?:embed\/([a-zA-Z0-9_-]+)(?:$|[\/\?].*))))|(?:youtu\.be\/([a-zA-Z0-9_-]+)(?:$|[\/\?].*)))/i,Gs=function(e){var t,n,r,i;function o(e){var t;return s(this,o),(t=f(this,h(o).call(this,e))).initialize({defaults:{maxResults:10,searchString:"",autoSelect:!0,apiKey:"",widescreen:!0},events:["onselected","onresultsadded"]}),t._nextPageToken=null,t._lastQuery=null,t._widescreen=t.options.widescreen,t}return d(o,e),l(o,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Component.YoutubeSearch.error.key-invalid","Component.YoutubeSearch.error.key-missing","Component.YoutubeSearch.error.search-failed","Component.YoutubeSearch.info.not-found","Component.YoutubeSearch.label.video-url","Component.YoutubeSearch.label.success-center","Component.YoutubeSearch.placeholder.query"]}}]),l(o,[{key:"update",value:function(){var e=this._query.value;this._reset();var t=e.match(Ks);if(t){var n=t[1]||t[2]||t[3];this._videoUrl=this._getYoutubeUrl(n),this._searchByIds([n],{q:e,pageToken:null,nextPageToken:null})}else!e.length||/^(?:https?|ftp|file):\/\//i.test(e)?this._videoUrl=e:(this._videoUrl="",this._search(e))}},{key:"_createUi",value:(i=a(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.element=Wr(Wr({className:"mt-field mt-youtube-video-url"},Yr({className:"mt-label",htmlFor:"mt-youtube-video-url"},this.localize("Component.YoutubeSearch.label.video-url")),this._query=Jr({className:"mt-text",id:"mt-youtube-video-url",type:"text",autocomplete:"off",placeholder:this.localize("Component.YoutubeSearch.placeholder.query"),value:this.options.searchString})),this._message=Br($a),this._resultsContainer=Wr({className:"mt-youtube-video-results-wrapper"},this._results=Wr({className:"mt-youtube-video-results mt-hide",id:"mt-youtube-video-results",onscroll:function(e){var n=e.currentTarget;n.scrollTop+n.clientHeight<n.scrollHeight||t._search(t._lastQuery)}},this._videos=Gr({className:"mt-hide"})))),ir.init(this._query,this.update,{timeout:200,minimum:1,reference:this}),e.next=4,this._message;case 4:this._message=e.sent;case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_search",value:(r=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,s,o,l,c,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.apiKey){e.next=3;break}return this._showMessage(Or("".concat(this.localize("Component.YoutubeSearch.error.key-missing")," "),Hr({href:$s,target:"_blank"},this.localize("Component.YoutubeSearch.label.success-center")))),e.abrupt("return");case 3:return this._showSpinner(),this._lastQuery=t,n={part:"id",q:t,maxResults:this.options.maxResults,key:this.options.apiKey},this._nextPageToken&&(n.pageToken=this._nextPageToken),e.prev=7,e.next=10,fetch("https://www.googleapis.com/youtube/v3/search?".concat(wr.buildQueryString(n)));case 10:if((i=e.sent).ok){e.next=13;break}throw new Error(i.statusText);case 13:return e.next=15,i.json();case 15:r=e.sent,e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),this._showMessage(this.localize("Component.YoutubeSearch.error.search-failed")),this._hideSpinner();case 22:if(this._checkData(r)){e.next=25;break}return this._hideSpinner(),e.abrupt("return");case 25:for(this._nextPageToken=r.nextPageToken,a=[],s=!0,o=!1,l=void 0,e.prev=30,c=r.items[Symbol.iterator]();!(s=(u=c.next()).done);s=!0)d=u.value,a.push(d.id.videoId);e.next=38;break;case 34:e.prev=34,e.t1=e.catch(30),o=!0,l=e.t1;case 38:e.prev=38,e.prev=39,s||null==c.return||c.return();case 41:if(e.prev=41,!o){e.next=44;break}throw l;case 44:return e.finish(41);case 45:return e.finish(38);case 46:this._searchByIds(a,{q:t,pageToken:n.pageToken,nextPageToken:this._nextPageToken});case 47:case"end":return e.stop()}}),e,this,[[7,18],[30,34,38,46],[39,,41,45]])}))),function(e){return r.apply(this,arguments)})},{key:"_searchByIds",value:(n=a(regeneratorRuntime.mark((function e(t,n){var r,i,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.apiKey){e.next=3;break}return this._showMessage(Or("".concat(this.localize("Component.YoutubeSearch.error.key-missing")," "),Hr({href:$s,target:"_blank"},this.localize("Component.YoutubeSearch.label.success-center")))),e.abrupt("return");case 3:return this._showSpinner(),r={part:"snippet,contentDetails",id:t.join(","),key:this.options.apiKey},e.next=7,fetch("https://www.googleapis.com/youtube/v3/videos?".concat(wr.buildQueryString(r)));case 7:if(i=e.sent,e.prev=8,i.ok){e.next=11;break}throw new Error(i.statusText);case 11:return e.next=13,i.json();case 13:a=e.sent,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(8),this._hideSpinner(),this._showMessage(this.localize("Component.YoutubeSearch.error.search-failed"));case 20:this._checkData(a)?(s=!1,n.pageToken&&(s=!0),this._addYoutubeVideos(a.items,s,this._query.value===n.q&&this._nextPageToken===n.nextPageToken)):this._hideSpinner();case 21:case"end":return e.stop()}}),e,this,[[8,16]])}))),function(e,t){return n.apply(this,arguments)})},{key:"_showSpinner",value:function(){this._results.classList.remove("mt-hide"),ai(this.spinner)}},{key:"_hideSpinner",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];si(this.spinner),e||this._results.classList.add("mt-hide")}},{key:"_showMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";li(this._message),this._message[t]([e])}},{key:"_hideMessage",value:function(){yi.EmptyFlash("all")}},{key:"_reset",value:function(){this._widescreen=!0,this._nextPageToken=null,this._hideSpinner(),this._videos.classList.add("mt-hide"),li(this._videos),this._hideMessage()}},{key:"_getYoutubeUrl",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.location.protocol;n=-1!==n.search(/https?:/)?n:"http:";var r="";if(this._query.value.match(Ks)){var i=new URL(this._query.value),a=parseInt(i.searchParams.get("start")||i.searchParams.get("t"),10);isNaN(a)||(r="?start=".concat(a))}return"".concat(n,"//www.youtube.com/").concat(t?"embed/":"watch?v=").concat(e).concat(r)}},{key:"_checkData",value:function(e){if(!e)return this._showMessage(this.localize("Component.YoutubeSearch.error.search-failed")),!1;if(e.pageInfo&&0===e.pageInfo.totalResults)return this._showMessage(this.localize("Component.YoutubeSearch.info.not-found"),"info"),!1;if(e.error){var t=e.error.errors&&e.error.errors[0]||{};switch(t.reason){case"keyInvalid":case"keyExpired":this._showMessage(Or("".concat(this.localize("Component.YoutubeSearch.error.key-invalid")," "),Hr({href:$s,target:"_blank"},this.localize("Component.YoutubeSearch.label.success-center"))));break;default:var n=this.localize("Component.YoutubeSearch.error.search-failed");t.message||t.reason?(n+=": ".concat(t.message||t.reason),t.message&&t.reason&&(n+=" (".concat(t.reason,")"))):e.error.message&&(n+=": ".concat(e.error.message)),this._showMessage(cr(n))}return!1}return!0}},{key:"_addYoutubeVideos",value:function(e,t,n){for(var r=this,i=[],a=0;a<e.length;a++){var s=this._videoItem(e[a]);i.push(s)}i.length&&(t||li(this._videos),i.forEach((function(e){r._videos.appendChild(e)})),this.callEvent("onresultsadded",{results:e}),n&&(this._videos.classList.remove("mt-hide"),this._hideSpinner(!0),this.options.autoSelect&&this._videos.children.length<=this.options.maxResults&&this._selectVideo(this._videos.firstElementChild)))}},{key:"_videoItem",value:function(e){var t=this,n=e.snippet,r="hd"===e.contentDetails.definition||"maxres"in e.snippet.thumbnails,i={id:e.id,thumb:n.thumbnails.default.url,title:n.title,description:n.description,widescreen:r,url:this._getYoutubeUrl(e.id,!1)};return Qr({className:"mt-youtube-video-item",title:i.title,dataset:{videoId:i.id,videoTitle:i.title,videoWidescreen:i.widescreen},onclick:function(e){t._selectVideo(e.currentTarget)},ondblclick:function(e){t._selectVideo(e.currentTarget,!0)}},Wr({className:"mt-youtube-video-thumb"},Mr("img",{src:i.thumb,width:"120",height:"90"})),Wr({className:"mt-youtube-video-info"},Wr({className:"mt-youtube-video-title"},Hr({href:i.url,target:"_blank"},i.title)),Wr({className:"mt-youtube-video-description"},i.description),Wr({className:"mt-youtube-video-url"},i.url)))}},{key:"_selectVideo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Array.from(this._videos.children).forEach((function(e){e.classList.remove("active")})),e.classList.add("active"),this._videoUrl=this._getYoutubeUrl(e.dataset.videoId),this._widescreen="true"===e.dataset.videoWidescreen,this.callEvent("onselected",{type:t?"submit":"select",id:e.dataset.videoId,url:this._videoUrl,aspectRatio:this._widescreen?"56.25":"75"})}},{key:"currentSelection",get:function(){return{url:this._videoUrl,aspectRatio:this._widescreen?"56.25":"75"}}}]),o}(Ui(ji)),Qs={noRatingTags:["article:topic-guide","article:topic-portfolio","article:topic-category"],_trackClick:function(e){if(e){var t=e.currentTarget;t.dataset.trackUri&&fetch(t.dataset.trackUri,{method:"post",credentials:"include"})}},buildSearchConstraint:function(e){var t=[];if(e.namespace="main",t.push("+namespace:"+wr.searchEscape(e.namespace)),"path"in e){var n=e.path;n.startsWith("/")&&(n=mr(n,"/")),""!==n&&t.push("+path.ancestor:"+wr.ancestorEscape(n))}if("tags"in e){var r=e.tags;"string"==typeof r&&(r=""===r?[]:r.split(",")),r.forEach((function(e){t.push('+tag:"'+wr.searchEscape(e)+'"')}))}return"+("+t.join(" ")+")"},getTemplateData:function(e,t){var n=this,r=[];return{results:e.map((function(e,t){var i=e.page.path,a="mt-search-information";Xn.get("userIsSeated")&&(a+=" mt-seated");var s="file"===e.type?e.page.title:e.title,o={id:e.id,type:e.type,isRecommended:"recommended"===e.type,title:""===s?"Home":s,path:i,uri:e.page.uri,trackUri:e.uriTrack,content:"content"in e?gr(e.content,200):null,fullContent:"content"in e&&e.content.length>200?e.content:null,canRate:!1,infoClass:a,resultIndex:t};if("file"===e.type)o=Object.assign(o,{fileType:e.mime.split("/")[1].replace("+","-"),fileTitle:e.title,fileUri:e.uri});else if(Xn.get("userIsSeated")&&!Xn.get("isF1Request")){var l=void 0!==("tags"in e?e.tags:[]).find((function(e){return e.startsWith("article:")&&!n.noRatingTags.includes(e)}));l&&r.push(e.id),o.canRate=l}return o})),rateablePages:r,strings:t}},logSearchEvent:function(e,t,n,r){return new et(jr).logSearch(Xn.get("userId"),{query:n.q,constraint:r,path:n.path,qid:t,totalresults:e.total,totalrecommended:e.recommended,offset:n.offset,limit:n.limit,_url:window.location.href})},_resultsTemplate:function(e,t){var n=this;return Qr({className:"result type-".concat(e.type)},Wr({className:e.infoClass},Wr({className:"title"},e.fileTitle&&Hr({className:"go result-spacer mt-tracked-result",href:e.fileUri,onclick:function(e){return n._trackClick(e)},title:e.fileTitle,dataset:{trackUri:e.trackUri,tracking:"false"}},Kr({className:"mt-search-file mt-icon-".concat(e.fileType)},"")," ".concat(e.fileTitle)),e.fileTitle&&Kr({}," ".concat(t.fileInPage," ")),Hr({className:"go result-spacer mt-tracked-result",href:e.uri,onclick:function(e){return n._trackClick(e)},title:e.title,dataset:{gaLabel:"Result ".concat(e.resultIndex),trackUri:e.trackUri,tracking:!1}},e.title),e.isRecommended&&Kr({className:"recommended-tag"}," ".concat(t.recommended))),Wr({className:"meta"},Wr({className:"url",title:e.uri},e.uri),e.content&&Wr({className:"preview"},Kr({className:"mt-search-partial-content"},e.content),e.fullContent&&Kr({className:"mt-search-full-content mt-hide"},e.fullContent),e.fullContent&&Wr({},Hr({className:"mt-help-more-content",dataset:{gaLabel:"Help more content"},href:"#"},t.more))))),e.canRate&&Wr({className:"mt-help-button-container",dataset:{pageId:e.id}},Vr({className:"mt-help-upvote ui-button-icon mt-icon-rating-yes"},t.rateYes),Vr({className:"mt-help-downvote ui-button-icon mt-icon-rating-no",type:"button"},t.rateNo)))},getResultsDom:function(e){var t=this;return Or(e.results.reduce((function(n,r){return n.push(t._resultsTemplate(r,e.strings)),n}),[]))},search:function(e,t){return(e=Object.assign({limit:5,offset:0,tags:[],path:"",recommendations:!0},e)).q=e.q.replace(/(^|\s)\*($|\s)/g," ").trim(),t&&(e.sessionid=t),new Sn(jr).search(e)}};function Js(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.locale,r=void 0===n?Xn.get("pageLanguageCode"):n,i=t.includeDay,a=void 0===i||i,s=t.includeYear,o=void 0===s||s;if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");var l={month:"short"};return a&&(l.day="numeric"),o&&(l.year="numeric"),e.toLocaleString(r,l)}function Ys(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).locale,n=void 0===t?Xn.get("pageLanguageCode"):t;if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");return e.toLocaleString(n,{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric"})}var Xs,Zs=Object.freeze({__proto__:null,apiDate:function(e){if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");var t={year:e.getUTCFullYear(),month:"0".concat(e.getUTCMonth()+1).slice(-2),day:"0".concat(e.getUTCDate()).slice(-2)};return"".concat(t.year).concat(t.month).concat(t.day)},apiDateTime:function(e){if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");var t={year:e.getUTCFullYear(),month:"0".concat(e.getUTCMonth()+1).slice(-2),day:"0".concat(e.getUTCDate()).slice(-2),hours:"0".concat(e.getUTCHours()).slice(-2),minutes:"0".concat(e.getUTCMinutes()).slice(-2),seconds:"0".concat(e.getUTCSeconds()).slice(-2)};return"".concat(t.year).concat(t.month).concat(t.day).concat(t.hours).concat(t.minutes).concat(t.seconds)},dateDiff:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).unit,r=void 0===n?"days":n;if(!(e instanceof Date&&t instanceof Date))throw new TypeError("Input dates must both be an instance of Date");var i={milliseconds:{factor:1},seconds:{factor:1e3},minutes:{factor:6e4},hours:{factor:36e5},days:{factor:864e5}};if(!Object.keys(i).includes(r))throw new RangeError("The supplied diff unit must be one of ".concat(Object.keys(i).join(", ")));var a=e.getTime(),s=t.getTime(),o=Math.abs(a-s);return Math.round(o/i[r].factor)},dayRange:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).step,r=void 0===n?1:n;if(!(e instanceof Date&&t instanceof Date))throw new TypeError("Input dates must both be an instance of Date");for(var i=[],a=new Date(e),s=t.getTime();a.getTime()<s;)i.push(new Date(a)),a.setDate(a.getDate()+r);return i},isValidDate:function(e){return e instanceof Date&&!Number.isNaN(e.getTime())},numericDate:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).locale,n=void 0===t?Xn.get("pageLanguageCode"):t;if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");return e.toLocaleString(n,{day:"numeric",month:"numeric",year:"numeric"})},numericTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.locale,r=void 0===n?Xn.get("pageLanguageCode"):n,i=t.includeMinutes,a=void 0===i||i,s=t.includeSeconds,o=void 0!==s&&s;if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");var l={hour:"numeric"};return a&&(l.minute="numeric"),o&&(l.second="numeric"),e.toLocaleString(r,l)},pageLastUpdatedTimestamp:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).locale,n=void 0===t?Xn.get("pageLanguageCode"):t;return Xn.get("userIsSeated")?Ys(e,{locale:n}):Js(e,{locale:n})},shortDate:Js,shortDateTime:Ys}),eo=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.component,r=void 0===n?null:n,i=t.environment,a=void 0===i?"mindtouch-web":i;s(this,e),this._component=r,this._environment=a}return l(e,[{key:"newEventName",value:function(e){return null!==this._component?"".concat(this._environment,":").concat(this._component,":").concat(e):"".concat(this._environment,":").concat(e)}},{key:"newErrorEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.newEvent("error",Object.assign(t,{_error:e}))}},{key:"newEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new CustomEvent(this.newEventName(e),{bubbles:!0,cancelable:!0});return n.data=t,n}}]),e}(),to=function(e){var t,n;function r(){var e;return s(this,r),(e=f(this,h(r).call(this)))._events=new et(e.martianSettings),e._eventFactory=null,e._id=null,e._type=null,e}return d(r,e),l(r,null,[{key:"init",value:(t=a(regeneratorRuntime.mark((function e(){var t,n,i,a,s,o,l,c,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=u.length>0&&void 0!==u[0]?u[0]:{}).eventFactory,i=t.id,a=void 0===i?null:i,s=t.type,o=void 0===s?"case":s,(l=new r)._eventFactory=n,l._type=o,null!==a){e.next=19;break}return c=null,e.prev=6,e.next=9,l._events.logFormInit(o);case 9:c=e.sent,e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(6),document.dispatchEvent(l._eventFactory.newErrorEvent(e.t0,{message:"Form logger could not be initialized",type:l._type})),e.abrupt("return",null);case 16:l._id=c.id,e.next=20;break;case 19:l._id=a;case 20:return document.dispatchEvent(l._eventFactory.newEvent("form-activity-logger-ready",{logger:l})),e.abrupt("return",l);case 22:case"end":return e.stop()}}),e,this,[[6,12]])}))),function(){return t.apply(this,arguments)})}]),l(r,[{key:"submit",value:(n=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._events.logFormSubmit(this._id,this._type);case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),document.dispatchEvent(this._eventFactory.newErrorEvent(e.t0,{id:this._id,message:"Form submission could not be logged",type:this._type})),e.abrupt("return",!1);case 9:return document.dispatchEvent(this._eventFactory.newEvent("form-activity-logger-submitted",{id:this._id,type:this._type})),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return n.apply(this,arguments)})},{key:"id",get:function(){return this._id}},{key:"type",get:function(){return this._type}}]),r}(ha(function(){return function e(){s(this,e)}}())),no=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.eventFactory,r=void 0===n?new eo({component:"analytics"}):n,i=t.getCurrentUserActivityToken,a=void 0===i?null:i;s(this,e),this._eventFactory=r,this._getCurrentUserActivityToken=a}var t;return l(e,[{key:"initFormActivityLogger",value:(t=a(regeneratorRuntime.mark((function e(t){var n,r,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(i.length>1&&void 0!==i[1]?i[1]:{}).id,r=void 0===n?null:n,e.next=3,to.init({eventFactory:this._eventFactory,errorHandler:this._errorHandler,id:r,type:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"userActivityToken",get:function(){var e=this._getCurrentUserActivityToken;return"function"!=typeof e?null:e()}}]),e}(),ro={analytics:new no({getCurrentUserActivityToken:function(){return"".concat($i("userId"),":").concat($i("sessionId"))}})};var io=function(e,t){return e=e.toLowerCase(),Mr("i",{className:"mt-review-icon-".concat(e),title:t("Page.ReviewWorkflow.label.reviewer-".concat(e))})},ao=function(e){return"assign-to-me"!==e&&"reassign"!==e},so={resourceKeys:["Page.ReviewBanner.label.single-review-description.accepted","Page.ReviewBanner.label.single-review-description.cancelled","Page.ReviewBanner.label.single-review-description.reviewRequested","Page.ReviewBanner.label.single-review-description.editsRequested"],key:function(e){var t=Object.keys(un.states).find((function(t){return un.states[t]===e}));return t?"Page.ReviewBanner.label.single-review-description.".concat(t):null}},oo=(c(Xs={},un.states.accepted,"Page.ReviewWorkflow.label.accepted"),c(Xs,un.states.cancelled,"Page.ReviewWorkflow.label.cancelled"),c(Xs,un.states.editsRequested,"Page.ReviewWorkflow.label.needs-edits"),c(Xs,un.states.reviewRequested,"Page.ReviewWorkflow.label.review-requested"),Xs),lo={resourceKeys:Object.values(oo),getResourceKey:function(e){return oo[e]||null}},co=Object.freeze({__proto__:null,canDisplayCommentBlock:ao,reviewDescription:so,reviewStateLabel:lo,reviewerTypeIcon:io}),uo=function(e){var t,n,r;function i(e){var t;if(s(this,i),(t=f(this,h(i).call(this,e))).initialize({defaults:{hidden:!0},events:["onhistoryshow","onhistoryhide"]}),!t.options.reviewId)throw new Error("A reviewId is required");return t}return d(i,e),l(i,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new i(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Dialog.ReviewWorkflow.message.no-review","Page.ReviewWorkflow.button.toggle.review-history","Page.ReviewWorkflow.label.section.select"].concat(v(so.resourceKeys),v(lo.resourceKeys))}}]),l(i,[{key:"_createUi",value:(r=a(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.element=Zr({className:"mt-recent-review-history",dataset:{reviewId:this.options.reviewId},hidden:this.options.hidden},ei({colSpan:"7"})),this.toggleButtonElement=Vr({className:"mt-review-history-toggle-collapse",ariaLabel:"".concat(this.localize("Page.ReviewWorkflow.button.toggle.review-history")),ariaExpanded:!1,onclick:function(){var e=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._getRecentReviewHistory();case 2:t._toggleReviewHistory(t.options.reviewId);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}),this.options.hidden||this._getRecentReviewHistory();case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_getRecentReviewHistory",value:(n=a(regeneratorRuntime.mark((function e(){var t,n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.element.children[0].children.length){e.next=16;break}return e.next=3,new un(this.martianSettings).getInfo(this.options.reviewId);case 3:if(this.review=e.sent,!(t=this.review.states.reverse().slice(0,5)).some((function(e){return"string"==typeof e.pageSection}))){e.next=15;break}return r=new Ht(this.review.page.id,this.martianSettings),e.next=10,r.getTableOfContents();case 10:if(!(i=e.sent)){e.next=15;break}return e.next=14,this._parseTOC(i);case 14:n=e.sent;case 15:t.forEach((function(e){var t;if(e.pageSection){var r=n.querySelector('a[href="#'.concat(e.pageSection,'"]'));r&&(t=r.innerText)}var i=a.localize(lo.getResourceKey(e.label));a.element.children[0].appendChild(Or($r({className:"mt-single-review-history-detail mt-icon-arrow2"},Mr("strong","".concat(i," - ")),a.localize(so.key(e.label),e.requestedBy.name,e.requestedOf.name)," ",Mr("time",{title:Ys(e.createdTime),dateTime:e.createdTime},Ys(e.createdTime)),t&&Or(" - ",Mr("strong",a.localize("Page.ReviewWorkflow.label.section.select")," - "),t)),a._reviewComment(e.comment)))}));case 16:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_parseTOC",value:function(e){var t=new DOMParser;try{return t.parseFromString(e,"text/html").body.querySelector("ol")}catch(e){return Mr("ol")}}},{key:"_reviewComment",value:function(e){var t=e.length>0?'"'.concat(e,'"'):Mr("i",this.localize("Dialog.ReviewWorkflow.message.no-review"));return $r({className:"mt-single-review-history-comment"},t)}},{key:"_toggleReviewHistory",value:function(e){this.element.hidden?(this.element.hidden=!1,this.toggleButtonElement.setAttribute("aria-expanded",!0),this.toggleButtonElement.classList.remove("mt-review-history-toggle-collapse"),this.toggleButtonElement.classList.add("mt-review-history-toggle-expand"),this.callEvent("onhistoryshow",{reviewId:this.options.reviewId})):(this.element.hidden=!0,this.toggleButtonElement.setAttribute("aria-expanded",!1),this.toggleButtonElement.classList.add("mt-review-history-toggle-collapse"),this.toggleButtonElement.classList.remove("mt-review-history-toggle-expand"),this.callEvent("onhistoryhide",{reviewId:e}))}}]),i}(ha(Ui(ji))),ho=function(e){var t,n,r;function i(e){var t;return s(this,i),(t=f(this,h(i).call(this,e))).initialize({defaults:{wrapperClasses:""},events:["onupdate","onerror","showreviewhistory"]}),t.options.wrapperClasses+=" mt-review-banner-container",t._pageId=t.getSetting("pageId"),t._userId=t.getSetting("userId"),t._userName=t.getSetting("userName"),t}return d(i,e),l(i,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new i(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Page.ReviewBanner.label.accept","Page.ReviewBanner.label.cancel","Page.ReviewBanner.label.multiple-reviews-description","Page.ReviewBanner.label.multiple-reviews","Page.ReviewBanner.label.reassign","Page.ReviewBanner.label.request-edits","Page.ReviewBanner.label.request-review","Page.ReviewBanner.label.review-history","Page.ReviewBanner.label.show-all-reviews","Page.ReviewBanner.label.assign-to-me"].concat(v(so.resourceKeys),v(uo.resourceKeys),v(Zi.resourceKeys))}},{key:"settingsKeys",get:function(){return["pageId","userId","userName","isDraftRequest"]}}]),l(i,[{key:"update",value:(r=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t||(t=this.element.parentElement),t&&li(t),e.next=4,this._createUi();case 4:this.element&&t&&t.appendChild(this.element);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_createUi",value:(n=a(regeneratorRuntime.mark((function e(){var t,n,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=this.getSetting("isDraftRequest")?"listForDraft":"listForPage",e.next=4,new un(this.martianSettings)[n](this._pageId);case 4:t=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),this.callEvent("onerror",e.t0),e.abrupt("return");case 11:if(0!==t.length){e.next=14;break}return this.element=null,e.abrupt("return");case 14:this.element=Wr({className:this.options.wrapperClasses}),t.length>1?this.element.appendChild(Or($r({className:"mt-review-banner-description"},Mr("strong",this.localize("Page.ReviewBanner.label.multiple-reviews")),Mr("br"),this.localize("Page.ReviewBanner.label.multiple-reviews-description",t.length)),Mr("ol",{className:"mt-review-banner-actions"},Mr("li",{className:"mt-review-banner-action"},Hr({className:"mt-review-banner-action-show-all-reviews",onclick:function(e){e.preventDefault(),i.callEvent("onupdate")}},this.localize("Page.ReviewBanner.label.show-all-reviews")))))):((r=t[0]).currentState=r.states.find((function(e){return e.id===r.currentStateId})),this.element.appendChild(Or($r({className:"mt-review-banner-description"},Mr("strong",r.currentState.label),Mr("br"),this.localize(so.key(r.currentState.label),r.currentState.requestedBy.name,r.currentState.requestedOf.name)," ",Mr("time",{title:Ys(r.currentState.createdTime),dateTime:r.currentState.createdTime},Js(r.currentState.createdTime))),this._getReviewActions(r))));case 16:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return n.apply(this,arguments)})},{key:"_getReviewActions",value:function(e){var t,n=this,r=Mr("ol",{className:"mt-review-banner-actions"});return e.rules.canAccept&&e.rules.canNeedsEdits&&(r.appendChild(Mr("li",{className:"mt-review-banner-action"},Hr({className:"mt-review-banner-action-needs-edits",onclick:function(t){t.preventDefault(),n.callEvent("onupdate",{reviewId:e.id,label:un.states.editsRequested,flag:"needs-edits"})}},this.localize("Page.ReviewBanner.label.request-edits")))),r.appendChild(Mr("li",{className:"mt-review-banner-action"},Hr({className:"mt-review-banner-action-accept",onclick:function(t){t.preventDefault(),n.callEvent("onupdate",{reviewId:e.id,label:un.states.accepted,flag:"accepted"})}},this.localize("Page.ReviewBanner.label.accept"))))),e.rules.canRequestReview&&r.appendChild(Mr("li",{className:"mt-review-banner-action"},Hr({className:"mt-review-banner-action-request-review",onclick:function(t){t.preventDefault(),n.callEvent("onupdate",{reviewId:e.id,label:un.states.reviewRequested,flag:"request-review"})}},this.localize("Page.ReviewBanner.label.request-review")))),e.rules.canReassign&&r.appendChild(Mr("li",{className:"mt-review-banner-action"},Hr({className:"mt-review-banner-action-reassign",onclick:function(t){t.preventDefault(),n.callEvent("onupdate",{reviewId:e.id,flag:"reassign"})}},this.localize("Page.ReviewBanner.label.reassign")))),e.rules.canPickup&&r.appendChild(Mr("li",{className:"mt-review-banner-action"},Hr({className:"mt-review-banner-action-assign-to-me",onclick:function(t){t.preventDefault(),n.callEvent("onupdate",{reviewId:e.id,flag:"assign-to-me",user:{name:n._userName,id:n._userId}})}},this.localize("Page.ReviewBanner.label.assign-to-me")))),e.rules.canCancel&&r.appendChild(Mr("li",{className:"mt-review-banner-action"},Hr({className:"mt-review-banner-action-cancel",onclick:function(t){t.preventDefault(),n.callEvent("onupdate",{reviewId:e.id,label:un.states.cancelled,flag:"cancel"})}},this.localize("Page.ReviewBanner.label.cancel")))),r.appendChild(Mr("li",{className:"mt-review-banner-action"},Hr({className:"mt-review-banner-action-review-history",onclick:(t=a(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,uo.create({reviewId:e.id,hidden:!1});case 2:return r=t.sent,t.next=5,Zi.create({content:r.element,showSecondaryButton:!1,title:n.localize("Page.ReviewBanner.label.review-history")});case 5:n._dialog=t.sent,n.callEvent("showreviewhistory");case 7:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},this.localize("Page.ReviewBanner.label.review-history")))),r}}]),i}(Yi(ha(Ui(ji)))),mo=function(e){var t,n;function r(e){var t;return s(this,r),(t=f(this,h(r).call(this,e))).initialize({defaults:{},events:["onrequestedofselected","onreset"]}),t}return d(r,e),l(r,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new r(t))._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Page.ReviewWorkflow.label.required","Page.ReviewWorkflow.label.reviewer-group","Page.ReviewWorkflow.label.reviewer-user","Page.ReviewWorkflow.label.reviewer","Page.ReviewWorkflow.title.selected-requested-of-reset","Page.ReviewWorkflow.grant.input.select.filter","Page.ReviewWorkflow.placeholder.user-group"]}},{key:"settingsKeys",get:function(){return["isArticleReviewCommunityMembersEnabled"]}}]),l(r,[{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.callEvent("onreset"),v(this._typeFilters).concat([this._reviewerInput]).forEach((function(e){return e.hidden=!1})),this._autoCompleteResults.hidden=!1,this._selectedReviewer.hidden=!0,this._reviewerInput.value="",e&&this._reviewerInput.focus()}},{key:"setSelectedReviewer",value:function(e){var t=e.type,n=e.name,r=e.hideReset,i=void 0!==r&&r;this._selectedReviewer.textContent=n,this._selectedReviewer.classList.remove("mt-review-selected-requested-of-user","mt-review-selected-requested-of-group"),this._selectedReviewer.classList.add("mt-review-selected-requested-of-".concat(t)),i&&(this._selectedReviewer.hidden=!0,this.element.querySelector(".mt-review-required").hidden=!0),this._autoCompleteResults.hidden=!0,this._selectedReviewer.hidden=!1,v(this._typeFilters).concat([this._reviewerInput]).forEach((function(e){return e.hidden=!0}))}},{key:"_setAutocompletePlaceholder",value:function(){var e=this,t=[],n=[this.element.querySelector('.mt-review-requested-of-type[name="users"]'),this.element.querySelector('.mt-review-requested-of-type[name="groups"]')];this._reviewerInput.setAttribute("disabled","disabled"),this._reviewerInput.setAttribute("placeholder",this._reviewerInput.dataset.selectFilter),n.forEach((function(n){n.checked&&(e._reviewerInput.removeAttribute("disabled"),t.push(n.parentElement.textContent.trim()))})),!1===this._reviewerInput.disabled&&(this._reviewerInput.setAttribute("placeholder",t.join(" & ")),this._reviewerInput.setAttribute("aria-label",t.join(" & ")))}},{key:"_createUi",value:function(){var e,t,n=this,r="mt-review-requested-of-input";this.element=Mr("fieldset",{className:"mt-review-requested-of"},Yr({htmlFor:r,className:"mt-review-form-label"},this.localize("Page.ReviewWorkflow.label.reviewer")," ",Kr({className:"mt-review-required"},"(".concat(this.localize("Page.ReviewWorkflow.label.required"),")"))),this._typeFilters=[Yr({className:"mt-review-requested-of-type-label mt-review-requested-of-type-label-first"},e=Jr({className:"mt-review-requested-of-type",defaultChecked:!0,name:"users",onclick:function(){return n._setAutocompletePlaceholder()},type:"checkbox"}),io("user",this.localize),this.localize("Page.ReviewWorkflow.label.reviewer-user")),Yr({className:"mt-review-requested-of-type-label"},t=Jr({className:"mt-review-requested-of-type",defaultChecked:!0,name:"groups",onclick:function(){return n._setAutocompletePlaceholder()},type:"checkbox"}),io("group",this.localize),this.localize("Page.ReviewWorkflow.label.reviewer-group"))],this._reviewerInput=Jr({type:"text",id:r,autocomplete:"off",autofocus:!0,dataset:{selectFilter:this.localize("Page.ReviewWorkflow.grant.input.select.filter")},placeholder:this.localize("Page.ReviewWorkflow.placeholder.user-group")}),this._autoCompleteResults=Wr({className:"mt-review-requested-of-results"}),this._selectedReviewer=Vr({className:"mt-review-selected-requested-of-reset",onclick:function(e){e.preventDefault(),n.reset(!0)},title:this.localize("Page.ReviewWorkflow.title.selected-requested-of-reset"),hidden:!0})),this._setUpAutocomplete(e,t)}},{key:"_setUpAutocomplete",value:(n=a(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ma.create({inputElement:this._reviewerInput,dataProvider:this._autocompleteDataProvider(t,n),parentElement:this._autoCompleteResults,onitemselected:function(e){r.callEvent("onrequestedofselected",{id:e.detail.id,type:e.detail.type,name:e.detail.label}),r.setSelectedReviewer({type:e.detail.type,name:e.detail.label})}});case 2:this._autocomplete=e.sent,this._autocomplete.itemsTemplate=this._autocompleteItemsTemplate;case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_autocompleteItemsTemplate",value:function(e){var t=this;return Gr({className:"mt-review-requested-of-list ui-menu"},e.map((function(e){return Qr({onmousedown:function(e){return t.itemSelected(e)},dataset:e,className:"ui-menu-item"},e.label||e.value)})))}},{key:"_autocompleteDataProvider",value:function(e,t){var n=this;return function(r){var i=[],a=[];if(e.checked){var s=new On(n.martianSettings),o={active:!0,format:"autocomplete",fullname:r,username:r};n.getSetting("isArticleReviewCommunityMembersEnabled")||(o.seated=!0);var l=s.searchUsers(o);a.push(l)}if(t.checked){var c=new Pt(n.martianSettings).getGroupList({nameFilter:r,limit:"all"});a.push(c)}return Promise.all(a).then((function(e){return e.forEach((function(e){e.users&&i.push.apply(i,v(e.users.map((function(e){return n._formatUserForAutoComplete(e)})))),e.groups&&i.push.apply(i,v(e.groups.map((function(e){return n._formatGroupForAutoComplete(e)}))))})),i}))}}},{key:"_formatUserForAutoComplete",value:function(e){var t=e.username;return e.fullname!==e.username&&""!==e.fullname&&(t+=" (".concat(e.fullname,")")),{value:e.username,label:Or(io("user",this.localize),t),type:"user",id:e.id}}},{key:"_formatGroupForAutoComplete",value:function(e){return{id:e.id,label:Or(io("group",this.localize),e.groupName),type:"group",value:e.groupName}}}]),r}(Yi(ha(Ui(ji)))),fo=function(e){var t,n,r,i;function o(e){var t;return s(this,o),(t=f(this,h(o).call(this,e))).initialize({defaults:{},events:["onsuccess","onerror","onsubmit","onrequestedofselected"]}),t._pageId=parseInt(t.getSetting("pageId"),10),t._isDraftRequest=t.getSetting("isDraftRequest"),t._reviewApi=new un(t.martianSettings),t}return d(o,e),l(o,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Page.ReviewWorkflow.button.cancel-create-review","Page.ReviewWorkflow.error.type-user-or-group","Page.ReviewWorkflow.label.date","Page.ReviewWorkflow.label.reassign","Page.ReviewWorkflow.label.review-comments","Page.ReviewWorkflow.label.section.entire-document","Page.ReviewWorkflow.label.section.no-headings","Page.ReviewWorkflow.label.section.remove","Page.ReviewWorkflow.label.section.table-of-contents","Page.ReviewWorkflow.label.section.select","Page.ReviewWorkflow.label.status","System.API.Error.article-review-user-forbidden"].concat(v(mo.resourceKeys))}},{key:"settingsKeys",get:function(){return["pageId","isDraftRequest"]}}]),l(o,[{key:"submitReview",value:(i=a(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={requestedOf:this._requestedOf.value.trim().length>0?parseInt(this._requestedOf.value,10):null,requestedOfType:this._requestedOf.dataset.type,comment:this._comment.value,draft:this._isDraftRequest,pageSection:this._selectedSection},n="create",void 0!==this.options.reviewId?(n="update",t.reviewId=this.options.reviewId,void 0!==this.options.label&&(t.label=this.options.label)):t.id=this._pageId,e.prev=3,e.next=6,this._reviewApi[n](t);case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),403===e.t0.status?(r={status:403,message:"Forbidden",info:{message:this.localize("System.API.Error.article-review-user-forbidden")}},this.callEvent("onerror",r)):("Page.ReviewWorkflow.error.user-or-group-must-be-provided"===e.t0.message&&(e.t0.message=this.localize("Page.ReviewWorkflow.error.type-user-or-group")),this.callEvent("onerror",e.t0)),e.abrupt("return");case 12:return this.callEvent("onsuccess",{id:t.requestedOf,type:t.requestedOfType,name:this._requestedOf.dataset.name,label:this.options.label}),e.next=15,this.element.reset();case 15:case"end":return e.stop()}}),e,this,[[3,8]])}))),function(){return i.apply(this,arguments)})},{key:"_setRequestedOf",value:function(e){var t=e.id,n=e.name,r=e.type;this._requestedOf.value=t,this._requestedOf.dataset.name=n,this._requestedOf.dataset.type=r}},{key:"_createUi",value:(r=a(regeneratorRuntime.mark((function e(){var t,n,r,i,s,o,l,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.options.reviewId){e.next=12;break}return e.prev=1,e.next=4,this._reviewApi.getInfo(this.options.reviewId);case 4:i=e.sent,n=i.states.find((function(e){return e.id===i.currentStateId})),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),this.callEvent("onerror",e.t0),e.abrupt("return");case 12:return s=new Ht(this._pageId,this.martianSettings),this._isDraftRequest&&(s=new Ue(this._pageId,this.martianSettings)),e.t1=this,e.next=17,s.getTableOfContents();case 17:return e.t2=e.sent,o=e.t1._parseTOC.call(e.t1,e.t2),n&&(l=n.label,"assign-to-me"===this.options.flag&&(l+="-> ".concat(this.localize("Page.ReviewWorkflow.label.reassign")),r={type:"user",name:this.options.user.name,id:this.options.user.id,hideReset:!0}),"reassign"===this.options.flag&&(l+="-> ".concat(this.localize("Page.ReviewWorkflow.label.reassign"))),void 0!==this.options.label&&(l+="-> ".concat(this.options.label),r={type:n.requestedBy.type,name:n.requestedBy.name,hideReset:!0})),e.t3=Mr,e.t4={className:"mt-review-form",onsubmit:function(e){e.preventDefault(),c.submitReview()},onreset:function(){var e=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:e.sent.reset();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},e.t5=n&&Or(Yr({className:"mt-review-form-label"},"".concat(this.localize("Page.ReviewWorkflow.label.date"),": ")),Mr("time",{title:Ys(n.createdTime),dateTime:n.createdTime},Js(n.createdTime)),Mr("br"),Yr({className:"mt-review-form-label"},"".concat(this.localize("Page.ReviewWorkflow.label.status"),": ")),Kr({className:"mt-review-form-state"},l),Mr("br")),e.t6=t=Br(mo,{onreset:function(){c._requestedOf.value=null,delete c._requestedOf.dataset.name,delete c._requestedOf.dataset.type},onrequestedofselected:function(e){c._setRequestedOf(e.detail),c._comment&&c._comment.focus(),c.callEvent("onrequestedofselected")}}),e.next=26,this._tableOfContentsDom(o);case 26:if(e.t7=e.sent,e.t8=ao(this.options.flag)&&Yr(this.localize("Page.ReviewWorkflow.label.review-comments")),e.t9=this._comment=ao(this.options.flag)&&Mr("textarea",{className:"mt-review-form-textarea",rows:4,autofocus:!0}),e.t10=this._requestedOf=Jr({type:"hidden",name:"requestedOf"}),this.element=(0,e.t3)("form",e.t4,e.t5,e.t6,e.t7,e.t8,e.t9,e.t10),!r){e.next=37;break}return e.next=34,t;case 34:e.t11=r,e.sent.setSelectedReviewer(e.t11),"assign-to-me"===this.options.flag&&this._setRequestedOf({id:this.options.user.id,name:this.options.user.name,type:"user"});case 37:this.addEvent("onsubmit",(function(){c.submitReview()}));case 38:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return r.apply(this,arguments)})},{key:"_parseTOC",value:function(e){var t,n=new DOMParser;try{t=n.parseFromString(e,"text/html")}catch(e){}return t.body.querySelector("ol")}},{key:"_tableOfContentsDom",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="mt-review-form-section-selection",r=Or(Yr({className:"mt-review-form-label"},"".concat(this.localize("Page.ReviewWorkflow.label.section.select"),": ")),this._selectedSectionElm=Kr({className:"mt-review-form-selected-section"})),null!==t){e.next=6;break}r.appendChild($r({className:"".concat(n," mt-review-form-section-selection-no-headings")},this.localize("Page.ReviewWorkflow.label.section.no-headings"))),e.next=12;break;case 6:return e.next=8,ea.create({collapsed:!0,content:t,toggleTitle:this.localize("Page.ReviewWorkflow.label.section.table-of-contents")});case 8:this._collapsibleSection=e.sent,this._collapsibleSection.element.classList.add(n),this._collapsibleSection.element.addEventListener("click",(function(e){e.target.hasAttribute&&e.target.hasAttribute("href")&&(e.preventDefault(),i._setSelection({urlFragment:e.target.getAttribute("href"),title:e.target.innerText}),i._collapsibleSection.close())})),r.appendChild(this._collapsibleSection.element);case 12:return this._setSelection({}),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_setSelection",value:function(e){var t=this,n=e.urlFragment,r=void 0===n?null:n,i=e.title;"string"==typeof r&&0===r.indexOf("#")&&(r=r.slice(1)),this._selectedSection=r,li(this._selectedSectionElm);var a=!1,s=Or(this.localize("Page.ReviewWorkflow.label.section.entire-document"));null!==r&&(a=!0,s=Vr({className:"mt-review-form-selected-section-reset",title:this.localize("Page.ReviewWorkflow.label.section.remove"),type:"button",onclick:function(){t._setSelection({})}},i)),this._selectedSectionElm.appendChild(s),this._collapsibleSection&&this._collapsibleSection.element&&(this._collapsibleSection.element.hidden=a)}}]),o}(Yi(ha(Ui(ji)))),po=function(e){var t,n,r,i,o;function c(e){var t;return s(this,c),(t=f(this,h(c).call(this,e))).initialize({defaults:{},events:["onupdate"]}),t._pageId=t.getSetting("pageId"),t._userIsAdmin=t.getSetting("userIsAdmin"),t._reviewApi=new un(t.martianSettings),t._userId=t.getSetting("userId"),t._userName=t.getSetting("userName"),t}return d(c,e),l(c,null,[{key:"create",value:(t=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new c(t),e.next=3,n._fetchDependencies();case 3:return e.next=5,n._createUi();case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Page.ReviewWorkflow.button.cancel","Page.ReviewWorkflow.label.accept","Page.ReviewWorkflow.label.date","Page.ReviewWorkflow.label.no-open-reviews","Page.ReviewWorkflow.label.reassign","Page.ReviewWorkflow.label.request-edits","Page.ReviewWorkflow.label.request-review","Page.ReviewWorkflow.label.select-action","Page.ReviewWorkflow.label.status","Page.ReviewWorkflow.table.actions","Page.ReviewWorkflow.label.assign-to-me","Page.ReviewWorkflow.table.requested-by","Page.ReviewWorkflow.table.requested-of","Page.ReviewWorkflow.table.review-history"].concat(v(mo.resourceKeys),v(uo.resourceKeys))}},{key:"settingsKeys",get:function(){return["pageId","userIsAdmin","userId","userName","isDraftRequest"]}}]),l(c,[{key:"updateUiFromStateTransition",value:(o=a(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==un.states.cancelled&&n!==un.states.accepted){e.next=4;break}this._reviews=this._reviews.filter((function(e){return e.id!==t})),e.next=6;break;case 4:return e.next=6,this._fetchDependencies();case 6:this._createUi();case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"_getState",value:function(e){switch(e){case"cancel":return un.states.cancelled;case"request-review":return un.states.reviewRequested;case"accepted":return un.states.accepted;case"needs-edits":return un.states.editsRequested}}},{key:"_fetchDependencies",value:(i=a(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSetting("isDraftRequest")?"listForDraft":"listForPage",e.next=3,new un(this.martianSettings)[t](this._pageId);case 3:this._reviews=e.sent;case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_createUi",value:(r=a(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$r(this.localize("Page.ReviewWorkflow.label.no-open-reviews")),this.element||(this.element=Wr(t)),!(this._reviews.length<1)){e.next=5;break}return this.element.replaceChild(t,this.element.children[0]),e.abrupt("return");case 5:return n=[ti(this.localize("Page.ReviewWorkflow.label.date")),ti(this.localize("Page.ReviewWorkflow.table.requested-by")),ti(this.localize("Page.ReviewWorkflow.table.requested-of")),ti(this.localize("Page.ReviewWorkflow.label.status")),ti(this.localize("Page.ReviewWorkflow.table.actions")),ti(this.localize("Page.ReviewWorkflow.table.review-history"))],e.t0=this.element,e.t1=Xr,e.t2={width:"100%"},e.t3=Mr("thead",Zr(n)),e.t4=Mr,e.next=13,Promise.all(this._reviews.map((function(e){return r._reviewElm(e)})));case 13:e.t5=e.sent,e.t6=(0,e.t4)("tbody",e.t5),e.t7=(0,e.t1)(e.t2,e.t3,e.t6),e.t8=this.element.children[0],e.t0.replaceChild.call(e.t0,e.t7,e.t8);case 18:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_reviewElm",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.states.find((function(e){return e.id===t.currentStateId})),r=Or(),e.next=4,uo.create({reviewId:t.id});case 4:return i=e.sent,a=Mr("select",{className:"mt-select-review-options",onchange:function(e){Array.from(s.element.querySelectorAll(".mt-review-row-selected")).forEach((function(e){e.classList.remove("mt-review-row-selected")})),e.target.closest("tr").classList.add("mt-review-row-selected");var n=s._getState(e.target.value);s.callEvent("onupdate",{reviewId:t.id,label:n,flag:e.target.value,user:{name:s._userName,id:s._userId}})}}),t.rules.canAccept&&t.rules.canNeedsEdits&&(a.appendChild(Mr("option",{value:"needs-edits",selected:"needs-edits"===this.options.flag},this.localize("Page.ReviewWorkflow.label.request-edits"))),a.appendChild(Mr("option",{value:"accepted",selected:"accepted"===this.options.flag},this.localize("Page.ReviewWorkflow.label.accept")))),t.rules.canRequestReview&&a.appendChild(Mr("option",{value:"request-review",selected:"request-review"===this.options.flag},this.localize("Page.ReviewWorkflow.label.request-review"))),(this._userIsAdmin||t.rules.canReassign)&&a.appendChild(Mr("option",{value:"reassign",selected:"reassign"===this.options.flag},this.localize("Page.ReviewWorkflow.label.reassign"))),(this._userIsAdmin||t.rules.canPickup)&&a.appendChild(Mr("option",{value:"assign-to-me",selected:"assign-to-me"===this.options.flag},this.localize("Page.ReviewWorkflow.label.assign-to-me"))),(this._userIsAdmin||t.rules.canCancel)&&a.appendChild(Mr("option",{value:"cancel",selected:"cancel"===this.options.flag},this.localize("Page.ReviewWorkflow.button.cancel"))),a.hasChildNodes()&&(a.appendChild(Mr("option",{value:"select",selected:!this.options.flag},this.localize("Page.ReviewWorkflow.label.select-action"))),r.appendChild(a)),e.abrupt("return",Or(Zr({dataset:{reviewId:t.id}},ei({title:Ys(n.createdTime)},Js(n.createdTime)),ei(n.requestedBy.name),ei(io(n.requestedOf.type,this.localize),n.requestedOf.name),ei(n.label),ei(r),ei({className:"mt-review-history"},i.toggleButtonElement)),i.element));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),c}(Yi(ha(Ui(ji)))),go={dialog:null,_alertDialogTmpl:function(e){var t=e.title,n=e.message,r=e.okButton;return Wr({className:"mt-dialog-root",dataset:{title:t}},Wr({className:"mt-scrolling-dialog-content"},Wr({className:"mt-dialog-alert mt-dialog-content"},$r(n))),Wr({className:"mt-dialog-button-container"},Wr({className:"ui-dialog-buttonset"},Vr({id:"mt-dialog-alert-ok",type:"button",className:"ui-button ui-button-primary ui-widget ui-state-default ui-corner-all ui-button-text-only",role:"button"},Kr({className:"ui-button-text"},r)))))},show:function(e){var t=this,n=this._alertDialogTmpl(e);this.dialog=$("<div></div>").modal({content:n,width:450,modal:!0,title:e.title,naming:"alert",resizable:!1,dialogClass:"mt-dialog",load:function(){t.init()}})},init:function(){var e=this;$("#mt-dialog-alert-ok").on("click",(function(){e.dialog.remove()}))}},vo={markedAsRead:function(){tr().at("layout","feature-banner","status.json").post("","").then((function(){$(".mt-new-features-container").slideUp(800),$("#mt-new-features-bar").remove()}))}};$((function(){$(document).on("click",".mt-new-features-close",vo.markedAsRead)}));var yo,bo=["Page.FeedbackRating.label.last-rated","Page.FeedbackRating.message.contact.yes","Page.FeedbackRating.message.contact.no","Page.FeedbackRating.message.submit.success","Page.FeedbackRating.message.submit.error"],wo=!1,_o={buttonClick:function(e,t){var n=e.hasClass("mt-selected");!0!==t||n||this.showFeedback(),this.elements.allButtons.removeClass("mt-selected"),n||e.addClass("mt-selected")},showFeedback:function(){var e=window.scrollY||document.documentElement.scrollTop,t=$(".mt-feedback-rating-container").offset().top;this.elements.feedbackForm.show(),e<t&&window.innerHeight+e<t+this.elements.feedbackForm.outerHeight()&&($("body, html").animate({scrollTop:t},100),this.elements.feedbackTextArea.focus())},getLocalStorageRatings:function(){var e=wr.fetch("mt-page-ratings")||null,t={};return null!==e&&(t=JSON.parse(e)),t},updateRatingUi:function(e){this.currentRating=e,0===e?this.buttonClick(this.elements.noButton):e>0&&this.buttonClick(this.elements.yesButton)},getRating:function(){var e=this;if(this.ratingInfo.useLocalStorage){var t=this.getLocalStorageRatings();if(this.ratingInfo.ratingKey in t){var n=window.parseInt(t[this.ratingInfo.ratingKey],10);this.updateRatingUi(n)}}else{new Ht(Xn.get("pageId"),jr).getRating().then((function(t){t.userRatedBy&&(e.updateRatingUi(t.userRatedBy.score),e.setRatedDate(t.userRatedBy.date))}),(function(){}))}},rate:function(e){var t=this;if(new Ht(Xn.get("pageId"),jr).rate(e,this.currentRating).then((function(){t.currentRating=e,null===e?t.elements.lastRating.empty():t.ratingInfo.useLocalStorage||t.setRatedDate(new Date)})),this.ratingInfo.useLocalStorage){var n=this.getLocalStorageRatings();""===e?delete n[this.ratingInfo.ratingKey]:n[this.ratingInfo.ratingKey]=e,wr.store("mt-page-ratings",JSON.stringify(n)),this.currentRating=e}},setRatedDate:function(e){this.elements.lastRating.text(yo("Page.FeedbackRating.label.last-rated",Ys(e)))},submitFeedback:function(){var e=$(".mt-feedback-consent-checkbox").prop("checked"),t=_o.elements.feedbackTextArea.val().trim(),n=_o.elements.feedbackForm.data(),r=n.userEmail,i=n.pageTitle,a=n.siteUrl,s=n.path.split("/").map(encodeURIComponent).join("/");if(""!==t&&!wo){var o={target:"mt-feedback-flash-message"};wo=!0,new Gn(jr).submitFeedback({_path:s,userEmail:r,pageTitle:i,siteUrl:a,content:t,contactAllowed:yo(e?"Page.FeedbackRating.message.contact.yes":"Page.FeedbackRating.message.contact.no")}).then((function(){wo=!1,_o.elements.feedbackForm.hide(),_o.elements.feedbackTextArea.val(""),_o.elements.feedbackSubmit.addClass("mt-disabled"),yi.Flash(yo("Page.FeedbackRating.message.submit.success"),"success",o)})).catch((function(){wo=!1,yi.Flash(yo("Page.FeedbackRating.message.submit.error"),"error",o),_o.elements.feedbackSubmit.one("click",_o.submitFeedback)}))}}};$((function(){var e=$(".mt-feedback-rating-container");if(0!==e.length&&(yo=xi("mt-localizations-feedback-rating",bo),!Xn.get("isDraftRequest")&&!e.is(":empty"))){var t=Xn.get("pageId");if(void 0===t||0===t)return;_o.ratingInfo={ratingKey:"".concat(t,":").concat(e.data("pageRevision")),useLocalStorage:e.data("useLocalStorage")},_o.currentRating=null,_o.elements={yesButton:$(".mt-rating-button-yes"),noButton:$(".mt-rating-button-no"),allButtons:$(".mt-feedback-rating-button"),lastRating:$(".mt-last-rating-date"),feedbackForm:$(".mt-feedback-form"),feedbackTextArea:$(".mt-feedback-improve-description"),feedbackSubmit:$(".mt-feedback-submit")},_o.elements.yesButton.on("click keypress",(function(){var e=_o.elements.yesButton.hasClass("mt-selected")?null:1;_o.rate(e),_o.buttonClick(_o.elements.yesButton,!0),_o.elements.yesButton.blur()})),_o.elements.noButton.on("click keypress",(function(){var e=_o.elements.noButton.hasClass("mt-selected")?null:0;_o.rate(e),_o.buttonClick(_o.elements.noButton,!0),_o.elements.noButton.blur()})),$(".mt-feedback-button").on("click keypress",(function(){yi.EmptyFlash("success"),_o.showFeedback()})),_o.elements.feedbackSubmit.on("click",_o.submitFeedback),_o.elements.feedbackTextArea.on("keyup",(function(){""===_o.elements.feedbackTextArea.val().trim()?_o.elements.feedbackSubmit.addClass("mt-disabled"):_o.elements.feedbackSubmit.removeClass("mt-disabled")})),_o.getRating()}})),$.widget("mt.inputRedirect",{options:{url:"/",key:"query",params:{},label:"Query",placeholder:"Search",button:null,buttontext:"Search",val:"",beforeCreate:null,afterCreate:null,beforeRefresh:null,afterRefresh:null,beforeDestroy:null,afterDestroy:null},_create:function(){this._trigger("beforeCreate");var e=this;if(e.options=wr.extendObject(e.options,e.element.data()),e.element.is("input"))e.$input=e.element,e.$form=e.$input.wrap("<form></form>").parent(),e.$element=e.$form.wrap("<div></div>").parent();else{if(!e.element.is("div"))throw new Error("ERROR: This inputRedirect widget can only be constructed on an <div> or <input> element.");e.element.empty(),e.$element=e.element,e.$input=$(document.createElement("input")),e.$form=$(document.createElement("form")),e.$form.append(e.$input),e.$element.append(e.$form)}e.$input.wrap('<fieldset class="ui-dform-fieldset"><div class="mt-field"></div></fieldset>'),e.$input.parents(".mt-field").prepend($('<label for="mt-inputRedirect-input" class="mt-inputRedirect-label ui-dform-label">'.toLowerCase()+e.options.label+"</label>")),!1!==e.options.button&&(e.options.button?e.$button=$(e.options.button):e.$button=$("<button>").button().html('<span class="ui-button-text">'.concat(e.options.buttontext,"</span>")).addClass("mt-inputRedirect-button".toLowerCase()).appendTo(e.$input.parents(".mt-field"))),e.$element.addClass("mt-inputRedirect".toLowerCase()),e.$form.addClass("ui-dform mt-inputRedirect-form".toLowerCase()).attr("autocomplete","off"),e.$input.addClass("mt-inputRedirect-input ui-dform-input".toLowerCase()).attr("placeholder",e.options.placeholder),e.$input.val(e.$input.attr("value")||e.options.val),e._on(e.$form,{submit:function(t){t.preventDefault(),e.search()}}),e._on(e.$button,{click:function(){e.search()}}),e._trigger("afterCreate")},destroy:function(){var e=this;e._trigger("beforeDestroy"),e.element.is("div")?e.element.removeClass("mt-inputRedirect".toLowerCase()).empty():e.element.is("input")&&(e.element.appendTo(this.$element.parent()),e.$element.remove()),e._trigger("afterDestroy")},search:function(){var e=this,t=e.$input.val().trim();if(""!==t){e.options.params[e.options.key]=t;var n="";Object.keys(e.options.params).length>0&&(n=wr.buildQueryString(e.options.params)),window.location=e.options.url+"?"+n}}});var ko=Object.assign(window.Deki||{},{get loc(){return wr.formatLocalization},Utility:wr,DelayedSearch:ir,Uri:yr,UriHash:bi,WindowHistory:wi,Fonts:_i,Related:_r,Ui:Object.assign(yi,{Events:ri,NewFeatures:vo,Dialog:{Alert:go}}),_mtLib:Object.assign({srcAnalyticsAnalyticsDispatcher:{AnalyticsDispatcher:ga},srcAnalyticsInteractionAnalytics:{InteractionAnalytics:ya},srcAnalyticsPageViewAnalytics:{PageViewAnalytics:_a},srcAnalyticsPageViewConsumptionAnalytics:{PageViewConsumptionAnalytics:Pa},srcAnalyticsPageViewPerformanceAnalytics:{PageViewPerformanceAnalytics:Ca},srcCommunityAppPlug:rr,srcCommunityDekiDelayedSearch:{delayedSearch:ir},srcCommunityDekiRelated:{related:_r},srcCommunityDekiUi:{ui:yi},srcCommunityDekiUriHash:{UriHash:bi},srcCommunityDekiUtility:{utility:wr},srcCommunityDekiWindowHistory:{windowHistory:wi},srcCommunityFonts:{fonts:_i},srcCommunityGuideTabsManager:{GuideTabsManager:la},srcCommunityRevealListing:{revealListing:function(e,t){if(e){t=Object.assign({showCount:5,showSelector:"li",allowCollapse:!0,collapsed:!1},t);var n=Vr({className:"mt-icon-expand-collapse mt-reveal-listing-expand-link",title:t.showAllLabel,onclick:function(i){i.preventDefault(),t.collapsed?(Array.from(e.getElementsByTagName(t.showSelector)).forEach((function(e){return e.removeAttribute("style")})),n.title=t.showLessLabel,n.innerText=t.showLessLabel,t.collapsed=!1):t.allowCollapse&&r()}},t.showAllLabel);e.classList.add("mt-reveal-listing"),e.querySelectorAll(t.showSelector).length>t.showCount+1&&!e.parentNode.querySelector("button.mt-icon-expand-collapse.mt-reveal-listing-expand-link")&&(e.parentNode.appendChild(n),r(),t.collapsed=!0)}function r(){Array.from(e.getElementsByTagName(t.showSelector)).splice(t.showCount).forEach((function(e){return e.style.display="none"})),n.title=t.showAllLabel,n.innerText=t.showAllLabel,t.collapsed=!0}}},srcCommunitySettings:{settings:Xn},srcCommunityUiEvents:ii,srcCommunityUiWidgetEditableText:{editableText:Ta},srcCommunityUiWidgetExpandablelist:{expandableList:Ea},srcCommunityUiWidgetGrid:{grid:Ra},srcCommunityUiWidgetModal:{modal:Ia},srcCommunityUiWidgetTabbedContent:Fa,srcComponentsComponentBase:{ComponentBase:qa},srcComponentsAutocompleteAutocomplete:{Autocomplete:Ma},srcComponentsCollapsibleSectionCollapsibleSection:{CollapsibleSection:ea},srcComponentsDialogDialog:{Dialog:Zi},srcComponentsFileUploaderFileUploader:{FileUploader:Wa},srcComponentsFlashMessageFlashMessage:{FlashMessage:$a,Message:Ga},srcComponentsGenerativeSearchGenerativeSearch:{GenerativeSearch:ts},srcComponentsProgressBarProgressBar:{ProgressBar:Va},srcComponentsTabsGuideTabs:{GuideTabs:ns},srcComponentsKcsWorkflowKcsWorkflow:{KcsWorkflow:Ss},srcComponentsTranslateTranslateBanner:{TranslateBanner:Ws},srcComponentsTranslateTranslateUtils:ia,srcComponentsPageTitleEditorPageTitleEditor:{PageTitleEditor:Ts},srcComponentsSortableSortable:{Sortable:ta},srcComponentsTreeHierarchyTree:{HierarchyTree:cs},srcComponentsNavigationHierarchyNavigation:{HierarchyNavigation:us},srcComponentsYoutubeSearchYoutubeSearch:{YoutubeSearch:Gs},srcComponentsRelatedPagesRelatedPages:{RelatedPages:Es},srcComponentsReviewWorkflowReviewBanner:{ReviewBanner:ho},srcComponentsReviewWorkflowReviewForm:{ReviewForm:fo},srcComponentsReviewWorkflowReviewHistory:{ReviewHistory:uo},srcComponentsReviewWorkflowReviewList:{ReviewList:po},srcComponentsReviewWorkflowReviewSelect:{ReviewSelect:mo},srcComponentsReviewWorkflowReviewHelper:co,srcComponentsSearchSearch:{Search:As},srcComponentsSearchSearchFilters:{SearchFilters:Fs},srcComponentsSearchSearchFiltersSpaceballs2:{SearchFiltersSpaceballs2:Us},srcComponentsSearchSearchLocationNav:{SearchLocationNav:Ms},srcComponentsSearchSearchUrl:{SearchUrl:qs},srcComponentsSearchSearchRedirect:{SearchRedirect:Bs},srcComponentsSearchSearchRedirectWidget:{SearchRedirectWidget:Hs},srcComponentsSearchResultsSearchResults:{SearchResults:xs},srcControllersSearch:{searchController:Qs},srcIntegrationsAnalyticsAnalyticsConnector:{AnalyticsConnector:no},srcIntegrationsDekiDekiIntegration:{DekiIntegration:ro},srcLibEnvironmentSettings:Xi,srcLibLocalizer:Bi,srcLibMartianSettingsManager:ma,srcLibMartianSettings:Ar,srcUiDateTimeUtility:Zs,srcUiDomBuilder:ni,srcUiDomEventFactory:{DomEventFactory:eo},srcUiDomTools:vi,srcUiLocalization:Ri,srcUiSpinner:oi,srcUiStringUtility:vr,srcUiUri:{Uri:yr},srcStandaloneUiSignInTabs:{signInTabsInit:function(e){if("querySelector"in e){var t=e.querySelector("#mt-login-form");t&&t.addEventListener("submit",(function(){ai(t)}));var n=e.querySelectorAll(".login-password-register ul.ui-tabs-nav > li");n.forEach((function(e){e.addEventListener("click",(function(t){t.preventDefault(),a(e)})),e.addEventListener("keydown",(function(t){"Enter"===t.code&&a(e)}))}));var r=new bi(window.location.hash),i=e.querySelector("#widget-".concat(r.getParam("tab")));null===i&&(i=e.querySelector("#widget-login")),a(i)}function a(t){if(null!==t){n.forEach((function(e){e.classList.remove("ui-state-active","ui-tabs-selected")})),t.classList.add("ui-state-active","ui-tabs-selected"),e.querySelectorAll("div.widget-panel").forEach((function(e){e.classList.remove("show","active-panel"),e.classList.add("hide")}));var r=e.querySelector("#".concat(t.id,"-panel"));if(r){r.classList.remove("hide"),r.classList.add("show","active-panel");var i=r.querySelector("#text-username");i&&i.focus()}window.location.hash=(new bi).withParam("tab",hr(t.id,"-")).toHashString()}}}},srcStandaloneUiHomepageNav:{homePageNavInit:function(){var e={rootNav:"elm-header-homepage-nav",openNav:"elm-header-homepage-nav-open",detailedNav:"elm-homepage-nav-detail",selectedPage:"elm-homepage-nav-selected",getSelector:function(e){return".".concat(this[e])}},t=document.querySelector(e.getSelector("rootNav"));if(null!==t){document.querySelector(".elm-homepage-nav-show").addEventListener("click",(function(){document.body.classList.add(e.openNav)})),document.querySelector(".elm-homepage-nav-hide").addEventListener("click",i),ui(".elm-homepage-nav-expand").forEach((function(n){n.addEventListener("click",(function(n){n.preventDefault();var i=n.currentTarget.closest(".elm-homepage-nav-item");document.querySelector(".elm-homepage-nav-list-root").scrollTop=0,r(),i.classList.add(e.selectedPage),t.classList.add(e.detailedNav)}))}));var n=document.querySelector(".elm-homepage-nav-back");null!==n&&n.addEventListener("click",r),document.addEventListener("click",(function(t){null===t.target.closest(e.getSelector("rootNav"))&&i()}))}function r(){t.classList.remove(e.detailedNav),ui(e.getSelector("selectedPage")).forEach((function(t){return t.classList.remove(e.selectedPage)}))}function i(){r(),document.body.classList.remove([e.openNav])}}}},Qn)});["PageId","BaseHref","PageTitle","PageName","PageIsRedirect","PageLanguageCode","FollowRedirects","PathSkin","PathCommon","UserName","UserSystemName","UserIsAnonymous","UserPermissions","PageEditable","PageNamespace","CDNHostname","WebFontConfig","isDraftRequest","isDraftAllowed","isXhrF1WebWidgetEnabled","PageRevision","isSkinResponsive","attachFileMax","moduleMode"].forEach((function(e){var t=e[0].toLowerCase()+e.slice(1);"CDNHostname"===e&&(t="cdnHostname"),ko[e]=Xn.get(t)}));var Po,So=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.maxHeight,i=void 0===r?400:r,a=n.maxWidth,o=void 0===a?500:a;s(this,e),this.triggerClass=t,this.options={maxHeight:i,maxWidth:o},this.imagePreview=document.getElementById("mt-image-preview"),this.drawShell(),this.addTriggers()}return l(e,[{key:"addTriggers",value:function(){document.body.addEventListener("mouseover",this.previewImage.bind(this)),document.body.addEventListener("mouseout",this.stopPreview.bind(this))}},{key:"previewImage",value:function(e){var t=this,n=e.target;if("string"!=typeof n.className||-1!==n.className.indexOf(this.triggerClass)){var r=n.dataset.imgSrc;if(r){var i=document.createElement("img");i.src=r,i.addEventListener("load",(function(){t.imagePreview.appendChild(i),t.imagePreview.className="",t.positionShell(i,n)}))}}}},{key:"stopPreview",value:function(){this.imagePreview.className="mt-hide",this.imagePreview.innerHTML="",this.imagePreview.style.opacity=0}},{key:"drawShell",value:function(){if(!this.imagePreview){var e=document.createElement("div");e.className="mt-hide",e.id="mt-image-preview",document.body.appendChild(e),this.imagePreview=document.getElementById(e.id)}}},{key:"positionShell",value:function(e,t){var n=e.width,r=e.height,i=r/n,a=window.scrollY||window.pageYOffset;n>r&&n>this.options.maxWidth?r=(n=this.options.maxWidth)*i:r>n&&r>this.options.maxHeight&&(i=n/r,n=(r=this.options.maxHeight)*i);var s=t.getBoundingClientRect();e.width=n,e.height=r,this.imagePreview.style.opacity=1,this.imagePreview.style.top=s.top+a-r-10+"px",this.imagePreview.style.left=s.left+"px"}}]),e}(),Co=["Article.Attach.table-description-blank","Article.Attach.table-description-character","Article.Attach.table-description-character-warning","Article.Attach.grid.empty-grid-text","Article.Attach.table-search-text","Article.Attach.table-header-file","Article.Attach.table-file-title","Article.Attach.table-description-button","Article.Attach.table-description-cancel","Article.Attach.menu.move","Article.Attach.menu.attachnew","Article.Attach.menu.delete","Article.Attach.menu.description","Article.Attach.table-header-date","Article.Attach.table-version-link","Article.Attach.table-header-size","Article.Attach.table-header-addedby","Article.Attach.table-header-ignore-on-import","Article.Attach.table-ignore-on-import-status-on","Article.Attach.table-ignore-on-import-status-off","Article.Attach.title.open-in-media-manager"],To=Ei(Co,"Article.Attach"),Eo="mindtouch.import.ignore",xo=["jpg","jpeg","jpe","gif","png"],Ro=!1,jo=Xn.get("userPermissions");jo&&(Ro=jo.includes("CREATE"));var Ao={descriptionCharLimit:500,currentCount:0,extensionList:xo.concat(["sh","txt","doc","zip","pdf","xls","csv","xlsx","xlsm","xltx","xltm","xlsb","xlam","ppt","pps","pptx","pptm","potx","potm","ppam","ppsx","ppsm","doc","rtf","txt","docx","docm","dotx","dotm","fla","swf","tar","rar","gzip","html","htm","shtml","wmv","avi","mov","mpg","mp4","mpeg","dwg","msg","dwf"]),isMediaManagerEnabled:Xn.get("isMediaManagerEnabled"),canCreate:Ro,transIcon:wr.getCacheUrl("/skins/common/icons/icon-trans.gif"),filenameDom:function(e){var t=Kr({className:"icon mt-icon-".concat(e.extension)},Mr("img",{src:e.icon,className:"mt-ext-".concat(e.extension),alt:e.extension}));return e.isImage&&(t.classList.add("mt-image-preview"),t.dataset.imgSrc=e.href),Wr(Wr({className:"file-name-row"},t,Hr({className:"file-name-link",href:e.href,title:e.title,target:"_blank"},e.filename),e.canFileBeAttached&&Wr({className:"file-attachment-actions"},this.isMediaManagerEnabled&&this.canCreate&&Hr({className:"ui-icon mt-icon-book4 file-attachment-action",title:Po(To.titleOpenInMediaManager),href:"/Special:Dashboard/ContentTools/Media?fileId=".concat(e.id)}),e.movable&&Hr({className:"ui-icon ui-icon-transferthick-e-w file-move-button file-attachment-action",title:e.moveMsg,href:"#"}),e.revisionAllowed&&Hr({className:"ui-icon ui-icon-arrowthick-1-n file-revision-launcher file-attachment-action",title:e.uploadMsg,href:"#",dataset:{fileInfo:e.dataAttr,userTz:e.userTz,allowedExtensions:e.extensions}}),e.deleteAllowed&&Hr({className:"ui-icon ui-icon-close file-delete-button file-attachment-action",title:e.deleteMsg,href:"#"}))),Wr({className:"file-row-description"},Kr({className:"file-row-description-display"},e.noDescription?Kr({className:"note"},Po(To.tableDescriptionBlank)):e.displayDescription),e.canFileBeAttached&&Wr({className:"file-description-actions"},Hr({href:"#",className:"ui-icon ui-icon-pencil file-row-description-edit",title:e.descriptionEditMsg})),e.canFileBeAttached&&Wr({className:"file-row-description-editor"},Mr("input",{className:"file-row-description-text"}),Wr({className:"file-row-description-buttons"},Hr({href:"#",className:"ui-button ui-button-primary file-row-description-save"},e.buttonText),Hr({href:"#",className:"ui-button file-row-description-cancel"},e.cancelText),Kr({className:"note file-row-description-charlimit"}," ",e.charLimitText)))))},transformRow:function(e){var t=e.filename,n=hr(t,".").toLowerCase();this.extensionList.includes(n)||(n="unknown");var r=ur(e.description);r=r.substring(0,this.descriptionCharLimit);var i="contents"in e?e.contents.size:e.size;return{id:e.id,filename:t,revision:e.revision,size:i,formattedSize:wr.formatBytes(i),date:e.lastModified||e.date,extension:n,isImage:xo.includes(n),user:"userCreatedBy"in e?cr(e.userCreatedBy.fullname||e.userCreatedBy.username):e.user,uri:"contents"in e?e.contents.href:e.uri,revisions:e.revisions,noDescription:""===r,description:e.description,descriptionText:r,fileIgnoreOnImport:"properties"in e&&e.properties.property.some((function(e){return e.name===Eo}))}},getDescriptionWarning:function(e){var t="",n=this.descriptionCharLimit-e;return n<0?t=Po(To.tableDescriptionCharacterWarning,pr(-1*n,0)):n<=50&&(t=Po(To.tableDescriptionCharacter,pr(n,0))),t},updateCountInfo:function(){},attachRevisionClickListener:function(e,t){var n=t.querySelector(".file-revision-launcher");n&&n.addEventListener("click",(function(){Ao.launchRevisionDialog(e,t)}))},setUpGrid:function(){var e=this;return new Promise((function(t){var n=e,r=Xn.get("isImportExportEnhancementsEnabled"),i={paginate:!1,showInfo:!1,enableSpinner:!0,responsive:Xn.get("isSkinResponsive"),emptyGridText:Po(To.gridEmptyGridText),searchText:Po(To.tableSearchText),dataSource:{_limit:e.options.attachFileMax,getData:function(){var e=Xn.get("pageId");return(Xn.get("isDraftRequest")?new Ue(e,jr):new Ht(e,jr)).getFiles({limit:this._limit}).then((function(e){return e.files}))}},colDefs:[{title:'<span class="mt-datatables-header-title">'.concat(Po(To.tableHeaderFile),"</span>"),class:"file-name all control",width:r&&!Xn.get("isDraftRequest")?"40%":"51%",formatter:function(e){var t=e.description,r=new yr(e.uri);r.addQueryParam("origin","mt-web");var i={buttonText:Po(To.tableDescriptionButton),cancelText:Po(To.tableDescriptionCancel),canFileBeAttached:Xn.get("canFileBeAttached"),charLimitText:n.getDescriptionWarning(t.length),dataAttr:JSON.stringify(e),deleteAllowed:Xn.get("isDraftAllowed")&&Xn.get("isDraftRequest")||!Xn.get("isDraftAllowed")||Xn.get("pageEditable"),deleteMsg:Po(To.menuDelete),description:t,descriptionEditMsg:Po(To.menuDescription),displayDescription:e.descriptionText,extension:e.extension,extensions:JSON.stringify(n.extensionList),filename:e.filename,href:r.toString(),icon:n.transIcon,id:e.id,isImage:e.isImage,movable:!Xn.get("isDraftRequest"),moveMsg:Po(To.menuMove),noDescription:e.noDescription,revisionAllowed:Xn.get("isDraftAllowed")&&Xn.get("isDraftRequest")||!Xn.get("isDraftAllowed")||Xn.get("pageEditable"),title:Po(To.tableFileTitle,e.filename,e.user),uploadMsg:Po(To.menuAttachnew),userTz:n.options.attachFileUserTz};return n.filenameDom(i).outerHTML}},{title:'<span class="mt-datatables-header-title">'.concat(Po(To.tableHeaderDate),"</span>"),class:"file-date min-tablet-l",width:"19%",searchable:!1,formatter:function(e,t){if("display"===t){var r=n._gridWidget.isColumnVisible(1),i=Ys(e.date);return 1!==e.revision&&1!==e.count&&Xn.get("pageEditable")&&r?'<div class="file-revision-wrapper"><a href="#" title="'.concat(Po(To.tableVersionLink),'" class="file-version-link">').concat(i,"</a></div>"):"<div>".concat(i,"</div>")}return e.date.toISOString()}},{title:'<span class="mt-datatables-header-title">'.concat(Po(To.tableHeaderSize),"</span>"),class:"file-size min-desktop",width:r&&!Xn.get("isDraftRequest")?"10%":"12%",searchable:!1,formatter:function(e,t){return"display"===t?e.formattedSize:window.parseInt(e.size,10)}},{title:'<span class="mt-datatables-header-title">'.concat(Po(To.tableHeaderAddedby),"</span>"),class:"file-addedby min-desktop",width:r&&!Xn.get("isDraftRequest")?"15%":"18%",searchable:!1,formatter:function(e){return e.user}}].concat(v(r&&!Xn.get("isDraftRequest")?[{title:'<span class="mt-datatables-header-title">'.concat(Po(To.tableHeaderIgnoreOnImport),"</span>"),class:"file-ignore-on-import min-desktop",width:"16%",searchable:!1,sortable:!1,formatter:function(e){return Wr({className:"mt-toggle-switch-button-label"},Vr({id:"buttonFileIgnoreOnImport"+e.id,className:Ao.checkDisableFileIgnoreOnImport()?"mt-toggle-switch-button":"mt-toggle-switch-button mt-toggle-switch-button-disable","aria-label":Po(To.tableHeaderIgnoreOnImport),"aria-checked":e.fileIgnoreOnImport,role:"switch",disabled:!Ao.checkDisableFileIgnoreOnImport()},Kr({className:Ao.checkDisableFileIgnoreOnImport()?"mt-toggle-switch-button-slider":"mt-toggle-switch-button-slider mt-toggle-switch-button-disable"})),Yr({id:"labelFileIgnoreOnImport"+e.id},e.fileIgnoreOnImport?Po(To.tableIgnoreOnImportStatusOn):Po(To.tableIgnoreOnImportStatusOff))).outerHTML}}]:[]),[{title:"hidden description column",class:"never",width:"0",searchable:!0,visible:!1,formatter:function(e){return e.description}}]),onRowAdd:function(e,t){Ao.attachRevisionClickListener(t.data,t.tr)},onGridDraw:function(){Ao.updateCountInfo()},transformData:function(e){return e&&!Array.isArray(e)&&(e=[e]),0===e.length?[]:e.map((function(e){return Ao.transformRow(e)}))},afterCreate:function(){new So("mt-image-preview"),t()}};e._gridWidget=Ra(i,Ao.$grid)}))},checkDisableFileIgnoreOnImport:function(){return Xn.get("canFileBeAttached")}};$((function(){Ao.$grid=$("#fileAttachTable"),0!==Ao.$grid.length&&0!==Xn.get("pageId")&&(Po=xi("mt-localizations-file-attachments",Co),0===Ao.$grid.length&&$(".dataTables_scrollHeadInner").css("width","100% !important"),Ao.options=Ao.$grid.data(),Ao.gridSetupComplete=Ao.setUpGrid(),$(document).on("click",".mt-toggle-switch-button",(function(){if(Ao.checkDisableFileIgnoreOnImport()){var e=$(this),t=e.attr("id").replace("buttonFileIgnoreOnImport",""),n=document.getElementById("labelFileIgnoreOnImport"+t),r="true"===e.attr("aria-checked"),i=new gt(t,jr);r?i.deleteFileProperty(Eo).then((function(t){"status"in t&&200===t.status&&(e.attr("aria-checked",String(!1)),n.innerHTML=Po(To.tableIgnoreOnImportStatusOff))})).catch((function(){e.attr("aria-checked",String(!0))})):i.postFileProperty(Eo).then((function(t){"@name"in t&&t["@name"]===Eo&&(e.attr("aria-checked",String(!0)),n.innerHTML=Po(To.tableIgnoreOnImportStatusOn))})).catch((function(){e.attr("aria-checked",String(!1))}))}})))})),$((function(){function e(e,t,n){var r=$(e);t.init(n),r.trigger("dialoginit")}$(".feedback-popup-trigger").on("click",(function(t){t.preventDefault();var n=JSON.parse($(this).attr("feedbackparams"))||{};$("<div></div>").modal({width:450,naming:{view:"page_feedback",namespace:"PageFeedback"},load:function(){var t=this;"context"in n||(n.context="generic"),wr.importModule({path:"/@lib/src/standalone/dialog.pageFeedback.js",moduleName:"pageFeedbackDialog"}).then((function(r){e(t,r,n)}))},params:n})})),$(document).on(ri.Rating.NegativeFeedbackLeft,(function(t,n){$("<div></div>").modal({width:450,naming:{view:"page_feedback",namespace:"PageFeedback"},load:function(){var t=this;"context"in n||(n.context="generic"),wr.importModule({path:"/@lib/src/standalone/dialog.pageFeedback.js",moduleName:"pageFeedbackDialog"}).then((function(r){e(t,r,n)}))},params:n})})),$(".page-pdf-export-launcher").on("click",(function(t){t.preventDefault();var n=$(this).attr("href");$("<div></div>").modal({width:425,naming:{view:"pdf_export",namespace:"PagePdfExport"},load:function(){var t=this;wr.importModule({path:"/@lib/src/standalone/dialog.pdfExport.js",moduleName:"pdfExportDialog"}).then((function(r){e(t,r,{uri:n})}))}})}))}));var Io=Object.assign(ko,{Ui:Object.assign(ko.Ui,{FileAttachments:Ao})});window.Deki=Io}();